import{d as Ce,r as ie,a as Ag,b as Mg,h as x,e as oh,i as Rg,f as Ko,t as Ad,g as Tg,j as Ii,k as ya,l as Rt,m as Dg,n as Xn,p as si,q as rn,s as Og,v as Pg,x as Lg,y as ge,z as L,B as sh,C as Eg,D as Vi,E as pe,F as Bg,G as ti,H as zs,I as ho,J as Md,K as be,L as Sr,M as Yn,N as Ng,O as Ig,P as qo,Q as zg,T as Fs,R as Ur,S as Ke,U as wa,V as Rd,W as Fg,X as $g,Y as wl,Z as Jn,_ as Hg,$ as _r,a0 as Ti,a1 as _,a2 as Or,a3 as Td,a4 as Dd,a5 as Od,a6 as Pd,a7 as Wg,a8 as Kt,a9 as Vg,aa as jg,ab as Bo,ac as Ug,ad as _g,ae as Ne,af as Kg,ag as lh,ah as $s,ai as Nr,aj as pr,ak as qg,al as dr,am as ah,an as hh,ao as Ye,ap as Gg,aq as Xg,ar as Ld,as as Yg,at as Jg,au as ft,av as Zg,aw as ch,ax as Ed,ay as xa,az as Go,aA as Bd,aB as Qg,aC as em,aD as tm,aE as gn,aF as dh,aG as im,aH as rm,aI as uh,aJ as Nd,aK as nm,aL as Ki,aM as om,aN as sm,aO as lm,aP as am,aQ as hm,aR as ws,aS as Zn,aT as Id,o as ri,c as xs,aU as Ht,aV as Je,u as ve,aW as cm,aX as dm,aY as zd,aZ as Fd,a_ as um,a$ as fm,b0 as Kr,b1 as pm,b2 as br,b3 as Hs,b4 as gm,b5 as mm,b6 as vm,A as bm,b7 as ym,b8 as wm,b9 as xm}from"./index-72180739.js";function $d(i){return typeof i=="string"?`s-${i}`:`n-${i}`}const km=oh(".v-x-scroll",{overflow:"auto",scrollbarWidth:"none"},[oh("&::-webkit-scrollbar",{width:0,height:0})]),Sm=Ce({name:"XScroll",props:{disabled:Boolean,onScroll:Function},setup(){const i=ie(null);function e(n){!(n.currentTarget.offsetWidth<n.currentTarget.scrollWidth)||n.deltaY===0||(n.currentTarget.scrollLeft+=n.deltaY+n.deltaX,n.preventDefault())}const t=Ag();return km.mount({id:"vueuc/x-scroll",head:!0,anchorMetaName:Mg,ssr:t}),Object.assign({selfRef:i,handleWheel:e},{scrollTo(...n){var o;(o=i.value)===null||o===void 0||o.scrollTo(...n)}})},render(){return x("div",{ref:"selfRef",onScroll:this.onScroll,onWheel:this.disabled?void 0:this.handleWheel,class:"v-x-scroll"},this.$slots)}});var Cm=/\s/;function Am(i){for(var e=i.length;e--&&Cm.test(i.charAt(e)););return e}var Mm=/^\s+/;function Rm(i){return i&&i.slice(0,Am(i)+1).replace(Mm,"")}var fh=0/0,Tm=/^[-+]0x[0-9a-f]+$/i,Dm=/^0b[01]+$/i,Om=/^0o[0-7]+$/i,Pm=parseInt;function ph(i){if(typeof i=="number")return i;if(Rg(i))return fh;if(Ko(i)){var e=typeof i.valueOf=="function"?i.valueOf():i;i=Ko(e)?e+"":e}if(typeof i!="string")return i===0?i:+i;i=Rm(i);var t=Dm.test(i);return t||Om.test(i)?Pm(i.slice(2),t?2:8):Tm.test(i)?fh:+i}function Lm(i,e,t,r){var n=-1,o=i==null?0:i.length;for(r&&o&&(t=i[++n]);++n<o;)t=e(t,i[n],n,i);return t}function Em(i){return function(e){return i==null?void 0:i[e]}}var Bm={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Nm=Em(Bm);const Im=Nm;var zm=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Fm="\\u0300-\\u036f",$m="\\ufe20-\\ufe2f",Hm="\\u20d0-\\u20ff",Wm=Fm+$m+Hm,Vm="["+Wm+"]",jm=RegExp(Vm,"g");function Um(i){return i=Ad(i),i&&i.replace(zm,Im).replace(jm,"")}var _m=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function Km(i){return i.match(_m)||[]}var qm=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function Gm(i){return qm.test(i)}var Hd="\\ud800-\\udfff",Xm="\\u0300-\\u036f",Ym="\\ufe20-\\ufe2f",Jm="\\u20d0-\\u20ff",Zm=Xm+Ym+Jm,Wd="\\u2700-\\u27bf",Vd="a-z\\xdf-\\xf6\\xf8-\\xff",Qm="\\xac\\xb1\\xd7\\xf7",e0="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",t0="\\u2000-\\u206f",i0=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",jd="A-Z\\xc0-\\xd6\\xd8-\\xde",r0="\\ufe0e\\ufe0f",Ud=Qm+e0+t0+i0,_d="['’]",gh="["+Ud+"]",n0="["+Zm+"]",Kd="\\d+",o0="["+Wd+"]",qd="["+Vd+"]",Gd="[^"+Hd+Ud+Kd+Wd+Vd+jd+"]",s0="\\ud83c[\\udffb-\\udfff]",l0="(?:"+n0+"|"+s0+")",a0="[^"+Hd+"]",Xd="(?:\\ud83c[\\udde6-\\uddff]){2}",Yd="[\\ud800-\\udbff][\\udc00-\\udfff]",Lr="["+jd+"]",h0="\\u200d",mh="(?:"+qd+"|"+Gd+")",c0="(?:"+Lr+"|"+Gd+")",vh="(?:"+_d+"(?:d|ll|m|re|s|t|ve))?",bh="(?:"+_d+"(?:D|LL|M|RE|S|T|VE))?",Jd=l0+"?",Zd="["+r0+"]?",d0="(?:"+h0+"(?:"+[a0,Xd,Yd].join("|")+")"+Zd+Jd+")*",u0="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",f0="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",p0=Zd+Jd+d0,g0="(?:"+[o0,Xd,Yd].join("|")+")"+p0,m0=RegExp([Lr+"?"+qd+"+"+vh+"(?="+[gh,Lr,"$"].join("|")+")",c0+"+"+bh+"(?="+[gh,Lr+mh,"$"].join("|")+")",Lr+"?"+mh+"+"+vh,Lr+"+"+bh,f0,u0,Kd,g0].join("|"),"g");function v0(i){return i.match(m0)||[]}function b0(i,e,t){return i=Ad(i),e=t?void 0:e,e===void 0?Gm(i)?v0(i):Km(i):i.match(e)||[]}var y0="['’]",w0=RegExp(y0,"g");function x0(i){return function(e){return Lm(b0(Um(e).replace(w0,"")),i,"")}}var k0=function(){return Tg.Date.now()};const Ws=k0;var S0="Expected a function",C0=Math.max,A0=Math.min;function M0(i,e,t){var r,n,o,s,l,a,h=0,c=!1,d=!1,u=!0;if(typeof i!="function")throw new TypeError(S0);e=ph(e)||0,Ko(t)&&(c=!!t.leading,d="maxWait"in t,o=d?C0(ph(t.maxWait)||0,e):o,u="trailing"in t?!!t.trailing:u);function f(k){var v=r,R=n;return r=n=void 0,h=k,s=i.apply(R,v),s}function g(k){return h=k,l=setTimeout(C,e),c?f(k):s}function y(k){var v=k-a,R=k-h,m=e-v;return d?A0(m,o-R):m}function b(k){var v=k-a,R=k-h;return a===void 0||v>=e||v<0||d&&R>=o}function C(){var k=Ws();if(b(k))return D(k);l=setTimeout(C,y(k))}function D(k){return l=void 0,u&&r?f(k):(r=n=void 0,s)}function T(){l!==void 0&&clearTimeout(l),h=0,r=a=n=l=void 0}function A(){return l===void 0?s:D(Ws())}function S(){var k=Ws(),v=b(k);if(r=arguments,n=this,a=k,v){if(l===void 0)return g(a);if(d)return clearTimeout(l),l=setTimeout(C,e),f(a)}return l===void 0&&(l=setTimeout(C,e)),s}return S.cancel=T,S.flush=A,S}var R0=x0(function(i,e,t){return i+(t?"-":"")+e.toLowerCase()});const T0=R0;var D0="Expected a function";function Vs(i,e,t){var r=!0,n=!0;if(typeof i!="function")throw new TypeError(D0);return Ko(t)&&(r="leading"in t?!!t.leading:r,n="trailing"in t?!!t.trailing:n),M0(i,e,{leading:r,maxWait:e,trailing:n})}const Qd=Ce({name:"Add",render(){return x("svg",{width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},x("path",{d:"M256 112V400M400 256H112",stroke:"currentColor","stroke-width":"32","stroke-linecap":"round","stroke-linejoin":"round"}))}}),O0=Ii("attach",x("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},x("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},x("g",{fill:"currentColor","fill-rule":"nonzero"},x("path",{d:"M3.25735931,8.70710678 L7.85355339,4.1109127 C8.82986412,3.13460197 10.4127766,3.13460197 11.3890873,4.1109127 C12.365398,5.08722343 12.365398,6.67013588 11.3890873,7.64644661 L6.08578644,12.9497475 C5.69526215,13.3402718 5.06209717,13.3402718 4.67157288,12.9497475 C4.28104858,12.5592232 4.28104858,11.9260582 4.67157288,11.5355339 L9.97487373,6.23223305 C10.1701359,6.0369709 10.1701359,5.72038841 9.97487373,5.52512627 C9.77961159,5.32986412 9.4630291,5.32986412 9.26776695,5.52512627 L3.96446609,10.8284271 C3.18341751,11.6094757 3.18341751,12.8758057 3.96446609,13.6568542 C4.74551468,14.4379028 6.01184464,14.4379028 6.79289322,13.6568542 L12.0961941,8.35355339 C13.4630291,6.98671837 13.4630291,4.77064094 12.0961941,3.40380592 C10.7293591,2.0369709 8.51328163,2.0369709 7.14644661,3.40380592 L2.55025253,8 C2.35499039,8.19526215 2.35499039,8.51184464 2.55025253,8.70710678 C2.74551468,8.90236893 3.06209717,8.90236893 3.25735931,8.70710678 Z"}))))),P0=Ii("trash",x("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},x("path",{d:"M432,144,403.33,419.74A32,32,0,0,1,371.55,448H140.46a32,32,0,0,1-31.78-28.26L80,144",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),x("rect",{x:"32",y:"64",width:"448",height:"80",rx:"16",ry:"16",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),x("line",{x1:"312",y1:"240",x2:"200",y2:"352",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),x("line",{x1:"312",y1:"352",x2:"200",y2:"240",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}))),L0=Ii("download",x("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},x("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},x("g",{fill:"currentColor","fill-rule":"nonzero"},x("path",{d:"M3.5,13 L12.5,13 C12.7761424,13 13,13.2238576 13,13.5 C13,13.7454599 12.8231248,13.9496084 12.5898756,13.9919443 L12.5,14 L3.5,14 C3.22385763,14 3,13.7761424 3,13.5 C3,13.2545401 3.17687516,13.0503916 3.41012437,13.0080557 L3.5,13 L12.5,13 L3.5,13 Z M7.91012437,1.00805567 L8,1 C8.24545989,1 8.44960837,1.17687516 8.49194433,1.41012437 L8.5,1.5 L8.5,10.292 L11.1819805,7.6109127 C11.3555469,7.43734635 11.6249713,7.4180612 11.8198394,7.55305725 L11.8890873,7.6109127 C12.0626536,7.78447906 12.0819388,8.05390346 11.9469427,8.2487716 L11.8890873,8.31801948 L8.35355339,11.8535534 C8.17998704,12.0271197 7.91056264,12.0464049 7.7156945,11.9114088 L7.64644661,11.8535534 L4.1109127,8.31801948 C3.91565056,8.12275734 3.91565056,7.80617485 4.1109127,7.6109127 C4.28447906,7.43734635 4.55390346,7.4180612 4.7487716,7.55305725 L4.81801948,7.6109127 L7.5,10.292 L7.5,1.5 C7.5,1.25454011 7.67687516,1.05039163 7.91012437,1.00805567 L8,1 L7.91012437,1.00805567 Z"}))))),E0=Ce({name:"Switcher",render(){return x("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},x("path",{d:"M12 8l10 8l-10 8z"}))}}),B0=Ii("cancel",x("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},x("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},x("g",{fill:"currentColor","fill-rule":"nonzero"},x("path",{d:"M2.58859116,2.7156945 L2.64644661,2.64644661 C2.82001296,2.47288026 3.08943736,2.45359511 3.2843055,2.58859116 L3.35355339,2.64644661 L8,7.293 L12.6464466,2.64644661 C12.8417088,2.45118446 13.1582912,2.45118446 13.3535534,2.64644661 C13.5488155,2.84170876 13.5488155,3.15829124 13.3535534,3.35355339 L8.707,8 L13.3535534,12.6464466 C13.5271197,12.820013 13.5464049,13.0894374 13.4114088,13.2843055 L13.3535534,13.3535534 C13.179987,13.5271197 12.9105626,13.5464049 12.7156945,13.4114088 L12.6464466,13.3535534 L8,8.707 L3.35355339,13.3535534 C3.15829124,13.5488155 2.84170876,13.5488155 2.64644661,13.3535534 C2.45118446,13.1582912 2.45118446,12.8417088 2.64644661,12.6464466 L7.293,8 L2.64644661,3.35355339 C2.47288026,3.17998704 2.45359511,2.91056264 2.58859116,2.7156945 L2.64644661,2.64644661 L2.58859116,2.7156945 Z"}))))),N0=Ii("retry",x("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},x("path",{d:"M320,146s24.36-12-64-12A160,160,0,1,0,416,294",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px;"}),x("polyline",{points:"256 58 336 138 256 218",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}))),I0=Ii("rotateClockwise",x("svg",{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},x("path",{d:"M3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10C17 12.7916 15.3658 15.2026 13 16.3265V14.5C13 14.2239 12.7761 14 12.5 14C12.2239 14 12 14.2239 12 14.5V17.5C12 17.7761 12.2239 18 12.5 18H15.5C15.7761 18 16 17.7761 16 17.5C16 17.2239 15.7761 17 15.5 17H13.8758C16.3346 15.6357 18 13.0128 18 10C18 5.58172 14.4183 2 10 2C5.58172 2 2 5.58172 2 10C2 10.2761 2.22386 10.5 2.5 10.5C2.77614 10.5 3 10.2761 3 10Z",fill:"currentColor"}),x("path",{d:"M10 12C11.1046 12 12 11.1046 12 10C12 8.89543 11.1046 8 10 8C8.89543 8 8 8.89543 8 10C8 11.1046 8.89543 12 10 12ZM10 11C9.44772 11 9 10.5523 9 10C9 9.44772 9.44772 9 10 9C10.5523 9 11 9.44772 11 10C11 10.5523 10.5523 11 10 11Z",fill:"currentColor"}))),z0=Ii("rotateClockwise",x("svg",{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},x("path",{d:"M17 10C17 6.13401 13.866 3 10 3C6.13401 3 3 6.13401 3 10C3 12.7916 4.63419 15.2026 7 16.3265V14.5C7 14.2239 7.22386 14 7.5 14C7.77614 14 8 14.2239 8 14.5V17.5C8 17.7761 7.77614 18 7.5 18H4.5C4.22386 18 4 17.7761 4 17.5C4 17.2239 4.22386 17 4.5 17H6.12422C3.66539 15.6357 2 13.0128 2 10C2 5.58172 5.58172 2 10 2C14.4183 2 18 5.58172 18 10C18 10.2761 17.7761 10.5 17.5 10.5C17.2239 10.5 17 10.2761 17 10Z",fill:"currentColor"}),x("path",{d:"M10 12C8.89543 12 8 11.1046 8 10C8 8.89543 8.89543 8 10 8C11.1046 8 12 8.89543 12 10C12 11.1046 11.1046 12 10 12ZM10 11C10.5523 11 11 10.5523 11 10C11 9.44772 10.5523 9 10 9C9.44772 9 9 9.44772 9 10C9 10.5523 9.44772 11 10 11Z",fill:"currentColor"}))),F0=Ii("zoomIn",x("svg",{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},x("path",{d:"M11.5 8.5C11.5 8.22386 11.2761 8 11 8H9V6C9 5.72386 8.77614 5.5 8.5 5.5C8.22386 5.5 8 5.72386 8 6V8H6C5.72386 8 5.5 8.22386 5.5 8.5C5.5 8.77614 5.72386 9 6 9H8V11C8 11.2761 8.22386 11.5 8.5 11.5C8.77614 11.5 9 11.2761 9 11V9H11C11.2761 9 11.5 8.77614 11.5 8.5Z",fill:"currentColor"}),x("path",{d:"M8.5 3C11.5376 3 14 5.46243 14 8.5C14 9.83879 13.5217 11.0659 12.7266 12.0196L16.8536 16.1464C17.0488 16.3417 17.0488 16.6583 16.8536 16.8536C16.68 17.0271 16.4106 17.0464 16.2157 16.9114L16.1464 16.8536L12.0196 12.7266C11.0659 13.5217 9.83879 14 8.5 14C5.46243 14 3 11.5376 3 8.5C3 5.46243 5.46243 3 8.5 3ZM8.5 4C6.01472 4 4 6.01472 4 8.5C4 10.9853 6.01472 13 8.5 13C10.9853 13 13 10.9853 13 8.5C13 6.01472 10.9853 4 8.5 4Z",fill:"currentColor"}))),$0=Ii("zoomOut",x("svg",{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},x("path",{d:"M11 8C11.2761 8 11.5 8.22386 11.5 8.5C11.5 8.77614 11.2761 9 11 9H6C5.72386 9 5.5 8.77614 5.5 8.5C5.5 8.22386 5.72386 8 6 8H11Z",fill:"currentColor"}),x("path",{d:"M14 8.5C14 5.46243 11.5376 3 8.5 3C5.46243 3 3 5.46243 3 8.5C3 11.5376 5.46243 14 8.5 14C9.83879 14 11.0659 13.5217 12.0196 12.7266L16.1464 16.8536L16.2157 16.9114C16.4106 17.0464 16.68 17.0271 16.8536 16.8536C17.0488 16.6583 17.0488 16.3417 16.8536 16.1464L12.7266 12.0196C13.5217 11.0659 14 9.83879 14 8.5ZM4 8.5C4 6.01472 6.01472 4 8.5 4C10.9853 4 13 6.01472 13 8.5C13 10.9853 10.9853 13 8.5 13C6.01472 13 4 10.9853 4 8.5Z",fill:"currentColor"}))),H0=Ce({name:"ResizeSmall",render(){return x("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},x("g",{fill:"none"},x("path",{d:"M5.5 4A1.5 1.5 0 0 0 4 5.5v1a.5.5 0 0 1-1 0v-1A2.5 2.5 0 0 1 5.5 3h1a.5.5 0 0 1 0 1h-1zM16 5.5A1.5 1.5 0 0 0 14.5 4h-1a.5.5 0 0 1 0-1h1A2.5 2.5 0 0 1 17 5.5v1a.5.5 0 0 1-1 0v-1zm0 9a1.5 1.5 0 0 1-1.5 1.5h-1a.5.5 0 0 0 0 1h1a2.5 2.5 0 0 0 2.5-2.5v-1a.5.5 0 0 0-1 0v1zm-12 0A1.5 1.5 0 0 0 5.5 16h1.25a.5.5 0 0 1 0 1H5.5A2.5 2.5 0 0 1 3 14.5v-1.25a.5.5 0 0 1 1 0v1.25zM8.5 7A1.5 1.5 0 0 0 7 8.5v3A1.5 1.5 0 0 0 8.5 13h3a1.5 1.5 0 0 0 1.5-1.5v-3A1.5 1.5 0 0 0 11.5 7h-3zM8 8.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-3z",fill:"currentColor"})))}}),W0=ya&&"loading"in document.createElement("img"),V0=(i={})=>{var e;const{root:t=null}=i;return{hash:`${i.rootMargin||"0px 0px 0px 0px"}-${Array.isArray(i.threshold)?i.threshold.join(","):(e=i.threshold)!==null&&e!==void 0?e:"0"}`,options:Object.assign(Object.assign({},i),{root:(typeof t=="string"?document.querySelector(t):t)||document.documentElement})}},js=new WeakMap,Us=new WeakMap,_s=new WeakMap,j0=(i,e,t)=>{if(!i)return()=>{};const r=V0(e),{root:n}=r.options;let o;const s=js.get(n);s?o=s:(o=new Map,js.set(n,o));let l,a;o.has(r.hash)?(a=o.get(r.hash),a[1].has(i)||(l=a[0],a[1].add(i),l.observe(i))):(l=new IntersectionObserver(d=>{d.forEach(u=>{if(u.isIntersecting){const f=Us.get(u.target),g=_s.get(u.target);f&&f(),g&&(g.value=!0)}})},r.options),l.observe(i),a=[l,new Set([i])],o.set(r.hash,a));let h=!1;const c=()=>{h||(Us.delete(i),_s.delete(i),h=!0,a[1].has(i)&&(a[0].unobserve(i),a[1].delete(i)),a[1].size<=0&&o.delete(r.hash),o.size||js.delete(n))};return Us.set(i,c),_s.set(i,t),c};function U0(){const i=Rt(Dg,null);return i===null&&Xn("use-dialog","No outer <n-dialog-provider /> founded."),i}const ka=Object.assign(Object.assign({},si.props),{onPreviewPrev:Function,onPreviewNext:Function,showToolbar:{type:Boolean,default:!0},showToolbarTooltip:Boolean}),eu=rn("n-image");var tu=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function l(c){try{h(r.next(c))}catch(d){s(d)}}function a(c){try{h(r.throw(c))}catch(d){s(d)}}function h(c){c.done?o(c.value):n(c.value).then(l,a)}h((r=r.apply(i,e||[])).next())})};const iu=i=>i.includes("image/"),yh=(i="")=>{const e=i.split("/"),r=e[e.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(r)||[""])[0]},wh=/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico)$/i,ru=i=>{if(i.type)return iu(i.type);const e=yh(i.name||"");if(wh.test(e))return!0;const t=i.thumbnailUrl||i.url||"",r=yh(t);return!!(/^data:image\//.test(t)||wh.test(r))};function _0(i){return tu(this,void 0,void 0,function*(){return yield new Promise(e=>{if(!i.type||!iu(i.type)){e("");return}e(window.URL.createObjectURL(i))})})}const K0=ya&&window.FileReader&&window.File;function q0(i){return i.isDirectory}function G0(i){return i.isFile}function X0(i,e){return tu(this,void 0,void 0,function*(){const t=[];let r,n=0;function o(){n++}function s(){n--,n||r(t)}function l(a){a.forEach(h=>{if(h){if(o(),e&&q0(h)){const c=h.createReader();o(),c.readEntries(d=>{l(d),s()},()=>{s()})}else G0(h)&&(o(),h.file(c=>{t.push({file:c,entry:h,source:"dnd"}),s()},()=>{s()}));s()}})}return yield new Promise(a=>{r=a,l(i)}),t})}function Ln(i){const{id:e,name:t,percentage:r,status:n,url:o,file:s,thumbnailUrl:l,type:a,fullPath:h,batchId:c}=i;return{id:e,name:t,percentage:r??null,status:n,url:o??null,file:s??null,thumbnailUrl:l??null,type:a??null,fullPath:h??null,batchId:c??null}}function Y0(i,e,t){return i=i.toLowerCase(),e=e.toLocaleLowerCase(),t=t.toLocaleLowerCase(),t.split(",").map(n=>n.trim()).filter(Boolean).some(n=>{if(n.startsWith(".")){if(i.endsWith(n))return!0}else if(n.includes("/")){const[o,s]=e.split("/"),[l,a]=n.split("/");if((l==="*"||o&&l&&l===o)&&(a==="*"||s&&a&&a===s))return!0}else return!0;return!1})}const nu=(i,e)=>{if(!i)return;const t=document.createElement("a");t.href=i,e!==void 0&&(t.download=e),document.body.appendChild(t),t.click(),document.body.removeChild(t)};function J0(){return{toolbarIconColor:"rgba(255, 255, 255, .9)",toolbarColor:"rgba(0, 0, 0, .35)",toolbarBoxShadow:"none",toolbarBorderRadius:"24px"}}const Z0=Og({name:"Image",common:Pg,peers:{Tooltip:Lg},self:J0}),Q0=x("svg",{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},x("path",{d:"M6 5C5.75454 5 5.55039 5.17688 5.50806 5.41012L5.5 5.5V14.5C5.5 14.7761 5.72386 15 6 15C6.24546 15 6.44961 14.8231 6.49194 14.5899L6.5 14.5V5.5C6.5 5.22386 6.27614 5 6 5ZM13.8536 5.14645C13.68 4.97288 13.4106 4.9536 13.2157 5.08859L13.1464 5.14645L8.64645 9.64645C8.47288 9.82001 8.4536 10.0894 8.58859 10.2843L8.64645 10.3536L13.1464 14.8536C13.3417 15.0488 13.6583 15.0488 13.8536 14.8536C14.0271 14.68 14.0464 14.4106 13.9114 14.2157L13.8536 14.1464L9.70711 10L13.8536 5.85355C14.0488 5.65829 14.0488 5.34171 13.8536 5.14645Z",fill:"currentColor"})),e1=x("svg",{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},x("path",{d:"M13.5 5C13.7455 5 13.9496 5.17688 13.9919 5.41012L14 5.5V14.5C14 14.7761 13.7761 15 13.5 15C13.2545 15 13.0504 14.8231 13.0081 14.5899L13 14.5V5.5C13 5.22386 13.2239 5 13.5 5ZM5.64645 5.14645C5.82001 4.97288 6.08944 4.9536 6.28431 5.08859L6.35355 5.14645L10.8536 9.64645C11.0271 9.82001 11.0464 10.0894 10.9114 10.2843L10.8536 10.3536L6.35355 14.8536C6.15829 15.0488 5.84171 15.0488 5.64645 14.8536C5.47288 14.68 5.4536 14.4106 5.58859 14.2157L5.64645 14.1464L9.79289 10L5.64645 5.85355C5.45118 5.65829 5.45118 5.34171 5.64645 5.14645Z",fill:"currentColor"})),t1=x("svg",{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},x("path",{d:"M4.089 4.216l.057-.07a.5.5 0 0 1 .638-.057l.07.057L10 9.293l5.146-5.147a.5.5 0 0 1 .638-.057l.07.057a.5.5 0 0 1 .057.638l-.057.07L10.707 10l5.147 5.146a.5.5 0 0 1 .057.638l-.057.07a.5.5 0 0 1-.638.057l-.07-.057L10 10.707l-5.146 5.147a.5.5 0 0 1-.638.057l-.07-.057a.5.5 0 0 1-.057-.638l.057-.07L9.293 10L4.146 4.854a.5.5 0 0 1-.057-.638l.057-.07l-.057.07z",fill:"currentColor"})),i1=x("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 1024 1024"},x("path",{fill:"currentColor",d:"M505.7 661a8 8 0 0 0 12.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"})),r1=ge([ge("body >",[L("image-container","position: fixed;")]),L("image-preview-container",`
 position: fixed;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 display: flex;
 `),L("image-preview-overlay",`
 z-index: -1;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 background: rgba(0, 0, 0, .3);
 `,[sh()]),L("image-preview-toolbar",`
 z-index: 1;
 position: absolute;
 left: 50%;
 transform: translateX(-50%);
 border-radius: var(--n-toolbar-border-radius);
 height: 48px;
 bottom: 40px;
 padding: 0 12px;
 background: var(--n-toolbar-color);
 box-shadow: var(--n-toolbar-box-shadow);
 color: var(--n-toolbar-icon-color);
 transition: color .3s var(--n-bezier);
 display: flex;
 align-items: center;
 `,[L("base-icon",`
 padding: 0 8px;
 font-size: 28px;
 cursor: pointer;
 `),sh()]),L("image-preview-wrapper",`
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 display: flex;
 pointer-events: none;
 `,[Eg()]),L("image-preview",`
 user-select: none;
 -webkit-user-select: none;
 pointer-events: all;
 margin: auto;
 max-height: calc(100vh - 32px);
 max-width: calc(100vw - 32px);
 transition: transform .3s var(--n-bezier);
 `),L("image",`
 display: inline-flex;
 max-height: 100%;
 max-width: 100%;
 `,[Vi("preview-disabled",`
 cursor: pointer;
 `),ge("img",`
 border-radius: inherit;
 `)])]),co=32,ou=Ce({name:"ImagePreview",props:Object.assign(Object.assign({},ka),{onNext:Function,onPrev:Function,clsPrefix:{type:String,required:!0}}),setup(i){const e=si("Image","-image",r1,Z0,i,pe(i,"clsPrefix"));let t=null;const r=ie(null),n=ie(null),o=ie(void 0),s=ie(!1),l=ie(!1),{localeRef:a}=Bg("Image");function h(){const{value:ee}=n;if(!t||!ee)return;const{style:ue}=ee,Q=t.getBoundingClientRect(),z=Q.left+Q.width/2,M=Q.top+Q.height/2;ue.transformOrigin=`${z}px ${M}px`}function c(ee){var ue,Q;switch(ee.key){case" ":ee.preventDefault();break;case"ArrowLeft":(ue=i.onPrev)===null||ue===void 0||ue.call(i);break;case"ArrowRight":(Q=i.onNext)===null||Q===void 0||Q.call(i);break;case"Escape":Be();break}}ti(s,ee=>{ee?zs("keydown",document,c):ho("keydown",document,c)}),Md(()=>{ho("keydown",document,c)});let d=0,u=0,f=0,g=0,y=0,b=0,C=0,D=0,T=!1;function A(ee){const{clientX:ue,clientY:Q}=ee;f=ue-d,g=Q-u,$g(we)}function S(ee){const{mouseUpClientX:ue,mouseUpClientY:Q,mouseDownClientX:z,mouseDownClientY:M}=ee,I=z-ue,j=M-Q,de=`vertical${j>0?"Top":"Bottom"}`,me=`horizontal${I>0?"Left":"Right"}`;return{moveVerticalDirection:de,moveHorizontalDirection:me,deltaHorizontal:I,deltaVertical:j}}function k(ee){const{value:ue}=r;if(!ue)return{offsetX:0,offsetY:0};const Q=ue.getBoundingClientRect(),{moveVerticalDirection:z,moveHorizontalDirection:M,deltaHorizontal:I,deltaVertical:j}=ee||{};let de=0,me=0;return Q.width<=window.innerWidth?de=0:Q.left>0?de=(Q.width-window.innerWidth)/2:Q.right<window.innerWidth?de=-(Q.width-window.innerWidth)/2:M==="horizontalRight"?de=Math.min((Q.width-window.innerWidth)/2,y-(I??0)):de=Math.max(-((Q.width-window.innerWidth)/2),y-(I??0)),Q.height<=window.innerHeight?me=0:Q.top>0?me=(Q.height-window.innerHeight)/2:Q.bottom<window.innerHeight?me=-(Q.height-window.innerHeight)/2:z==="verticalBottom"?me=Math.min((Q.height-window.innerHeight)/2,b-(j??0)):me=Math.max(-((Q.height-window.innerHeight)/2),b-(j??0)),{offsetX:de,offsetY:me}}function v(ee){ho("mousemove",document,A),ho("mouseup",document,v);const{clientX:ue,clientY:Q}=ee;T=!1;const z=S({mouseUpClientX:ue,mouseUpClientY:Q,mouseDownClientX:C,mouseDownClientY:D}),M=k(z);f=M.offsetX,g=M.offsetY,we()}const R=Rt(eu,null);function m(ee){var ue,Q;if((Q=(ue=R==null?void 0:R.previewedImgPropsRef.value)===null||ue===void 0?void 0:ue.onMousedown)===null||Q===void 0||Q.call(ue,ee),ee.button!==0)return;const{clientX:z,clientY:M}=ee;T=!0,d=z-f,u=M-g,y=f,b=g,C=z,D=M,we(),zs("mousemove",document,A),zs("mouseup",document,v)}function N(ee){var ue,Q;(Q=(ue=R==null?void 0:R.previewedImgPropsRef.value)===null||ue===void 0?void 0:ue.onDblclick)===null||Q===void 0||Q.call(ue,ee);const z=W();U=U===z?1:z,we()}const V=1.5;let J=0,U=1,re=0;function te(){U=1,J=0}function $(){var ee;te(),re=0,(ee=i.onPrev)===null||ee===void 0||ee.call(i)}function ne(){var ee;te(),re=0,(ee=i.onNext)===null||ee===void 0||ee.call(i)}function X(){re-=90,we()}function Z(){re+=90,we()}function P(){const{value:ee}=r;if(!ee)return 1;const{innerWidth:ue,innerHeight:Q}=window,z=Math.max(1,ee.naturalHeight/(Q-co)),M=Math.max(1,ee.naturalWidth/(ue-co));return Math.max(3,z*2,M*2)}function W(){const{value:ee}=r;if(!ee)return 1;const{innerWidth:ue,innerHeight:Q}=window,z=ee.naturalHeight/(Q-co),M=ee.naturalWidth/(ue-co);return z<1&&M<1?1:Math.max(z,M)}function K(){const ee=P();U<ee&&(J+=1,U=Math.min(ee,Math.pow(V,J)),we())}function fe(){if(U>.5){const ee=U;J-=1,U=Math.max(.5,Math.pow(V,J));const ue=ee-U;we(!1);const Q=k();U+=ue,we(!1),U-=ue,f=Q.offsetX,g=Q.offsetY,we()}}function Ge(){const ee=o.value;ee&&nu(ee,void 0)}function we(ee=!0){var ue;const{value:Q}=r;if(!Q)return;const{style:z}=Q,M=Rd((ue=R==null?void 0:R.previewedImgPropsRef.value)===null||ue===void 0?void 0:ue.style);let I="";if(typeof M=="string")I=M+";";else for(const de in M)I+=`${T0(de)}: ${M[de]};`;const j=`transform-origin: center; transform: translateX(${f}px) translateY(${g}px) rotate(${re}deg) scale(${U});`;T?z.cssText=I+"cursor: grabbing; transition: none;"+j:z.cssText=I+"cursor: grab;"+j+(ee?"":"transition: none;"),ee||Q.offsetHeight}function Be(){s.value=!s.value,l.value=!0}function bt(){U=W(),J=Math.ceil(Math.log(U)/Math.log(V)),f=0,g=0,we()}const Tt={setPreviewSrc:ee=>{o.value=ee},setThumbnailEl:ee=>{t=ee},toggleShow:Be};function nt(ee,ue){if(i.showToolbarTooltip){const{value:Q}=e;return x(Fg,{to:!1,theme:Q.peers.Tooltip,themeOverrides:Q.peerOverrides.Tooltip,keepAliveOnHover:!1},{default:()=>a.value[ue],trigger:()=>ee})}else return ee}const _e=be(()=>{const{common:{cubicBezierEaseInOut:ee},self:{toolbarIconColor:ue,toolbarBorderRadius:Q,toolbarBoxShadow:z,toolbarColor:M}}=e.value;return{"--n-bezier":ee,"--n-toolbar-icon-color":ue,"--n-toolbar-color":M,"--n-toolbar-border-radius":Q,"--n-toolbar-box-shadow":z}}),{inlineThemeDisabled:yt}=Sr(),Xe=yt?Yn("image-preview",void 0,_e,i):void 0;return Object.assign({previewRef:r,previewWrapperRef:n,previewSrc:o,show:s,appear:Ng(),displayed:l,previewedImgProps:R==null?void 0:R.previewedImgPropsRef,handleWheel(ee){ee.preventDefault()},handlePreviewMousedown:m,handlePreviewDblclick:N,syncTransformOrigin:h,handleAfterLeave:()=>{te(),re=0,l.value=!1},handleDragStart:ee=>{var ue,Q;(Q=(ue=R==null?void 0:R.previewedImgPropsRef.value)===null||ue===void 0?void 0:ue.onDragstart)===null||Q===void 0||Q.call(ue,ee),ee.preventDefault()},zoomIn:K,zoomOut:fe,handleDownloadClick:Ge,rotateCounterclockwise:X,rotateClockwise:Z,handleSwitchPrev:$,handleSwitchNext:ne,withTooltip:nt,resizeToOrignalImageSize:bt,cssVars:yt?void 0:_e,themeClass:Xe==null?void 0:Xe.themeClass,onRender:Xe==null?void 0:Xe.onRender},Tt)},render(){var i,e;const{clsPrefix:t}=this;return x(Ur,null,(e=(i=this.$slots).default)===null||e===void 0?void 0:e.call(i),x(Ig,{show:this.show},{default:()=>{var r;return this.show||this.displayed?((r=this.onRender)===null||r===void 0||r.call(this),qo(x("div",{class:[`${t}-image-preview-container`,this.themeClass],style:this.cssVars,onWheel:this.handleWheel},x(Fs,{name:"fade-in-transition",appear:this.appear},{default:()=>this.show?x("div",{class:`${t}-image-preview-overlay`,onClick:this.toggleShow}):null}),this.showToolbar?x(Fs,{name:"fade-in-transition",appear:this.appear},{default:()=>{if(!this.show)return null;const{withTooltip:n}=this;return x("div",{class:`${t}-image-preview-toolbar`},this.onPrev?x(Ur,null,n(x(Ke,{clsPrefix:t,onClick:this.handleSwitchPrev},{default:()=>Q0}),"tipPrevious"),n(x(Ke,{clsPrefix:t,onClick:this.handleSwitchNext},{default:()=>e1}),"tipNext")):null,n(x(Ke,{clsPrefix:t,onClick:this.rotateCounterclockwise},{default:()=>x(z0,null)}),"tipCounterclockwise"),n(x(Ke,{clsPrefix:t,onClick:this.rotateClockwise},{default:()=>x(I0,null)}),"tipClockwise"),n(x(Ke,{clsPrefix:t,onClick:this.resizeToOrignalImageSize},{default:()=>x(H0,null)}),"tipOriginalSize"),n(x(Ke,{clsPrefix:t,onClick:this.zoomOut},{default:()=>x($0,null)}),"tipZoomOut"),n(x(Ke,{clsPrefix:t,onClick:this.zoomIn},{default:()=>x(F0,null)}),"tipZoomIn"),n(x(Ke,{clsPrefix:t,onClick:this.handleDownloadClick},{default:()=>i1}),"tipDownload"),n(x(Ke,{clsPrefix:t,onClick:this.toggleShow},{default:()=>t1}),"tipClose"))}}):null,x(Fs,{name:"fade-in-scale-up-transition",onAfterLeave:this.handleAfterLeave,appear:this.appear,onEnter:this.syncTransformOrigin,onBeforeLeave:this.syncTransformOrigin},{default:()=>{const{previewedImgProps:n={}}=this;return qo(x("div",{class:`${t}-image-preview-wrapper`,ref:"previewWrapperRef"},x("img",Object.assign({},n,{draggable:!1,onMousedown:this.handlePreviewMousedown,onDblclick:this.handlePreviewDblclick,class:[`${t}-image-preview`,n.class],key:this.previewSrc,src:this.previewSrc,ref:"previewRef",onDragstart:this.handleDragStart}))),[[wa,this.show]])}})),[[zg,{enabled:this.show}]])):null}}))}}),su=rn("n-image-group"),n1=ka,o1=Ce({name:"ImageGroup",props:n1,setup(i){let e;const{mergedClsPrefixRef:t}=Sr(i),r=`c${wl()}`,n=Hg(),o=a=>{var h;e=a,(h=l.value)===null||h===void 0||h.setPreviewSrc(a)};function s(a){var h,c;if(!(n!=null&&n.proxy))return;const u=n.proxy.$el.parentElement.querySelectorAll(`[data-group-id=${r}]:not([data-error=true])`);if(!u.length)return;const f=Array.from(u).findIndex(g=>g.dataset.previewSrc===e);~f?o(u[(f+a+u.length)%u.length].dataset.previewSrc):o(u[0].dataset.previewSrc),a===1?(h=i.onPreviewNext)===null||h===void 0||h.call(i):(c=i.onPreviewPrev)===null||c===void 0||c.call(i)}Jn(su,{mergedClsPrefixRef:t,setPreviewSrc:o,setThumbnailEl:a=>{var h;(h=l.value)===null||h===void 0||h.setThumbnailEl(a)},toggleShow:()=>{var a;(a=l.value)===null||a===void 0||a.toggleShow()},groupId:r});const l=ie(null);return{mergedClsPrefix:t,previewInstRef:l,next:()=>{s(1)},prev:()=>{s(-1)}}},render(){return x(ou,{theme:this.theme,themeOverrides:this.themeOverrides,clsPrefix:this.mergedClsPrefix,ref:"previewInstRef",onPrev:this.prev,onNext:this.next,showToolbar:this.showToolbar,showToolbarTooltip:this.showToolbarTooltip},this.$slots)}}),s1=Object.assign({alt:String,height:[String,Number],imgProps:Object,previewedImgProps:Object,lazy:Boolean,intersectionObserverOptions:Object,objectFit:{type:String,default:"fill"},previewSrc:String,fallbackSrc:String,width:[String,Number],src:String,previewDisabled:Boolean,loadDescription:String,onError:Function,onLoad:Function},ka),l1=Ce({name:"Image",props:s1,inheritAttrs:!1,setup(i){const e=ie(null),t=ie(!1),r=ie(null),n=Rt(su,null),{mergedClsPrefixRef:o}=n||Sr(i),s={click:()=>{if(i.previewDisabled||t.value)return;const h=i.previewSrc||i.src;if(n){n.setPreviewSrc(h),n.setThumbnailEl(e.value),n.toggleShow();return}const{value:c}=r;c&&(c.setPreviewSrc(h),c.setThumbnailEl(e.value),c.toggleShow())}},l=ie(!i.lazy);_r(()=>{var h;(h=e.value)===null||h===void 0||h.setAttribute("data-group-id",(n==null?void 0:n.groupId)||"")}),_r(()=>{if(i.lazy&&i.intersectionObserverOptions){let h;const c=Ti(()=>{h==null||h(),h=void 0,h=j0(e.value,i.intersectionObserverOptions,l)});Md(()=>{c(),h==null||h()})}}),Ti(()=>{var h;i.src,(h=i.imgProps)===null||h===void 0||h.src,t.value=!1});const a=ie(!1);return Jn(eu,{previewedImgPropsRef:pe(i,"previewedImgProps")}),Object.assign({mergedClsPrefix:o,groupId:n==null?void 0:n.groupId,previewInstRef:r,imageRef:e,showError:t,shouldStartLoading:l,loaded:a,mergedOnClick:h=>{var c,d;s.click(),(d=(c=i.imgProps)===null||c===void 0?void 0:c.onClick)===null||d===void 0||d.call(c,h)},mergedOnError:h=>{if(!l.value)return;t.value=!0;const{onError:c,imgProps:{onError:d}={}}=i;c==null||c(h),d==null||d(h)},mergedOnLoad:h=>{const{onLoad:c,imgProps:{onLoad:d}={}}=i;c==null||c(h),d==null||d(h),a.value=!0}},s)},render(){var i,e;const{mergedClsPrefix:t,imgProps:r={},loaded:n,$attrs:o,lazy:s}=this,l=(e=(i=this.$slots).placeholder)===null||e===void 0?void 0:e.call(i),a=this.src||r.src,h=x("img",Object.assign(Object.assign({},r),{ref:"imageRef",width:this.width||r.width,height:this.height||r.height,src:this.showError?this.fallbackSrc:s&&this.intersectionObserverOptions?this.shouldStartLoading?a:void 0:a,alt:this.alt||r.alt,"aria-label":this.alt||r.alt,onClick:this.mergedOnClick,onError:this.mergedOnError,onLoad:this.mergedOnLoad,loading:W0&&s&&!this.intersectionObserverOptions?"lazy":"eager",style:[r.style||"",l&&!n?{height:"0",width:"0",visibility:"hidden"}:"",{objectFit:this.objectFit}],"data-error":this.showError,"data-preview-src":this.previewSrc||this.src}));return x("div",Object.assign({},o,{role:"none",class:[o.class,`${t}-image`,(this.previewDisabled||this.showError)&&`${t}-image--preview-disabled`]}),this.groupId?h:x(ou,{theme:this.theme,themeOverrides:this.themeOverrides,clsPrefix:t,ref:"previewInstRef",showToolbar:this.showToolbar,showToolbarTooltip:this.showToolbarTooltip},{default:()=>h}),!n&&l)}}),a1=ge([L("progress",{display:"inline-block"},[L("progress-icon",`
 color: var(--n-icon-color);
 transition: color .3s var(--n-bezier);
 `),_("line",`
 width: 100%;
 display: block;
 `,[L("progress-content",`
 display: flex;
 align-items: center;
 `,[L("progress-graph",{flex:1})]),L("progress-custom-content",{marginLeft:"14px"}),L("progress-icon",`
 width: 30px;
 padding-left: 14px;
 height: var(--n-icon-size-line);
 line-height: var(--n-icon-size-line);
 font-size: var(--n-icon-size-line);
 `,[_("as-text",`
 color: var(--n-text-color-line-outer);
 text-align: center;
 width: 40px;
 font-size: var(--n-font-size);
 padding-left: 4px;
 transition: color .3s var(--n-bezier);
 `)])]),_("circle, dashboard",{width:"120px"},[L("progress-custom-content",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 justify-content: center;
 `),L("progress-text",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 color: inherit;
 font-size: var(--n-font-size-circle);
 color: var(--n-text-color-circle);
 font-weight: var(--n-font-weight-circle);
 transition: color .3s var(--n-bezier);
 white-space: nowrap;
 `),L("progress-icon",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 color: var(--n-icon-color);
 font-size: var(--n-icon-size-circle);
 `)]),_("multiple-circle",`
 width: 200px;
 color: inherit;
 `,[L("progress-text",`
 font-weight: var(--n-font-weight-circle);
 color: var(--n-text-color-circle);
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 justify-content: center;
 transition: color .3s var(--n-bezier);
 `)]),L("progress-content",{position:"relative"}),L("progress-graph",{position:"relative"},[L("progress-graph-circle",[ge("svg",{verticalAlign:"bottom"}),L("progress-graph-circle-fill",`
 stroke: var(--n-fill-color);
 transition:
 opacity .3s var(--n-bezier),
 stroke .3s var(--n-bezier),
 stroke-dasharray .3s var(--n-bezier);
 `,[_("empty",{opacity:0})]),L("progress-graph-circle-rail",`
 transition: stroke .3s var(--n-bezier);
 overflow: hidden;
 stroke: var(--n-rail-color);
 `)]),L("progress-graph-line",[_("indicator-inside",[L("progress-graph-line-rail",`
 height: 16px;
 line-height: 16px;
 border-radius: 10px;
 `,[L("progress-graph-line-fill",`
 height: inherit;
 border-radius: 10px;
 `),L("progress-graph-line-indicator",`
 background: #0000;
 white-space: nowrap;
 text-align: right;
 margin-left: 14px;
 margin-right: 14px;
 height: inherit;
 font-size: 12px;
 color: var(--n-text-color-line-inner);
 transition: color .3s var(--n-bezier);
 `)])]),_("indicator-inside-label",`
 height: 16px;
 display: flex;
 align-items: center;
 `,[L("progress-graph-line-rail",`
 flex: 1;
 transition: background-color .3s var(--n-bezier);
 `),L("progress-graph-line-indicator",`
 background: var(--n-fill-color);
 font-size: 12px;
 transform: translateZ(0);
 display: flex;
 vertical-align: middle;
 height: 16px;
 line-height: 16px;
 padding: 0 10px;
 border-radius: 10px;
 position: absolute;
 white-space: nowrap;
 color: var(--n-text-color-line-inner);
 transition:
 right .2s var(--n-bezier),
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `)]),L("progress-graph-line-rail",`
 position: relative;
 overflow: hidden;
 height: var(--n-rail-height);
 border-radius: 5px;
 background-color: var(--n-rail-color);
 transition: background-color .3s var(--n-bezier);
 `,[L("progress-graph-line-fill",`
 background: var(--n-fill-color);
 position: relative;
 border-radius: 5px;
 height: inherit;
 width: 100%;
 max-width: 0%;
 transition:
 background-color .3s var(--n-bezier),
 max-width .2s var(--n-bezier);
 `,[_("processing",[ge("&::after",`
 content: "";
 background-image: var(--n-line-bg-processing);
 animation: progress-processing-animation 2s var(--n-bezier) infinite;
 `)])])])])])]),ge("@keyframes progress-processing-animation",`
 0% {
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 100%;
 opacity: 1;
 }
 66% {
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 0;
 opacity: 0;
 }
 100% {
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 0;
 opacity: 0;
 }
 `)]),h1={success:x(Td,null),error:x(Dd,null),warning:x(Od,null),info:x(Pd,null)},c1=Ce({name:"ProgressLine",props:{clsPrefix:{type:String,required:!0},percentage:{type:Number,default:0},railColor:String,railStyle:[String,Object],fillColor:String,status:{type:String,required:!0},indicatorPlacement:{type:String,required:!0},indicatorTextColor:String,unit:{type:String,default:"%"},processing:{type:Boolean,required:!0},showIndicator:{type:Boolean,required:!0},height:[String,Number],railBorderRadius:[String,Number],fillBorderRadius:[String,Number]},setup(i,{slots:e}){const t=be(()=>Or(i.height)),r=be(()=>i.railBorderRadius!==void 0?Or(i.railBorderRadius):i.height!==void 0?Or(i.height,{c:.5}):""),n=be(()=>i.fillBorderRadius!==void 0?Or(i.fillBorderRadius):i.railBorderRadius!==void 0?Or(i.railBorderRadius):i.height!==void 0?Or(i.height,{c:.5}):"");return()=>{const{indicatorPlacement:o,railColor:s,railStyle:l,percentage:a,unit:h,indicatorTextColor:c,status:d,showIndicator:u,fillColor:f,processing:g,clsPrefix:y}=i;return x("div",{class:`${y}-progress-content`,role:"none"},x("div",{class:`${y}-progress-graph`,"aria-hidden":!0},x("div",{class:[`${y}-progress-graph-line`,{[`${y}-progress-graph-line--indicator-${o}`]:!0}]},x("div",{class:`${y}-progress-graph-line-rail`,style:[{backgroundColor:s,height:t.value,borderRadius:r.value},l]},x("div",{class:[`${y}-progress-graph-line-fill`,g&&`${y}-progress-graph-line-fill--processing`],style:{maxWidth:`${i.percentage}%`,backgroundColor:f,height:t.value,lineHeight:t.value,borderRadius:n.value}},o==="inside"?x("div",{class:`${y}-progress-graph-line-indicator`,style:{color:c}},e.default?e.default():`${a}${h}`):null)))),u&&o==="outside"?x("div",null,e.default?x("div",{class:`${y}-progress-custom-content`,style:{color:c},role:"none"},e.default()):d==="default"?x("div",{role:"none",class:`${y}-progress-icon ${y}-progress-icon--as-text`,style:{color:c}},a,h):x("div",{class:`${y}-progress-icon`,"aria-hidden":!0},x(Ke,{clsPrefix:y},{default:()=>h1[d]}))):null)}}}),d1={success:x(Td,null),error:x(Dd,null),warning:x(Od,null),info:x(Pd,null)},u1=Ce({name:"ProgressCircle",props:{clsPrefix:{type:String,required:!0},status:{type:String,required:!0},strokeWidth:{type:Number,required:!0},fillColor:String,railColor:String,railStyle:[String,Object],percentage:{type:Number,default:0},offsetDegree:{type:Number,default:0},showIndicator:{type:Boolean,required:!0},indicatorTextColor:String,unit:String,viewBoxWidth:{type:Number,required:!0},gapDegree:{type:Number,required:!0},gapOffsetDegree:{type:Number,default:0}},setup(i,{slots:e}){function t(r,n,o){const{gapDegree:s,viewBoxWidth:l,strokeWidth:a}=i,h=50,c=0,d=h,u=0,f=2*h,g=50+a/2,y=`M ${g},${g} m ${c},${d}
      a ${h},${h} 0 1 1 ${u},${-f}
      a ${h},${h} 0 1 1 ${-u},${f}`,b=Math.PI*2*h,C={stroke:o,strokeDasharray:`${r/100*(b-s)}px ${l*8}px`,strokeDashoffset:`-${s/2}px`,transformOrigin:n?"center":void 0,transform:n?`rotate(${n}deg)`:void 0};return{pathString:y,pathStyle:C}}return()=>{const{fillColor:r,railColor:n,strokeWidth:o,offsetDegree:s,status:l,percentage:a,showIndicator:h,indicatorTextColor:c,unit:d,gapOffsetDegree:u,clsPrefix:f}=i,{pathString:g,pathStyle:y}=t(100,0,n),{pathString:b,pathStyle:C}=t(a,s,r),D=100+o;return x("div",{class:`${f}-progress-content`,role:"none"},x("div",{class:`${f}-progress-graph`,"aria-hidden":!0},x("div",{class:`${f}-progress-graph-circle`,style:{transform:u?`rotate(${u}deg)`:void 0}},x("svg",{viewBox:`0 0 ${D} ${D}`},x("g",null,x("path",{class:`${f}-progress-graph-circle-rail`,d:g,"stroke-width":o,"stroke-linecap":"round",fill:"none",style:y})),x("g",null,x("path",{class:[`${f}-progress-graph-circle-fill`,a===0&&`${f}-progress-graph-circle-fill--empty`],d:b,"stroke-width":o,"stroke-linecap":"round",fill:"none",style:C}))))),h?x("div",null,e.default?x("div",{class:`${f}-progress-custom-content`,role:"none"},e.default()):l!=="default"?x("div",{class:`${f}-progress-icon`,"aria-hidden":!0},x(Ke,{clsPrefix:f},{default:()=>d1[l]})):x("div",{class:`${f}-progress-text`,style:{color:c},role:"none"},x("span",{class:`${f}-progress-text__percentage`},a),x("span",{class:`${f}-progress-text__unit`},d))):null)}}});function xh(i,e,t=100){return`m ${t/2} ${t/2-i} a ${i} ${i} 0 1 1 0 ${2*i} a ${i} ${i} 0 1 1 0 -${2*i}`}const f1=Ce({name:"ProgressMultipleCircle",props:{clsPrefix:{type:String,required:!0},viewBoxWidth:{type:Number,required:!0},percentage:{type:Array,default:[0]},strokeWidth:{type:Number,required:!0},circleGap:{type:Number,required:!0},showIndicator:{type:Boolean,required:!0},fillColor:{type:Array,default:()=>[]},railColor:{type:Array,default:()=>[]},railStyle:{type:Array,default:()=>[]}},setup(i,{slots:e}){const t=be(()=>i.percentage.map((n,o)=>`${Math.PI*n/100*(i.viewBoxWidth/2-i.strokeWidth/2*(1+2*o)-i.circleGap*o)*2}, ${i.viewBoxWidth*8}`));return()=>{const{viewBoxWidth:r,strokeWidth:n,circleGap:o,showIndicator:s,fillColor:l,railColor:a,railStyle:h,percentage:c,clsPrefix:d}=i;return x("div",{class:`${d}-progress-content`,role:"none"},x("div",{class:`${d}-progress-graph`,"aria-hidden":!0},x("div",{class:`${d}-progress-graph-circle`},x("svg",{viewBox:`0 0 ${r} ${r}`},c.map((u,f)=>x("g",{key:f},x("path",{class:`${d}-progress-graph-circle-rail`,d:xh(r/2-n/2*(1+2*f)-o*f,n,r),"stroke-width":n,"stroke-linecap":"round",fill:"none",style:[{strokeDashoffset:0,stroke:a[f]},h[f]]}),x("path",{class:[`${d}-progress-graph-circle-fill`,u===0&&`${d}-progress-graph-circle-fill--empty`],d:xh(r/2-n/2*(1+2*f)-o*f,n,r),"stroke-width":n,"stroke-linecap":"round",fill:"none",style:{strokeDasharray:t.value[f],strokeDashoffset:0,stroke:l[f]}})))))),s&&e.default?x("div",null,x("div",{class:`${d}-progress-text`},e.default())):null)}}}),p1=Object.assign(Object.assign({},si.props),{processing:Boolean,type:{type:String,default:"line"},gapDegree:Number,gapOffsetDegree:Number,status:{type:String,default:"default"},railColor:[String,Array],railStyle:[String,Array],color:[String,Array],viewBoxWidth:{type:Number,default:100},strokeWidth:{type:Number,default:7},percentage:[Number,Array],unit:{type:String,default:"%"},showIndicator:{type:Boolean,default:!0},indicatorPosition:{type:String,default:"outside"},indicatorPlacement:{type:String,default:"outside"},indicatorTextColor:String,circleGap:{type:Number,default:1},height:Number,borderRadius:[String,Number],fillBorderRadius:[String,Number],offsetDegree:Number}),g1=Ce({name:"Progress",props:p1,setup(i){const e=be(()=>i.indicatorPlacement||i.indicatorPosition),t=be(()=>{if(i.gapDegree||i.gapDegree===0)return i.gapDegree;if(i.type==="dashboard")return 75}),{mergedClsPrefixRef:r,inlineThemeDisabled:n}=Sr(i),o=si("Progress","-progress",a1,Wg,i,r),s=be(()=>{const{status:a}=i,{common:{cubicBezierEaseInOut:h},self:{fontSize:c,fontSizeCircle:d,railColor:u,railHeight:f,iconSizeCircle:g,iconSizeLine:y,textColorCircle:b,textColorLineInner:C,textColorLineOuter:D,lineBgProcessing:T,fontWeightCircle:A,[Kt("iconColor",a)]:S,[Kt("fillColor",a)]:k}}=o.value;return{"--n-bezier":h,"--n-fill-color":k,"--n-font-size":c,"--n-font-size-circle":d,"--n-font-weight-circle":A,"--n-icon-color":S,"--n-icon-size-circle":g,"--n-icon-size-line":y,"--n-line-bg-processing":T,"--n-rail-color":u,"--n-rail-height":f,"--n-text-color-circle":b,"--n-text-color-line-inner":C,"--n-text-color-line-outer":D}}),l=n?Yn("progress",be(()=>i.status[0]),s,i):void 0;return{mergedClsPrefix:r,mergedIndicatorPlacement:e,gapDeg:t,cssVars:n?void 0:s,themeClass:l==null?void 0:l.themeClass,onRender:l==null?void 0:l.onRender}},render(){const{type:i,cssVars:e,indicatorTextColor:t,showIndicator:r,status:n,railColor:o,railStyle:s,color:l,percentage:a,viewBoxWidth:h,strokeWidth:c,mergedIndicatorPlacement:d,unit:u,borderRadius:f,fillBorderRadius:g,height:y,processing:b,circleGap:C,mergedClsPrefix:D,gapDeg:T,gapOffsetDegree:A,themeClass:S,$slots:k,onRender:v}=this;return v==null||v(),x("div",{class:[S,`${D}-progress`,`${D}-progress--${i}`,`${D}-progress--${n}`],style:e,"aria-valuemax":100,"aria-valuemin":0,"aria-valuenow":a,role:i==="circle"||i==="line"||i==="dashboard"?"progressbar":"none"},i==="circle"||i==="dashboard"?x(u1,{clsPrefix:D,status:n,showIndicator:r,indicatorTextColor:t,railColor:o,fillColor:l,railStyle:s,offsetDegree:this.offsetDegree,percentage:a,viewBoxWidth:h,strokeWidth:c,gapDegree:T===void 0?i==="dashboard"?75:0:T,gapOffsetDegree:A,unit:u},k):i==="line"?x(c1,{clsPrefix:D,status:n,showIndicator:r,indicatorTextColor:t,railColor:o,fillColor:l,railStyle:s,percentage:a,processing:b,indicatorPlacement:d,unit:u,fillBorderRadius:g,railBorderRadius:f,height:y},k):i==="multiple-circle"?x(f1,{clsPrefix:D,strokeWidth:c,railColor:o,fillColor:l,railStyle:s,viewBoxWidth:h,percentage:a,showIndicator:r,circleGap:C},k):null)}}),m1=Object.assign(Object.assign({},si.props),{trigger:String,xScrollable:Boolean,onScroll:Function,size:Number}),v1=Ce({name:"Scrollbar",props:m1,setup(){const i=ie(null);return Object.assign(Object.assign({},{scrollTo:(...t)=>{var r;(r=i.value)===null||r===void 0||r.scrollTo(t[0],t[1])},scrollBy:(...t)=>{var r;(r=i.value)===null||r===void 0||r.scrollBy(t[0],t[1])}}),{scrollbarInstRef:i})},render(){return x(Vg,Object.assign({ref:"scrollbarInstRef"},this.$props),this.$slots)}}),kh=v1,lu=rn("n-tabs"),b1={tab:[String,Number,Object,Function],name:{type:[String,Number],required:!0},disabled:Boolean,displayDirective:{type:String,default:"if"},closable:{type:Boolean,default:void 0},tabProps:Object,label:[String,Number,Object,Function]},y1=Object.assign({internalLeftPadded:Boolean,internalAddable:Boolean,internalCreatedByPane:Boolean},_g(b1,["displayDirective"])),Xo=Ce({__TAB__:!0,inheritAttrs:!1,name:"Tab",props:y1,setup(i){const{mergedClsPrefixRef:e,valueRef:t,typeRef:r,closableRef:n,tabStyleRef:o,tabChangeIdRef:s,onBeforeLeaveRef:l,triggerRef:a,handleAdd:h,activateTab:c,handleClose:d}=Rt(lu);return{trigger:a,mergedClosable:be(()=>{if(i.internalAddable)return!1;const{closable:u}=i;return u===void 0?n.value:u}),style:o,clsPrefix:e,value:t,type:r,handleClose(u){u.stopPropagation(),!i.disabled&&d(i.name)},activateTab(){if(i.disabled)return;if(i.internalAddable){h();return}const{name:u}=i,f=++s.id;if(u!==t.value){const{value:g}=l;g?Promise.resolve(g(i.name,t.value)).then(y=>{y&&s.id===f&&c(u)}):c(u)}}}},render(){const{internalAddable:i,clsPrefix:e,name:t,disabled:r,label:n,tab:o,value:s,mergedClosable:l,style:a,trigger:h,$slots:{default:c}}=this,d=n??o;return x("div",{class:`${e}-tabs-tab-wrapper`},this.internalLeftPadded?x("div",{class:`${e}-tabs-tab-pad`}):null,x("div",Object.assign({key:t,"data-name":t,"data-disabled":r?!0:void 0},jg({class:[`${e}-tabs-tab`,s===t&&`${e}-tabs-tab--active`,r&&`${e}-tabs-tab--disabled`,l&&`${e}-tabs-tab--closable`,i&&`${e}-tabs-tab--addable`],onClick:h==="click"?this.activateTab:void 0,onMouseenter:h==="hover"?this.activateTab:void 0,style:i?void 0:a},this.internalCreatedByPane?this.tabProps||{}:this.$attrs)),x("span",{class:`${e}-tabs-tab__label`},i?x(Ur,null,x("div",{class:`${e}-tabs-tab__height-placeholder`}," "),x(Ke,{clsPrefix:e},{default:()=>x(Qd,null)})):c?c():typeof d=="object"?d:Bo(d??t)),l&&this.type==="card"?x(Ug,{clsPrefix:e,class:`${e}-tabs-tab__close`,onClick:this.handleClose,disabled:r}):null))}}),w1=L("tabs",`
 box-sizing: border-box;
 width: 100%;
 display: flex;
 flex-direction: column;
 transition:
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
`,[_("segment-type",[L("tabs-rail",[ge("&.transition-disabled","color: red;",[L("tabs-tab",`
 transition: none;
 `)])])]),_("top",[L("tab-pane",`
 padding: var(--n-pane-padding-top) var(--n-pane-padding-right) var(--n-pane-padding-bottom) var(--n-pane-padding-left);
 `)]),_("left",[L("tab-pane",`
 padding: var(--n-pane-padding-right) var(--n-pane-padding-bottom) var(--n-pane-padding-left) var(--n-pane-padding-top);
 `)]),_("left, right",`
 flex-direction: row;
 `,[L("tabs-bar",`
 width: 2px;
 right: 0;
 transition:
 top .2s var(--n-bezier),
 max-height .2s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `),L("tabs-tab",`
 padding: var(--n-tab-padding-vertical); 
 `)]),_("right",`
 flex-direction: row-reverse;
 `,[L("tab-pane",`
 padding: var(--n-pane-padding-left) var(--n-pane-padding-top) var(--n-pane-padding-right) var(--n-pane-padding-bottom);
 `),L("tabs-bar",`
 left: 0;
 `)]),_("bottom",`
 flex-direction: column-reverse;
 justify-content: flex-end;
 `,[L("tab-pane",`
 padding: var(--n-pane-padding-bottom) var(--n-pane-padding-right) var(--n-pane-padding-top) var(--n-pane-padding-left);
 `),L("tabs-bar",`
 top: 0;
 `)]),L("tabs-rail",`
 padding: 3px;
 border-radius: var(--n-tab-border-radius);
 width: 100%;
 background-color: var(--n-color-segment);
 transition: background-color .3s var(--n-bezier);
 display: flex;
 align-items: center;
 `,[L("tabs-tab-wrapper",`
 flex-basis: 0;
 flex-grow: 1;
 display: flex;
 align-items: center;
 justify-content: center;
 `,[L("tabs-tab",`
 overflow: hidden;
 border-radius: var(--n-tab-border-radius);
 width: 100%;
 display: flex;
 align-items: center;
 justify-content: center;
 `,[_("active",`
 font-weight: var(--n-font-weight-strong);
 color: var(--n-tab-text-color-active);
 background-color: var(--n-tab-color-segment);
 box-shadow: 0 1px 3px 0 rgba(0, 0, 0, .08);
 `),ge("&:hover",`
 color: var(--n-tab-text-color-hover);
 `)])])]),_("flex",[L("tabs-nav",{width:"100%"},[L("tabs-wrapper",{width:"100%"},[L("tabs-tab",{marginRight:0})])])]),L("tabs-nav",`
 box-sizing: border-box;
 line-height: 1.5;
 display: flex;
 transition: border-color .3s var(--n-bezier);
 `,[Ne("prefix, suffix",`
 display: flex;
 align-items: center;
 `),Ne("prefix","padding-right: 16px;"),Ne("suffix","padding-left: 16px;")]),_("top, bottom",[L("tabs-nav-scroll-wrapper",[ge("&::before",`
 top: 0;
 bottom: 0;
 left: 0;
 width: 20px;
 `),ge("&::after",`
 top: 0;
 bottom: 0;
 right: 0;
 width: 20px;
 `),_("shadow-start",[ge("&::before",`
 box-shadow: inset 10px 0 8px -8px rgba(0, 0, 0, .12);
 `)]),_("shadow-end",[ge("&::after",`
 box-shadow: inset -10px 0 8px -8px rgba(0, 0, 0, .12);
 `)])])]),_("left, right",[L("tabs-nav-scroll-wrapper",[ge("&::before",`
 top: 0;
 left: 0;
 right: 0;
 height: 20px;
 `),ge("&::after",`
 bottom: 0;
 left: 0;
 right: 0;
 height: 20px;
 `),_("shadow-start",[ge("&::before",`
 box-shadow: inset 0 10px 8px -8px rgba(0, 0, 0, .12);
 `)]),_("shadow-end",[ge("&::after",`
 box-shadow: inset 0 -10px 8px -8px rgba(0, 0, 0, .12);
 `)])])]),L("tabs-nav-scroll-wrapper",`
 flex: 1;
 position: relative;
 overflow: hidden;
 `,[L("tabs-nav-y-scroll",`
 height: 100%;
 width: 100%;
 overflow-y: auto; 
 scrollbar-width: none;
 `,[ge("&::-webkit-scrollbar",`
 width: 0;
 height: 0;
 `)]),ge("&::before, &::after",`
 transition: box-shadow .3s var(--n-bezier);
 pointer-events: none;
 content: "";
 position: absolute;
 z-index: 1;
 `)]),L("tabs-nav-scroll-content",`
 display: flex;
 position: relative;
 min-width: 100%;
 width: fit-content;
 box-sizing: border-box;
 `),L("tabs-wrapper",`
 display: inline-flex;
 flex-wrap: nowrap;
 position: relative;
 `),L("tabs-tab-wrapper",`
 display: flex;
 flex-wrap: nowrap;
 flex-shrink: 0;
 flex-grow: 0;
 `),L("tabs-tab",`
 cursor: pointer;
 white-space: nowrap;
 flex-wrap: nowrap;
 display: inline-flex;
 align-items: center;
 color: var(--n-tab-text-color);
 font-size: var(--n-tab-font-size);
 background-clip: padding-box;
 padding: var(--n-tab-padding);
 transition:
 box-shadow .3s var(--n-bezier),
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[_("disabled",{cursor:"not-allowed"}),Ne("close",`
 margin-left: 6px;
 transition:
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
 `),Ne("label",`
 display: flex;
 align-items: center;
 `)]),L("tabs-bar",`
 position: absolute;
 bottom: 0;
 height: 2px;
 border-radius: 1px;
 background-color: var(--n-bar-color);
 transition:
 left .2s var(--n-bezier),
 max-width .2s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `,[ge("&.transition-disabled",`
 transition: none;
 `),_("disabled",`
 background-color: var(--n-tab-text-color-disabled)
 `)]),L("tabs-pane-wrapper",`
 position: relative;
 overflow: hidden;
 transition: max-height .2s var(--n-bezier);
 `),L("tab-pane",`
 color: var(--n-pane-text-color);
 width: 100%;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 opacity .2s var(--n-bezier);
 left: 0;
 right: 0;
 top: 0;
 `,[ge("&.next-transition-leave-active, &.prev-transition-leave-active, &.next-transition-enter-active, &.prev-transition-enter-active",`
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 transform .2s var(--n-bezier),
 opacity .2s var(--n-bezier);
 `),ge("&.next-transition-leave-active, &.prev-transition-leave-active",`
 position: absolute;
 `),ge("&.next-transition-enter-from, &.prev-transition-leave-to",`
 transform: translateX(32px);
 opacity: 0;
 `),ge("&.next-transition-leave-to, &.prev-transition-enter-from",`
 transform: translateX(-32px);
 opacity: 0;
 `),ge("&.next-transition-leave-from, &.next-transition-enter-to, &.prev-transition-leave-from, &.prev-transition-enter-to",`
 transform: translateX(0);
 opacity: 1;
 `)]),L("tabs-tab-pad",`
 box-sizing: border-box;
 width: var(--n-tab-gap);
 flex-grow: 0;
 flex-shrink: 0;
 `),_("line-type, bar-type",[L("tabs-tab",`
 font-weight: var(--n-tab-font-weight);
 box-sizing: border-box;
 vertical-align: bottom;
 `,[ge("&:hover",{color:"var(--n-tab-text-color-hover)"}),_("active",`
 color: var(--n-tab-text-color-active);
 font-weight: var(--n-tab-font-weight-active);
 `),_("disabled",{color:"var(--n-tab-text-color-disabled)"})])]),L("tabs-nav",[_("line-type",[_("top",[Ne("prefix, suffix",`
 border-bottom: 1px solid var(--n-tab-border-color);
 `),L("tabs-nav-scroll-content",`
 border-bottom: 1px solid var(--n-tab-border-color);
 `),L("tabs-bar",`
 bottom: -1px;
 `)]),_("left",[Ne("prefix, suffix",`
 border-right: 1px solid var(--n-tab-border-color);
 `),L("tabs-nav-scroll-content",`
 border-right: 1px solid var(--n-tab-border-color);
 `),L("tabs-bar",`
 right: -1px;
 `)]),_("right",[Ne("prefix, suffix",`
 border-left: 1px solid var(--n-tab-border-color);
 `),L("tabs-nav-scroll-content",`
 border-left: 1px solid var(--n-tab-border-color);
 `),L("tabs-bar",`
 left: -1px;
 `)]),_("bottom",[Ne("prefix, suffix",`
 border-top: 1px solid var(--n-tab-border-color);
 `),L("tabs-nav-scroll-content",`
 border-top: 1px solid var(--n-tab-border-color);
 `),L("tabs-bar",`
 top: -1px;
 `)]),Ne("prefix, suffix",`
 transition: border-color .3s var(--n-bezier);
 `),L("tabs-nav-scroll-content",`
 transition: border-color .3s var(--n-bezier);
 `),L("tabs-bar",`
 border-radius: 0;
 `)]),_("card-type",[Ne("prefix, suffix",`
 transition: border-color .3s var(--n-bezier);
 border-bottom: 1px solid var(--n-tab-border-color);
 `),L("tabs-pad",`
 flex-grow: 1;
 transition: border-color .3s var(--n-bezier);
 border-bottom: 1px solid var(--n-tab-border-color);
 `),L("tabs-tab-pad",`
 transition: border-color .3s var(--n-bezier);
 `),L("tabs-tab",`
 font-weight: var(--n-tab-font-weight);
 border: 1px solid var(--n-tab-border-color);
 background-color: var(--n-tab-color);
 box-sizing: border-box;
 position: relative;
 vertical-align: bottom;
 display: flex;
 justify-content: space-between;
 font-size: var(--n-tab-font-size);
 color: var(--n-tab-text-color);
 `,[_("addable",`
 padding-left: 8px;
 padding-right: 8px;
 font-size: 16px;
 `,[Ne("height-placeholder",`
 width: 0;
 font-size: var(--n-tab-font-size);
 `),Vi("disabled",[ge("&:hover",`
 color: var(--n-tab-text-color-hover);
 `)])]),_("closable","padding-right: 8px;"),_("active",`
 background-color: #0000;
 font-weight: var(--n-tab-font-weight-active);
 color: var(--n-tab-text-color-active);
 `),_("disabled","color: var(--n-tab-text-color-disabled);")]),L("tabs-scroll-padding","border-bottom: 1px solid var(--n-tab-border-color);")]),_("left, right",[L("tabs-wrapper",`
 flex-direction: column;
 `,[L("tabs-tab-wrapper",`
 flex-direction: column;
 `,[L("tabs-tab-pad",`
 height: var(--n-tab-gap-vertical);
 width: 100%;
 `)])])]),_("top",[_("card-type",[L("tabs-tab",`
 border-top-left-radius: var(--n-tab-border-radius);
 border-top-right-radius: var(--n-tab-border-radius);
 `,[_("active",`
 border-bottom: 1px solid #0000;
 `)]),L("tabs-tab-pad",`
 border-bottom: 1px solid var(--n-tab-border-color);
 `)])]),_("left",[_("card-type",[L("tabs-tab",`
 border-top-left-radius: var(--n-tab-border-radius);
 border-bottom-left-radius: var(--n-tab-border-radius);
 `,[_("active",`
 border-right: 1px solid #0000;
 `)]),L("tabs-tab-pad",`
 border-right: 1px solid var(--n-tab-border-color);
 `)])]),_("right",[_("card-type",[L("tabs-tab",`
 border-top-right-radius: var(--n-tab-border-radius);
 border-bottom-right-radius: var(--n-tab-border-radius);
 `,[_("active",`
 border-left: 1px solid #0000;
 `)]),L("tabs-tab-pad",`
 border-left: 1px solid var(--n-tab-border-color);
 `)])]),_("bottom",[_("card-type",[L("tabs-tab",`
 border-bottom-left-radius: var(--n-tab-border-radius);
 border-bottom-right-radius: var(--n-tab-border-radius);
 `,[_("active",`
 border-top: 1px solid #0000;
 `)]),L("tabs-tab-pad",`
 border-top: 1px solid var(--n-tab-border-color);
 `)])])])]),x1=Object.assign(Object.assign({},si.props),{value:[String,Number],defaultValue:[String,Number],trigger:{type:String,default:"click"},type:{type:String,default:"bar"},closable:Boolean,justifyContent:String,size:{type:String,default:"medium"},placement:{type:String,default:"top"},tabStyle:[String,Object],barWidth:Number,paneClass:String,paneStyle:[String,Object],paneWrapperClass:String,paneWrapperStyle:[String,Object],addable:[Boolean,Object],tabsPadding:{type:Number,default:0},animated:Boolean,onBeforeLeave:Function,onAdd:Function,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onClose:[Function,Array],labelSize:String,activeName:[String,Number],onActiveNameChange:[Function,Array]}),k1=Ce({name:"Tabs",props:x1,setup(i,{slots:e}){var t,r,n,o;const{mergedClsPrefixRef:s,inlineThemeDisabled:l}=Sr(i),a=si("Tabs","-tabs",w1,Kg,i,s),h=ie(null),c=ie(null),d=ie(null),u=ie(null),f=ie(null),g=ie(!0),y=ie(!0),b=lh(i,["labelSize","size"]),C=lh(i,["activeName","value"]),D=ie((r=(t=C.value)!==null&&t!==void 0?t:i.defaultValue)!==null&&r!==void 0?r:e.default?(o=(n=$s(e.default())[0])===null||n===void 0?void 0:n.props)===null||o===void 0?void 0:o.name:null),T=Nr(C,D),A={id:0},S=be(()=>{if(!(!i.justifyContent||i.type==="card"))return{display:"flex",justifyContent:i.justifyContent}});ti(T,()=>{A.id=0,m(),N()});function k(){var z;const{value:M}=T;return M===null?null:(z=h.value)===null||z===void 0?void 0:z.querySelector(`[data-name="${M}"]`)}function v(z){if(i.type==="card")return;const{value:M}=c;if(M&&z){const I=`${s.value}-tabs-bar--disabled`,{barWidth:j,placement:de}=i;if(z.dataset.disabled==="true"?M.classList.add(I):M.classList.remove(I),["top","bottom"].includes(de)){if(R(["top","maxHeight","height"]),typeof j=="number"&&z.offsetWidth>=j){const me=Math.floor((z.offsetWidth-j)/2)+z.offsetLeft;M.style.left=`${me}px`,M.style.maxWidth=`${j}px`}else M.style.left=`${z.offsetLeft}px`,M.style.maxWidth=`${z.offsetWidth}px`;M.style.width="8192px",M.offsetWidth}else{if(R(["left","maxWidth","width"]),typeof j=="number"&&z.offsetHeight>=j){const me=Math.floor((z.offsetHeight-j)/2)+z.offsetTop;M.style.top=`${me}px`,M.style.maxHeight=`${j}px`}else M.style.top=`${z.offsetTop}px`,M.style.maxHeight=`${z.offsetHeight}px`;M.style.height="8192px",M.offsetHeight}}}function R(z){const{value:M}=c;if(M)for(const I of z)M.style[I]=""}function m(){if(i.type==="card")return;const z=k();z&&v(z)}function N(z){var M;const I=(M=f.value)===null||M===void 0?void 0:M.$el;if(!I)return;const j=k();if(!j)return;const{scrollLeft:de,offsetWidth:me}=I,{offsetLeft:Se,offsetWidth:Re}=j;de>Se?I.scrollTo({top:0,left:Se,behavior:"smooth"}):Se+Re>de+me&&I.scrollTo({top:0,left:Se+Re-me,behavior:"smooth"})}const V=ie(null);let J=0,U=null;function re(z){const M=V.value;if(M){J=z.getBoundingClientRect().height;const I=`${J}px`,j=()=>{M.style.height=I,M.style.maxHeight=I};U?(j(),U(),U=null):U=j}}function te(z){const M=V.value;if(M){const I=z.getBoundingClientRect().height,j=()=>{document.body.offsetHeight,M.style.maxHeight=`${I}px`,M.style.height=`${Math.max(J,I)}px`};U?(U(),U=null,j()):U=j}}function $(){const z=V.value;if(z){z.style.maxHeight="",z.style.height="";const{paneWrapperStyle:M}=i;if(typeof M=="string")z.style.cssText=M;else if(M){const{maxHeight:I,height:j}=M;I!==void 0&&(z.style.maxHeight=I),j!==void 0&&(z.style.height=j)}}}const ne={value:[]},X=ie("next");function Z(z){const M=T.value;let I="next";for(const j of ne.value){if(j===M)break;if(j===z){I="prev";break}}X.value=I,P(z)}function P(z){const{onActiveNameChange:M,onUpdateValue:I,"onUpdate:value":j}=i;M&&Ye(M,z),I&&Ye(I,z),j&&Ye(j,z),D.value=z}function W(z){const{onClose:M}=i;M&&Ye(M,z)}function K(){const{value:z}=c;if(!z)return;const M="transition-disabled";z.classList.add(M),m(),z.classList.remove(M)}let fe=0;function Ge(z){var M;if(z.contentRect.width===0&&z.contentRect.height===0||fe===z.contentRect.width)return;fe=z.contentRect.width;const{type:I}=i;(I==="line"||I==="bar")&&K(),I!=="segment"&&_e((M=f.value)===null||M===void 0?void 0:M.$el)}const we=Vs(Ge,64);ti([()=>i.justifyContent,()=>i.size],()=>{pr(()=>{const{type:z}=i;(z==="line"||z==="bar")&&K()})});const Be=ie(!1);function bt(z){var M;const{target:I,contentRect:{width:j}}=z,de=I.parentElement.offsetWidth;if(!Be.value)de<j&&(Be.value=!0);else{const{value:me}=u;if(!me)return;de-j>me.$el.offsetWidth&&(Be.value=!1)}_e((M=f.value)===null||M===void 0?void 0:M.$el)}const Tt=Vs(bt,64);function nt(){const{onAdd:z}=i;z&&z(),pr(()=>{const M=k(),{value:I}=f;!M||!I||I.scrollTo({left:M.offsetLeft,top:0,behavior:"smooth"})})}function _e(z){if(!z)return;const{placement:M}=i;if(M==="top"||M==="bottom"){const{scrollLeft:I,scrollWidth:j,offsetWidth:de}=z;g.value=I<=0,y.value=I+de>=j}else{const{scrollTop:I,scrollHeight:j,offsetHeight:de}=z;g.value=I<=0,y.value=I+de>=j}}const yt=Vs(z=>{_e(z.target)},64);Jn(lu,{triggerRef:pe(i,"trigger"),tabStyleRef:pe(i,"tabStyle"),paneClassRef:pe(i,"paneClass"),paneStyleRef:pe(i,"paneStyle"),mergedClsPrefixRef:s,typeRef:pe(i,"type"),closableRef:pe(i,"closable"),valueRef:T,tabChangeIdRef:A,onBeforeLeaveRef:pe(i,"onBeforeLeave"),activateTab:Z,handleClose:W,handleAdd:nt}),qg(()=>{m(),N()}),Ti(()=>{const{value:z}=d;if(!z)return;const{value:M}=s,I=`${M}-tabs-nav-scroll-wrapper--shadow-start`,j=`${M}-tabs-nav-scroll-wrapper--shadow-end`;g.value?z.classList.remove(I):z.classList.add(I),y.value?z.classList.remove(j):z.classList.add(j)});const Xe=ie(null);ti(T,()=>{if(i.type==="segment"){const z=Xe.value;z&&pr(()=>{z.classList.add("transition-disabled"),z.offsetWidth,z.classList.remove("transition-disabled")})}});const ee={syncBarPosition:()=>{m()}},ue=be(()=>{const{value:z}=b,{type:M}=i,I={card:"Card",bar:"Bar",line:"Line",segment:"Segment"}[M],j=`${z}${I}`,{self:{barColor:de,closeIconColor:me,closeIconColorHover:Se,closeIconColorPressed:Re,tabColor:ke,tabBorderColor:wt,paneTextColor:jt,tabFontWeight:ai,tabBorderRadius:an,tabFontWeightActive:Ar,colorSegment:hn,fontWeightStrong:Te,tabColorSegment:cn,closeSize:Qt,closeIconSize:Mi,closeColorHover:It,closeColorPressed:hi,closeBorderRadius:Fi,[Kt("panePadding",z)]:ut,[Kt("tabPadding",j)]:Mr,[Kt("tabPaddingVertical",j)]:ci,[Kt("tabGap",j)]:dn,[Kt("tabGap",`${j}Vertical`)]:sr,[Kt("tabTextColor",M)]:xt,[Kt("tabTextColorActive",M)]:Rr,[Kt("tabTextColorHover",M)]:un,[Kt("tabTextColorDisabled",M)]:Ut,[Kt("tabFontSize",z)]:Tr},common:{cubicBezierEaseInOut:Dr}}=a.value;return{"--n-bezier":Dr,"--n-color-segment":hn,"--n-bar-color":de,"--n-tab-font-size":Tr,"--n-tab-text-color":xt,"--n-tab-text-color-active":Rr,"--n-tab-text-color-disabled":Ut,"--n-tab-text-color-hover":un,"--n-pane-text-color":jt,"--n-tab-border-color":wt,"--n-tab-border-radius":an,"--n-close-size":Qt,"--n-close-icon-size":Mi,"--n-close-color-hover":It,"--n-close-color-pressed":hi,"--n-close-border-radius":Fi,"--n-close-icon-color":me,"--n-close-icon-color-hover":Se,"--n-close-icon-color-pressed":Re,"--n-tab-color":ke,"--n-tab-font-weight":ai,"--n-tab-font-weight-active":Ar,"--n-tab-padding":Mr,"--n-tab-padding-vertical":ci,"--n-tab-gap":dn,"--n-tab-gap-vertical":sr,"--n-pane-padding-left":dr(ut,"left"),"--n-pane-padding-right":dr(ut,"right"),"--n-pane-padding-top":dr(ut,"top"),"--n-pane-padding-bottom":dr(ut,"bottom"),"--n-font-weight-strong":Te,"--n-tab-color-segment":cn}}),Q=l?Yn("tabs",be(()=>`${b.value[0]}${i.type[0]}`),ue,i):void 0;return Object.assign({mergedClsPrefix:s,mergedValue:T,renderedNames:new Set,tabsRailElRef:Xe,tabsPaneWrapperRef:V,tabsElRef:h,barElRef:c,addTabInstRef:u,xScrollInstRef:f,scrollWrapperElRef:d,addTabFixed:Be,tabWrapperStyle:S,handleNavResize:we,mergedSize:b,handleScroll:yt,handleTabsResize:Tt,cssVars:l?void 0:ue,themeClass:Q==null?void 0:Q.themeClass,animationDirection:X,renderNameListRef:ne,onAnimationBeforeLeave:re,onAnimationEnter:te,onAnimationAfterEnter:$,onRender:Q==null?void 0:Q.onRender},ee)},render(){const{mergedClsPrefix:i,type:e,placement:t,addTabFixed:r,addable:n,mergedSize:o,renderNameListRef:s,onRender:l,paneWrapperClass:a,paneWrapperStyle:h,$slots:{default:c,prefix:d,suffix:u}}=this;l==null||l();const f=c?$s(c()).filter(S=>S.type.__TAB_PANE__===!0):[],g=c?$s(c()).filter(S=>S.type.__TAB__===!0):[],y=!g.length,b=e==="card",C=e==="segment",D=!b&&!C&&this.justifyContent;s.value=[];const T=()=>{const S=x("div",{style:this.tabWrapperStyle,class:[`${i}-tabs-wrapper`]},D?null:x("div",{class:`${i}-tabs-scroll-padding`,style:{width:`${this.tabsPadding}px`}}),y?f.map((k,v)=>(s.value.push(k.props.name),Ks(x(Xo,Object.assign({},k.props,{internalCreatedByPane:!0,internalLeftPadded:v!==0&&(!D||D==="center"||D==="start"||D==="end")}),k.children?{default:k.children.tab}:void 0)))):g.map((k,v)=>(s.value.push(k.props.name),Ks(v!==0&&!D?Ah(k):k))),!r&&n&&b?Ch(n,(y?f.length:g.length)!==0):null,D?null:x("div",{class:`${i}-tabs-scroll-padding`,style:{width:`${this.tabsPadding}px`}}));return x("div",{ref:"tabsElRef",class:`${i}-tabs-nav-scroll-content`},b&&n?x(hh,{onResize:this.handleTabsResize},{default:()=>S}):S,b?x("div",{class:`${i}-tabs-pad`}):null,b?null:x("div",{ref:"barElRef",class:`${i}-tabs-bar`}))},A=C?"top":t;return x("div",{class:[`${i}-tabs`,this.themeClass,`${i}-tabs--${e}-type`,`${i}-tabs--${o}-size`,D&&`${i}-tabs--flex`,`${i}-tabs--${A}`],style:this.cssVars},x("div",{class:[`${i}-tabs-nav--${e}-type`,`${i}-tabs-nav--${A}`,`${i}-tabs-nav`]},ah(d,S=>S&&x("div",{class:`${i}-tabs-nav__prefix`},S)),C?x("div",{class:`${i}-tabs-rail`,ref:"tabsRailElRef"},y?f.map((S,k)=>(s.value.push(S.props.name),x(Xo,Object.assign({},S.props,{internalCreatedByPane:!0,internalLeftPadded:k!==0}),S.children?{default:S.children.tab}:void 0))):g.map((S,k)=>(s.value.push(S.props.name),k===0?S:Ah(S)))):x(hh,{onResize:this.handleNavResize},{default:()=>x("div",{class:`${i}-tabs-nav-scroll-wrapper`,ref:"scrollWrapperElRef"},["top","bottom"].includes(A)?x(Sm,{ref:"xScrollInstRef",onScroll:this.handleScroll},{default:T}):x("div",{class:`${i}-tabs-nav-y-scroll`,onScroll:this.handleScroll},T()))}),r&&n&&b?Ch(n,!0):null,ah(u,S=>S&&x("div",{class:`${i}-tabs-nav__suffix`},S))),y&&(this.animated&&(A==="top"||A==="bottom")?x("div",{ref:"tabsPaneWrapperRef",style:h,class:[`${i}-tabs-pane-wrapper`,a]},Sh(f,this.mergedValue,this.renderedNames,this.onAnimationBeforeLeave,this.onAnimationEnter,this.onAnimationAfterEnter,this.animationDirection)):Sh(f,this.mergedValue,this.renderedNames)))}});function Sh(i,e,t,r,n,o,s){const l=[];return i.forEach(a=>{const{name:h,displayDirective:c,"display-directive":d}=a.props,u=g=>c===g||d===g,f=e===h;if(a.key!==void 0&&(a.key=h),f||u("show")||u("show:lazy")&&t.has(h)){t.has(h)||t.add(h);const g=!u("if");l.push(g?qo(a,[[wa,f]]):a)}}),s?x(Gg,{name:`${s}-transition`,onBeforeLeave:r,onEnter:n,onAfterEnter:o},{default:()=>l}):l}function Ch(i,e){return x(Xo,{ref:"addTabInstRef",key:"__addable",name:"__addable",internalCreatedByPane:!0,internalAddable:!0,internalLeftPadded:e,disabled:typeof i=="object"&&i.disabled})}function Ah(i){const e=Xg(i);return e.props?e.props.internalLeftPadded=!0:e.props={internalLeftPadded:!0},e}function Ks(i){return Array.isArray(i.dynamicProps)?i.dynamicProps.includes("internalLeftPadded")||i.dynamicProps.push("internalLeftPadded"):i.dynamicProps=["internalLeftPadded"],i}const au=rn("n-tree-select"),Qn=rn("n-tree"),S1=Ce({name:"NTreeSwitcher",props:{clsPrefix:{type:String,required:!0},indent:{type:Number,required:!0},expanded:Boolean,selected:Boolean,hide:Boolean,loading:Boolean,onClick:Function,tmNode:{type:Object,required:!0}},setup(i){const{renderSwitcherIconRef:e}=Rt(Qn,null);return()=>{const{clsPrefix:t,expanded:r,hide:n,indent:o,onClick:s}=i;return x("span",{"data-switcher":!0,class:[`${t}-tree-node-switcher`,r&&`${t}-tree-node-switcher--expanded`,n&&`${t}-tree-node-switcher--hide`],style:{width:`${o}px`},onClick:s},x("div",{class:`${t}-tree-node-switcher__icon`},x(Ld,null,{default:()=>{if(i.loading)return x(Yg,{clsPrefix:t,key:"loading",radius:85,strokeWidth:20});const{value:l}=e;return l?l({expanded:i.expanded,selected:i.selected,option:i.tmNode.rawNode}):x(Ke,{clsPrefix:t,key:"switcher"},{default:()=>x(E0,null)})}})))}}}),C1=Ce({name:"NTreeNodeCheckbox",props:{clsPrefix:{type:String,required:!0},indent:{type:Number,required:!0},right:Boolean,focusable:Boolean,disabled:Boolean,checked:Boolean,indeterminate:Boolean,onCheck:Function},setup(i){const e=Rt(Qn);function t(n){const{onCheck:o}=i;o&&o(n)}function r(n){t(n)}return{handleUpdateValue:r,mergedTheme:e.mergedThemeRef}},render(){const{clsPrefix:i,mergedTheme:e,checked:t,indeterminate:r,disabled:n,focusable:o,indent:s,handleUpdateValue:l}=this;return x("span",{class:[`${i}-tree-node-checkbox`,this.right&&`${i}-tree-node-checkbox--right`],style:{width:`${s}px`},"data-checkbox":!0},x(Jg,{focusable:o,disabled:n,theme:e.peers.Checkbox,themeOverrides:e.peerOverrides.Checkbox,checked:t,indeterminate:r,onUpdateChecked:l}))}}),A1=Ce({name:"TreeNodeContent",props:{clsPrefix:{type:String,required:!0},disabled:Boolean,checked:Boolean,selected:Boolean,onClick:Function,onDragstart:Function,tmNode:{type:Object,required:!0},nodeProps:Object},setup(i){const{renderLabelRef:e,renderPrefixRef:t,renderSuffixRef:r,labelFieldRef:n}=Rt(Qn),o=ie(null);function s(a){const{onClick:h}=i;h&&h(a)}function l(a){s(a)}return{selfRef:o,renderLabel:e,renderPrefix:t,renderSuffix:r,labelField:n,handleClick:l}},render(){const{clsPrefix:i,labelField:e,nodeProps:t,checked:r=!1,selected:n=!1,renderLabel:o,renderPrefix:s,renderSuffix:l,handleClick:a,onDragstart:h,tmNode:{rawNode:c,rawNode:{prefix:d,suffix:u,[e]:f}}}=this;return x("span",Object.assign({},t,{ref:"selfRef",class:[`${i}-tree-node-content`,t==null?void 0:t.class],onClick:a,draggable:h===void 0?void 0:!0,onDragstart:h}),s||d?x("div",{class:`${i}-tree-node-content__prefix`},s?s({option:c,selected:n,checked:r}):Bo(d)):null,x("div",{class:`${i}-tree-node-content__text`},o?o({option:c,selected:n,checked:r}):Bo(f)),l||u?x("div",{class:`${i}-tree-node-content__suffix`},l?l({option:c,selected:n,checked:r}):Bo(u)):null)}});function Mh({position:i,offsetLevel:e,indent:t,el:r}){const n={position:"absolute",boxSizing:"border-box",right:0};if(i==="inside")n.left=0,n.top=0,n.bottom=0,n.borderRadius="inherit",n.boxShadow="inset 0 0 0 2px var(--n-drop-mark-color)";else{const o=i==="before"?"top":"bottom";n[o]=0,n.left=`${r.offsetLeft+6-e*t}px`,n.height="2px",n.backgroundColor="var(--n-drop-mark-color)",n.transformOrigin=o,n.borderRadius="1px",n.transform=i==="before"?"translateY(-4px)":"translateY(4px)"}return x("div",{style:n})}function M1({dropPosition:i,node:e}){return e.isLeaf===!1||e.children?!0:i!=="inside"}function R1(i){return be(()=>i.leafOnly?"child":i.checkStrategy)}function Wi(i,e){return!!i.rawNode[e]}function hu(i,e,t,r){i==null||i.forEach(n=>{t(n),hu(n[e],e,t,r),r(n)})}function T1(i,e,t,r,n){const o=new Set,s=new Set,l=[];return hu(i,r,a=>{if(l.push(a),n(e,a)){s.add(a[t]);for(let h=l.length-2;h>=0;--h)if(!o.has(l[h][t]))o.add(l[h][t]);else return}},()=>{l.pop()}),{expandedKeys:Array.from(o),highlightKeySet:s}}if(ya&&Image){const i=new Image;i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}function D1(i,e,t,r,n){const o=new Set,s=new Set,l=new Set,a=[],h=[],c=[];function d(f){f.forEach(g=>{if(c.push(g),e(t,g)){o.add(g[r]),l.add(g[r]);for(let b=c.length-2;b>=0;--b){const C=c[b][r];if(!s.has(C))s.add(C),o.has(C)&&o.delete(C);else break}}const y=g[n];y&&d(y),c.pop()})}d(i);function u(f,g){f.forEach(y=>{const b=y[r],C=o.has(b),D=s.has(b);if(!C&&!D)return;const T=y[n];if(T)if(C)g.push(y);else{a.push(b);const A=Object.assign(Object.assign({},y),{[n]:[]});g.push(A),u(T,A[n])}else g.push(y)})}return u(i,h),{filteredTree:h,highlightKeySet:l,expandedKeys:a}}const O1=Ce({name:"TreeNode",props:{clsPrefix:{type:String,required:!0},tmNode:{type:Object,required:!0}},setup(i){const e=Rt(Qn),{droppingNodeParentRef:t,droppingMouseNodeRef:r,draggingNodeRef:n,droppingPositionRef:o,droppingOffsetLevelRef:s,nodePropsRef:l,indentRef:a,blockLineRef:h,checkboxPlacementRef:c,checkOnClickRef:d,disabledFieldRef:u,showLineRef:f}=e,g=ft(()=>!!i.tmNode.rawNode.checkboxDisabled),y=ft(()=>Wi(i.tmNode,u.value)),b=ft(()=>e.disabledRef.value||y.value),C=be(()=>{const{value:P}=l;if(P)return P({option:i.tmNode.rawNode})}),D=ie(null),T={value:null};_r(()=>{T.value=D.value.$el});function A(){const{tmNode:P}=i;if(!P.isLeaf&&!P.shallowLoaded){if(!e.loadingKeysRef.value.has(P.key))e.loadingKeysRef.value.add(P.key);else return;const{onLoadRef:{value:W}}=e;W&&W(P.rawNode).then(K=>{K!==!1&&e.handleSwitcherClick(P)}).finally(()=>{e.loadingKeysRef.value.delete(P.key)})}else e.handleSwitcherClick(P)}const S=ft(()=>!y.value&&e.selectableRef.value&&(e.internalTreeSelect?e.mergedCheckStrategyRef.value!=="child"||e.multipleRef.value&&e.cascadeRef.value||i.tmNode.isLeaf:!0)),k=ft(()=>e.checkableRef.value&&(e.cascadeRef.value||e.mergedCheckStrategyRef.value!=="child"||i.tmNode.isLeaf)),v=ft(()=>e.displayedCheckedKeysRef.value.includes(i.tmNode.key)),R=ft(()=>{const{value:P}=k;if(!P)return!1;const{value:W}=d,{tmNode:K}=i;return typeof W=="boolean"?!K.disabled&&W:W(i.tmNode.rawNode)});function m(P){const{value:W}=e.expandOnClickRef,{value:K}=S,{value:fe}=R;if(!K&&!W&&!fe||ch(P,"checkbox")||ch(P,"switcher"))return;const{tmNode:Ge}=i;K&&e.handleSelect(Ge),W&&!Ge.isLeaf&&A(),fe&&J(!v.value)}function N(P){var W,K;h.value||(b.value||m(P),(K=(W=C.value)===null||W===void 0?void 0:W.onClick)===null||K===void 0||K.call(W,P))}function V(P){var W,K;h.value&&(b.value||m(P),(K=(W=C.value)===null||W===void 0?void 0:W.onClick)===null||K===void 0||K.call(W,P))}function J(P){e.handleCheck(i.tmNode,P)}function U(P){e.handleDragStart({event:P,node:i.tmNode})}function re(P){P.currentTarget===P.target&&e.handleDragEnter({event:P,node:i.tmNode})}function te(P){P.preventDefault(),e.handleDragOver({event:P,node:i.tmNode})}function $(P){e.handleDragEnd({event:P,node:i.tmNode})}function ne(P){P.currentTarget===P.target&&e.handleDragLeave({event:P,node:i.tmNode})}function X(P){P.preventDefault(),o.value!==null&&e.handleDrop({event:P,node:i.tmNode,dropPosition:o.value})}const Z=be(()=>{const{clsPrefix:P}=i,{value:W}=a;if(f.value){const K=[];let fe=i.tmNode.parent;for(;fe;)fe.isLastChild?K.push(x("div",{class:`${P}-tree-node-indent`},x("div",{style:{width:`${W}px`}}))):K.push(x("div",{class:[`${P}-tree-node-indent`,`${P}-tree-node-indent--show-line`]},x("div",{style:{width:`${W}px`}}))),fe=fe.parent;return K.reverse()}else return Zg(i.tmNode.level,x("div",{class:`${i.clsPrefix}-tree-node-indent`},x("div",{style:{width:`${W}px`}})))});return{showDropMark:ft(()=>{const{value:P}=n;if(!P)return;const{value:W}=o;if(!W)return;const{value:K}=r;if(!K)return;const{tmNode:fe}=i;return fe.key===K.key}),showDropMarkAsParent:ft(()=>{const{value:P}=t;if(!P)return!1;const{tmNode:W}=i,{value:K}=o;return K==="before"||K==="after"?P.key===W.key:!1}),pending:ft(()=>e.pendingNodeKeyRef.value===i.tmNode.key),loading:ft(()=>e.loadingKeysRef.value.has(i.tmNode.key)),highlight:ft(()=>{var P;return(P=e.highlightKeySetRef.value)===null||P===void 0?void 0:P.has(i.tmNode.key)}),checked:v,indeterminate:ft(()=>e.displayedIndeterminateKeysRef.value.includes(i.tmNode.key)),selected:ft(()=>e.mergedSelectedKeysRef.value.includes(i.tmNode.key)),expanded:ft(()=>e.mergedExpandedKeysRef.value.includes(i.tmNode.key)),disabled:b,checkable:k,mergedCheckOnClick:R,checkboxDisabled:g,selectable:S,expandOnClick:e.expandOnClickRef,internalScrollable:e.internalScrollableRef,draggable:e.draggableRef,blockLine:h,nodeProps:C,checkboxFocusable:e.internalCheckboxFocusableRef,droppingPosition:o,droppingOffsetLevel:s,indent:a,checkboxPlacement:c,showLine:f,contentInstRef:D,contentElRef:T,indentNodes:Z,handleCheck:J,handleDrop:X,handleDragStart:U,handleDragEnter:re,handleDragOver:te,handleDragEnd:$,handleDragLeave:ne,handleLineClick:V,handleContentClick:N,handleSwitcherClick:A}},render(){const{tmNode:i,clsPrefix:e,checkable:t,expandOnClick:r,selectable:n,selected:o,checked:s,highlight:l,draggable:a,blockLine:h,indent:c,indentNodes:d,disabled:u,pending:f,internalScrollable:g,nodeProps:y,checkboxPlacement:b}=this,C=a&&!u?{onDragenter:this.handleDragEnter,onDragleave:this.handleDragLeave,onDragend:this.handleDragEnd,onDrop:this.handleDrop,onDragover:this.handleDragOver}:void 0,D=g?$d(i.key):void 0,T=b==="right",A=t?x(C1,{indent:c,right:T,focusable:this.checkboxFocusable,disabled:u||this.checkboxDisabled,clsPrefix:e,checked:this.checked,indeterminate:this.indeterminate,onCheck:this.handleCheck}):null;return x("div",Object.assign({class:`${e}-tree-node-wrapper`},C),x("div",Object.assign({},h?y:void 0,{class:[`${e}-tree-node`,{[`${e}-tree-node--selected`]:o,[`${e}-tree-node--checkable`]:t,[`${e}-tree-node--highlight`]:l,[`${e}-tree-node--pending`]:f,[`${e}-tree-node--disabled`]:u,[`${e}-tree-node--selectable`]:n,[`${e}-tree-node--clickable`]:n||r||this.mergedCheckOnClick},y==null?void 0:y.class],"data-key":D,draggable:a&&h,onClick:this.handleLineClick,onDragstart:a&&h&&!u?this.handleDragStart:void 0}),d,i.isLeaf&&this.showLine?x("div",{class:[`${e}-tree-node-indent`,`${e}-tree-node-indent--show-line`,i.isLeaf&&`${e}-tree-node-indent--is-leaf`,i.isLastChild&&`${e}-tree-node-indent--last-child`]},x("div",{style:{width:`${c}px`}})):x(S1,{clsPrefix:e,expanded:this.expanded,selected:o,loading:this.loading,hide:i.isLeaf,tmNode:this.tmNode,indent:c,onClick:this.handleSwitcherClick}),T?null:A,x(A1,{ref:"contentInstRef",clsPrefix:e,checked:s,selected:o,onClick:this.handleContentClick,nodeProps:h?void 0:y,onDragstart:a&&!h&&!u?this.handleDragStart:void 0,tmNode:i}),a?this.showDropMark?Mh({el:this.contentElRef.value,position:this.droppingPosition,offsetLevel:this.droppingOffsetLevel,indent:c}):this.showDropMarkAsParent?Mh({el:this.contentElRef.value,position:"inside",offsetLevel:this.droppingOffsetLevel,indent:c}):null:null,T?A:null))}}),cu=O1;function P1({props:i,fNodesRef:e,mergedExpandedKeysRef:t,mergedSelectedKeysRef:r,handleSelect:n,handleSwitcherClick:o}){const{value:s}=r,l=Rt(au,null),a=l?l.pendingNodeKeyRef:ie(s.length?s[s.length-1]:null);function h(c){if(!i.keyboard)return;const{value:d}=a;if(d===null){if((c.key==="ArrowDown"||c.key==="ArrowUp")&&c.preventDefault(),["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(c.key)&&d===null){const{value:u}=e;let f=0;for(;f<u.length;){if(!u[f].disabled){a.value=u[f].key;break}f+=1}}}else{const{value:u}=e;let f=u.findIndex(g=>g.key===d);if(!~f)return;if(c.key==="Enter")n(u[f]);else if(c.key==="ArrowDown")for(c.preventDefault(),f+=1;f<u.length;){if(!u[f].disabled){a.value=u[f].key;break}f+=1}else if(c.key==="ArrowUp")for(c.preventDefault(),f-=1;f>=0;){if(!u[f].disabled){a.value=u[f].key;break}f-=1}else if(c.key==="ArrowLeft"){const g=u[f];if(g.isLeaf||!t.value.includes(d)){const y=g.getParent();y&&(a.value=y.key)}else o(g)}else if(c.key==="ArrowRight"){const g=u[f];if(g.isLeaf)return;if(!t.value.includes(d))o(g);else for(f+=1;f<u.length;){if(!u[f].disabled){a.value=u[f].key;break}f+=1}}}}return{pendingNodeKeyRef:a,handleKeydown:h}}const L1=Ce({name:"TreeMotionWrapper",props:{clsPrefix:{type:String,required:!0},height:Number,nodes:{type:Array,required:!0},mode:{type:String,required:!0},onAfterEnter:{type:Function,required:!0}},render(){const{clsPrefix:i}=this;return x(xa,{onAfterEnter:this.onAfterEnter,appear:!0,reverse:this.mode==="collapse"},{default:()=>x("div",{class:[`${i}-tree-motion-wrapper`,`${i}-tree-motion-wrapper--${this.mode}`],style:{height:Ed(this.height)}},this.nodes.map(e=>x(cu,{clsPrefix:i,tmNode:e})))})}}),qs=Bd(),E1=L("tree",`
 font-size: var(--n-font-size);
 outline: none;
`,[ge("ul, li",`
 margin: 0;
 padding: 0;
 list-style: none;
 `),ge(">",[L("tree-node",[ge("&:first-child","margin-top: 0;")])]),L("tree-motion-wrapper",[_("expand",[Go({duration:"0.2s"})]),_("collapse",[Go({duration:"0.2s",reverse:!0})])]),L("tree-node-wrapper",`
 box-sizing: border-box;
 padding: var(--n-node-wrapper-padding);
 `),L("tree-node",`
 transform: translate3d(0,0,0);
 position: relative;
 display: flex;
 border-radius: var(--n-node-border-radius);
 transition: background-color .3s var(--n-bezier);
 `,[_("highlight",[L("tree-node-content",[Ne("text","border-bottom-color: var(--n-node-text-color-disabled);")])]),_("disabled",[L("tree-node-content",`
 color: var(--n-node-text-color-disabled);
 cursor: not-allowed;
 `)]),Vi("disabled",[_("clickable",[L("tree-node-content",`
 cursor: pointer;
 `)])])]),_("block-node",[L("tree-node-content",`
 flex: 1;
 min-width: 0;
 `)]),Vi("block-line",[L("tree-node",[Vi("disabled",[L("tree-node-content",[ge("&:hover","background: var(--n-node-color-hover);")]),_("selectable",[L("tree-node-content",[ge("&:active","background: var(--n-node-color-pressed);")])]),_("pending",[L("tree-node-content",`
 background: var(--n-node-color-hover);
 `)]),_("selected",[L("tree-node-content","background: var(--n-node-color-active);")])])])]),_("block-line",[L("tree-node",[Vi("disabled",[ge("&:hover","background: var(--n-node-color-hover);"),_("pending",`
 background: var(--n-node-color-hover);
 `),_("selectable",[Vi("selected",[ge("&:active","background: var(--n-node-color-pressed);")])]),_("selected","background: var(--n-node-color-active);")]),_("disabled",`
 cursor: not-allowed;
 `)])]),L("tree-node-indent",`
 flex-grow: 0;
 flex-shrink: 0;
 `,[_("show-line","position: relative",[ge("&::before",`
 position: absolute;
 left: 50%;
 border-left: 1px solid var(--n-border-color);
 transition: border-color .3s var(--n-bezier);
 transform: translate(-50%);
 content: "";
 top: var(--n-line-offset-top);
 bottom: var(--n-line-offset-bottom);
 `),_("last-child",[ge("&::before",`
 bottom: 50%;
 `)]),_("is-leaf",[ge("&::after",`
 position: absolute;
 content: "";
 left: calc(50% + 0.5px);
 right: 0;
 bottom: 50%;
 transition: border-color .3s var(--n-bezier);
 border-bottom: 1px solid var(--n-border-color);
 `)])]),Vi("show-line","height: 0;")]),L("tree-node-switcher",`
 cursor: pointer;
 display: inline-flex;
 flex-shrink: 0;
 height: var(--n-node-content-height);
 align-items: center;
 justify-content: center;
 transition: transform .15s var(--n-bezier);
 vertical-align: bottom;
 `,[Ne("icon",`
 position: relative;
 height: 14px;
 width: 14px;
 display: flex;
 color: var(--n-arrow-color);
 transition: color .3s var(--n-bezier);
 font-size: 14px;
 `,[L("icon",[qs]),L("base-loading",`
 color: var(--n-loading-color);
 position: absolute;
 left: 0;
 top: 0;
 right: 0;
 bottom: 0;
 `,[qs]),L("base-icon",[qs])]),_("hide","visibility: hidden;"),_("expanded","transform: rotate(90deg);")]),L("tree-node-checkbox",`
 display: inline-flex;
 height: var(--n-node-content-height);
 vertical-align: bottom;
 align-items: center;
 justify-content: center;
 `),L("tree-node-content",`
 user-select: none;
 position: relative;
 display: inline-flex;
 align-items: center;
 min-height: var(--n-node-content-height);
 box-sizing: border-box;
 line-height: var(--n-line-height);
 vertical-align: bottom;
 padding: 0 6px 0 4px;
 cursor: default;
 border-radius: var(--n-node-border-radius);
 color: var(--n-node-text-color);
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[ge("&:last-child","margin-bottom: 0;"),Ne("prefix",`
 display: inline-flex;
 margin-right: 8px;
 `),Ne("text",`
 border-bottom: 1px solid #0000;
 transition: border-color .3s var(--n-bezier);
 flex-grow: 1;
 max-width: 100%;
 `),Ne("suffix",`
 display: inline-flex;
 `)]),Ne("empty","margin: auto;")]);var B1=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function l(c){try{h(r.next(c))}catch(d){s(d)}}function a(c){try{h(r.throw(c))}catch(d){s(d)}}function h(c){c.done?o(c.value):n(c.value).then(l,a)}h((r=r.apply(i,e||[])).next())})};function N1(i,e,t,r){return{getIsGroup(){return!1},getKey(o){return o[i]},getChildren:r||(o=>o[e]),getDisabled(o){return!!(o[t]||o.checkboxDisabled)}}}const I1={allowCheckingNotLoaded:Boolean,filter:Function,defaultExpandAll:Boolean,expandedKeys:Array,keyField:{type:String,default:"key"},labelField:{type:String,default:"label"},childrenField:{type:String,default:"children"},disabledField:{type:String,default:"disabled"},defaultExpandedKeys:{type:Array,default:()=>[]},indeterminateKeys:Array,renderSwitcherIcon:Function,onUpdateIndeterminateKeys:[Function,Array],"onUpdate:indeterminateKeys":[Function,Array],onUpdateExpandedKeys:[Function,Array],"onUpdate:expandedKeys":[Function,Array]},z1=Object.assign(Object.assign(Object.assign(Object.assign({},si.props),{accordion:Boolean,showIrrelevantNodes:{type:Boolean,default:!0},data:{type:Array,default:()=>[]},expandOnDragenter:{type:Boolean,default:!0},expandOnClick:Boolean,checkOnClick:{type:[Boolean,Function],default:!1},cancelable:{type:Boolean,default:!0},checkable:Boolean,draggable:Boolean,blockNode:Boolean,blockLine:Boolean,showLine:Boolean,disabled:Boolean,checkedKeys:Array,defaultCheckedKeys:{type:Array,default:()=>[]},selectedKeys:Array,defaultSelectedKeys:{type:Array,default:()=>[]},multiple:Boolean,pattern:{type:String,default:""},onLoad:Function,cascade:Boolean,selectable:{type:Boolean,default:!0},scrollbarProps:Object,indent:{type:Number,default:24},allowDrop:{type:Function,default:M1},animated:{type:Boolean,default:!0},checkboxPlacement:{type:String,default:"left"},virtualScroll:Boolean,watchProps:Array,renderLabel:Function,renderPrefix:Function,renderSuffix:Function,nodeProps:Function,keyboard:{type:Boolean,default:!0},getChildren:Function,onDragenter:[Function,Array],onDragleave:[Function,Array],onDragend:[Function,Array],onDragstart:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onUpdateCheckedKeys:[Function,Array],"onUpdate:checkedKeys":[Function,Array],onUpdateSelectedKeys:[Function,Array],"onUpdate:selectedKeys":[Function,Array]}),I1),{internalTreeSelect:Boolean,internalScrollable:Boolean,internalScrollablePadding:String,internalRenderEmpty:Function,internalHighlightKeySet:Object,internalUnifySelectCheck:Boolean,internalCheckboxFocusable:{type:Boolean,default:!0},internalFocusable:{type:Boolean,default:!0},checkStrategy:{type:String,default:"all"},leafOnly:Boolean}),F1=Ce({name:"Tree",props:z1,setup(i){const{mergedClsPrefixRef:e,inlineThemeDisabled:t,mergedRtlRef:r}=Sr(i),n=Qg("Tree",r,e),o=si("Tree","-tree",E1,em,i,e),s=ie(null),l=ie(null),a=ie(null);function h(){var O;return(O=a.value)===null||O===void 0?void 0:O.listElRef}function c(){var O;return(O=a.value)===null||O===void 0?void 0:O.itemsElRef}const d=be(()=>{const{filter:O}=i;if(O)return O;const{labelField:H}=i;return(Y,se)=>{if(!Y.length)return!0;const he=se[H];return typeof he=="string"?he.toLowerCase().includes(Y.toLowerCase()):!1}}),u=be(()=>{const{pattern:O}=i;return O?!O.length||!d.value?{filteredTree:i.data,highlightKeySet:null,expandedKeys:void 0}:D1(i.data,d.value,O,i.keyField,i.childrenField):{filteredTree:i.data,highlightKeySet:null,expandedKeys:void 0}}),f=be(()=>tm(i.showIrrelevantNodes?i.data:u.value.filteredTree,N1(i.keyField,i.childrenField,i.disabledField,i.getChildren))),g=Rt(au,null),y=i.internalTreeSelect?g.dataTreeMate:f,{watchProps:b}=i,C=ie([]);b!=null&&b.includes("defaultCheckedKeys")?Ti(()=>{C.value=i.defaultCheckedKeys}):C.value=i.defaultCheckedKeys;const D=pe(i,"checkedKeys"),T=Nr(D,C),A=be(()=>y.value.getCheckedKeys(T.value,{cascade:i.cascade,allowNotLoaded:i.allowCheckingNotLoaded})),S=R1(i),k=be(()=>A.value.checkedKeys),v=be(()=>{const{indeterminateKeys:O}=i;return O!==void 0?O:A.value.indeterminateKeys}),R=ie([]);b!=null&&b.includes("defaultSelectedKeys")?Ti(()=>{R.value=i.defaultSelectedKeys}):R.value=i.defaultSelectedKeys;const m=pe(i,"selectedKeys"),N=Nr(m,R),V=ie([]),J=O=>{V.value=i.defaultExpandAll?y.value.getNonLeafKeys():O===void 0?i.defaultExpandedKeys:O};b!=null&&b.includes("defaultExpandedKeys")?Ti(()=>{J(void 0)}):Ti(()=>{J(i.defaultExpandedKeys)});const U=pe(i,"expandedKeys"),re=Nr(U,V),te=be(()=>f.value.getFlattenedNodes(re.value)),{pendingNodeKeyRef:$,handleKeydown:ne}=P1({props:i,mergedSelectedKeysRef:N,fNodesRef:te,mergedExpandedKeysRef:re,handleSelect:ci,handleSwitcherClick:Mr});let X=null,Z=null;const P=ie(new Set),W=be(()=>i.internalHighlightKeySet||u.value.highlightKeySet),K=Nr(W,P),fe=ie(new Set),Ge=be(()=>re.value.filter(O=>!fe.value.has(O)));let we=0;const Be=ie(null),bt=ie(null),Tt=ie(null),nt=ie(null),_e=ie(0),yt=be(()=>{const{value:O}=bt;return O?O.parent:null});ti(pe(i,"data"),()=>{fe.value.clear(),$.value=null,Qt()},{deep:!1});let Xe=!1;const ee=()=>{Xe=!0,pr(()=>{Xe=!1})};let ue;ti(pe(i,"pattern"),(O,H)=>{if(i.showIrrelevantNodes)if(ue=void 0,O){const{expandedKeys:Y,highlightKeySet:se}=T1(i.data,i.pattern,i.keyField,i.childrenField,d.value);P.value=se,ee(),Re(Y,Se(Y),{node:null,action:"filter"})}else P.value=new Set;else if(!O.length)ue!==void 0&&(ee(),Re(ue,Se(ue),{node:null,action:"filter"}));else{H.length||(ue=re.value);const{expandedKeys:Y}=u.value;Y!==void 0&&(ee(),Re(Y,Se(Y),{node:null,action:"filter"}))}});function Q(O){return B1(this,void 0,void 0,function*(){const{onLoad:H}=i;if(!H){yield Promise.resolve();return}const{value:Y}=fe;if(!Y.has(O.key)){Y.add(O.key);try{(yield H(O.rawNode))===!1&&hi()}catch(se){console.error(se),hi()}Y.delete(O.key)}})}Ti(()=>{var O;const{value:H}=f;if(!H)return;const{getNode:Y}=H;(O=re.value)===null||O===void 0||O.forEach(se=>{const he=Y(se);he&&!he.shallowLoaded&&Q(he)})});const z=ie(!1),M=ie([]);ti(Ge,(O,H)=>{if(!i.animated||Xe){pr(de);return}const Y=gn(o.value.self.nodeHeight),se=new Set(H);let he=null,$e=null;for(const De of O)if(!se.has(De)){if(he!==null)return;he=De}const ot=new Set(O);for(const De of H)if(!ot.has(De)){if($e!==null)return;$e=De}if(he===null&&$e===null)return;const{virtualScroll:kt}=i,ei=(kt?a.value.listElRef:s.value).offsetHeight,Ri=Math.ceil(ei/Y)+1;let Ot;if(he!==null&&(Ot=H),$e!==null&&(Ot===void 0?Ot=O:Ot=Ot.filter(De=>De!==$e)),z.value=!0,M.value=f.value.getFlattenedNodes(Ot),he!==null){const De=M.value.findIndex(Pt=>Pt.key===he);if(~De){const Pt=M.value[De].children;if(Pt){const Lt=dh(Pt,O);M.value.splice(De+1,0,{__motion:!0,mode:"expand",height:kt?Lt.length*Y:void 0,nodes:kt?Lt.slice(0,Ri):Lt})}}}if($e!==null){const De=M.value.findIndex(Pt=>Pt.key===$e);if(~De){const Pt=M.value[De].children;if(!Pt)return;z.value=!0;const Lt=dh(Pt,O);M.value.splice(De+1,0,{__motion:!0,mode:"collapse",height:kt?Lt.length*Y:void 0,nodes:kt?Lt.slice(0,Ri):Lt})}}});const I=be(()=>im(te.value)),j=be(()=>z.value?M.value:te.value);function de(){const{value:O}=l;O&&O.sync()}function me(){z.value=!1,i.virtualScroll&&pr(de)}function Se(O){const{getNode:H}=y.value;return O.map(Y=>{var se;return((se=H(Y))===null||se===void 0?void 0:se.rawNode)||null})}function Re(O,H,Y){const{"onUpdate:expandedKeys":se,onUpdateExpandedKeys:he}=i;V.value=O,se&&Ye(se,O,H,Y),he&&Ye(he,O,H,Y)}function ke(O,H,Y){const{"onUpdate:checkedKeys":se,onUpdateCheckedKeys:he}=i;C.value=O,he&&Ye(he,O,H,Y),se&&Ye(se,O,H,Y)}function wt(O,H){const{"onUpdate:indeterminateKeys":Y,onUpdateIndeterminateKeys:se}=i;Y&&Ye(Y,O,H),se&&Ye(se,O,H)}function jt(O,H,Y){const{"onUpdate:selectedKeys":se,onUpdateSelectedKeys:he}=i;R.value=O,he&&Ye(he,O,H,Y),se&&Ye(se,O,H,Y)}function ai(O){const{onDragenter:H}=i;H&&Ye(H,O)}function an(O){const{onDragleave:H}=i;H&&Ye(H,O)}function Ar(O){const{onDragend:H}=i;H&&Ye(H,O)}function hn(O){const{onDragstart:H}=i;H&&Ye(H,O)}function Te(O){const{onDragover:H}=i;H&&Ye(H,O)}function cn(O){const{onDrop:H}=i;H&&Ye(H,O)}function Qt(){Mi(),It()}function Mi(){Be.value=null}function It(){_e.value=0,bt.value=null,Tt.value=null,nt.value=null,hi()}function hi(){X&&(window.clearTimeout(X),X=null),Z=null}function Fi(O,H){if(i.disabled||Wi(O,i.disabledField))return;if(i.internalUnifySelectCheck&&!i.multiple){ci(O);return}const Y=H?"check":"uncheck",{checkedKeys:se,indeterminateKeys:he}=y.value[Y](O.key,k.value,{cascade:i.cascade,checkStrategy:S.value,allowNotLoaded:i.allowCheckingNotLoaded});ke(se,Se(se),{node:O.rawNode,action:Y}),wt(he,Se(he))}function ut(O){if(i.disabled)return;const{key:H}=O,{value:Y}=re,se=Y.findIndex(he=>he===H);if(~se){const he=Array.from(Y);he.splice(se,1),Re(he,Se(he),{node:O.rawNode,action:"collapse"})}else{const he=f.value.getNode(H);if(!he||he.isLeaf)return;let $e;if(i.accordion){const ot=new Set(O.siblings.map(({key:kt})=>kt));$e=Y.filter(kt=>!ot.has(kt)),$e.push(H)}else $e=Y.concat(H);Re($e,Se($e),{node:O.rawNode,action:"expand"})}}function Mr(O){i.disabled||z.value||ut(O)}function ci(O){if(!(i.disabled||!i.selectable)){if($.value=O.key,i.internalUnifySelectCheck){const{value:{checkedKeys:H,indeterminateKeys:Y}}=A;i.multiple?Fi(O,!(H.includes(O.key)||Y.includes(O.key))):ke([O.key],Se([O.key]),{node:O.rawNode,action:"check"})}if(i.multiple){const H=Array.from(N.value),Y=H.findIndex(se=>se===O.key);~Y?i.cancelable&&H.splice(Y,1):~Y||H.push(O.key),jt(H,Se(H),{node:O.rawNode,action:~Y?"unselect":"select"})}else N.value.includes(O.key)?i.cancelable&&jt([],[],{node:O.rawNode,action:"unselect"}):jt([O.key],Se([O.key]),{node:O.rawNode,action:"select"})}}function dn(O){if(X&&(window.clearTimeout(X),X=null),O.isLeaf)return;Z=O.key;const H=()=>{if(Z!==O.key)return;const{value:Y}=Tt;if(Y&&Y.key===O.key&&!re.value.includes(O.key)){const se=re.value.concat(O.key);Re(se,Se(se),{node:O.rawNode,action:"expand"})}X=null,Z=null};O.shallowLoaded?X=window.setTimeout(()=>{H()},1e3):X=window.setTimeout(()=>{Q(O).then(()=>{H()})},1e3)}function sr({event:O,node:H}){!i.draggable||i.disabled||Wi(H,i.disabledField)||(Tr({event:O,node:H},!1),ai({event:O,node:H.rawNode}))}function xt({event:O,node:H}){!i.draggable||i.disabled||Wi(H,i.disabledField)||an({event:O,node:H.rawNode})}function Rr(O){O.target===O.currentTarget&&It()}function un({event:O,node:H}){Qt(),!(!i.draggable||i.disabled||Wi(H,i.disabledField))&&Ar({event:O,node:H.rawNode})}function Ut({event:O,node:H}){!i.draggable||i.disabled||Wi(H,i.disabledField)||(we=O.clientX,Be.value=H,hn({event:O,node:H.rawNode}))}function Tr({event:O,node:H},Y=!0){var se;if(!i.draggable||i.disabled||Wi(H,i.disabledField))return;const{value:he}=Be;if(!he)return;const{allowDrop:$e,indent:ot}=i;Y&&Te({event:O,node:H.rawNode});const kt=O.currentTarget,{height:ei,top:Ri}=kt.getBoundingClientRect(),Ot=O.clientY-Ri;let De;$e({node:H.rawNode,dropPosition:"inside",phase:"drag"})?Ot<=8?De="before":Ot>=ei-8?De="after":De="inside":Ot<=ei/2?De="before":De="after";const{value:Lt}=I;let Oe,et;const lr=Lt(H.key);if(lr===null){It();return}let p=!1;De==="inside"?(Oe=H,et="inside"):De==="before"?H.isFirstChild?(Oe=H,et="before"):(Oe=te.value[lr-1],et="after"):(Oe=H,et="after"),!Oe.isLeaf&&re.value.includes(Oe.key)&&(p=!0,et==="after"&&(Oe=te.value[lr+1],Oe?et="before":(Oe=H,et="inside")));const w=Oe;if(Tt.value=w,!p&&he.isLastChild&&he.key===Oe.key&&(et="after"),et==="after"){let B=we-O.clientX,q=0;for(;B>=ot/2&&Oe.parent!==null&&Oe.isLastChild&&q<1;)B-=ot,q+=1,Oe=Oe.parent;_e.value=q}else _e.value=0;if((he.contains(Oe)||et==="inside"&&((se=he.parent)===null||se===void 0?void 0:se.key)===Oe.key)&&!(he.key===w.key&&he.key===Oe.key)){It();return}if(!$e({node:Oe.rawNode,dropPosition:et,phase:"drag"})){It();return}if(he.key===Oe.key)hi();else if(Z!==Oe.key)if(et==="inside"){if(i.expandOnDragenter){if(dn(Oe),!Oe.shallowLoaded&&Z!==Oe.key){Qt();return}}else if(!Oe.shallowLoaded){Qt();return}}else hi();else et!=="inside"&&hi();nt.value=et,bt.value=Oe}function Dr({event:O,node:H,dropPosition:Y}){if(!i.draggable||i.disabled||Wi(H,i.disabledField))return;const{value:se}=Be,{value:he}=bt,{value:$e}=nt;if(!(!se||!he||!$e)&&i.allowDrop({node:he.rawNode,dropPosition:$e,phase:"drag"})&&se.key!==he.key){if($e==="before"){const ot=se.getNext({includeDisabled:!0});if(ot&&ot.key===he.key){It();return}}if($e==="after"){const ot=se.getPrev({includeDisabled:!0});if(ot&&ot.key===he.key){It();return}}cn({event:O,node:he.rawNode,dragNode:se.rawNode,dropPosition:Y}),Qt()}}function ao(){de()}function Is(){de()}function $i(O){var H;if(i.virtualScroll||i.internalScrollable){const{value:Y}=l;if(!((H=Y==null?void 0:Y.containerRef)===null||H===void 0)&&H.contains(O.relatedTarget))return;$.value=null}else{const{value:Y}=s;if(Y!=null&&Y.contains(O.relatedTarget))return;$.value=null}}ti($,O=>{var H,Y;if(O!==null){if(i.virtualScroll)(H=a.value)===null||H===void 0||H.scrollTo({key:O});else if(i.internalScrollable){const{value:se}=l;if(se===null)return;const he=(Y=se.contentRef)===null||Y===void 0?void 0:Y.querySelector(`[data-key="${$d(O)}"]`);if(!he)return;se.scrollTo({el:he})}}}),Jn(Qn,{loadingKeysRef:fe,highlightKeySetRef:K,displayedCheckedKeysRef:k,displayedIndeterminateKeysRef:v,mergedSelectedKeysRef:N,mergedExpandedKeysRef:re,mergedThemeRef:o,mergedCheckStrategyRef:S,nodePropsRef:pe(i,"nodeProps"),disabledRef:pe(i,"disabled"),checkableRef:pe(i,"checkable"),selectableRef:pe(i,"selectable"),expandOnClickRef:pe(i,"expandOnClick"),onLoadRef:pe(i,"onLoad"),draggableRef:pe(i,"draggable"),blockLineRef:pe(i,"blockLine"),indentRef:pe(i,"indent"),cascadeRef:pe(i,"cascade"),checkOnClickRef:pe(i,"checkOnClick"),checkboxPlacementRef:i.checkboxPlacement,droppingMouseNodeRef:Tt,droppingNodeParentRef:yt,draggingNodeRef:Be,droppingPositionRef:nt,droppingOffsetLevelRef:_e,fNodesRef:te,pendingNodeKeyRef:$,showLineRef:pe(i,"showLine"),disabledFieldRef:pe(i,"disabledField"),internalScrollableRef:pe(i,"internalScrollable"),internalCheckboxFocusableRef:pe(i,"internalCheckboxFocusable"),internalTreeSelect:i.internalTreeSelect,renderLabelRef:pe(i,"renderLabel"),renderPrefixRef:pe(i,"renderPrefix"),renderSuffixRef:pe(i,"renderSuffix"),renderSwitcherIconRef:pe(i,"renderSwitcherIcon"),labelFieldRef:pe(i,"labelField"),multipleRef:pe(i,"multiple"),handleSwitcherClick:Mr,handleDragEnd:un,handleDragEnter:sr,handleDragLeave:xt,handleDragStart:Ut,handleDrop:Dr,handleDragOver:Tr,handleSelect:ci,handleCheck:Fi});function di(O){var H;(H=a.value)===null||H===void 0||H.scrollTo(O)}const Hi={handleKeydown:ne,scrollTo:di,getCheckedData:()=>{if(!i.checkable)return{keys:[],options:[]};const{checkedKeys:O}=A.value;return{keys:O,options:Se(O)}},getIndeterminateData:()=>{if(!i.checkable)return{keys:[],options:[]};const{indeterminateKeys:O}=A.value;return{keys:O,options:Se(O)}}},fn=be(()=>{const{common:{cubicBezierEaseInOut:O},self:{fontSize:H,nodeBorderRadius:Y,nodeColorHover:se,nodeColorPressed:he,nodeColorActive:$e,arrowColor:ot,loadingColor:kt,nodeTextColor:ei,nodeTextColorDisabled:Ri,dropMarkColor:Ot,nodeWrapperPadding:De,nodeHeight:Pt,lineHeight:Lt}}=o.value,Oe=dr(De,"top"),et=dr(De,"bottom"),lr=Ed(gn(Pt)-gn(Oe)-gn(et));return{"--n-arrow-color":ot,"--n-loading-color":kt,"--n-bezier":O,"--n-font-size":H,"--n-node-border-radius":Y,"--n-node-color-active":$e,"--n-node-color-hover":se,"--n-node-color-pressed":he,"--n-node-text-color":ei,"--n-node-text-color-disabled":Ri,"--n-drop-mark-color":Ot,"--n-node-wrapper-padding":De,"--n-line-offset-top":`-${Oe}`,"--n-line-offset-bottom":`-${et}`,"--n-node-content-height":lr,"--n-line-height":Lt}}),Dt=t?Yn("tree",void 0,fn,i):void 0;return Object.assign(Object.assign({},Hi),{mergedClsPrefix:e,mergedTheme:o,rtlEnabled:n,fNodes:j,aip:z,selfElRef:s,virtualListInstRef:a,scrollbarInstRef:l,handleFocusout:$i,handleDragLeaveTree:Rr,handleScroll:ao,getScrollContainer:h,getScrollContent:c,handleAfterEnter:me,handleResize:Is,cssVars:t?void 0:fn,themeClass:Dt==null?void 0:Dt.themeClass,onRender:Dt==null?void 0:Dt.onRender})},render(){var i;const{fNodes:e,internalRenderEmpty:t}=this;if(!e.length&&t)return t();const{mergedClsPrefix:r,blockNode:n,blockLine:o,draggable:s,disabled:l,internalFocusable:a,checkable:h,handleKeydown:c,rtlEnabled:d,handleFocusout:u,scrollbarProps:f}=this,g=a&&!l,y=g?"0":void 0,b=[`${r}-tree`,d&&`${r}-tree--rtl`,h&&`${r}-tree--checkable`,(o||n)&&`${r}-tree--block-node`,o&&`${r}-tree--block-line`],C=T=>"__motion"in T?x(L1,{height:T.height,nodes:T.nodes,clsPrefix:r,mode:T.mode,onAfterEnter:this.handleAfterEnter}):x(cu,{key:T.key,tmNode:T,clsPrefix:r});if(this.virtualScroll){const{mergedTheme:T,internalScrollablePadding:A}=this,S=dr(A||"0");return x(uh,Object.assign({},f,{ref:"scrollbarInstRef",onDragleave:s?this.handleDragLeaveTree:void 0,container:this.getScrollContainer,content:this.getScrollContent,class:b,theme:T.peers.Scrollbar,themeOverrides:T.peerOverrides.Scrollbar,tabindex:y,onKeydown:g?c:void 0,onFocusout:g?u:void 0}),{default:()=>{var k;return(k=this.onRender)===null||k===void 0||k.call(this),x(rm,{ref:"virtualListInstRef",items:this.fNodes,itemSize:gn(T.self.nodeHeight),ignoreItemResize:this.aip,paddingTop:S.top,paddingBottom:S.bottom,class:this.themeClass,style:[this.cssVars,{paddingLeft:S.left,paddingRight:S.right}],onScroll:this.handleScroll,onResize:this.handleResize,showScrollbar:!1,itemResizable:!0},{default:({item:v})=>C(v)})}})}const{internalScrollable:D}=this;return b.push(this.themeClass),(i=this.onRender)===null||i===void 0||i.call(this),D?x(uh,Object.assign({},f,{class:b,tabindex:y,onKeydown:g?c:void 0,onFocusout:g?u:void 0,style:this.cssVars,contentStyle:{padding:this.internalScrollablePadding}}),{default:()=>x("div",{onDragleave:s?this.handleDragLeaveTree:void 0,ref:"selfElRef"},this.fNodes.map(C))}):x("div",{class:b,tabindex:y,ref:"selfElRef",style:this.cssVars,onKeydown:g?c:void 0,onFocusout:g?u:void 0,onDragleave:s?this.handleDragLeaveTree:void 0},e.length?e.map(C):Nd(this.$slots.empty,()=>[x(nm,{class:`${r}-tree__empty`,theme:this.mergedTheme.peers.Empty,themeOverrides:this.mergedTheme.peerOverrides.Empty})]))}}),nn=rn("n-upload"),du="__UPLOAD_DRAGGER__",uu=Ce({name:"UploadDragger",[du]:!0,setup(i,{slots:e}){const t=Rt(nn,null);return t||Xn("upload-dragger","`n-upload-dragger` must be placed inside `n-upload`."),()=>{const{mergedClsPrefixRef:{value:r},mergedDisabledRef:{value:n},maxReachedRef:{value:o}}=t;return x("div",{class:[`${r}-upload-dragger`,(n||o)&&`${r}-upload-dragger--disabled`]},e)}}}),fu=Ce({name:"UploadTrigger",props:{abstract:Boolean},setup(i,{slots:e}){const t=Rt(nn,null);t||Xn("upload-trigger","`n-upload-trigger` must be placed inside `n-upload`.");const{mergedClsPrefixRef:r,mergedDisabledRef:n,maxReachedRef:o,listTypeRef:s,dragOverRef:l,openOpenFileDialog:a,draggerInsideRef:h,handleFileAddition:c,mergedDirectoryDndRef:d,triggerStyleRef:u}=t,f=be(()=>s.value==="image-card");function g(){n.value||o.value||a()}function y(T){T.preventDefault(),l.value=!0}function b(T){T.preventDefault(),l.value=!0}function C(T){T.preventDefault(),l.value=!1}function D(T){var A;if(T.preventDefault(),!h.value||n.value||o.value){l.value=!1;return}const S=(A=T.dataTransfer)===null||A===void 0?void 0:A.items;S!=null&&S.length?X0(Array.from(S).map(k=>k.webkitGetAsEntry()),d.value).then(k=>{c(k)}).finally(()=>{l.value=!1}):l.value=!1}return()=>{var T;const{value:A}=r;return i.abstract?(T=e.default)===null||T===void 0?void 0:T.call(e,{handleClick:g,handleDrop:D,handleDragOver:y,handleDragEnter:b,handleDragLeave:C}):x("div",{class:[`${A}-upload-trigger`,(n.value||o.value)&&`${A}-upload-trigger--disabled`,f.value&&`${A}-upload-trigger--image-card`],style:u.value,onClick:g,onDrop:D,onDragover:y,onDragenter:b,onDragleave:C},f.value?x(uu,null,{default:()=>Nd(e.default,()=>[x(Ke,{clsPrefix:A},{default:()=>x(Qd,null)})])}):e)}}}),$1=Ce({name:"UploadProgress",props:{show:Boolean,percentage:{type:Number,required:!0},status:{type:String,required:!0}},setup(){return{mergedTheme:Rt(nn).mergedThemeRef}},render(){return x(xa,null,{default:()=>this.show?x(g1,{type:"line",showIndicator:!1,percentage:this.percentage,status:this.status,height:2,theme:this.mergedTheme.peers.Progress,themeOverrides:this.mergedTheme.peerOverrides.Progress}):null})}}),H1=x("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28"},x("g",{fill:"none"},x("path",{d:"M21.75 3A3.25 3.25 0 0 1 25 6.25v15.5A3.25 3.25 0 0 1 21.75 25H6.25A3.25 3.25 0 0 1 3 21.75V6.25A3.25 3.25 0 0 1 6.25 3h15.5zm.583 20.4l-7.807-7.68a.75.75 0 0 0-.968-.07l-.084.07l-7.808 7.68c.183.065.38.1.584.1h15.5c.204 0 .4-.035.583-.1l-7.807-7.68l7.807 7.68zM21.75 4.5H6.25A1.75 1.75 0 0 0 4.5 6.25v15.5c0 .208.036.408.103.593l7.82-7.692a2.25 2.25 0 0 1 3.026-.117l.129.117l7.82 7.692c.066-.185.102-.385.102-.593V6.25a1.75 1.75 0 0 0-1.75-1.75zm-3.25 3a2.5 2.5 0 1 1 0 5a2.5 2.5 0 0 1 0-5zm0 1.5a1 1 0 1 0 0 2a1 1 0 0 0 0-2z",fill:"currentColor"}))),W1=x("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28"},x("g",{fill:"none"},x("path",{d:"M6.4 2A2.4 2.4 0 0 0 4 4.4v19.2A2.4 2.4 0 0 0 6.4 26h15.2a2.4 2.4 0 0 0 2.4-2.4V11.578c0-.729-.29-1.428-.805-1.944l-6.931-6.931A2.4 2.4 0 0 0 14.567 2H6.4zm-.9 2.4a.9.9 0 0 1 .9-.9H14V10a2 2 0 0 0 2 2h6.5v11.6a.9.9 0 0 1-.9.9H6.4a.9.9 0 0 1-.9-.9V4.4zm16.44 6.1H16a.5.5 0 0 1-.5-.5V4.06l6.44 6.44z",fill:"currentColor"})));var V1=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function l(c){try{h(r.next(c))}catch(d){s(d)}}function a(c){try{h(r.throw(c))}catch(d){s(d)}}function h(c){c.done?o(c.value):n(c.value).then(l,a)}h((r=r.apply(i,e||[])).next())})};const uo={paddingMedium:"0 3px",heightMedium:"24px",iconSizeMedium:"18px"},j1=Ce({name:"UploadFile",props:{clsPrefix:{type:String,required:!0},file:{type:Object,required:!0},listType:{type:String,required:!0}},setup(i){const e=Rt(nn),t=ie(null),r=ie(""),n=be(()=>{const{file:S}=i;return S.status==="finished"?"success":S.status==="error"?"error":"info"}),o=be(()=>{const{file:S}=i;if(S.status==="error")return"error"}),s=be(()=>{const{file:S}=i;return S.status==="uploading"}),l=be(()=>{if(!e.showCancelButtonRef.value)return!1;const{file:S}=i;return["uploading","pending","error"].includes(S.status)}),a=be(()=>{if(!e.showRemoveButtonRef.value)return!1;const{file:S}=i;return["finished"].includes(S.status)}),h=be(()=>{if(!e.showDownloadButtonRef.value)return!1;const{file:S}=i;return["finished"].includes(S.status)}),c=be(()=>{if(!e.showRetryButtonRef.value)return!1;const{file:S}=i;return["error"].includes(S.status)}),d=ft(()=>r.value||i.file.thumbnailUrl||i.file.url),u=be(()=>{if(!e.showPreviewButtonRef.value)return!1;const{file:{status:S},listType:k}=i;return["finished"].includes(S)&&d.value&&k==="image-card"});function f(){e.submit(i.file.id)}function g(S){S.preventDefault();const{file:k}=i;["finished","pending","error"].includes(k.status)?b(k):["uploading"].includes(k.status)?D(k):sm("upload","The button clicked type is unknown.")}function y(S){S.preventDefault(),C(i.file)}function b(S){const{xhrMap:k,doChange:v,onRemoveRef:{value:R},mergedFileListRef:{value:m}}=e;Promise.resolve(R?R({file:Object.assign({},S),fileList:m}):!0).then(N=>{if(N===!1)return;const V=Object.assign({},S,{status:"removed"});k.delete(S.id),v(V,void 0,{remove:!0})})}function C(S){const{onDownloadRef:{value:k}}=e;Promise.resolve(k?k(Object.assign({},S)):!0).then(v=>{v!==!1&&nu(S.url,S.name)})}function D(S){const{xhrMap:k}=e,v=k.get(S.id);v==null||v.abort(),b(Object.assign({},S))}function T(){const{onPreviewRef:{value:S}}=e;if(S)S(i.file);else if(i.listType==="image-card"){const{value:k}=t;if(!k)return;k.click()}}const A=()=>V1(this,void 0,void 0,function*(){const{listType:S}=i;S!=="image"&&S!=="image-card"||e.shouldUseThumbnailUrlRef.value(i.file)&&(r.value=yield e.getFileThumbnailUrlResolver(i.file))});return Ti(()=>{A()}),{mergedTheme:e.mergedThemeRef,progressStatus:n,buttonType:o,showProgress:s,disabled:e.mergedDisabledRef,showCancelButton:l,showRemoveButton:a,showDownloadButton:h,showRetryButton:c,showPreviewButton:u,mergedThumbnailUrl:d,shouldUseThumbnailUrl:e.shouldUseThumbnailUrlRef,renderIcon:e.renderIconRef,imageRef:t,handleRemoveOrCancelClick:g,handleDownloadClick:y,handleRetryClick:f,handlePreviewClick:T}},render(){const{clsPrefix:i,mergedTheme:e,listType:t,file:r,renderIcon:n}=this;let o;const s=t==="image";s||t==="image-card"?o=!this.shouldUseThumbnailUrl(r)||!this.mergedThumbnailUrl?x("span",{class:`${i}-upload-file-info__thumbnail`},n?n(r):ru(r)?x(Ke,{clsPrefix:i},{default:()=>H1}):x(Ke,{clsPrefix:i},{default:()=>W1})):x("a",{rel:"noopener noreferer",target:"_blank",href:r.url||void 0,class:`${i}-upload-file-info__thumbnail`,onClick:this.handlePreviewClick},t==="image-card"?x(l1,{src:this.mergedThumbnailUrl||void 0,previewSrc:r.url||void 0,alt:r.name,ref:"imageRef"}):x("img",{src:this.mergedThumbnailUrl||void 0,alt:r.name})):o=x("span",{class:`${i}-upload-file-info__thumbnail`},n?n(r):x(Ke,{clsPrefix:i},{default:()=>x(O0,null)}));const a=x($1,{show:this.showProgress,percentage:r.percentage||0,status:this.progressStatus}),h=t==="text"||t==="image";return x("div",{class:[`${i}-upload-file`,`${i}-upload-file--${this.progressStatus}-status`,r.url&&r.status!=="error"&&t!=="image-card"&&`${i}-upload-file--with-url`,`${i}-upload-file--${t}-type`]},x("div",{class:`${i}-upload-file-info`},o,x("div",{class:`${i}-upload-file-info__name`},h&&(r.url&&r.status!=="error"?x("a",{rel:"noopener noreferer",target:"_blank",href:r.url||void 0,onClick:this.handlePreviewClick},r.name):x("span",{onClick:this.handlePreviewClick},r.name)),s&&a),x("div",{class:[`${i}-upload-file-info__action`,`${i}-upload-file-info__action--${t}-type`]},this.showPreviewButton?x(Ki,{key:"preview",quaternary:!0,type:this.buttonType,onClick:this.handlePreviewClick,theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,builtinThemeOverrides:uo},{icon:()=>x(Ke,{clsPrefix:i},{default:()=>x(om,null)})}):null,(this.showRemoveButton||this.showCancelButton)&&!this.disabled&&x(Ki,{key:"cancelOrTrash",theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,quaternary:!0,builtinThemeOverrides:uo,type:this.buttonType,onClick:this.handleRemoveOrCancelClick},{icon:()=>x(Ld,null,{default:()=>this.showRemoveButton?x(Ke,{clsPrefix:i,key:"trash"},{default:()=>x(P0,null)}):x(Ke,{clsPrefix:i,key:"cancel"},{default:()=>x(B0,null)})})}),this.showRetryButton&&!this.disabled&&x(Ki,{key:"retry",quaternary:!0,type:this.buttonType,onClick:this.handleRetryClick,theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,builtinThemeOverrides:uo},{icon:()=>x(Ke,{clsPrefix:i},{default:()=>x(N0,null)})}),this.showDownloadButton?x(Ki,{key:"download",quaternary:!0,type:this.buttonType,onClick:this.handleDownloadClick,theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,builtinThemeOverrides:uo},{icon:()=>x(Ke,{clsPrefix:i},{default:()=>x(L0,null)})}):null)),!s&&a)}}),U1=Ce({name:"UploadFileList",setup(i,{slots:e}){const t=Rt(nn,null);t||Xn("upload-file-list","`n-upload-file-list` must be placed inside `n-upload`.");const{abstractRef:r,mergedClsPrefixRef:n,listTypeRef:o,mergedFileListRef:s,fileListStyleRef:l,cssVarsRef:a,themeClassRef:h,maxReachedRef:c,showTriggerRef:d,imageGroupPropsRef:u}=t,f=be(()=>o.value==="image-card"),g=()=>s.value.map(b=>x(j1,{clsPrefix:n.value,key:b.id,file:b,listType:o.value})),y=()=>f.value?x(o1,Object.assign({},u.value),{default:g}):x(xa,{group:!0},{default:g});return()=>{const{value:b}=n,{value:C}=r;return x("div",{class:[`${b}-upload-file-list`,f.value&&`${b}-upload-file-list--grid`,C?h==null?void 0:h.value:void 0],style:[C&&a?a.value:"",l.value]},y(),d.value&&!c.value&&f.value&&x(fu,null,e))}}}),_1=ge([L("upload","width: 100%;",[_("dragger-inside",[L("upload-trigger",`
 display: block;
 `)]),_("drag-over",[L("upload-dragger",`
 border: var(--n-dragger-border-hover);
 `)])]),L("upload-dragger",`
 cursor: pointer;
 box-sizing: border-box;
 width: 100%;
 text-align: center;
 border-radius: var(--n-border-radius);
 padding: 24px;
 opacity: 1;
 transition:
 opacity .3s var(--n-bezier),
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 background-color: var(--n-dragger-color);
 border: var(--n-dragger-border);
 `,[ge("&:hover",`
 border: var(--n-dragger-border-hover);
 `),_("disabled",`
 cursor: not-allowed;
 `)]),L("upload-trigger",`
 display: inline-block;
 box-sizing: border-box;
 opacity: 1;
 transition: opacity .3s var(--n-bezier);
 `,[ge("+",[L("upload-file-list","margin-top: 8px;")]),_("disabled",`
 opacity: var(--n-item-disabled-opacity);
 cursor: not-allowed;
 `),_("image-card",`
 width: 96px;
 height: 96px;
 `,[L("base-icon",`
 font-size: 24px;
 `),L("upload-dragger",`
 padding: 0;
 height: 100%;
 width: 100%;
 display: flex;
 align-items: center;
 justify-content: center;
 `)])]),L("upload-file-list",`
 line-height: var(--n-line-height);
 opacity: 1;
 transition: opacity .3s var(--n-bezier);
 `,[ge("a, img","outline: none;"),_("disabled",`
 opacity: var(--n-item-disabled-opacity);
 cursor: not-allowed;
 `,[L("upload-file","cursor: not-allowed;")]),_("grid",`
 display: grid;
 grid-template-columns: repeat(auto-fill, 96px);
 grid-gap: 8px;
 margin-top: 0;
 `),L("upload-file",`
 display: block;
 box-sizing: border-box;
 cursor: default;
 padding: 0px 12px 0 6px;
 transition: background-color .3s var(--n-bezier);
 border-radius: var(--n-border-radius);
 `,[Go(),L("progress",[Go({foldPadding:!0})]),ge("&:hover",`
 background-color: var(--n-item-color-hover);
 `,[L("upload-file-info",[Ne("action",`
 opacity: 1;
 `)])]),_("image-type",`
 border-radius: var(--n-border-radius);
 text-decoration: underline;
 text-decoration-color: #0000;
 `,[L("upload-file-info",`
 padding-top: 0px;
 padding-bottom: 0px;
 width: 100%;
 height: 100%;
 display: flex;
 justify-content: space-between;
 align-items: center;
 padding: 6px 0;
 `,[L("progress",`
 padding: 2px 0;
 margin-bottom: 0;
 `),Ne("name",`
 padding: 0 8px;
 `),Ne("thumbnail",`
 width: 32px;
 height: 32px;
 font-size: 28px;
 display: flex;
 justify-content: center;
 align-items: center;
 `,[ge("img",`
 width: 100%;
 `)])])]),_("text-type",[L("progress",`
 box-sizing: border-box;
 padding-bottom: 6px;
 margin-bottom: 6px;
 `)]),_("image-card-type",`
 position: relative;
 width: 96px;
 height: 96px;
 border: var(--n-item-border-image-card);
 border-radius: var(--n-border-radius);
 padding: 0;
 display: flex;
 align-items: center;
 justify-content: center;
 transition: border-color .3s var(--n-bezier), background-color .3s var(--n-bezier);
 border-radius: var(--n-border-radius);
 overflow: hidden;
 `,[L("progress",`
 position: absolute;
 left: 8px;
 bottom: 8px;
 right: 8px;
 width: unset;
 `),L("upload-file-info",`
 padding: 0;
 width: 100%;
 height: 100%;
 `,[Ne("thumbnail",`
 width: 100%;
 height: 100%;
 display: flex;
 flex-direction: column;
 align-items: center;
 justify-content: center;
 font-size: 36px;
 `,[ge("img",`
 width: 100%;
 `)])]),ge("&::before",`
 position: absolute;
 z-index: 1;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 border-radius: inherit;
 opacity: 0;
 transition: opacity .2s var(--n-bezier);
 content: "";
 `),ge("&:hover",[ge("&::before","opacity: 1;"),L("upload-file-info",[Ne("thumbnail","opacity: .12;")])])]),_("error-status",[ge("&:hover",`
 background-color: var(--n-item-color-hover-error);
 `),L("upload-file-info",[Ne("name","color: var(--n-item-text-color-error);"),Ne("thumbnail","color: var(--n-item-text-color-error);")]),_("image-card-type",`
 border: var(--n-item-border-image-card-error);
 `)]),_("with-url",`
 cursor: pointer;
 `,[L("upload-file-info",[Ne("name",`
 color: var(--n-item-text-color-success);
 text-decoration-color: var(--n-item-text-color-success);
 `,[ge("a",`
 text-decoration: underline;
 `)])])]),L("upload-file-info",`
 position: relative;
 padding-top: 6px;
 padding-bottom: 6px;
 display: flex;
 flex-wrap: nowrap;
 `,[Ne("thumbnail",`
 font-size: 18px;
 opacity: 1;
 transition: opacity .2s var(--n-bezier);
 color: var(--n-item-icon-color);
 `,[L("base-icon",`
 margin-right: 2px;
 vertical-align: middle;
 transition: color .3s var(--n-bezier);
 `)]),Ne("action",`
 padding-top: inherit;
 padding-bottom: inherit;
 position: absolute;
 right: 0;
 top: 0;
 bottom: 0;
 width: 80px;
 display: flex;
 align-items: center;
 transition: opacity .2s var(--n-bezier);
 justify-content: flex-end;
 opacity: 0;
 `,[L("button",[ge("&:not(:last-child)",{marginRight:"4px"}),L("base-icon",[ge("svg",[Bd()])])]),_("image-type",`
 position: relative;
 max-width: 80px;
 width: auto;
 `),_("image-card-type",`
 z-index: 2;
 position: absolute;
 width: 100%;
 height: 100%;
 left: 0;
 right: 0;
 bottom: 0;
 top: 0;
 display: flex;
 justify-content: center;
 align-items: center;
 `)]),Ne("name",`
 color: var(--n-item-text-color);
 flex: 1;
 display: flex;
 justify-content: center;
 text-overflow: ellipsis;
 overflow: hidden;
 flex-direction: column;
 text-decoration-color: #0000;
 font-size: var(--n-font-size);
 transition:
 color .3s var(--n-bezier),
 text-decoration-color .3s var(--n-bezier); 
 `,[ge("a",`
 color: inherit;
 text-decoration: underline;
 `)])])])]),L("upload-file-input",`
 display: block;
 width: 0;
 height: 0;
 opacity: 0;
 `)]);var Rh=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function l(c){try{h(r.next(c))}catch(d){s(d)}}function a(c){try{h(r.throw(c))}catch(d){s(d)}}function h(c){c.done?o(c.value):n(c.value).then(l,a)}h((r=r.apply(i,e||[])).next())})};function K1(i,e,t){const{doChange:r,xhrMap:n}=i;let o=0;function s(a){var h;let c=Object.assign({},e,{status:"error",percentage:o});n.delete(e.id),c=Ln(((h=i.onError)===null||h===void 0?void 0:h.call(i,{file:c,event:a}))||c),r(c,a)}function l(a){var h;if(i.isErrorState){if(i.isErrorState(t)){s(a);return}}else if(t.status<200||t.status>=300){s(a);return}let c=Object.assign({},e,{status:"finished",percentage:o});n.delete(e.id),c=Ln(((h=i.onFinish)===null||h===void 0?void 0:h.call(i,{file:c,event:a}))||c),r(c,a)}return{handleXHRLoad:l,handleXHRError:s,handleXHRAbort(a){const h=Object.assign({},e,{status:"removed",file:null,percentage:o});n.delete(e.id),r(h,a)},handleXHRProgress(a){const h=Object.assign({},e,{status:"uploading"});if(a.lengthComputable){const c=Math.ceil(a.loaded/a.total*100);h.percentage=c,o=c}r(h,a)}}}function q1(i){const{inst:e,file:t,data:r,headers:n,withCredentials:o,action:s,customRequest:l}=i,{doChange:a}=i.inst;let h=0;l({file:t,data:r,headers:n,withCredentials:o,action:s,onProgress(c){const d=Object.assign({},t,{status:"uploading"}),u=c.percent;d.percentage=u,h=u,a(d)},onFinish(){var c;let d=Object.assign({},t,{status:"finished",percentage:h});d=Ln(((c=e.onFinish)===null||c===void 0?void 0:c.call(e,{file:d}))||d),a(d)},onError(){var c;let d=Object.assign({},t,{status:"error",percentage:h});d=Ln(((c=e.onError)===null||c===void 0?void 0:c.call(e,{file:d}))||d),a(d)}})}function G1(i,e,t){const r=K1(i,e,t);t.onabort=r.handleXHRAbort,t.onerror=r.handleXHRError,t.onload=r.handleXHRLoad,t.upload&&(t.upload.onprogress=r.handleXHRProgress)}function pu(i,e){return typeof i=="function"?i({file:e}):i||{}}function X1(i,e,t){const r=pu(e,t);r&&Object.keys(r).forEach(n=>{i.setRequestHeader(n,r[n])})}function Y1(i,e,t){const r=pu(e,t);r&&Object.keys(r).forEach(n=>{i.append(n,r[n])})}function J1(i,e,t,{method:r,action:n,withCredentials:o,responseType:s,headers:l,data:a}){const h=new XMLHttpRequest;h.responseType=s,i.xhrMap.set(t.id,h),h.withCredentials=o;const c=new FormData;if(Y1(c,a,t),c.append(e,t.file),G1(i,t,h),n!==void 0){h.open(r.toUpperCase(),n),X1(h,l,t),h.send(c);const d=Object.assign({},t,{status:"uploading"});i.doChange(d)}}const Z1=Object.assign(Object.assign({},si.props),{name:{type:String,default:"file"},accept:String,action:String,customRequest:Function,directory:Boolean,directoryDnd:{type:Boolean,default:void 0},method:{type:String,default:"POST"},multiple:Boolean,showFileList:{type:Boolean,default:!0},data:[Object,Function],headers:[Object,Function],withCredentials:Boolean,responseType:{type:String,default:""},disabled:{type:Boolean,default:void 0},onChange:Function,onRemove:Function,onFinish:Function,onError:Function,onBeforeUpload:Function,isErrorState:Function,onDownload:Function,defaultUpload:{type:Boolean,default:!0},fileList:Array,"onUpdate:fileList":[Function,Array],onUpdateFileList:[Function,Array],fileListStyle:[String,Object],defaultFileList:{type:Array,default:()=>[]},showCancelButton:{type:Boolean,default:!0},showRemoveButton:{type:Boolean,default:!0},showDownloadButton:Boolean,showRetryButton:{type:Boolean,default:!0},showPreviewButton:{type:Boolean,default:!0},listType:{type:String,default:"text"},onPreview:Function,shouldUseThumbnailUrl:{type:Function,default:i=>K0?ru(i):!1},createThumbnailUrl:Function,abstract:Boolean,max:Number,showTrigger:{type:Boolean,default:!0},imageGroupProps:Object,inputProps:Object,triggerStyle:[String,Object],renderIcon:Function}),Q1=Ce({name:"Upload",props:Z1,setup(i){i.abstract&&i.listType==="image-card"&&Xn("upload","when the list-type is image-card, abstract is not supported.");const{mergedClsPrefixRef:e,inlineThemeDisabled:t}=Sr(i),r=si("Upload","-upload",_1,lm,i,e),n=am(i),o=be(()=>{const{max:m}=i;return m!==void 0?f.value.length>=m:!1}),s=ie(i.defaultFileList),l=pe(i,"fileList"),a=ie(null),h={value:!1},c=ie(!1),d=new Map,u=Nr(l,s),f=be(()=>u.value.map(Ln));function g(){var m;(m=a.value)===null||m===void 0||m.click()}function y(m){const N=m.target;D(N.files?Array.from(N.files).map(V=>({file:V,entry:null,source:"input"})):null,m),N.value=""}function b(m){const{"onUpdate:fileList":N,onUpdateFileList:V}=i;N&&Ye(N,m),V&&Ye(V,m),s.value=m}const C=be(()=>i.multiple||i.directory);function D(m,N){if(!m||m.length===0)return;const{onBeforeUpload:V}=i;m=C.value?m:[m[0]];const{max:J,accept:U}=i;m=m.filter(({file:te,source:$})=>$==="dnd"&&(U!=null&&U.trim())?Y0(te.name,te.type,U):!0),J&&(m=m.slice(0,J-f.value.length));const re=wl();Promise.all(m.map(({file:te,entry:$})=>Rh(this,void 0,void 0,function*(){var ne;const X={id:wl(),batchId:re,name:te.name,status:"pending",percentage:0,file:te,url:null,type:te.type,thumbnailUrl:null,fullPath:(ne=$==null?void 0:$.fullPath)!==null&&ne!==void 0?ne:`/${te.webkitRelativePath||te.name}`};return!V||(yield V({file:X,fileList:f.value}))!==!1?X:null}))).then(te=>Rh(this,void 0,void 0,function*(){let $=Promise.resolve();te.forEach(ne=>{$=$.then(pr).then(()=>{ne&&A(ne,N,{append:!0})})}),yield $})).then(()=>{i.defaultUpload&&T()})}function T(m){const{method:N,action:V,withCredentials:J,headers:U,data:re,name:te}=i,$=m!==void 0?f.value.filter(X=>X.id===m):f.value,ne=m!==void 0;$.forEach(X=>{const{status:Z}=X;(Z==="pending"||Z==="error"&&ne)&&(i.customRequest?q1({inst:{doChange:A,xhrMap:d,onFinish:i.onFinish,onError:i.onError},file:X,action:V,withCredentials:J,headers:U,data:re,customRequest:i.customRequest}):J1({doChange:A,xhrMap:d,onFinish:i.onFinish,onError:i.onError,isErrorState:i.isErrorState},te,X,{method:N,action:V,withCredentials:J,responseType:i.responseType,headers:U,data:re}))})}const A=(m,N,V={append:!1,remove:!1})=>{const{append:J,remove:U}=V,re=Array.from(f.value),te=re.findIndex($=>$.id===m.id);if(J||U||~te){J?re.push(m):U?re.splice(te,1):re.splice(te,1,m);const{onChange:$}=i;$&&$({file:m,fileList:re,event:N}),b(re)}};function S(m){var N;if(m.thumbnailUrl)return m.thumbnailUrl;const{createThumbnailUrl:V}=i;return V?(N=V(m.file,m))!==null&&N!==void 0?N:m.url||"":m.url?m.url:m.file?_0(m.file):""}const k=be(()=>{const{common:{cubicBezierEaseInOut:m},self:{draggerColor:N,draggerBorder:V,draggerBorderHover:J,itemColorHover:U,itemColorHoverError:re,itemTextColorError:te,itemTextColorSuccess:$,itemTextColor:ne,itemIconColor:X,itemDisabledOpacity:Z,lineHeight:P,borderRadius:W,fontSize:K,itemBorderImageCardError:fe,itemBorderImageCard:Ge}}=r.value;return{"--n-bezier":m,"--n-border-radius":W,"--n-dragger-border":V,"--n-dragger-border-hover":J,"--n-dragger-color":N,"--n-font-size":K,"--n-item-color-hover":U,"--n-item-color-hover-error":re,"--n-item-disabled-opacity":Z,"--n-item-icon-color":X,"--n-item-text-color":ne,"--n-item-text-color-error":te,"--n-item-text-color-success":$,"--n-line-height":P,"--n-item-border-image-card-error":fe,"--n-item-border-image-card":Ge}}),v=t?Yn("upload",void 0,k,i):void 0;Jn(nn,{mergedClsPrefixRef:e,mergedThemeRef:r,showCancelButtonRef:pe(i,"showCancelButton"),showDownloadButtonRef:pe(i,"showDownloadButton"),showRemoveButtonRef:pe(i,"showRemoveButton"),showRetryButtonRef:pe(i,"showRetryButton"),onRemoveRef:pe(i,"onRemove"),onDownloadRef:pe(i,"onDownload"),mergedFileListRef:f,triggerStyleRef:pe(i,"triggerStyle"),shouldUseThumbnailUrlRef:pe(i,"shouldUseThumbnailUrl"),renderIconRef:pe(i,"renderIcon"),xhrMap:d,submit:T,doChange:A,showPreviewButtonRef:pe(i,"showPreviewButton"),onPreviewRef:pe(i,"onPreview"),getFileThumbnailUrlResolver:S,listTypeRef:pe(i,"listType"),dragOverRef:c,openOpenFileDialog:g,draggerInsideRef:h,handleFileAddition:D,mergedDisabledRef:n.mergedDisabledRef,maxReachedRef:o,fileListStyleRef:pe(i,"fileListStyle"),abstractRef:pe(i,"abstract"),acceptRef:pe(i,"accept"),cssVarsRef:t?void 0:k,themeClassRef:v==null?void 0:v.themeClass,onRender:v==null?void 0:v.onRender,showTriggerRef:pe(i,"showTrigger"),imageGroupPropsRef:pe(i,"imageGroupProps"),mergedDirectoryDndRef:be(()=>{var m;return(m=i.directoryDnd)!==null&&m!==void 0?m:i.directory})});const R={clear:()=>{s.value=[]},submit:T,openOpenFileDialog:g};return Object.assign({mergedClsPrefix:e,draggerInsideRef:h,inputElRef:a,mergedTheme:r,dragOver:c,mergedMultiple:C,cssVars:t?void 0:k,themeClass:v==null?void 0:v.themeClass,onRender:v==null?void 0:v.onRender,handleFileInputChange:y},R)},render(){var i,e;const{draggerInsideRef:t,mergedClsPrefix:r,$slots:n,directory:o,onRender:s}=this;if(n.default&&!this.abstract){const a=n.default()[0];!((i=a==null?void 0:a.type)===null||i===void 0)&&i[du]&&(t.value=!0)}const l=x("input",Object.assign({},this.inputProps,{ref:"inputElRef",type:"file",class:`${r}-upload-file-input`,accept:this.accept,multiple:this.mergedMultiple,onChange:this.handleFileInputChange,webkitdirectory:o||void 0,directory:o||void 0}));return this.abstract?x(Ur,null,(e=n.default)===null||e===void 0?void 0:e.call(n),x(hm,{to:"body"},l)):(s==null||s(),x("div",{class:[`${r}-upload`,t.value&&`${r}-upload--dragger-inside`,this.dragOver&&`${r}-upload--drag-over`,this.themeClass],style:this.cssVars},l,this.showTrigger&&this.listType!=="image-card"&&x(fu,null,n),this.showFileList&&x(U1,null,n)))}});function ks(i){var e=i.statementIndent,t=i.jsonld,r=i.json||t,n=i.typescript,o=i.wordCharacters||/[\w$\xa1-\uffff]/,s=function(){function p(zt){return{type:zt,style:"keyword"}}var w=p("keyword a"),B=p("keyword b"),q=p("keyword c"),le=p("keyword d"),Ae=p("operator"),Ie={type:"atom",style:"atom"};return{if:p("if"),while:w,with:w,else:B,do:B,try:B,finally:B,return:le,break:le,continue:le,new:p("new"),delete:q,void:q,throw:q,debugger:p("debugger"),var:p("var"),const:p("var"),let:p("var"),function:p("function"),catch:p("catch"),for:p("for"),switch:p("switch"),case:p("case"),default:p("default"),in:Ae,typeof:Ae,instanceof:Ae,true:Ie,false:Ie,null:Ie,undefined:Ie,NaN:Ie,Infinity:Ie,this:p("this"),class:p("class"),super:p("atom"),yield:q,export:p("export"),import:p("import"),extends:q,await:q}}(),l=/[+\-*&%=<>!?|~^@]/,a=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function h(p){for(var w=!1,B,q=!1;(B=p.next())!=null;){if(!w){if(B=="/"&&!q)return;B=="["?q=!0:q&&B=="]"&&(q=!1)}w=!w&&B=="\\"}}var c,d;function u(p,w,B){return c=p,d=B,w}function f(p,w){var B=p.next();if(B=='"'||B=="'")return w.tokenize=g(B),w.tokenize(p,w);if(B=="."&&p.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return u("number","number");if(B=="."&&p.match(".."))return u("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(B))return u(B);if(B=="="&&p.eat(">"))return u("=>","operator");if(B=="0"&&p.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return u("number","number");if(/\d/.test(B))return p.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),u("number","number");if(B=="/")return p.eat("*")?(w.tokenize=y,y(p,w)):p.eat("/")?(p.skipToEnd(),u("comment","comment")):lr(p,w,1)?(h(p),p.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),u("regexp","string.special")):(p.eat("="),u("operator","operator",p.current()));if(B=="`")return w.tokenize=b,b(p,w);if(B=="#"&&p.peek()=="!")return p.skipToEnd(),u("meta","meta");if(B=="#"&&p.eatWhile(o))return u("variable","property");if(B=="<"&&p.match("!--")||B=="-"&&p.match("->")&&!/\S/.test(p.string.slice(0,p.start)))return p.skipToEnd(),u("comment","comment");if(l.test(B))return(B!=">"||!w.lexical||w.lexical.type!=">")&&(p.eat("=")?(B=="!"||B=="=")&&p.eat("="):/[<>*+\-|&?]/.test(B)&&(p.eat(B),B==">"&&p.eat(B))),B=="?"&&p.eat(".")?u("."):u("operator","operator",p.current());if(o.test(B)){p.eatWhile(o);var q=p.current();if(w.lastType!="."){if(s.propertyIsEnumerable(q)){var le=s[q];return u(le.type,le.style,q)}if(q=="async"&&p.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return u("async","keyword",q)}return u("variable","variable",q)}}function g(p){return function(w,B){var q=!1,le;if(t&&w.peek()=="@"&&w.match(a))return B.tokenize=f,u("jsonld-keyword","meta");for(;(le=w.next())!=null&&!(le==p&&!q);)q=!q&&le=="\\";return q||(B.tokenize=f),u("string","string")}}function y(p,w){for(var B=!1,q;q=p.next();){if(q=="/"&&B){w.tokenize=f;break}B=q=="*"}return u("comment","comment")}function b(p,w){for(var B=!1,q;(q=p.next())!=null;){if(!B&&(q=="`"||q=="$"&&p.eat("{"))){w.tokenize=f;break}B=!B&&q=="\\"}return u("quasi","string.special",p.current())}var C="([{}])";function D(p,w){w.fatArrowAt&&(w.fatArrowAt=null);var B=p.string.indexOf("=>",p.start);if(!(B<0)){if(n){var q=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(p.string.slice(p.start,B));q&&(B=q.index)}for(var le=0,Ae=!1,Ie=B-1;Ie>=0;--Ie){var zt=p.string.charAt(Ie),_t=C.indexOf(zt);if(_t>=0&&_t<3){if(!le){++Ie;break}if(--le==0){zt=="("&&(Ae=!0);break}}else if(_t>=3&&_t<6)++le;else if(o.test(zt))Ae=!0;else if(/["'\/`]/.test(zt))for(;;--Ie){if(Ie==0)return;var pn=p.string.charAt(Ie-1);if(pn==zt&&p.string.charAt(Ie-2)!="\\"){Ie--;break}}else if(Ae&&!le){++Ie;break}}Ae&&!le&&(w.fatArrowAt=Ie)}}var T={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function A(p,w,B,q,le,Ae){this.indented=p,this.column=w,this.type=B,this.prev=le,this.info=Ae,q!=null&&(this.align=q)}function S(p,w){for(var B=p.localVars;B;B=B.next)if(B.name==w)return!0;for(var q=p.context;q;q=q.prev)for(var B=q.vars;B;B=B.next)if(B.name==w)return!0}function k(p,w,B,q,le){var Ae=p.cc;for(v.state=p,v.stream=le,v.marked=null,v.cc=Ae,v.style=w,p.lexical.hasOwnProperty("align")||(p.lexical.align=!0);;){var Ie=Ae.length?Ae.pop():r?we:fe;if(Ie(B,q)){for(;Ae.length&&Ae[Ae.length-1].lex;)Ae.pop()();return v.marked?v.marked:B=="variable"&&S(p,q)?"variableName.local":w}}}var v={state:null,column:null,marked:null,cc:null};function R(){for(var p=arguments.length-1;p>=0;p--)v.cc.push(arguments[p])}function m(){return R.apply(null,arguments),!0}function N(p,w){for(var B=w;B;B=B.next)if(B.name==p)return!0;return!1}function V(p){var w=v.state;if(v.marked="def",w.context){if(w.lexical.info=="var"&&w.context&&w.context.block){var B=J(p,w.context);if(B!=null){w.context=B;return}}else if(!N(p,w.localVars)){w.localVars=new te(p,w.localVars);return}}i.globalVars&&!N(p,w.globalVars)&&(w.globalVars=new te(p,w.globalVars))}function J(p,w){if(w)if(w.block){var B=J(p,w.prev);return B?B==w.prev?w:new re(B,w.vars,!0):null}else return N(p,w.vars)?w:new re(w.prev,new te(p,w.vars),!1);else return null}function U(p){return p=="public"||p=="private"||p=="protected"||p=="abstract"||p=="readonly"}function re(p,w,B){this.prev=p,this.vars=w,this.block=B}function te(p,w){this.name=p,this.next=w}var $=new te("this",new te("arguments",null));function ne(){v.state.context=new re(v.state.context,v.state.localVars,!1),v.state.localVars=$}function X(){v.state.context=new re(v.state.context,v.state.localVars,!0),v.state.localVars=null}ne.lex=X.lex=!0;function Z(){v.state.localVars=v.state.context.vars,v.state.context=v.state.context.prev}Z.lex=!0;function P(p,w){var B=function(){var q=v.state,le=q.indented;if(q.lexical.type=="stat")le=q.lexical.indented;else for(var Ae=q.lexical;Ae&&Ae.type==")"&&Ae.align;Ae=Ae.prev)le=Ae.indented;q.lexical=new A(le,v.stream.column(),p,null,q.lexical,w)};return B.lex=!0,B}function W(){var p=v.state;p.lexical.prev&&(p.lexical.type==")"&&(p.indented=p.lexical.indented),p.lexical=p.lexical.prev)}W.lex=!0;function K(p){function w(B){return B==p?m():p==";"||B=="}"||B==")"||B=="]"?R():m(w)}return w}function fe(p,w){return p=="var"?m(P("vardef",w),sr,K(";"),W):p=="keyword a"?m(P("form"),bt,fe,W):p=="keyword b"?m(P("form"),fe,W):p=="keyword d"?v.stream.match(/^\s*$/,!1)?m():m(P("stat"),nt,K(";"),W):p=="debugger"?m(K(";")):p=="{"?m(P("}"),X,jt,W,Z):p==";"?m():p=="if"?(v.state.lexical.info=="else"&&v.state.cc[v.state.cc.length-1]==W&&v.state.cc.pop()(),m(P("form"),bt,fe,W,Dr)):p=="function"?m(di):p=="for"?m(P("form"),X,ao,fe,Z,W):p=="class"||n&&w=="interface"?(v.marked="keyword",m(P("form",p=="class"?p:w),H,W)):p=="variable"?n&&w=="declare"?(v.marked="keyword",m(fe)):n&&(w=="module"||w=="enum"||w=="type")&&v.stream.match(/^\s*\w/,!1)?(v.marked="keyword",w=="enum"?m(Lt):w=="type"?m(fn,K("operator"),Te,K(";")):m(P("form"),xt,K("{"),P("}"),jt,W,W)):n&&w=="namespace"?(v.marked="keyword",m(P("form"),we,fe,W)):n&&w=="abstract"?(v.marked="keyword",m(fe)):m(P("stat"),j):p=="switch"?m(P("form"),bt,K("{"),P("}","switch"),X,jt,W,W,Z):p=="case"?m(we,K(":")):p=="default"?m(K(":")):p=="catch"?m(P("form"),ne,Ge,fe,W,Z):p=="export"?m(P("stat"),$e,W):p=="import"?m(P("stat"),kt,W):p=="async"?m(fe):w=="@"?m(we,fe):R(P("stat"),we,K(";"),W)}function Ge(p){if(p=="(")return m(Dt,K(")"))}function we(p,w){return Tt(p,w,!1)}function Be(p,w){return Tt(p,w,!0)}function bt(p){return p!="("?R():m(P(")"),nt,K(")"),W)}function Tt(p,w,B){if(v.state.fatArrowAt==v.stream.start){var q=B?Q:ue;if(p=="(")return m(ne,P(")"),ke(Dt,")"),W,K("=>"),q,Z);if(p=="variable")return R(ne,xt,K("=>"),q,Z)}var le=B?yt:_e;return T.hasOwnProperty(p)?m(le):p=="function"?m(di,le):p=="class"||n&&w=="interface"?(v.marked="keyword",m(P("form"),O,W)):p=="keyword c"||p=="async"?m(B?Be:we):p=="("?m(P(")"),nt,K(")"),W,le):p=="operator"||p=="spread"?m(B?Be:we):p=="["?m(P("]"),Pt,W,le):p=="{"?wt(me,"}",null,le):p=="quasi"?R(Xe,le):p=="new"?m(z(B)):m()}function nt(p){return p.match(/[;\}\)\],]/)?R():R(we)}function _e(p,w){return p==","?m(nt):yt(p,w,!1)}function yt(p,w,B){var q=B==!1?_e:yt,le=B==!1?we:Be;if(p=="=>")return m(ne,B?Q:ue,Z);if(p=="operator")return/\+\+|--/.test(w)||n&&w=="!"?m(q):n&&w=="<"&&v.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?m(P(">"),ke(Te,">"),W,q):w=="?"?m(we,K(":"),le):m(le);if(p=="quasi")return R(Xe,q);if(p!=";"){if(p=="(")return wt(Be,")","call",q);if(p==".")return m(de,q);if(p=="[")return m(P("]"),nt,K("]"),W,q);if(n&&w=="as")return v.marked="keyword",m(Te,q);if(p=="regexp")return v.state.lastType=v.marked="operator",v.stream.backUp(v.stream.pos-v.stream.start-1),m(le)}}function Xe(p,w){return p!="quasi"?R():w.slice(w.length-2)!="${"?m(Xe):m(nt,ee)}function ee(p){if(p=="}")return v.marked="string.special",v.state.tokenize=b,m(Xe)}function ue(p){return D(v.stream,v.state),R(p=="{"?fe:we)}function Q(p){return D(v.stream,v.state),R(p=="{"?fe:Be)}function z(p){return function(w){return w=="."?m(p?I:M):w=="variable"&&n?m(Mr,p?yt:_e):R(p?Be:we)}}function M(p,w){if(w=="target")return v.marked="keyword",m(_e)}function I(p,w){if(w=="target")return v.marked="keyword",m(yt)}function j(p){return p==":"?m(W,fe):R(_e,K(";"),W)}function de(p){if(p=="variable")return v.marked="property",m()}function me(p,w){if(p=="async")return v.marked="property",m(me);if(p=="variable"||v.style=="keyword"){if(v.marked="property",w=="get"||w=="set")return m(Se);var B;return n&&v.state.fatArrowAt==v.stream.start&&(B=v.stream.match(/^\s*:\s*/,!1))&&(v.state.fatArrowAt=v.stream.pos+B[0].length),m(Re)}else{if(p=="number"||p=="string")return v.marked=t?"property":v.style+" property",m(Re);if(p=="jsonld-keyword")return m(Re);if(n&&U(w))return v.marked="keyword",m(me);if(p=="[")return m(we,ai,K("]"),Re);if(p=="spread")return m(Be,Re);if(w=="*")return v.marked="keyword",m(me);if(p==":")return R(Re)}}function Se(p){return p!="variable"?R(Re):(v.marked="property",m(di))}function Re(p){if(p==":")return m(Be);if(p=="(")return R(di)}function ke(p,w,B){function q(le,Ae){if(B?B.indexOf(le)>-1:le==","){var Ie=v.state.lexical;return Ie.info=="call"&&(Ie.pos=(Ie.pos||0)+1),m(function(zt,_t){return zt==w||_t==w?R():R(p)},q)}return le==w||Ae==w?m():B&&B.indexOf(";")>-1?R(p):m(K(w))}return function(le,Ae){return le==w||Ae==w?m():R(p,q)}}function wt(p,w,B){for(var q=3;q<arguments.length;q++)v.cc.push(arguments[q]);return m(P(w,B),ke(p,w),W)}function jt(p){return p=="}"?m():R(fe,jt)}function ai(p,w){if(n){if(p==":")return m(Te);if(w=="?")return m(ai)}}function an(p,w){if(n&&(p==":"||w=="in"))return m(Te)}function Ar(p){if(n&&p==":")return v.stream.match(/^\s*\w+\s+is\b/,!1)?m(we,hn,Te):m(Te)}function hn(p,w){if(w=="is")return v.marked="keyword",m()}function Te(p,w){if(w=="keyof"||w=="typeof"||w=="infer"||w=="readonly")return v.marked="keyword",m(w=="typeof"?Be:Te);if(p=="variable"||w=="void")return v.marked="type",m(ut);if(w=="|"||w=="&")return m(Te);if(p=="string"||p=="number"||p=="atom")return m(ut);if(p=="[")return m(P("]"),ke(Te,"]",","),W,ut);if(p=="{")return m(P("}"),Qt,W,ut);if(p=="(")return m(ke(Fi,")"),cn,ut);if(p=="<")return m(ke(Te,">"),Te);if(p=="quasi")return R(It,ut)}function cn(p){if(p=="=>")return m(Te)}function Qt(p){return p.match(/[\}\)\]]/)?m():p==","||p==";"?m(Qt):R(Mi,Qt)}function Mi(p,w){if(p=="variable"||v.style=="keyword")return v.marked="property",m(Mi);if(w=="?"||p=="number"||p=="string")return m(Mi);if(p==":")return m(Te);if(p=="[")return m(K("variable"),an,K("]"),Mi);if(p=="(")return R(Hi,Mi);if(!p.match(/[;\}\)\],]/))return m()}function It(p,w){return p!="quasi"?R():w.slice(w.length-2)!="${"?m(It):m(Te,hi)}function hi(p){if(p=="}")return v.marked="string.special",v.state.tokenize=b,m(It)}function Fi(p,w){return p=="variable"&&v.stream.match(/^\s*[?:]/,!1)||w=="?"?m(Fi):p==":"?m(Te):p=="spread"?m(Fi):R(Te)}function ut(p,w){if(w=="<")return m(P(">"),ke(Te,">"),W,ut);if(w=="|"||p=="."||w=="&")return m(Te);if(p=="[")return m(Te,K("]"),ut);if(w=="extends"||w=="implements")return v.marked="keyword",m(Te);if(w=="?")return m(Te,K(":"),Te)}function Mr(p,w){if(w=="<")return m(P(">"),ke(Te,">"),W,ut)}function ci(){return R(Te,dn)}function dn(p,w){if(w=="=")return m(Te)}function sr(p,w){return w=="enum"?(v.marked="keyword",m(Lt)):R(xt,ai,Ut,Tr)}function xt(p,w){if(n&&U(w))return v.marked="keyword",m(xt);if(p=="variable")return V(w),m();if(p=="spread")return m(xt);if(p=="[")return wt(un,"]");if(p=="{")return wt(Rr,"}")}function Rr(p,w){return p=="variable"&&!v.stream.match(/^\s*:/,!1)?(V(w),m(Ut)):(p=="variable"&&(v.marked="property"),p=="spread"?m(xt):p=="}"?R():p=="["?m(we,K("]"),K(":"),Rr):m(K(":"),xt,Ut))}function un(){return R(xt,Ut)}function Ut(p,w){if(w=="=")return m(Be)}function Tr(p){if(p==",")return m(sr)}function Dr(p,w){if(p=="keyword b"&&w=="else")return m(P("form","else"),fe,W)}function ao(p,w){if(w=="await")return m(ao);if(p=="(")return m(P(")"),Is,W)}function Is(p){return p=="var"?m(sr,$i):p=="variable"?m($i):R($i)}function $i(p,w){return p==")"?m():p==";"?m($i):w=="in"||w=="of"?(v.marked="keyword",m(we,$i)):R(we,$i)}function di(p,w){if(w=="*")return v.marked="keyword",m(di);if(p=="variable")return V(w),m(di);if(p=="(")return m(ne,P(")"),ke(Dt,")"),W,Ar,fe,Z);if(n&&w=="<")return m(P(">"),ke(ci,">"),W,di)}function Hi(p,w){if(w=="*")return v.marked="keyword",m(Hi);if(p=="variable")return V(w),m(Hi);if(p=="(")return m(ne,P(")"),ke(Dt,")"),W,Ar,Z);if(n&&w=="<")return m(P(">"),ke(ci,">"),W,Hi)}function fn(p,w){if(p=="keyword"||p=="variable")return v.marked="type",m(fn);if(w=="<")return m(P(">"),ke(ci,">"),W)}function Dt(p,w){return w=="@"&&m(we,Dt),p=="spread"?m(Dt):n&&U(w)?(v.marked="keyword",m(Dt)):n&&p=="this"?m(ai,Ut):R(xt,ai,Ut)}function O(p,w){return p=="variable"?H(p,w):Y(p,w)}function H(p,w){if(p=="variable")return V(w),m(Y)}function Y(p,w){if(w=="<")return m(P(">"),ke(ci,">"),W,Y);if(w=="extends"||w=="implements"||n&&p==",")return w=="implements"&&(v.marked="keyword"),m(n?Te:we,Y);if(p=="{")return m(P("}"),se,W)}function se(p,w){if(p=="async"||p=="variable"&&(w=="static"||w=="get"||w=="set"||n&&U(w))&&v.stream.match(/^\s+#?[\w$\xa1-\uffff]/,!1))return v.marked="keyword",m(se);if(p=="variable"||v.style=="keyword")return v.marked="property",m(he,se);if(p=="number"||p=="string")return m(he,se);if(p=="[")return m(we,ai,K("]"),he,se);if(w=="*")return v.marked="keyword",m(se);if(n&&p=="(")return R(Hi,se);if(p==";"||p==",")return m(se);if(p=="}")return m();if(w=="@")return m(we,se)}function he(p,w){if(w=="!"||w=="?")return m(he);if(p==":")return m(Te,Ut);if(w=="=")return m(Be);var B=v.state.lexical.prev,q=B&&B.info=="interface";return R(q?Hi:di)}function $e(p,w){return w=="*"?(v.marked="keyword",m(De,K(";"))):w=="default"?(v.marked="keyword",m(we,K(";"))):p=="{"?m(ke(ot,"}"),De,K(";")):R(fe)}function ot(p,w){if(w=="as")return v.marked="keyword",m(K("variable"));if(p=="variable")return R(Be,ot)}function kt(p){return p=="string"?m():p=="("?R(we):p=="."?R(_e):R(ei,Ri,De)}function ei(p,w){return p=="{"?wt(ei,"}"):(p=="variable"&&V(w),w=="*"&&(v.marked="keyword"),m(Ot))}function Ri(p){if(p==",")return m(ei,Ri)}function Ot(p,w){if(w=="as")return v.marked="keyword",m(ei)}function De(p,w){if(w=="from")return v.marked="keyword",m(we)}function Pt(p){return p=="]"?m():R(ke(Be,"]"))}function Lt(){return R(P("form"),xt,K("{"),P("}"),ke(Oe,"}"),W,W)}function Oe(){return R(xt,Ut)}function et(p,w){return p.lastType=="operator"||p.lastType==","||l.test(w.charAt(0))||/[,.]/.test(w.charAt(0))}function lr(p,w,B){return w.tokenize==f&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(w.lastType)||w.lastType=="quasi"&&/\{\s*$/.test(p.string.slice(0,p.pos-(B||0)))}return{name:i.name,startState:function(p){var w={tokenize:f,lastType:"sof",cc:[],lexical:new A(-p,0,"block",!1),localVars:i.localVars,context:i.localVars&&new re(null,null,!1),indented:0};return i.globalVars&&typeof i.globalVars=="object"&&(w.globalVars=i.globalVars),w},token:function(p,w){if(p.sol()&&(w.lexical.hasOwnProperty("align")||(w.lexical.align=!1),w.indented=p.indentation(),D(p,w)),w.tokenize!=y&&p.eatSpace())return null;var B=w.tokenize(p,w);return c=="comment"?B:(w.lastType=c=="operator"&&(d=="++"||d=="--")?"incdec":c,k(w,B,c,d,p))},indent:function(p,w,B){if(p.tokenize==y||p.tokenize==b)return null;if(p.tokenize!=f)return 0;var q=w&&w.charAt(0),le=p.lexical,Ae;if(!/^\s*else\b/.test(w))for(var Ie=p.cc.length-1;Ie>=0;--Ie){var zt=p.cc[Ie];if(zt==W)le=le.prev;else if(zt!=Dr&&zt!=Z)break}for(;(le.type=="stat"||le.type=="form")&&(q=="}"||(Ae=p.cc[p.cc.length-1])&&(Ae==_e||Ae==yt)&&!/^[,\.=+\-*:?[\(]/.test(w));)le=le.prev;e&&le.type==")"&&le.prev.type=="stat"&&(le=le.prev);var _t=le.type,pn=q==_t;return _t=="vardef"?le.indented+(p.lastType=="operator"||p.lastType==","?le.info.length+1:0):_t=="form"&&q=="{"?le.indented:_t=="form"?le.indented+B.unit:_t=="stat"?le.indented+(et(p,w)?e||B.unit:0):le.info=="switch"&&!pn&&i.doubleIndentSwitch!=!1?le.indented+(/^(?:case|default)\b/.test(w)?B.unit:2*B.unit):le.align?le.column+(pn?0:1):le.indented+(pn?0:B.unit)},languageData:{indentOnInput:/^\s*(?:case .*?:|default:|\{|\})$/,commentTokens:r?void 0:{line:"//",block:{open:"/*",close:"*/"}},closeBrackets:{brackets:["(","[","{","'",'"',"`"]},wordChars:"$"}}}ks({name:"javascript"});const ev=ks({name:"json",json:!0});ks({name:"json",jsonld:!0});ks({name:"typescript",typescript:!0});function tv(i){return new RegExp("^(?:"+i.join("|")+")","i")}function Ss(i){return new RegExp("^(?:"+i.join("|")+")$","i")}var iv=Ss(["_G","_VERSION","assert","collectgarbage","dofile","error","getfenv","getmetatable","ipairs","load","loadfile","loadstring","module","next","pairs","pcall","print","rawequal","rawget","rawset","require","select","setfenv","setmetatable","tonumber","tostring","type","unpack","xpcall","coroutine.create","coroutine.resume","coroutine.running","coroutine.status","coroutine.wrap","coroutine.yield","debug.debug","debug.getfenv","debug.gethook","debug.getinfo","debug.getlocal","debug.getmetatable","debug.getregistry","debug.getupvalue","debug.setfenv","debug.sethook","debug.setlocal","debug.setmetatable","debug.setupvalue","debug.traceback","close","flush","lines","read","seek","setvbuf","write","io.close","io.flush","io.input","io.lines","io.open","io.output","io.popen","io.read","io.stderr","io.stdin","io.stdout","io.tmpfile","io.type","io.write","math.abs","math.acos","math.asin","math.atan","math.atan2","math.ceil","math.cos","math.cosh","math.deg","math.exp","math.floor","math.fmod","math.frexp","math.huge","math.ldexp","math.log","math.log10","math.max","math.min","math.modf","math.pi","math.pow","math.rad","math.random","math.randomseed","math.sin","math.sinh","math.sqrt","math.tan","math.tanh","os.clock","os.date","os.difftime","os.execute","os.exit","os.getenv","os.remove","os.rename","os.setlocale","os.time","os.tmpname","package.cpath","package.loaded","package.loaders","package.loadlib","package.path","package.preload","package.seeall","string.byte","string.char","string.dump","string.find","string.format","string.gmatch","string.gsub","string.len","string.lower","string.match","string.rep","string.reverse","string.sub","string.upper","table.concat","table.insert","table.maxn","table.remove","table.sort"]),rv=Ss(["and","break","elseif","false","nil","not","or","return","true","function","end","if","then","else","do","while","repeat","until","for","in","local"]),nv=Ss(["function","if","repeat","do","\\(","{"]),ov=Ss(["end","until","\\)","}"]),sv=tv(["end","until","\\)","}","else","elseif"]);function Th(i){for(var e=0;i.eat("=");)++e;return i.eat("["),e}function Sa(i,e){var t=i.next();return t=="-"&&i.eat("-")?i.eat("[")&&i.eat("[")?(e.cur=Dh(Th(i),"comment"))(i,e):(i.skipToEnd(),"comment"):t=='"'||t=="'"?(e.cur=lv(t))(i,e):t=="["&&/[\[=]/.test(i.peek())?(e.cur=Dh(Th(i),"string"))(i,e):/\d/.test(t)?(i.eatWhile(/[\w.%]/),"number"):/[\w_]/.test(t)?(i.eatWhile(/[\w\\\-_.]/),"variable"):null}function Dh(i,e){return function(t,r){for(var n=null,o;(o=t.next())!=null;)if(n==null)o=="]"&&(n=0);else if(o=="=")++n;else if(o=="]"&&n==i){r.cur=Sa;break}else n=null;return e}}function lv(i){return function(e,t){for(var r=!1,n;(n=e.next())!=null&&!(n==i&&!r);)r=!r&&n=="\\";return r||(t.cur=Sa),"string"}}const av={name:"lua",startState:function(){return{basecol:0,indentDepth:0,cur:Sa}},token:function(i,e){if(i.eatSpace())return null;var t=e.cur(i,e),r=i.current();return t=="variable"&&(rv.test(r)?t="keyword":iv.test(r)&&(t="builtin")),t!="comment"&&t!="string"&&(nv.test(r)?++e.indentDepth:ov.test(r)&&--e.indentDepth),t},indent:function(i,e,t){var r=sv.test(e);return i.basecol+t.unit*(i.indentDepth-(r?1:0))},languageData:{indentOnInput:/^\s*(?:end|until|else|\)|\})$/,commentTokens:{line:"--",block:{open:"--[[",close:"]]--"}}}};var hv=["true","false","on","off","yes","no"],cv=new RegExp("\\b(("+hv.join(")|(")+"))$","i");const dv={name:"yaml",token:function(i,e){var t=i.peek(),r=e.escaped;if(e.escaped=!1,t=="#"&&(i.pos==0||/\s/.test(i.string.charAt(i.pos-1))))return i.skipToEnd(),"comment";if(i.match(/^('([^']|\\.)*'?|"([^"]|\\.)*"?)/))return"string";if(e.literal&&i.indentation()>e.keyCol)return i.skipToEnd(),"string";if(e.literal&&(e.literal=!1),i.sol()){if(e.keyCol=0,e.pair=!1,e.pairStart=!1,i.match("---")||i.match("..."))return"def";if(i.match(/^\s*-\s+/))return"meta"}if(i.match(/^(\{|\}|\[|\])/))return t=="{"?e.inlinePairs++:t=="}"?e.inlinePairs--:t=="["?e.inlineList++:e.inlineList--,"meta";if(e.inlineList>0&&!r&&t==",")return i.next(),"meta";if(e.inlinePairs>0&&!r&&t==",")return e.keyCol=0,e.pair=!1,e.pairStart=!1,i.next(),"meta";if(e.pairStart){if(i.match(/^\s*(\||\>)\s*/))return e.literal=!0,"meta";if(i.match(/^\s*(\&|\*)[a-z0-9\._-]+\b/i))return"variable";if(e.inlinePairs==0&&i.match(/^\s*-?[0-9\.\,]+\s?$/)||e.inlinePairs>0&&i.match(/^\s*-?[0-9\.\,]+\s?(?=(,|}))/))return"number";if(i.match(cv))return"keyword"}return!e.pair&&i.match(/^\s*(?:[,\[\]{}&*!|>'"%@`][^\s'":]|[^,\[\]{}#&*!|>'"%@`])[^#]*?(?=\s*:($|\s))/)?(e.pair=!0,e.keyCol=i.indentation(),"atom"):e.pair&&i.match(/^:\s*/)?(e.pairStart=!0,"meta"):(e.pairStart=!1,e.escaped=t=="\\",i.next(),null)},startState:function(){return{pair:!1,pairStart:!1,keyCol:0,inlinePairs:0,inlineList:0,literal:!1,escaped:!1}},languageData:{commentTokens:{line:"#"}}};function xl(){return xl=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},xl.apply(this,arguments)}const uv={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},fv=Kr("path",{d:"M20 6h-8l-1.41-1.41C10.21 4.21 9.7 4 9.17 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-2 8h-2v2c0 .55-.45 1-1 1s-1-.45-1-1v-2h-2c-.55 0-1-.45-1-1s.45-1 1-1h2v-2c0-.55.45-1 1-1s1 .45 1 1v2h2c.55 0 1 .45 1 1s-.45 1-1 1z",fill:"currentColor"},null,-1),pv=[fv],gv=Ce({name:"CreateNewFolderRound",render:function(i,e){return ri(),br("svg",uv,pv)}}),mv={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},vv=Kr("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8.83c0-.53-.21-1.04-.59-1.41l-4.83-4.83c-.37-.38-.88-.59-1.41-.59H6zm7 6V3.5L18.5 9H14c-.55 0-1-.45-1-1z",fill:"currentColor"},null,-1),bv=[vv],yv=Ce({name:"InsertDriveFileRound",render:function(i,e){return ri(),br("svg",mv,bv)}}),wv={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},xv=Kr("path",{d:"M17.65 6.35a7.95 7.95 0 0 0-6.48-2.31c-3.67.37-6.69 3.35-7.1 7.02C3.52 15.91 7.27 20 12 20a7.98 7.98 0 0 0 7.21-4.56c.32-.67-.16-1.44-.9-1.44c-.37 0-.72.2-.88.53a5.994 5.994 0 0 1-6.8 3.31c-2.22-.49-4.01-2.3-4.48-4.52A6.002 6.002 0 0 1 12 6c1.66 0 3.14.69 4.22 1.78l-1.51 1.51c-.63.63-.19 1.71.7 1.71H19c.55 0 1-.45 1-1V6.41c0-.89-1.08-1.34-1.71-.71l-.64.65z",fill:"currentColor"},null,-1),kv=[xv],Sv=Ce({name:"RefreshRound",render:function(i,e){return ri(),br("svg",wv,kv)}});"stream"in Blob.prototype||Object.defineProperty(Blob.prototype,"stream",{value(){return new Response(this).body}}),"setBigUint64"in DataView.prototype||Object.defineProperty(DataView.prototype,"setBigUint64",{value(i,e,t){const r=Number(0xffffffffn&e),n=Number(e>>32n);this.setUint32(i+(t?0:4),r,t),this.setUint32(i+(t?4:0),n,t)}});var qr=i=>new DataView(new ArrayBuffer(i)),Oi=i=>new Uint8Array(i.buffer||i),Ir=i=>new TextEncoder().encode(String(i)),gr=i=>Math.min(4294967295,Number(i)),Oh=i=>Math.min(65535,Number(i));function Cv(i,e){if(e===void 0||e instanceof Date||(e=new Date(e)),i instanceof File)return{isFile:1,t:e||new Date(i.lastModified),i:i.stream()};if(i instanceof Response)return{isFile:1,t:e||new Date(i.headers.get("Last-Modified")||Date.now()),i:i.body};if(e===void 0)e=new Date;else if(isNaN(e))throw new Error("Invalid modification date.");if(i===void 0)return{isFile:0,t:e};if(typeof i=="string")return{isFile:1,t:e,i:Ir(i)};if(i instanceof Blob)return{isFile:1,t:e,i:i.stream()};if(i instanceof Uint8Array||i instanceof ReadableStream)return{isFile:1,t:e,i};if(i instanceof ArrayBuffer||ArrayBuffer.isView(i))return{isFile:1,t:e,i:Oi(i)};if(Symbol.asyncIterator in i)return{isFile:1,t:e,i:gu(i[Symbol.asyncIterator]())};throw new TypeError("Unsupported input format.")}function gu(i,e=i){return new ReadableStream({async pull(t){let r=0;for(;t.desiredSize>r;){const n=await i.next();if(!n.value){t.close();break}{const o=Av(n.value);t.enqueue(o),r+=o.byteLength}}},cancel(t){var r;(r=e.throw)==null||r.call(e,t)}})}function Av(i){return typeof i=="string"?Ir(i):i instanceof Uint8Array?i:Oi(i)}function mu(i,e,t){let[r,n]=function(o){return o?o instanceof Uint8Array?[o,1]:ArrayBuffer.isView(o)||o instanceof ArrayBuffer?[Oi(o),1]:[Ir(o),0]:[void 0,0]}(e);if(i instanceof File)return{o:Gs(r||Ir(i.name)),u:BigInt(i.size),l:n};if(i instanceof Response){const o=i.headers.get("content-disposition"),s=o&&o.match(/;\s*filename\*?=["']?(.*?)["']?$/i),l=s&&s[1]||i.url&&new URL(i.url).pathname.split("/").findLast(Boolean),a=l&&decodeURIComponent(l),h=t||+i.headers.get("content-length");return{o:Gs(r||Ir(a)),u:BigInt(h),l:n}}return r=Gs(r,i!==void 0||t!==void 0),typeof i=="string"?{o:r,u:BigInt(Ir(i).length),l:n}:i instanceof Blob?{o:r,u:BigInt(i.size),l:n}:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?{o:r,u:BigInt(i.byteLength),l:n}:{o:r,u:Mv(i,t),l:n}}function Mv(i,e){return e>-1?BigInt(e):i?void 0:0n}function Gs(i,e=1){if(!i||i.every(t=>t===47))throw new Error("The file must have a name.");if(e)for(;i[i.length-1]===47;)i=i.subarray(0,-1);else i[i.length-1]!==47&&(i=new Uint8Array([...i,47]));return i}var vu=new Uint32Array(256);for(let i=0;i<256;++i){let e=i;for(let t=0;t<8;++t)e=e>>>1^(1&e&&3988292384);vu[i]=e}function Ph(i,e=0){e^=-1;for(var t=0,r=i.length;t<r;t++)e=e>>>8^vu[255&e^i[t]];return(-1^e)>>>0}function bu(i,e,t=0){const r=i.getSeconds()>>1|i.getMinutes()<<5|i.getHours()<<11,n=i.getDate()|i.getMonth()+1<<5|i.getFullYear()-1980<<9;e.setUint16(t,r,1),e.setUint16(t+2,n,1)}function Rv({o:i,l:e},t){return 8*(!e||(t??function(r){try{Tv.decode(r)}catch{return 0}return 1}(i)))}var Tv=new TextDecoder("utf8",{fatal:1});function Dv(i,e=0){const t=qr(30);return t.setUint32(0,1347093252),t.setUint32(4,754976768|e),bu(i.t,t,10),t.setUint16(26,i.o.length,1),Oi(t)}async function*Ov(i){let{i:e}=i;if("then"in e&&(e=await e),e instanceof Uint8Array)yield e,i.m=Ph(e,0),i.u=BigInt(e.length);else{i.u=0n;const t=e.getReader();for(;;){const{value:r,done:n}=await t.read();if(n)break;i.m=Ph(r,i.m),i.u+=BigInt(r.length),yield r}}}function Pv(i,e){const t=qr(16+(e?8:0));return t.setUint32(0,1347094280),t.setUint32(4,i.isFile?i.m:0,1),e?(t.setBigUint64(8,i.u,1),t.setBigUint64(16,i.u,1)):(t.setUint32(8,gr(i.u),1),t.setUint32(12,gr(i.u),1)),Oi(t)}function Lv(i,e,t=0,r=0){const n=qr(46);return n.setUint32(0,1347092738),n.setUint32(4,755182848),n.setUint16(8,2048|t),bu(i.t,n,12),n.setUint32(16,i.isFile?i.m:0,1),n.setUint32(20,gr(i.u),1),n.setUint32(24,gr(i.u),1),n.setUint16(28,i.o.length,1),n.setUint16(30,r,1),n.setUint16(40,i.isFile?33204:16893,1),n.setUint32(42,gr(e),1),Oi(n)}function Ev(i,e,t){const r=qr(t);return r.setUint16(0,1,1),r.setUint16(2,t-4,1),16&t&&(r.setBigUint64(4,i.u,1),r.setBigUint64(12,i.u,1)),r.setBigUint64(t-8,e,1),Oi(r)}function yu(i){return i instanceof File||i instanceof Response?[[i],[i]]:[[i.input,i.name,i.size],[i.input,i.lastModified]]}var Bv=i=>function(e){let t=BigInt(22),r=0n,n=0;for(const o of e){if(!o.o)throw new Error("Every file must have a non-empty name.");if(o.u===void 0)throw new Error(`Missing size for file "${new TextDecoder().decode(o.o)}".`);const s=o.u>=0xffffffffn,l=r>=0xffffffffn;r+=BigInt(46+o.o.length+(s&&8))+o.u,t+=BigInt(o.o.length+46+(12*l|28*s)),n||(n=s)}return(n||r>=0xffffffffn)&&(t+=BigInt(76)),t+r}(function*(e){for(const t of e)yield mu(...yu(t)[0])}(i));function Nv(i,e={}){const t={"Content-Type":"application/zip","Content-Disposition":"attachment"};return(typeof e.length=="bigint"||Number.isInteger(e.length))&&e.length>0&&(t["Content-Length"]=String(e.length)),e.metadata&&(t["Content-Length"]=String(Bv(e.metadata))),new Response(Iv(i,e),{headers:t})}function Iv(i,e={}){const t=function(r){var n;const o=r[Symbol.iterator in r?Symbol.iterator:Symbol.asyncIterator]();return{async next(){const s=await o.next();if(s.done)return s;const[l,a]=yu(s.value);return{done:0,value:Object.assign(Cv(...a),mu(...l))}},throw:(n=o.throw)==null?void 0:n.bind(o),[Symbol.asyncIterator](){return this}}}(i);return gu(async function*(r,n){const o=[];let s=0n,l=0n,a=0;for await(const d of r){const u=Rv(d,n.buffersAreUTF8);yield Dv(d,u),yield d.o,d.isFile&&(yield*Ov(d));const f=d.u>=0xffffffffn,g=12*(s>=0xffffffffn)|28*f;yield Pv(d,f),o.push(Lv(d,s,u,g)),o.push(d.o),g&&o.push(Ev(d,s,g)),f&&(s+=8n),l++,s+=BigInt(46+d.o.length)+d.u,a||(a=f)}let h=0n;for(const d of o)yield d,h+=BigInt(d.length);if(a||s>=0xffffffffn){const d=qr(76);d.setUint32(0,1347094022),d.setBigUint64(4,BigInt(44),1),d.setUint32(12,755182848),d.setBigUint64(24,l,1),d.setBigUint64(32,l,1),d.setBigUint64(40,h,1),d.setBigUint64(48,s,1),d.setUint32(56,1347094023),d.setBigUint64(64,s+h,1),d.setUint32(72,1,1),yield Oi(d)}const c=qr(22);c.setUint32(0,1347093766),c.setUint16(8,Oh(l),1),c.setUint16(10,Oh(l),1),c.setUint32(12,gr(h),1),c.setUint32(16,gr(s),1),yield Oi(c)}(t,e),t)}async function wu(i,e){return(await i.readdir(e)).filter(t=>t!=="."&&t!=="..")}function Xs(i,e,t,r){async function n(o){const{mode:s}=await i.lstat(o);if(await i.isDir(s)){o.endsWith("/")||(o+="/"),e&&await e(o);const l=await wu(i,o);for(const a of l)await n(o+a);return r&&r(o)}return t(o)}return n}const zv=Ce({__name:"FileManager",props:{fs:{},height:{},hidePath:{},onOpenFile:{},onNewFile:{},onNewFolder:{},onUpload:{},onErrorPaste:{},onRename:{},onDeleteFile:{},onDeleteFolder:{},onErrorDownload:{}},setup(i,{expose:e}){const t=i,{fs:r,hidePath:n,onOpenFile:o,onNewFile:s,onNewFolder:l,onErrorPaste:a,onUpload:h,onRename:c,onDeleteFile:d,onDeleteFolder:u,onErrorDownload:f}=Zn(t),{height:g}=ws(t);function y(){return{key:"/",label:"/",isLeaf:!1}}const b=ie([y()]),C=ie([]),D=ie([]),T=ie(!1),A=ie(""),S=ie(!1),k=ie(0),v=ie(0),R=ie(""),m=ie(""),N=be(()=>{const M=R.value||m.value?[{label:"Paste",key:"paste"}]:[];return[{label:"Download",key:"download"},{label:"Upload",key:"upload"},{label:"Cut",key:"cut"},{label:"Copy",key:"copy"},...M,{label:"Rename",key:"rename"},{label:"Delete",key:"delete"}]});function V(){T.value=!1}function J(){if(D.value.length){const M=D.value[0];return W(M)}return"/"}function U(){b.value=[y()]}async function re(M){try{return await r.lstat(M),!0}catch{return!1}}async function te(M){if(await re(M)){const I=Error();throw I.name="PathExistsError",I}}function $(){const M=J();s(M,async I=>(await te(I),r.writeFile(I,"").finally(U)))}function ne(){const M=J();l(M,async I=>(await te(I),r.mkdir(I).finally(U)))}function X({option:M}){return{async onClick(){M.isFile&&o(M.key)},onContextmenu(I){T.value=!0,A.value=M.key,S.value=M.isFile,k.value=I.clientX,v.value=I.clientY,I.preventDefault()}}}const Z=Xs(r,void 0,r.unlink,r.rmdir);function P(M){return M.endsWith("/")&&(M=M.slice(0,M.length-1)),M.slice(M.lastIndexOf("/")+1)}function W(M){return M.slice(0,M.lastIndexOf("/")+1)}function K(M,I){if(M.endsWith("/")&&I.startsWith(M))return Promise.reject(new Error);const j=P(M);function de(me){return I+j+"/"+me.slice(M.length)}return Xs(r,me=>r.mkdir(de(me)),async me=>r.writeFile(de(me),await r.readFile(me)),void 0)(M)}function fe(M,I){const j=URL.createObjectURL(M),de=document.createElement("a");de.href=j,de.download=I,document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(j)}async function Ge(M){const I=await r.readFile(M),j=M.slice(M.lastIndexOf("/")+1),de=new Blob([I],{type:"application/octet-stream"});fe(de,j)}async function we(M){const I=M==="/"?"root":P(M),j=[];function de(ke){return I+"/"+ke.slice(M.length)}async function me(ke){j.push({name:de(ke),input:await r.readFile(ke)})}function Se(ke){j.push({name:de(ke)})}await Xs(r,void 0,me,Se)(M);const Re=await Nv(j).blob();fe(Re,I+".zip")}function Be(M){const I=W(M);h(I,async j=>{try{for(const{name:de,content:me}of j)await r.writeFile(I+de,me)}finally{U()}})}function bt(M){R.value=M,m.value=""}function Tt(M){R.value="",m.value=M}async function nt(M){const I=W(M);try{if(R.value){const j=P(R.value),de=I+j;await r.rename(R.value,de),R.value=""}else await K(m.value,I),m.value=""}catch{a&&a(I)}finally{U()}}function _e(M,I){return(I?u:d)(M,j=>Z(j).finally(U))}function yt(M){const I=A.value;switch(M){case"download":(S.value?Ge:we)(I).catch(()=>f&&f(I));break;case"upload":Be(I);break;case"cut":bt(I);break;case"copy":Tt(I);break;case"paste":nt(I);break;case"rename":c(I,async j=>{const de=I==="/"?j:I.slice(0,I.lastIndexOf("/",I.length-2))+"/"+j;return r.rename(I,de).finally(U)});break;case"delete":_e(I,!S.value);break}T.value=!1}async function Xe(M){const I=M.key,j=[],de=await wu(r,I);for(const me of de){const Se=I+me;if(n&&n(Se))continue;const Re={label:me},{mode:ke}=await r.lstat(Se);await r.isDir(ke)?(Re.key=Se+"/",Re.isLeaf=!1):(Re.key=Se,Re.isLeaf=!0,await r.isFile(ke)?Re.isFile=!0:Re.disabled=!0),j.push(Re)}j.sort((me,Se)=>me.key.localeCompare(Se.key)),M.children=j}async function ee(M){const{key:I,ctrlKey:j,metaKey:de,altKey:me,shiftKey:Se}=M,Re=/Macintosh/.test(navigator.userAgent),ke=!me&&!Se&&(Re&&!j&&de||!Re&&j&&!de),wt=D.value[0],{mode:jt}=await r.lstat(wt);switch(I){case"Delete":_e(wt,await r.isDir(jt));break;case"c":case"C":ke&&Tt(wt);break;case"v":case"V":ke&&nt(wt);break;case"x":case"X":ke&&bt(wt);break}}async function ue({node:M,dragNode:I}){const j=I.key,de=P(j),me=W(M.key),Se=me+de;try{await r.rename(j,Se)}catch{a&&a(me)}finally{U()}}function Q(M){M.key==="Escape"&&V()}_r(()=>document.addEventListener("keyup",Q)),pm(()=>document.removeEventListener("keyup",Q));function z(M){C.value.includes(M)||C.value.push(M)}return e({expandFolder:z}),(M,I)=>(ri(),br(Ur,null,[Je(ve(gm),{style:{gap:"5px"}},{default:Ht(()=>[Je(ve(Ki),{text:"",title:"New File",onClick:$},{default:Ht(()=>[Je(ve(Hs),{component:ve(yv)},null,8,["component"])]),_:1}),Je(ve(Ki),{text:"",title:"New Folder",onClick:ne},{default:Ht(()=>[Je(ve(Hs),{component:ve(gv)},null,8,["component"])]),_:1}),Je(ve(Ki),{text:"",title:"Refresh Explorer",onClick:U},{default:Ht(()=>[Je(ve(Hs),{component:ve(Sv)},null,8,["component"])]),_:1})]),_:1}),Je(ve(kh),{"x-scrollable":"",style:Rd({height:ve(g)})},{default:Ht(()=>[Je(ve(kh),null,{default:Ht(()=>[Je(ve(F1),{"expanded-keys":C.value,"onUpdate:expandedKeys":I[0]||(I[0]=j=>C.value=j),"selected-keys":D.value,"onUpdate:selectedKeys":I[1]||(I[1]=j=>D.value=j),animated:!1,cancelable:!1,draggable:"","expand-on-click":"",data:b.value,"node-props":X,onLoad:Xe,onKeydown:ee,onDrop:ue},null,8,["expanded-keys","selected-keys","data"]),Je(ve(mm),{trigger:"manual",placement:"bottom-start",show:T.value,options:N.value,x:k.value,y:v.value,onSelect:yt,onClickoutside:V},null,8,["show","options","x","y"])]),_:1})]),_:1},8,["style"])],64))}});class Pe{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,r){let n=[];return this.decompose(0,e,n,2),r.length&&r.decompose(0,r.length,n,3),this.decompose(t,this.length,n,1),vi.from(n,this.length-(t-e)+r.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){let r=[];return this.decompose(e,t,r,0),vi.from(r,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),r=this.length-this.scanIdentical(e,-1),n=new Rn(this),o=new Rn(e);for(let s=t,l=t;;){if(n.next(s),o.next(s),s=0,n.lineBreak!=o.lineBreak||n.done!=o.done||n.value!=o.value)return!1;if(l+=n.value.length,n.done||l>=r)return!0}}iter(e=1){return new Rn(this,e)}iterRange(e,t=this.length){return new xu(this,e,t)}iterLines(e,t){let r;if(e==null)r=this.iter();else{t==null&&(t=this.lines+1);let n=this.line(e).from;r=this.iterRange(n,Math.max(n,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new ku(r)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?Pe.empty:e.length<=32?new qe(e):vi.from(qe.split(e,[]))}}class qe extends Pe{constructor(e,t=Fv(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,r,n){for(let o=0;;o++){let s=this.text[o],l=n+s.length;if((t?r:l)>=e)return new $v(n,l,r,s);n=l+1,r++}}decompose(e,t,r,n){let o=e<=0&&t>=this.length?this:new qe(Lh(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(n&1){let s=r.pop(),l=No(o.text,s.text.slice(),0,o.length);if(l.length<=32)r.push(new qe(l,s.length+o.length));else{let a=l.length>>1;r.push(new qe(l.slice(0,a)),new qe(l.slice(a)))}}else r.push(o)}replace(e,t,r){if(!(r instanceof qe))return super.replace(e,t,r);let n=No(this.text,No(r.text,Lh(this.text,0,e)),t),o=this.length+r.length-(t-e);return n.length<=32?new qe(n,o):vi.from(qe.split(n,[]),o)}sliceString(e,t=this.length,r=`
`){let n="";for(let o=0,s=0;o<=t&&s<this.text.length;s++){let l=this.text[s],a=o+l.length;o>e&&s&&(n+=r),e<a&&t>o&&(n+=l.slice(Math.max(0,e-o),t-o)),o=a+1}return n}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let r=[],n=-1;for(let o of e)r.push(o),n+=o.length+1,r.length==32&&(t.push(new qe(r,n)),r=[],n=-1);return n>-1&&t.push(new qe(r,n)),t}}class vi extends Pe{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let r of e)this.lines+=r.lines}lineInner(e,t,r,n){for(let o=0;;o++){let s=this.children[o],l=n+s.length,a=r+s.lines-1;if((t?a:l)>=e)return s.lineInner(e,t,r,n);n=l+1,r=a+1}}decompose(e,t,r,n){for(let o=0,s=0;s<=t&&o<this.children.length;o++){let l=this.children[o],a=s+l.length;if(e<=a&&t>=s){let h=n&((s<=e?1:0)|(a>=t?2:0));s>=e&&a<=t&&!h?r.push(l):l.decompose(e-s,t-s,r,h)}s=a+1}}replace(e,t,r){if(r.lines<this.lines)for(let n=0,o=0;n<this.children.length;n++){let s=this.children[n],l=o+s.length;if(e>=o&&t<=l){let a=s.replace(e-o,t-o,r),h=this.lines-s.lines+a.lines;if(a.lines<h>>5-1&&a.lines>h>>5+1){let c=this.children.slice();return c[n]=a,new vi(c,this.length-(t-e)+r.length)}return super.replace(o,l,a)}o=l+1}return super.replace(e,t,r)}sliceString(e,t=this.length,r=`
`){let n="";for(let o=0,s=0;o<this.children.length&&s<=t;o++){let l=this.children[o],a=s+l.length;s>e&&o&&(n+=r),e<a&&t>s&&(n+=l.sliceString(e-s,t-s,r)),s=a+1}return n}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof vi))return 0;let r=0,[n,o,s,l]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;n+=t,o+=t){if(n==s||o==l)return r;let a=this.children[n],h=e.children[o];if(a!=h)return r+a.scanIdentical(h,t);r+=a.length+1}}static from(e,t=e.reduce((r,n)=>r+n.length+1,-1)){let r=0;for(let f of e)r+=f.lines;if(r<32){let f=[];for(let g of e)g.flatten(f);return new qe(f,t)}let n=Math.max(32,r>>5),o=n<<1,s=n>>1,l=[],a=0,h=-1,c=[];function d(f){let g;if(f.lines>o&&f instanceof vi)for(let y of f.children)d(y);else f.lines>s&&(a>s||!a)?(u(),l.push(f)):f instanceof qe&&a&&(g=c[c.length-1])instanceof qe&&f.lines+g.lines<=32?(a+=f.lines,h+=f.length+1,c[c.length-1]=new qe(g.text.concat(f.text),g.length+1+f.length)):(a+f.lines>n&&u(),a+=f.lines,h+=f.length+1,c.push(f))}function u(){a!=0&&(l.push(c.length==1?c[0]:vi.from(c,h)),h=-1,a=c.length=0)}for(let f of e)d(f);return u(),l.length==1?l[0]:new vi(l,t)}}Pe.empty=new qe([""],0);function Fv(i){let e=-1;for(let t of i)e+=t.length+1;return e}function No(i,e,t=0,r=1e9){for(let n=0,o=0,s=!0;o<i.length&&n<=r;o++){let l=i[o],a=n+l.length;a>=t&&(a>r&&(l=l.slice(0,r-n)),n<t&&(l=l.slice(t-n)),s?(e[e.length-1]+=l,s=!1):e.push(l)),n=a+1}return e}function Lh(i,e,t){return No(i,[""],e,t)}class Rn{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof qe?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let r=this.nodes.length-1,n=this.nodes[r],o=this.offsets[r],s=o>>1,l=n instanceof qe?n.text.length:n.children.length;if(s==(t>0?l:0)){if(r==0)return this.done=!0,this.value="",this;t>0&&this.offsets[r-1]++,this.nodes.pop(),this.offsets.pop()}else if((o&1)==(t>0?0:1)){if(this.offsets[r]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(n instanceof qe){let a=n.text[s+(t<0?-1:0)];if(this.offsets[r]+=t,a.length>Math.max(0,e))return this.value=e==0?a:t>0?a.slice(e):a.slice(0,a.length-e),this;e-=a.length}else{let a=n.children[s+(t<0?-1:0)];e>a.length?(e-=a.length,this.offsets[r]+=t):(t<0&&this.offsets[r]--,this.nodes.push(a),this.offsets.push(t>0?1:(a instanceof qe?a.text.length:a.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class xu{constructor(e,t,r){this.value="",this.done=!1,this.cursor=new Rn(e,t>r?-1:1),this.pos=t>r?e.length:0,this.from=Math.min(t,r),this.to=Math.max(t,r)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let r=t<0?this.pos-this.from:this.to-this.pos;e>r&&(e=r),r-=e;let{value:n}=this.cursor.next(e);return this.pos+=(n.length+e)*t,this.value=n.length<=r?n:t<0?n.slice(n.length-r):n.slice(0,r),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class ku{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:r,value:n}=this.inner.next(e);return t?(this.done=!0,this.value=""):r?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(Pe.prototype[Symbol.iterator]=function(){return this.iter()},Rn.prototype[Symbol.iterator]=xu.prototype[Symbol.iterator]=ku.prototype[Symbol.iterator]=function(){return this});class $v{constructor(e,t,r,n){this.from=e,this.to=t,this.number=r,this.text=n}get length(){return this.to-this.from}}let Hr="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(i=>i?parseInt(i,36):1);for(let i=1;i<Hr.length;i++)Hr[i]+=Hr[i-1];function Hv(i){for(let e=1;e<Hr.length;e+=2)if(Hr[e]>i)return Hr[e-1]<=i;return!1}function Eh(i){return i>=127462&&i<=127487}const Bh=8205;function mt(i,e,t=!0,r=!0){return(t?Su:Wv)(i,e,r)}function Su(i,e,t){if(e==i.length)return e;e&&Cu(i.charCodeAt(e))&&Au(i.charCodeAt(e-1))&&e--;let r=lt(i,e);for(e+=Gt(r);e<i.length;){let n=lt(i,e);if(r==Bh||n==Bh||t&&Hv(n))e+=Gt(n),r=n;else if(Eh(n)){let o=0,s=e-2;for(;s>=0&&Eh(lt(i,s));)o++,s-=2;if(o%2==0)break;e+=2}else break}return e}function Wv(i,e,t){for(;e>0;){let r=Su(i,e-2,t);if(r<e)return r;e--}return 0}function Cu(i){return i>=56320&&i<57344}function Au(i){return i>=55296&&i<56320}function lt(i,e){let t=i.charCodeAt(e);if(!Au(t)||e+1==i.length)return t;let r=i.charCodeAt(e+1);return Cu(r)?(t-55296<<10)+(r-56320)+65536:t}function Ca(i){return i<=65535?String.fromCharCode(i):(i-=65536,String.fromCharCode((i>>10)+55296,(i&1023)+56320))}function Gt(i){return i<65536?1:2}const kl=/\r\n?|\n/;var Ct=function(i){return i[i.Simple=0]="Simple",i[i.TrackDel=1]="TrackDel",i[i.TrackBefore=2]="TrackBefore",i[i.TrackAfter=3]="TrackAfter",i}(Ct||(Ct={}));class xi{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let r=this.sections[t+1];e+=r<0?this.sections[t]:r}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,r=0,n=0;t<this.sections.length;){let o=this.sections[t++],s=this.sections[t++];s<0?(e(r,n,o),n+=o):n+=s,r+=o}}iterChangedRanges(e,t=!1){Sl(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let r=this.sections[t++],n=this.sections[t++];n<0?e.push(r,n):e.push(n,r)}return new xi(e)}composeDesc(e){return this.empty?e:e.empty?this:Mu(this,e)}mapDesc(e,t=!1){return e.empty?this:Cl(this,e,t)}mapPos(e,t=-1,r=Ct.Simple){let n=0,o=0;for(let s=0;s<this.sections.length;){let l=this.sections[s++],a=this.sections[s++],h=n+l;if(a<0){if(h>e)return o+(e-n);o+=l}else{if(r!=Ct.Simple&&h>=e&&(r==Ct.TrackDel&&n<e&&h>e||r==Ct.TrackBefore&&n<e||r==Ct.TrackAfter&&h>e))return null;if(h>e||h==e&&t<0&&!l)return e==n||t<0?o:o+a;o+=a}n=h}if(e>n)throw new RangeError(`Position ${e} is out of range for changeset of length ${n}`);return o}touchesRange(e,t=e){for(let r=0,n=0;r<this.sections.length&&n<=t;){let o=this.sections[r++],s=this.sections[r++],l=n+o;if(s>=0&&n<=t&&l>=e)return n<e&&l>t?"cover":!0;n=l}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let r=this.sections[t++],n=this.sections[t++];e+=(e?" ":"")+r+(n>=0?":"+n:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new xi(e)}static create(e){return new xi(e)}}class it extends xi{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return Sl(this,(t,r,n,o,s)=>e=e.replace(n,n+(r-t),s),!1),e}mapDesc(e,t=!1){return Cl(this,e,t,!0)}invert(e){let t=this.sections.slice(),r=[];for(let n=0,o=0;n<t.length;n+=2){let s=t[n],l=t[n+1];if(l>=0){t[n]=l,t[n+1]=s;let a=n>>1;for(;r.length<a;)r.push(Pe.empty);r.push(s?e.slice(o,o+s):Pe.empty)}o+=s}return new it(t,r)}compose(e){return this.empty?e:e.empty?this:Mu(this,e,!0)}map(e,t=!1){return e.empty?this:Cl(this,e,t,!0)}iterChanges(e,t=!1){Sl(this,e,t)}get desc(){return xi.create(this.sections)}filter(e){let t=[],r=[],n=[],o=new En(this);e:for(let s=0,l=0;;){let a=s==e.length?1e9:e[s++];for(;l<a||l==a&&o.len==0;){if(o.done)break e;let c=Math.min(o.len,a-l);pt(n,c,-1);let d=o.ins==-1?-1:o.off==0?o.ins:0;pt(t,c,d),d>0&&qi(r,t,o.text),o.forward(c),l+=c}let h=e[s++];for(;l<h;){if(o.done)break e;let c=Math.min(o.len,h-l);pt(t,c,-1),pt(n,c,o.ins==-1?-1:o.off==0?o.ins:0),o.forward(c),l+=c}}return{changes:new it(t,r),filtered:xi.create(n)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let r=this.sections[t],n=this.sections[t+1];n<0?e.push(r):n==0?e.push([r]):e.push([r].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,r){let n=[],o=[],s=0,l=null;function a(c=!1){if(!c&&!n.length)return;s<t&&pt(n,t-s,-1);let d=new it(n,o);l=l?l.compose(d.map(l)):d,n=[],o=[],s=0}function h(c){if(Array.isArray(c))for(let d of c)h(d);else if(c instanceof it){if(c.length!=t)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${t})`);a(),l=l?l.compose(c.map(l)):c}else{let{from:d,to:u=d,insert:f}=c;if(d>u||d<0||u>t)throw new RangeError(`Invalid change range ${d} to ${u} (in doc of length ${t})`);let g=f?typeof f=="string"?Pe.of(f.split(r||kl)):f:Pe.empty,y=g.length;if(d==u&&y==0)return;d<s&&a(),d>s&&pt(n,d-s,-1),pt(n,u-d,y),qi(o,n,g),s=u}}return h(e),a(!l),l}static empty(e){return new it(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],r=[];for(let n=0;n<e.length;n++){let o=e[n];if(typeof o=="number")t.push(o,-1);else{if(!Array.isArray(o)||typeof o[0]!="number"||o.some((s,l)=>l&&typeof s!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(o.length==1)t.push(o[0],0);else{for(;r.length<n;)r.push(Pe.empty);r[n]=Pe.of(o.slice(1)),t.push(o[0],r[n].length)}}}return new it(t,r)}static createSet(e,t){return new it(e,t)}}function pt(i,e,t,r=!1){if(e==0&&t<=0)return;let n=i.length-2;n>=0&&t<=0&&t==i[n+1]?i[n]+=e:e==0&&i[n]==0?i[n+1]+=t:r?(i[n]+=e,i[n+1]+=t):i.push(e,t)}function qi(i,e,t){if(t.length==0)return;let r=e.length-2>>1;if(r<i.length)i[i.length-1]=i[i.length-1].append(t);else{for(;i.length<r;)i.push(Pe.empty);i.push(t)}}function Sl(i,e,t){let r=i.inserted;for(let n=0,o=0,s=0;s<i.sections.length;){let l=i.sections[s++],a=i.sections[s++];if(a<0)n+=l,o+=l;else{let h=n,c=o,d=Pe.empty;for(;h+=l,c+=a,a&&r&&(d=d.append(r[s-2>>1])),!(t||s==i.sections.length||i.sections[s+1]<0);)l=i.sections[s++],a=i.sections[s++];e(n,h,o,c,d),n=h,o=c}}}function Cl(i,e,t,r=!1){let n=[],o=r?[]:null,s=new En(i),l=new En(e);for(let a=-1;;)if(s.ins==-1&&l.ins==-1){let h=Math.min(s.len,l.len);pt(n,h,-1),s.forward(h),l.forward(h)}else if(l.ins>=0&&(s.ins<0||a==s.i||s.off==0&&(l.len<s.len||l.len==s.len&&!t))){let h=l.len;for(pt(n,l.ins,-1);h;){let c=Math.min(s.len,h);s.ins>=0&&a<s.i&&s.len<=c&&(pt(n,0,s.ins),o&&qi(o,n,s.text),a=s.i),s.forward(c),h-=c}l.next()}else if(s.ins>=0){let h=0,c=s.len;for(;c;)if(l.ins==-1){let d=Math.min(c,l.len);h+=d,c-=d,l.forward(d)}else if(l.ins==0&&l.len<c)c-=l.len,l.next();else break;pt(n,h,a<s.i?s.ins:0),o&&a<s.i&&qi(o,n,s.text),a=s.i,s.forward(s.len-c)}else{if(s.done&&l.done)return o?it.createSet(n,o):xi.create(n);throw new Error("Mismatched change set lengths")}}function Mu(i,e,t=!1){let r=[],n=t?[]:null,o=new En(i),s=new En(e);for(let l=!1;;){if(o.done&&s.done)return n?it.createSet(r,n):xi.create(r);if(o.ins==0)pt(r,o.len,0,l),o.next();else if(s.len==0&&!s.done)pt(r,0,s.ins,l),n&&qi(n,r,s.text),s.next();else{if(o.done||s.done)throw new Error("Mismatched change set lengths");{let a=Math.min(o.len2,s.len),h=r.length;if(o.ins==-1){let c=s.ins==-1?-1:s.off?0:s.ins;pt(r,a,c,l),n&&c&&qi(n,r,s.text)}else s.ins==-1?(pt(r,o.off?0:o.len,a,l),n&&qi(n,r,o.textBit(a))):(pt(r,o.off?0:o.len,s.off?0:s.ins,l),n&&!s.off&&qi(n,r,s.text));l=(o.ins>a||s.ins>=0&&s.len>a)&&(l||r.length>h),o.forward2(a),s.forward(a)}}}}class En{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?Pe.empty:e[t]}textBit(e){let{inserted:t}=this.set,r=this.i-2>>1;return r>=t.length&&!e?Pe.empty:t[r].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class ur{constructor(e,t,r){this.from=e,this.to=t,this.flags=r}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,t=-1){let r,n;return this.empty?r=n=e.mapPos(this.from,t):(r=e.mapPos(this.from,1),n=e.mapPos(this.to,-1)),r==this.from&&n==this.to?this:new ur(r,n,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return F.range(e,t);let r=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return F.range(this.anchor,r)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return F.range(e.anchor,e.head)}static create(e,t,r){return new ur(e,t,r)}}class F{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:F.create(this.ranges.map(r=>r.map(e,t)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new F([this.main],0)}addRange(e,t=!0){return F.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let r=this.ranges.slice();return r[t]=e,F.create(r,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new F(e.ranges.map(t=>ur.fromJSON(t)),e.main)}static single(e,t=e){return new F([F.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let r=0,n=0;n<e.length;n++){let o=e[n];if(o.empty?o.from<=r:o.from<r)return F.normalized(e.slice(),t);r=o.to}return new F(e,t)}static cursor(e,t=0,r,n){return ur.create(e,e,(t==0?0:t<0?4:8)|(r==null?3:Math.min(2,r))|(n??33554431)<<5)}static range(e,t,r,n){let o=(r??33554431)<<5|(n==null?3:Math.min(2,n));return t<e?ur.create(t,e,24|o):ur.create(e,t,(t>e?4:0)|o)}static normalized(e,t=0){let r=e[t];e.sort((n,o)=>n.from-o.from),t=e.indexOf(r);for(let n=1;n<e.length;n++){let o=e[n],s=e[n-1];if(o.empty?o.from<=s.to:o.from<s.to){let l=s.from,a=Math.max(o.to,s.to);n<=t&&t--,e.splice(--n,2,o.anchor>o.head?F.range(a,l):F.range(l,a))}}return new F(e,t)}}function Ru(i,e){for(let t of i.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let Aa=0;class ae{constructor(e,t,r,n,o){this.combine=e,this.compareInput=t,this.compare=r,this.isStatic=n,this.id=Aa++,this.default=e([]),this.extensions=typeof o=="function"?o(this):o}static define(e={}){return new ae(e.combine||(t=>t),e.compareInput||((t,r)=>t===r),e.compare||(e.combine?(t,r)=>t===r:Ma),!!e.static,e.enables)}of(e){return new Io([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new Io(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new Io(e,this,2,t)}from(e,t){return t||(t=r=>r),this.compute([e],r=>t(r.field(e)))}}function Ma(i,e){return i==e||i.length==e.length&&i.every((t,r)=>t===e[r])}class Io{constructor(e,t,r,n){this.dependencies=e,this.facet=t,this.type=r,this.value=n,this.id=Aa++}dynamicSlot(e){var t;let r=this.value,n=this.facet.compareInput,o=this.id,s=e[o]>>1,l=this.type==2,a=!1,h=!1,c=[];for(let d of this.dependencies)d=="doc"?a=!0:d=="selection"?h=!0:((t=e[d.id])!==null&&t!==void 0?t:1)&1||c.push(e[d.id]);return{create(d){return d.values[s]=r(d),1},update(d,u){if(a&&u.docChanged||h&&(u.docChanged||u.selection)||Al(d,c)){let f=r(d);if(l?!Nh(f,d.values[s],n):!n(f,d.values[s]))return d.values[s]=f,1}return 0},reconfigure:(d,u)=>{let f,g=u.config.address[o];if(g!=null){let y=Jo(u,g);if(this.dependencies.every(b=>b instanceof ae?u.facet(b)===d.facet(b):b instanceof dt?u.field(b,!1)==d.field(b,!1):!0)||(l?Nh(f=r(d),y,n):n(f=r(d),y)))return d.values[s]=y,0}else f=r(d);return d.values[s]=f,1}}}}function Nh(i,e,t){if(i.length!=e.length)return!1;for(let r=0;r<i.length;r++)if(!t(i[r],e[r]))return!1;return!0}function Al(i,e){let t=!1;for(let r of e)Tn(i,r)&1&&(t=!0);return t}function Vv(i,e,t){let r=t.map(a=>i[a.id]),n=t.map(a=>a.type),o=r.filter(a=>!(a&1)),s=i[e.id]>>1;function l(a){let h=[];for(let c=0;c<r.length;c++){let d=Jo(a,r[c]);if(n[c]==2)for(let u of d)h.push(u);else h.push(d)}return e.combine(h)}return{create(a){for(let h of r)Tn(a,h);return a.values[s]=l(a),1},update(a,h){if(!Al(a,o))return 0;let c=l(a);return e.compare(c,a.values[s])?0:(a.values[s]=c,1)},reconfigure(a,h){let c=Al(a,r),d=h.config.facets[e.id],u=h.facet(e);if(d&&!c&&Ma(t,d))return a.values[s]=u,0;let f=l(a);return e.compare(f,u)?(a.values[s]=u,0):(a.values[s]=f,1)}}}const Ih=ae.define({static:!0});class dt{constructor(e,t,r,n,o){this.id=e,this.createF=t,this.updateF=r,this.compareF=n,this.spec=o,this.provides=void 0}static define(e){let t=new dt(Aa++,e.create,e.update,e.compare||((r,n)=>r===n),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(Ih).find(r=>r.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:r=>(r.values[t]=this.create(r),1),update:(r,n)=>{let o=r.values[t],s=this.updateF(o,n);return this.compareF(o,s)?0:(r.values[t]=s,1)},reconfigure:(r,n)=>n.config.address[this.id]!=null?(r.values[t]=n.field(this),0):(r.values[t]=this.create(r),1)}}init(e){return[this,Ih.of({field:this,create:e})]}get extension(){return this}}const hr={lowest:4,low:3,default:2,high:1,highest:0};function mn(i){return e=>new Tu(e,i)}const on={highest:mn(hr.highest),high:mn(hr.high),default:mn(hr.default),low:mn(hr.low),lowest:mn(hr.lowest)};class Tu{constructor(e,t){this.inner=e,this.prec=t}}class Gr{of(e){return new Ml(this,e)}reconfigure(e){return Gr.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class Ml{constructor(e,t){this.compartment=e,this.inner=t}}class Yo{constructor(e,t,r,n,o,s){for(this.base=e,this.compartments=t,this.dynamicSlots=r,this.address=n,this.staticValues=o,this.facets=s,this.statusTemplate=[];this.statusTemplate.length<r.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,r){let n=[],o=Object.create(null),s=new Map;for(let u of jv(e,t,s))u instanceof dt?n.push(u):(o[u.facet.id]||(o[u.facet.id]=[])).push(u);let l=Object.create(null),a=[],h=[];for(let u of n)l[u.id]=h.length<<1,h.push(f=>u.slot(f));let c=r==null?void 0:r.config.facets;for(let u in o){let f=o[u],g=f[0].facet,y=c&&c[u]||[];if(f.every(b=>b.type==0))if(l[g.id]=a.length<<1|1,Ma(y,f))a.push(r.facet(g));else{let b=g.combine(f.map(C=>C.value));a.push(r&&g.compare(b,r.facet(g))?r.facet(g):b)}else{for(let b of f)b.type==0?(l[b.id]=a.length<<1|1,a.push(b.value)):(l[b.id]=h.length<<1,h.push(C=>b.dynamicSlot(C)));l[g.id]=h.length<<1,h.push(b=>Vv(b,g,f))}}let d=h.map(u=>u(l));return new Yo(e,s,d,l,a,o)}}function jv(i,e,t){let r=[[],[],[],[],[]],n=new Map;function o(s,l){let a=n.get(s);if(a!=null){if(a<=l)return;let h=r[a].indexOf(s);h>-1&&r[a].splice(h,1),s instanceof Ml&&t.delete(s.compartment)}if(n.set(s,l),Array.isArray(s))for(let h of s)o(h,l);else if(s instanceof Ml){if(t.has(s.compartment))throw new RangeError("Duplicate use of compartment in extensions");let h=e.get(s.compartment)||s.inner;t.set(s.compartment,h),o(h,l)}else if(s instanceof Tu)o(s.inner,s.prec);else if(s instanceof dt)r[l].push(s),s.provides&&o(s.provides,l);else if(s instanceof Io)r[l].push(s),s.facet.extensions&&o(s.facet.extensions,hr.default);else{let h=s.extension;if(!h)throw new Error(`Unrecognized extension value in extension set (${s}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);o(h,l)}}return o(i,hr.default),r.reduce((s,l)=>s.concat(l))}function Tn(i,e){if(e&1)return 2;let t=e>>1,r=i.status[t];if(r==4)throw new Error("Cyclic dependency between fields and/or facets");if(r&2)return r;i.status[t]=4;let n=i.computeSlot(i,i.config.dynamicSlots[t]);return i.status[t]=2|n}function Jo(i,e){return e&1?i.config.staticValues[e>>1]:i.values[e>>1]}const Du=ae.define(),Ou=ae.define({combine:i=>i.some(e=>e),static:!0}),Pu=ae.define({combine:i=>i.length?i[0]:void 0,static:!0}),Lu=ae.define(),Eu=ae.define(),Bu=ae.define(),Nu=ae.define({combine:i=>i.length?i[0]:!1});class zi{constructor(e,t){this.type=e,this.value=t}static define(){return new Uv}}class Uv{of(e){return new zi(this,e)}}class _v{constructor(e){this.map=e}of(e){return new xe(this,e)}}class xe{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new xe(this.type,t)}is(e){return this.type==e}static define(e={}){return new _v(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let r=[];for(let n of e){let o=n.map(t);o&&r.push(o)}return r}}xe.reconfigure=xe.define();xe.appendConfig=xe.define();class rt{constructor(e,t,r,n,o,s){this.startState=e,this.changes=t,this.selection=r,this.effects=n,this.annotations=o,this.scrollIntoView=s,this._doc=null,this._state=null,r&&Ru(r,t.newLength),o.some(l=>l.type==rt.time)||(this.annotations=o.concat(rt.time.of(Date.now())))}static create(e,t,r,n,o,s){return new rt(e,t,r,n,o,s)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(rt.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}rt.time=zi.define();rt.userEvent=zi.define();rt.addToHistory=zi.define();rt.remote=zi.define();function Kv(i,e){let t=[];for(let r=0,n=0;;){let o,s;if(r<i.length&&(n==e.length||e[n]>=i[r]))o=i[r++],s=i[r++];else if(n<e.length)o=e[n++],s=e[n++];else return t;!t.length||t[t.length-1]<o?t.push(o,s):t[t.length-1]<s&&(t[t.length-1]=s)}}function Iu(i,e,t){var r;let n,o,s;return t?(n=e.changes,o=it.empty(e.changes.length),s=i.changes.compose(e.changes)):(n=e.changes.map(i.changes),o=i.changes.mapDesc(e.changes,!0),s=i.changes.compose(n)),{changes:s,selection:e.selection?e.selection.map(o):(r=i.selection)===null||r===void 0?void 0:r.map(n),effects:xe.mapEffects(i.effects,n).concat(xe.mapEffects(e.effects,o)),annotations:i.annotations.length?i.annotations.concat(e.annotations):e.annotations,scrollIntoView:i.scrollIntoView||e.scrollIntoView}}function Rl(i,e,t){let r=e.selection,n=Wr(e.annotations);return e.userEvent&&(n=n.concat(rt.userEvent.of(e.userEvent))),{changes:e.changes instanceof it?e.changes:it.of(e.changes||[],t,i.facet(Pu)),selection:r&&(r instanceof F?r:F.single(r.anchor,r.head)),effects:Wr(e.effects),annotations:n,scrollIntoView:!!e.scrollIntoView}}function zu(i,e,t){let r=Rl(i,e.length?e[0]:{},i.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let o=1;o<e.length;o++){e[o].filter===!1&&(t=!1);let s=!!e[o].sequential;r=Iu(r,Rl(i,e[o],s?r.changes.newLength:i.doc.length),s)}let n=rt.create(i,r.changes,r.selection,r.effects,r.annotations,r.scrollIntoView);return Gv(t?qv(n):n)}function qv(i){let e=i.startState,t=!0;for(let n of e.facet(Lu)){let o=n(i);if(o===!1){t=!1;break}Array.isArray(o)&&(t=t===!0?o:Kv(t,o))}if(t!==!0){let n,o;if(t===!1)o=i.changes.invertedDesc,n=it.empty(e.doc.length);else{let s=i.changes.filter(t);n=s.changes,o=s.filtered.mapDesc(s.changes).invertedDesc}i=rt.create(e,n,i.selection&&i.selection.map(o),xe.mapEffects(i.effects,o),i.annotations,i.scrollIntoView)}let r=e.facet(Eu);for(let n=r.length-1;n>=0;n--){let o=r[n](i);o instanceof rt?i=o:Array.isArray(o)&&o.length==1&&o[0]instanceof rt?i=o[0]:i=zu(e,Wr(o),!1)}return i}function Gv(i){let e=i.startState,t=e.facet(Bu),r=i;for(let n=t.length-1;n>=0;n--){let o=t[n](i);o&&Object.keys(o).length&&(r=Iu(r,Rl(e,o,i.changes.newLength),!0))}return r==i?i:rt.create(e,i.changes,i.selection,r.effects,r.annotations,r.scrollIntoView)}const Xv=[];function Wr(i){return i==null?Xv:Array.isArray(i)?i:[i]}var Ve=function(i){return i[i.Word=0]="Word",i[i.Space=1]="Space",i[i.Other=2]="Other",i}(Ve||(Ve={}));const Yv=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Tl;try{Tl=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function Jv(i){if(Tl)return Tl.test(i);for(let e=0;e<i.length;e++){let t=i[e];if(/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||Yv.test(t)))return!0}return!1}function Zv(i){return e=>{if(!/\S/.test(e))return Ve.Space;if(Jv(e))return Ve.Word;for(let t=0;t<i.length;t++)if(e.indexOf(i[t])>-1)return Ve.Word;return Ve.Other}}class Me{constructor(e,t,r,n,o,s){this.config=e,this.doc=t,this.selection=r,this.values=n,this.status=e.statusTemplate.slice(),this.computeSlot=o,s&&(s._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)Tn(this,l<<1);this.computeSlot=null}field(e,t=!0){let r=this.config.address[e.id];if(r==null){if(t)throw new RangeError("Field is not present in this state");return}return Tn(this,r),Jo(this,r)}update(...e){return zu(this,e,!0)}applyTransaction(e){let t=this.config,{base:r,compartments:n}=t;for(let s of e.effects)s.is(Gr.reconfigure)?(t&&(n=new Map,t.compartments.forEach((l,a)=>n.set(a,l)),t=null),n.set(s.value.compartment,s.value.extension)):s.is(xe.reconfigure)?(t=null,r=s.value):s.is(xe.appendConfig)&&(t=null,r=Wr(r).concat(s.value));let o;t?o=e.startState.values.slice():(t=Yo.resolve(r,n,this),o=new Me(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(s,l)=>l.reconfigure(s,this),null).values),new Me(t,e.newDoc,e.newSelection,o,(s,l)=>l.update(s,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:F.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,r=e(t.ranges[0]),n=this.changes(r.changes),o=[r.range],s=Wr(r.effects);for(let l=1;l<t.ranges.length;l++){let a=e(t.ranges[l]),h=this.changes(a.changes),c=h.map(n);for(let u=0;u<l;u++)o[u]=o[u].map(c);let d=n.mapDesc(h,!0);o.push(a.range.map(d)),n=n.compose(c),s=xe.mapEffects(s,c).concat(xe.mapEffects(Wr(a.effects),d))}return{changes:n,selection:F.create(o,t.mainIndex),effects:s}}changes(e=[]){return e instanceof it?e:it.of(e,this.doc.length,this.facet(Me.lineSeparator))}toText(e){return Pe.of(e.split(this.facet(Me.lineSeparator)||kl))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(Tn(this,t),Jo(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let r in e){let n=e[r];n instanceof dt&&this.config.address[n.id]!=null&&(t[r]=n.spec.toJSON(this.field(e[r]),this))}return t}static fromJSON(e,t={},r){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(r){for(let o in r)if(Object.prototype.hasOwnProperty.call(e,o)){let s=r[o],l=e[o];n.push(s.init(a=>s.spec.fromJSON(l,a)))}}return Me.create({doc:e.doc,selection:F.fromJSON(e.selection),extensions:t.extensions?n.concat([t.extensions]):n})}static create(e={}){let t=Yo.resolve(e.extensions||[],new Map),r=e.doc instanceof Pe?e.doc:Pe.of((e.doc||"").split(t.staticFacet(Me.lineSeparator)||kl)),n=e.selection?e.selection instanceof F?e.selection:F.single(e.selection.anchor,e.selection.head):F.single(0);return Ru(n,r.length),t.staticFacet(Ou)||(n=n.asSingle()),new Me(t,r,n,t.dynamicSlots.map(()=>null),(o,s)=>s.create(o),null)}get tabSize(){return this.facet(Me.tabSize)}get lineBreak(){return this.facet(Me.lineSeparator)||`
`}get readOnly(){return this.facet(Nu)}phrase(e,...t){for(let r of this.facet(Me.phrases))if(Object.prototype.hasOwnProperty.call(r,e)){e=r[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(r,n)=>{if(n=="$")return"$";let o=+(n||1);return!o||o>t.length?r:t[o-1]})),e}languageDataAt(e,t,r=-1){let n=[];for(let o of this.facet(Du))for(let s of o(this,t,r))Object.prototype.hasOwnProperty.call(s,e)&&n.push(s[e]);return n}charCategorizer(e){return Zv(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:r,length:n}=this.doc.lineAt(e),o=this.charCategorizer(e),s=e-r,l=e-r;for(;s>0;){let a=mt(t,s,!1);if(o(t.slice(a,s))!=Ve.Word)break;s=a}for(;l<n;){let a=mt(t,l);if(o(t.slice(l,a))!=Ve.Word)break;l=a}return s==l?null:F.range(s+r,l+r)}}Me.allowMultipleSelections=Ou;Me.tabSize=ae.define({combine:i=>i.length?i[0]:4});Me.lineSeparator=Pu;Me.readOnly=Nu;Me.phrases=ae.define({compare(i,e){let t=Object.keys(i),r=Object.keys(e);return t.length==r.length&&t.every(n=>i[n]==e[n])}});Me.languageData=Du;Me.changeFilter=Lu;Me.transactionFilter=Eu;Me.transactionExtender=Bu;Gr.reconfigure=xe.define();function Ci(i,e,t={}){let r={};for(let n of i)for(let o of Object.keys(n)){let s=n[o],l=r[o];if(l===void 0)r[o]=s;else if(!(l===s||s===void 0))if(Object.hasOwnProperty.call(t,o))r[o]=t[o](l,s);else throw new Error("Config merge conflict for field "+o)}for(let n in e)r[n]===void 0&&(r[n]=e[n]);return r}class yr{eq(e){return this==e}range(e,t=e){return Dl.create(e,t,this)}}yr.prototype.startSide=yr.prototype.endSide=0;yr.prototype.point=!1;yr.prototype.mapMode=Ct.TrackDel;let Dl=class Fu{constructor(e,t,r){this.from=e,this.to=t,this.value=r}static create(e,t,r){return new Fu(e,t,r)}};function Ol(i,e){return i.from-e.from||i.value.startSide-e.value.startSide}class Ra{constructor(e,t,r,n){this.from=e,this.to=t,this.value=r,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(e,t,r,n=0){let o=r?this.to:this.from;for(let s=n,l=o.length;;){if(s==l)return s;let a=s+l>>1,h=o[a]-e||(r?this.value[a].endSide:this.value[a].startSide)-t;if(a==s)return h>=0?s:l;h>=0?l=a:s=a+1}}between(e,t,r,n){for(let o=this.findIndex(t,-1e9,!0),s=this.findIndex(r,1e9,!1,o);o<s;o++)if(n(this.from[o]+e,this.to[o]+e,this.value[o])===!1)return!1}map(e,t){let r=[],n=[],o=[],s=-1,l=-1;for(let a=0;a<this.value.length;a++){let h=this.value[a],c=this.from[a]+e,d=this.to[a]+e,u,f;if(c==d){let g=t.mapPos(c,h.startSide,h.mapMode);if(g==null||(u=f=g,h.startSide!=h.endSide&&(f=t.mapPos(c,h.endSide),f<u)))continue}else if(u=t.mapPos(c,h.startSide),f=t.mapPos(d,h.endSide),u>f||u==f&&h.startSide>0&&h.endSide<=0)continue;(f-u||h.endSide-h.startSide)<0||(s<0&&(s=u),h.point&&(l=Math.max(l,f-u)),r.push(h),n.push(u-s),o.push(f-s))}return{mapped:r.length?new Ra(n,o,r,l):null,pos:s}}}class Ee{constructor(e,t,r,n){this.chunkPos=e,this.chunk=t,this.nextLayer=r,this.maxPoint=n}static create(e,t,r,n){return new Ee(e,t,r,n)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:r=!1,filterFrom:n=0,filterTo:o=this.length}=e,s=e.filter;if(t.length==0&&!s)return this;if(r&&(t=t.slice().sort(Ol)),this.isEmpty)return t.length?Ee.of(t):this;let l=new $u(this,null,-1).goto(0),a=0,h=[],c=new Qi;for(;l.value||a<t.length;)if(a<t.length&&(l.from-t[a].from||l.startSide-t[a].value.startSide)>=0){let d=t[a++];c.addInner(d.from,d.to,d.value)||h.push(d)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(l.chunkIndex)<t[a].from)&&(!s||n>this.chunkEnd(l.chunkIndex)||o<this.chunkPos[l.chunkIndex])&&c.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!s||n>l.to||o<l.from||s(l.from,l.to,l.value))&&(c.addInner(l.from,l.to,l.value)||h.push(Dl.create(l.from,l.to,l.value))),l.next());return c.finishInner(this.nextLayer.isEmpty&&!h.length?Ee.empty:this.nextLayer.update({add:h,filter:s,filterFrom:n,filterTo:o}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],r=[],n=-1;for(let s=0;s<this.chunk.length;s++){let l=this.chunkPos[s],a=this.chunk[s],h=e.touchesRange(l,l+a.length);if(h===!1)n=Math.max(n,a.maxPoint),t.push(a),r.push(e.mapPos(l));else if(h===!0){let{mapped:c,pos:d}=a.map(l,e);c&&(n=Math.max(n,c.maxPoint),t.push(c),r.push(d))}}let o=this.nextLayer.map(e);return t.length==0?o:new Ee(r,t,o||Ee.empty,n)}between(e,t,r){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let o=this.chunkPos[n],s=this.chunk[n];if(t>=o&&e<=o+s.length&&s.between(o,e-o,t-o,r)===!1)return}this.nextLayer.between(e,t,r)}}iter(e=0){return Bn.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Bn.from(e).goto(t)}static compare(e,t,r,n,o=-1){let s=e.filter(d=>d.maxPoint>0||!d.isEmpty&&d.maxPoint>=o),l=t.filter(d=>d.maxPoint>0||!d.isEmpty&&d.maxPoint>=o),a=zh(s,l,r),h=new vn(s,a,o),c=new vn(l,a,o);r.iterGaps((d,u,f)=>Fh(h,d,c,u,f,n)),r.empty&&r.length==0&&Fh(h,0,c,0,0,n)}static eq(e,t,r=0,n){n==null&&(n=1e9-1);let o=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0),s=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0);if(o.length!=s.length)return!1;if(!o.length)return!0;let l=zh(o,s),a=new vn(o,l,0).goto(r),h=new vn(s,l,0).goto(r);for(;;){if(a.to!=h.to||!Pl(a.active,h.active)||a.point&&(!h.point||!a.point.eq(h.point)))return!1;if(a.to>n)return!0;a.next(),h.next()}}static spans(e,t,r,n,o=-1){let s=new vn(e,null,o).goto(t),l=t,a=s.openStart;for(;;){let h=Math.min(s.to,r);if(s.point){let c=s.activeForPoint(s.to),d=s.pointFrom<t?c.length+1:Math.min(c.length,a);n.point(l,h,s.point,c,d,s.pointRank),a=Math.min(s.openEnd(h),c.length)}else h>l&&(n.span(l,h,s.active,a),a=s.openEnd(h));if(s.to>r)return a+(s.point&&s.to>r?1:0);l=s.to,s.next()}}static of(e,t=!1){let r=new Qi;for(let n of e instanceof Dl?[e]:t?Qv(e):e)r.add(n.from,n.to,n.value);return r.finish()}}Ee.empty=new Ee([],[],null,-1);function Qv(i){if(i.length>1)for(let e=i[0],t=1;t<i.length;t++){let r=i[t];if(Ol(e,r)>0)return i.slice().sort(Ol);e=r}return i}Ee.empty.nextLayer=Ee.empty;class Qi{finishChunk(e){this.chunks.push(new Ra(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,r){this.addInner(e,t,r)||(this.nextLayer||(this.nextLayer=new Qi)).add(e,t,r)}addInner(e,t,r){let n=e-this.lastTo||r.startSide-this.last.endSide;if(n<=0&&(e-this.lastFrom||r.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=r,this.lastFrom=e,this.lastTo=t,this.value.push(r),r.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let r=t.value.length-1;return this.last=t.value[r],this.lastFrom=t.from[r]+e,this.lastTo=t.to[r]+e,!0}finish(){return this.finishInner(Ee.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=Ee.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function zh(i,e,t){let r=new Map;for(let o of i)for(let s=0;s<o.chunk.length;s++)o.chunk[s].maxPoint<=0&&r.set(o.chunk[s],o.chunkPos[s]);let n=new Set;for(let o of e)for(let s=0;s<o.chunk.length;s++){let l=r.get(o.chunk[s]);l!=null&&(t?t.mapPos(l):l)==o.chunkPos[s]&&!(t!=null&&t.touchesRange(l,l+o.chunk[s].length))&&n.add(o.chunk[s])}return n}class $u{constructor(e,t,r,n=0){this.layer=e,this.skip=t,this.minPoint=r,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,r){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<e||n.maxPoint<this.minPoint))break;this.chunkIndex++,r=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!r||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],r=e+t.from[this.rangeIndex];if(this.from=r,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Bn{constructor(e){this.heap=e}static from(e,t=null,r=-1){let n=[];for(let o=0;o<e.length;o++)for(let s=e[o];!s.isEmpty;s=s.nextLayer)s.maxPoint>=r&&n.push(new $u(s,t,r,o));return n.length==1?n[0]:new Bn(n)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let r of this.heap)r.goto(e,t);for(let r=this.heap.length>>1;r>=0;r--)Ys(this.heap,r);return this.next(),this}forward(e,t){for(let r of this.heap)r.forward(e,t);for(let r=this.heap.length>>1;r>=0;r--)Ys(this.heap,r);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Ys(this.heap,0)}}}function Ys(i,e){for(let t=i[e];;){let r=(e<<1)+1;if(r>=i.length)break;let n=i[r];if(r+1<i.length&&n.compare(i[r+1])>=0&&(n=i[r+1],r++),t.compare(n)<0)break;i[r]=t,i[e]=n,e=r}}class vn{constructor(e,t,r){this.minPoint=r,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Bn.from(e,t,r)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){fo(this.active,e),fo(this.activeTo,e),fo(this.activeRank,e),this.minActive=$h(this.active,this.activeTo)}addActive(e){let t=0,{value:r,to:n,rank:o}=this.cursor;for(;t<this.activeRank.length&&this.activeRank[t]<=o;)t++;po(this.active,t,r),po(this.activeTo,t,n),po(this.activeRank,t,o),e&&po(e,t,this.cursor.from),this.minActive=$h(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let r=this.openStart<0?[]:null;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>e){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),r&&fo(r,n)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let o=this.cursor.value;if(!o.point)this.addActive(r),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=o,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=o.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(r){this.openStart=0;for(let n=r.length-1;n>=0&&r[n]<e;n--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let r=this.active.length-1;r>=0&&!(this.activeRank[r]<this.pointRank);r--)(this.activeTo[r]>e||this.activeTo[r]==e&&this.active[r].endSide>=this.point.endSide)&&t.push(this.active[r]);return t.reverse()}openEnd(e){let t=0;for(let r=this.activeTo.length-1;r>=0&&this.activeTo[r]>e;r--)t++;return t}}function Fh(i,e,t,r,n,o){i.goto(e),t.goto(r);let s=r+n,l=r,a=r-e;for(;;){let h=i.to+a-t.to||i.endSide-t.endSide,c=h<0?i.to+a:t.to,d=Math.min(c,s);if(i.point||t.point?i.point&&t.point&&(i.point==t.point||i.point.eq(t.point))&&Pl(i.activeForPoint(i.to),t.activeForPoint(t.to))||o.comparePoint(l,d,i.point,t.point):d>l&&!Pl(i.active,t.active)&&o.compareRange(l,d,i.active,t.active),c>s)break;l=c,h<=0&&i.next(),h>=0&&t.next()}}function Pl(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!=e[t]&&!i[t].eq(e[t]))return!1;return!0}function fo(i,e){for(let t=e,r=i.length-1;t<r;t++)i[t]=i[t+1];i.pop()}function po(i,e,t){for(let r=i.length-1;r>=e;r--)i[r+1]=i[r];i[e]=t}function $h(i,e){let t=-1,r=1e9;for(let n=0;n<e.length;n++)(e[n]-r||i[n].endSide-i[t].endSide)<0&&(t=n,r=e[n]);return t}function eo(i,e,t=i.length){let r=0;for(let n=0;n<t;)i.charCodeAt(n)==9?(r+=e-r%e,n++):(r++,n=mt(i,n));return r}function Ll(i,e,t,r){for(let n=0,o=0;;){if(o>=e)return n;if(n==i.length)break;o+=i.charCodeAt(n)==9?t-o%t:1,n=mt(i,n)}return r===!0?-1:i.length}const El="ͼ",Hh=typeof Symbol>"u"?"__"+El:Symbol.for(El),Bl=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),Wh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};let Xr=class{constructor(i,e){this.rules=[];let{finish:t}=e||{};function r(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function n(o,s,l,a){let h=[],c=/^@(\w+)\b/.exec(o[0]),d=c&&c[1]=="keyframes";if(c&&s==null)return l.push(o[0]+";");for(let u in s){let f=s[u];if(/&/.test(u))n(u.split(/,\s*/).map(g=>o.map(y=>g.replace(/&/,y))).reduce((g,y)=>g.concat(y)),f,l);else if(f&&typeof f=="object"){if(!c)throw new RangeError("The value of a property ("+u+") should be a primitive value.");n(r(u),f,h,d)}else f!=null&&h.push(u.replace(/_.*/,"").replace(/[A-Z]/g,g=>"-"+g.toLowerCase())+": "+f+";")}(h.length||d)&&l.push((t&&!c&&!a?o.map(t):o).join(", ")+" {"+h.join(" ")+"}")}for(let o in i)n(r(o),i[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let i=Wh[Hh]||1;return Wh[Hh]=i+1,El+i.toString(36)}static mount(i,e,t){let r=i[Bl],n=t&&t.nonce;r?n&&r.setNonce(n):r=new eb(i,n),r.mount(Array.isArray(e)?e:[e])}},Vh=new Map,eb=class{constructor(i,e){let t=i.ownerDocument||i,r=t.defaultView;if(!i.head&&i.adoptedStyleSheets&&r.CSSStyleSheet){let n=Vh.get(t);if(n)return i.adoptedStyleSheets=[n.sheet,...i.adoptedStyleSheets],i[Bl]=n;this.sheet=new r.CSSStyleSheet,i.adoptedStyleSheets=[this.sheet,...i.adoptedStyleSheets],Vh.set(t,this)}else{this.styleTag=t.createElement("style"),e&&this.styleTag.setAttribute("nonce",e);let n=i.head||i;n.insertBefore(this.styleTag,n.firstChild)}this.modules=[],i[Bl]=this}mount(i){let e=this.sheet,t=0,r=0;for(let n=0;n<i.length;n++){let o=i[n],s=this.modules.indexOf(o);if(s<r&&s>-1&&(this.modules.splice(s,1),r--,s=-1),s==-1){if(this.modules.splice(r++,0,o),e)for(let l=0;l<o.rules.length;l++)e.insertRule(o.rules[l],t++)}else{for(;r<s;)t+=this.modules[r++].rules.length;t+=o.rules.length,r++}}if(!e){let n="";for(let o=0;o<this.modules.length;o++)n+=this.modules[o].getRules()+`
`;this.styleTag.textContent=n}}setNonce(i){this.styleTag&&this.styleTag.getAttribute("nonce")!=i&&this.styleTag.setAttribute("nonce",i)}};var er={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Nn={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},jh=typeof navigator<"u"&&/Chrome\/(\d+)/.exec(navigator.userAgent),tb=typeof navigator<"u"&&/Mac/.test(navigator.platform),ib=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),rb=tb||jh&&+jh[1]<57;for(var at=0;at<10;at++)er[48+at]=er[96+at]=String(at);for(var at=1;at<=24;at++)er[at+111]="F"+at;for(var at=65;at<=90;at++)er[at]=String.fromCharCode(at+32),Nn[at]=String.fromCharCode(at);for(var Js in er)Nn.hasOwnProperty(Js)||(Nn[Js]=er[Js]);function nb(i){var e=rb&&(i.ctrlKey||i.altKey||i.metaKey)||ib&&i.shiftKey&&i.key&&i.key.length==1||i.key=="Unidentified",t=!e&&i.key||(i.shiftKey?Nn:er)[i.keyCode]||i.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}function Zo(i){let e;return i.nodeType==11?e=i.getSelection?i:i.ownerDocument:e=i,e.getSelection()}function Nl(i,e){return e?i==e||i.contains(e.nodeType!=1?e.parentNode:e):!1}function ob(i){let e=i.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function zo(i,e){if(!e.anchorNode)return!1;try{return Nl(i,e.anchorNode)}catch{return!1}}function In(i){return i.nodeType==3?wr(i,0,i.nodeValue.length).getClientRects():i.nodeType==1?i.getClientRects():[]}function Qo(i,e,t,r){return t?Uh(i,e,t,r,-1)||Uh(i,e,t,r,1):!1}function zn(i){for(var e=0;;e++)if(i=i.previousSibling,!i)return e}function Uh(i,e,t,r,n){for(;;){if(i==t&&e==r)return!0;if(e==(n<0?0:Pi(i))){if(i.nodeName=="DIV")return!1;let o=i.parentNode;if(!o||o.nodeType!=1)return!1;e=zn(i)+(n<0?0:1),i=o}else if(i.nodeType==1){if(i=i.childNodes[e+(n<0?-1:0)],i.nodeType==1&&i.contentEditable=="false")return!1;e=n<0?Pi(i):0}else return!1}}function Pi(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}function Ta(i,e){let t=e?i.left:i.right;return{left:t,right:t,top:i.top,bottom:i.bottom}}function sb(i){return{left:0,right:i.innerWidth,top:0,bottom:i.innerHeight}}function lb(i,e,t,r,n,o,s,l){let a=i.ownerDocument,h=a.defaultView||window;for(let c=i,d=!1;c&&!d;)if(c.nodeType==1){let u,f=c==a.body,g=1,y=1;if(f)u=sb(h);else{if(/^(fixed|sticky)$/.test(getComputedStyle(c).position)&&(d=!0),c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.assignedSlot||c.parentNode;continue}let D=c.getBoundingClientRect();g=D.width/c.offsetWidth,y=D.height/c.offsetHeight,u={left:D.left,right:D.left+c.clientWidth*g,top:D.top,bottom:D.top+c.clientHeight*y}}let b=0,C=0;if(n=="nearest")e.top<u.top?(C=-(u.top-e.top+s),t>0&&e.bottom>u.bottom+C&&(C=e.bottom-u.bottom+C+s)):e.bottom>u.bottom&&(C=e.bottom-u.bottom+s,t<0&&e.top-C<u.top&&(C=-(u.top+C-e.top+s)));else{let D=e.bottom-e.top,T=u.bottom-u.top;C=(n=="center"&&D<=T?e.top+D/2-T/2:n=="start"||n=="center"&&t<0?e.top-s:e.bottom-T+s)-u.top}if(r=="nearest"?e.left<u.left?(b=-(u.left-e.left+o),t>0&&e.right>u.right+b&&(b=e.right-u.right+b+o)):e.right>u.right&&(b=e.right-u.right+o,t<0&&e.left<u.left+b&&(b=-(u.left+b-e.left+o))):b=(r=="center"?e.left+(e.right-e.left)/2-(u.right-u.left)/2:r=="start"==l?e.left-o:e.right-(u.right-u.left)+o)-u.left,b||C)if(f)h.scrollBy(b,C);else{let D=0,T=0;if(C){let A=c.scrollTop;c.scrollTop+=C/y,T=(c.scrollTop-A)*y}if(b){let A=c.scrollLeft;c.scrollLeft+=b/g,D=(c.scrollLeft-A)*g}e={left:e.left-D,top:e.top-T,right:e.right-D,bottom:e.bottom-T},D&&Math.abs(D-b)<1&&(r="nearest"),T&&Math.abs(T-C)<1&&(n="nearest")}if(f)break;c=c.assignedSlot||c.parentNode}else if(c.nodeType==11)c=c.host;else break}function ab(i){let e=i.ownerDocument;for(let t=i.parentNode;t&&t!=e.body;)if(t.nodeType==1){if(t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)return t;t=t.assignedSlot||t.parentNode}else if(t.nodeType==11)t=t.host;else break;return null}class hb{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:r}=e;this.set(t,Math.min(e.anchorOffset,t?Pi(t):0),r,Math.min(e.focusOffset,r?Pi(r):0))}set(e,t,r,n){this.anchorNode=e,this.anchorOffset=t,this.focusNode=r,this.focusOffset=n}}let Pr=null;function Hu(i){if(i.setActive)return i.setActive();if(Pr)return i.focus(Pr);let e=[];for(let t=i;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(i.focus(Pr==null?{get preventScroll(){return Pr={preventScroll:!0},!0}}:void 0),!Pr){Pr=!1;for(let t=0;t<e.length;){let r=e[t++],n=e[t++],o=e[t++];r.scrollTop!=n&&(r.scrollTop=n),r.scrollLeft!=o&&(r.scrollLeft=o)}}}let _h;function wr(i,e,t=e){let r=_h||(_h=document.createRange());return r.setEnd(i,t),r.setStart(i,e),r}function Vr(i,e,t){let r={key:e,code:e,keyCode:t,which:t,cancelable:!0},n=new KeyboardEvent("keydown",r);n.synthetic=!0,i.dispatchEvent(n);let o=new KeyboardEvent("keyup",r);return o.synthetic=!0,i.dispatchEvent(o),n.defaultPrevented||o.defaultPrevented}function cb(i){for(;i;){if(i&&(i.nodeType==9||i.nodeType==11&&i.host))return i;i=i.assignedSlot||i.parentNode}return null}function Wu(i){for(;i.attributes.length;)i.removeAttributeNode(i.attributes[0])}function db(i,e){let t=e.focusNode,r=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=r)return!1;for(r=Math.min(r,Pi(t));;)if(r){if(t.nodeType!=1)return!1;let n=t.childNodes[r-1];n.contentEditable=="false"?r--:(t=n,r=Pi(t))}else{if(t==i)return!0;r=zn(t),t=t.parentNode}}function Vu(i){return i.scrollTop>Math.max(1,i.scrollHeight-i.clientHeight-4)}class gt{constructor(e,t,r=!0){this.node=e,this.offset=t,this.precise=r}static before(e,t){return new gt(e.parentNode,zn(e),t)}static after(e,t){return new gt(e.parentNode,zn(e)+1,t)}}const Da=[];class We{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let r of this.children){if(r==e)return t;t+=r.length+r.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(this.flags&2){let r=this.dom,n=null,o;for(let s of this.children){if(s.flags&7){if(!s.dom&&(o=n?n.nextSibling:r.firstChild)){let l=We.get(o);(!l||!l.parent&&l.canReuseDOM(s))&&s.reuseDOM(o)}s.sync(e,t),s.flags&=-8}if(o=n?n.nextSibling:r.firstChild,t&&!t.written&&t.node==r&&o!=s.dom&&(t.written=!0),s.dom.parentNode==r)for(;o&&o!=s.dom;)o=Kh(o);else r.insertBefore(s.dom,o);n=s.dom}for(o=n?n.nextSibling:r.firstChild,o&&t&&t.node==r&&(t.written=!0);o;)o=Kh(o)}else if(this.flags&1)for(let r of this.children)r.flags&7&&(r.sync(e,t),r.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,t){let r;if(e==this.dom)r=this.dom.childNodes[t];else{let n=Pi(e)==0?0:t==0?-1:1;for(;;){let o=e.parentNode;if(o==this.dom)break;n==0&&o.firstChild!=o.lastChild&&(e==o.firstChild?n=-1:n=1),e=o}n<0?r=e:r=e.nextSibling}if(r==this.dom.firstChild)return 0;for(;r&&!We.get(r);)r=r.nextSibling;if(!r)return this.length;for(let n=0,o=0;;n++){let s=this.children[n];if(s.dom==r)return o;o+=s.length+s.breakAfter}}domBoundsAround(e,t,r=0){let n=-1,o=-1,s=-1,l=-1;for(let a=0,h=r,c=r;a<this.children.length;a++){let d=this.children[a],u=h+d.length;if(h<e&&u>t)return d.domBoundsAround(e,t,h);if(u>=e&&n==-1&&(n=a,o=h),h>t&&d.dom.parentNode==this.dom){s=a,l=c;break}c=u,h=u+d.breakAfter}return{from:o,to:l<0?r+this.length:l,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:s<this.children.length&&s>=0?this.children[s].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.flags|=2),t.flags&1)return;t.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,r=Da){this.markDirty();for(let n=e;n<t;n++){let o=this.children[n];o.parent==this&&o.destroy()}this.children.splice(e,t-e,...r);for(let n=0;n<r.length;n++)r[n].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new ju(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,r,n,o,s){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){this.parent=null}}We.prototype.breakAfter=0;function Kh(i){let e=i.nextSibling;return i.parentNode.removeChild(i),e}class ju{constructor(e,t,r){this.children=e,this.pos=t,this.i=r,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let r=this.children[--this.i];this.pos-=r.length+r.breakAfter}}}function Uu(i,e,t,r,n,o,s,l,a){let{children:h}=i,c=h.length?h[e]:null,d=o.length?o[o.length-1]:null,u=d?d.breakAfter:s;if(!(e==r&&c&&!s&&!u&&o.length<2&&c.merge(t,n,o.length?d:null,t==0,l,a))){if(r<h.length){let f=h[r];f&&(n<f.length||f.breakAfter&&d!=null&&d.breakAfter)?(e==r&&(f=f.split(n),n=0),!u&&d&&f.merge(0,n,d,!0,0,a)?o[o.length-1]=f:(n&&f.merge(0,n,null,!1,0,a),o.push(f))):f!=null&&f.breakAfter&&(d?d.breakAfter=1:s=1),r++}for(c&&(c.breakAfter=s,t>0&&(!s&&o.length&&c.merge(t,c.length,o[0],!1,l,0)?c.breakAfter=o.shift().breakAfter:(t<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(t,c.length,null,!1,l,0),e++));e<r&&o.length;)if(h[r-1].become(o[o.length-1]))r--,o.pop(),a=o.length?0:l;else if(h[e].become(o[0]))e++,o.shift(),l=o.length?0:a;else break;!o.length&&e&&r<h.length&&!h[e-1].breakAfter&&h[r].merge(0,0,h[e-1],!1,l,a)&&e--,(e<r||o.length)&&i.replaceChildren(e,r,o)}}function _u(i,e,t,r,n,o){let s=i.childCursor(),{i:l,off:a}=s.findPos(t,1),{i:h,off:c}=s.findPos(e,-1),d=e-t;for(let u of r)d+=u.length;i.length+=d,Uu(i,h,c,l,a,r,0,n,o)}let Wt=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},Il=typeof document<"u"?document:{documentElement:{style:{}}};const zl=/Edge\/(\d+)/.exec(Wt.userAgent),Ku=/MSIE \d/.test(Wt.userAgent),Fl=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Wt.userAgent),Cs=!!(Ku||Fl||zl),qh=!Cs&&/gecko\/(\d+)/i.test(Wt.userAgent),Zs=!Cs&&/Chrome\/(\d+)/.exec(Wt.userAgent),Gh="webkitFontSmoothing"in Il.documentElement.style,qu=!Cs&&/Apple Computer/.test(Wt.vendor),Xh=qu&&(/Mobile\/\w+/.test(Wt.userAgent)||Wt.maxTouchPoints>2);var ce={mac:Xh||/Mac/.test(Wt.platform),windows:/Win/.test(Wt.platform),linux:/Linux|X11/.test(Wt.platform),ie:Cs,ie_version:Ku?Il.documentMode||6:Fl?+Fl[1]:zl?+zl[1]:0,gecko:qh,gecko_version:qh?+(/Firefox\/(\d+)/.exec(Wt.userAgent)||[0,0])[1]:0,chrome:!!Zs,chrome_version:Zs?+Zs[1]:0,ios:Xh,android:/Android\b/.test(Wt.userAgent),webkit:Gh,safari:qu,webkit_version:Gh?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:Il.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const ub=256;class Li extends We{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,r){return this.flags&8||r&&(!(r instanceof Li)||this.length-(t-e)+r.length>ub||r.flags&8)?!1:(this.text=this.text.slice(0,e)+(r?r.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new Li(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t.flags|=this.flags&8,t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new gt(this.dom,e)}domBoundsAround(e,t,r){return{from:r,to:r+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return fb(this.dom,e,t)}}class Ei extends We{constructor(e,t=[],r=0){super(),this.mark=e,this.children=t,this.length=r;for(let n of t)n.setParent(this)}setAttrs(e){if(Wu(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,t){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,r,n,o,s){return r&&(!(r instanceof Ei&&r.mark.eq(this.mark))||e&&o<=0||t<this.length&&s<=0)?!1:(_u(this,e,t,r?r.children:[],o-1,s-1),this.markDirty(),!0)}split(e){let t=[],r=0,n=-1,o=0;for(let l of this.children){let a=r+l.length;a>e&&t.push(r<e?l.split(e-r):l),n<0&&r>=e&&(n=o),r=a,o++}let s=this.length-e;return this.length=e,n>-1&&(this.children.length=n,this.markDirty()),new Ei(this.mark,t,s)}domAtPos(e){return Gu(this,e)}coordsAt(e,t){return Yu(this,e,t)}}function fb(i,e,t){let r=i.nodeValue.length;e>r&&(e=r);let n=e,o=e,s=0;e==0&&t<0||e==r&&t>=0?ce.chrome||ce.gecko||(e?(n--,s=1):o<r&&(o++,s=-1)):t<0?n--:o<r&&o++;let l=wr(i,n,o).getClientRects();if(!l.length)return null;let a=l[(s?s<0:t>=0)?0:l.length-1];return ce.safari&&!s&&a.width==0&&(a=Array.prototype.find.call(l,h=>h.width)||a),s?Ta(a,s<0):a||null}class Gi extends We{static create(e,t,r){return new Gi(e,t,r)}constructor(e,t,r){super(),this.widget=e,this.length=t,this.side=r,this.prevWidget=null}split(e){let t=Gi.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,t,r,n,o,s){return r&&(!(r instanceof Gi)||!this.widget.compare(r.widget)||e>0&&o<=0||t<this.length&&s<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-t),!0)}become(e){return e instanceof Gi&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return Pe.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,r=t&&t.state.doc,n=this.posAtStart;return r?r.slice(n,n+this.length):Pe.empty}domAtPos(e){return(this.length?e==0:this.side>0)?gt.before(this.dom):gt.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let r=this.widget.coordsAt(this.dom,e,t);if(r)return r;let n=this.dom.getClientRects(),o=null;if(!n.length)return null;let s=this.side?this.side<0:e>0;for(let l=s?n.length-1:0;o=n[l],!(e>0?l==0:l==n.length-1||o.top<o.bottom);l+=s?-1:1);return Ta(o,!s)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Yr extends We{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof Yr&&e.side==this.side}split(){return new Yr(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?gt.before(this.dom):gt.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return Pe.empty}get isHidden(){return!0}}Li.prototype.children=Gi.prototype.children=Yr.prototype.children=Da;function Gu(i,e){let t=i.dom,{children:r}=i,n=0;for(let o=0;n<r.length;n++){let s=r[n],l=o+s.length;if(!(l==o&&s.getSide()<=0)){if(e>o&&e<l&&s.dom.parentNode==t)return s.domAtPos(e-o);if(e<=o)break;o=l}}for(let o=n;o>0;o--){let s=r[o-1];if(s.dom.parentNode==t)return s.domAtPos(s.length)}for(let o=n;o<r.length;o++){let s=r[o];if(s.dom.parentNode==t)return s.domAtPos(0)}return new gt(t,0)}function Xu(i,e,t){let r,{children:n}=i;t>0&&e instanceof Ei&&n.length&&(r=n[n.length-1])instanceof Ei&&r.mark.eq(e.mark)?Xu(r,e.children[0],t-1):(n.push(e),e.setParent(i)),i.length+=e.length}function Yu(i,e,t){let r=null,n=-1,o=null,s=-1;function l(h,c){for(let d=0,u=0;d<h.children.length&&u<=c;d++){let f=h.children[d],g=u+f.length;g>=c&&(f.children.length?l(f,c-u):(!o||o.isHidden&&t>0)&&(g>c||u==g&&f.getSide()>0)?(o=f,s=c-u):(u<c||u==g&&f.getSide()<0&&!f.isHidden)&&(r=f,n=c-u)),u=g}}l(i,e);let a=(t<0?r:o)||r||o;return a?a.coordsAt(Math.max(0,a==r?n:s),t):pb(i)}function pb(i){let e=i.dom.lastChild;if(!e)return i.dom.getBoundingClientRect();let t=In(e);return t[t.length-1]||null}function $l(i,e){for(let t in i)t=="class"&&e.class?e.class+=" "+i.class:t=="style"&&e.style?e.style+=";"+i.style:e[t]=i[t];return e}const Yh=Object.create(null);function Oa(i,e,t){if(i==e)return!0;i||(i=Yh),e||(e=Yh);let r=Object.keys(i),n=Object.keys(e);if(r.length-(t&&r.indexOf(t)>-1?1:0)!=n.length-(t&&n.indexOf(t)>-1?1:0))return!1;for(let o of r)if(o!=t&&(n.indexOf(o)==-1||i[o]!==e[o]))return!1;return!0}function Hl(i,e,t){let r=!1;if(e)for(let n in e)t&&n in t||(r=!0,n=="style"?i.style.cssText="":i.removeAttribute(n));if(t)for(let n in t)e&&e[n]==t[n]||(r=!0,n=="style"?i.style.cssText=t[n]:i.setAttribute(n,t[n]));return r}function gb(i){let e=Object.create(null);for(let t=0;t<i.attributes.length;t++){let r=i.attributes[t];e[r.name]=r.value}return e}class tt extends We{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,r,n,o,s){if(r){if(!(r instanceof tt))return!1;this.dom||r.transferDOM(this)}return n&&this.setDeco(r?r.attrs:null),_u(this,e,t,r?r.children:[],o,s),!0}split(e){let t=new tt;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i:r,off:n}=this.childPos(e);n&&(t.append(this.children[r].split(n),0),this.children[r].merge(n,this.children[r].length,null,!1,0,0),r++);for(let o=r;o<this.children.length;o++)t.append(this.children[o],0);for(;r>0&&this.children[r-1].length==0;)this.children[--r].destroy();return this.children.length=r,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){Oa(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){Xu(this,e,t)}addLineDeco(e){let t=e.spec.attributes,r=e.spec.class;t&&(this.attrs=$l(t,this.attrs||{})),r&&(this.attrs=$l({class:r},this.attrs||{}))}domAtPos(e){return Gu(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,t){var r;this.dom?this.flags&4&&(Wu(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Hl(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let n=this.dom.lastChild;for(;n&&We.get(n)instanceof Ei;)n=n.lastChild;if(!n||!this.length||n.nodeName!="BR"&&((r=We.get(n))===null||r===void 0?void 0:r.isEditable)==!1&&(!ce.ios||!this.children.some(o=>o instanceof Li))){let o=document.createElement("BR");o.cmIgnore=!0,this.dom.appendChild(o)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,t;for(let r of this.children){if(!(r instanceof Li)||/[^ -~]/.test(r.text))return null;let n=In(r.dom);if(n.length!=1)return null;e+=n[0].width,t=n[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:t}:null}coordsAt(e,t){let r=Yu(this,e,t);if(!this.children.length&&r&&this.parent){let{heightOracle:n}=this.parent.view.viewState,o=r.bottom-r.top;if(Math.abs(o-n.lineHeight)<2&&n.textHeight<o){let s=(o-n.textHeight)/2;return{top:r.top+s,bottom:r.bottom-s,left:r.left,right:r.left}}}return r}become(e){return!1}covers(){return!0}static find(e,t){for(let r=0,n=0;r<e.children.length;r++){let o=e.children[r],s=n+o.length;if(s>=t){if(o instanceof tt)return o;if(s>t)break}n=s+o.breakAfter}return null}}class mr extends We{constructor(e,t,r){super(),this.widget=e,this.length=t,this.deco=r,this.breakAfter=0,this.prevWidget=null}merge(e,t,r,n,o,s){return r&&(!(r instanceof mr)||!this.widget.compare(r.widget)||e>0&&o<=0||t<this.length&&s<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?gt.before(this.dom):gt.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let r=new mr(this.widget,t,this.deco);return r.breakAfter=this.breakAfter,r}get children(){return Da}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Pe.empty}domBoundsAround(){return null}become(e){return e instanceof mr&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){return this.widget.coordsAt(this.dom,e,t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:t,endSide:r}=this.deco;return t==r?!1:e<0?t<0:r>0}}class nr{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,r){return null}get isHidden(){return!1}destroy(e){}}var At=function(i){return i[i.Text=0]="Text",i[i.WidgetBefore=1]="WidgetBefore",i[i.WidgetAfter=2]="WidgetAfter",i[i.WidgetRange=3]="WidgetRange",i}(At||(At={}));class ye extends yr{constructor(e,t,r,n){super(),this.startSide=e,this.endSide=t,this.widget=r,this.spec=n}get heightRelevant(){return!1}static mark(e){return new to(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),r=!!e.block;return t+=r&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new tr(e,t,t,r,e.widget||null,!1)}static replace(e){let t=!!e.block,r,n;if(e.isBlockGap)r=-5e8,n=4e8;else{let{start:o,end:s}=Ju(e,t);r=(o?t?-3e8:-1:5e8)-1,n=(s?t?2e8:1:-6e8)+1}return new tr(e,r,n,t,e.widget||null,!0)}static line(e){return new io(e)}static set(e,t=!1){return Ee.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}ye.none=Ee.empty;class to extends ye{constructor(e){let{start:t,end:r}=Ju(e);super(t?-1:5e8,r?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var t,r;return this==e||e instanceof to&&this.tagName==e.tagName&&(this.class||((t=this.attrs)===null||t===void 0?void 0:t.class))==(e.class||((r=e.attrs)===null||r===void 0?void 0:r.class))&&Oa(this.attrs,e.attrs,"class")}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}to.prototype.point=!1;class io extends ye{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof io&&this.spec.class==e.spec.class&&Oa(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}io.prototype.mapMode=Ct.TrackBefore;io.prototype.point=!0;class tr extends ye{constructor(e,t,r,n,o,s){super(t,r,o,e),this.block=n,this.isReplace=s,this.mapMode=n?t<=0?Ct.TrackBefore:Ct.TrackAfter:Ct.TrackDel}get type(){return this.startSide!=this.endSide?At.WidgetRange:this.startSide<=0?At.WidgetBefore:At.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof tr&&mb(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}tr.prototype.point=!0;function Ju(i,e=!1){let{inclusiveStart:t,inclusiveEnd:r}=i;return t==null&&(t=i.inclusive),r==null&&(r=i.inclusive),{start:t??e,end:r??e}}function mb(i,e){return i==e||!!(i&&e&&i.compare(e))}function Wl(i,e,t,r=0){let n=t.length-1;n>=0&&t[n]+r>=i?t[n]=Math.max(t[n],e):t.push(i,e)}class Dn{constructor(e,t,r,n){this.doc=e,this.pos=t,this.end=r,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof mr&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new tt),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(go(new Yr(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!e&&!this.posCovered()&&this.getLine()}buildText(e,t,r){for(;e>0;){if(this.textOff==this.text.length){let{value:o,lineBreak:s,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(s){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=o,this.textOff=0}let n=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(t.length-r)),this.getLine().append(go(new Li(this.text.slice(this.textOff,this.textOff+n)),t),r),this.atCursorPos=!0,this.textOff+=n,e-=n,r=0}}span(e,t,r,n){this.buildText(t-e,r,n),this.pos=t,this.openStart<0&&(this.openStart=n)}point(e,t,r,n,o,s){if(this.disallowBlockEffectsFor[s]&&r instanceof tr){if(r.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=t-e;if(r instanceof tr)if(r.block)r.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new mr(r.widget||new Jh("div"),l,r));else{let a=Gi.create(r.widget||new Jh("span"),l,l?0:r.startSide),h=this.atCursorPos&&!a.isEditable&&o<=n.length&&(e<t||r.startSide>0),c=!a.isEditable&&(e<t||o>n.length||r.startSide<=0),d=this.getLine();this.pendingBuffer==2&&!h&&!a.isEditable&&(this.pendingBuffer=0),this.flushBuffer(n),h&&(d.append(go(new Yr(1),n),o),o=n.length+Math.max(0,o-n.length)),d.append(go(a,n),o),this.atCursorPos=c,this.pendingBuffer=c?e<t||o>n.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=n.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(r);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=o)}static build(e,t,r,n,o){let s=new Dn(e,t,r,o);return s.openEnd=Ee.spans(n,t,r,s),s.openStart<0&&(s.openStart=s.openEnd),s.finish(s.openEnd),s}}function go(i,e){for(let t of e)i=new Ei(t,[i],i.length);return i}class Jh extends nr{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}const Zu=ae.define(),Qu=ae.define(),ef=ae.define(),tf=ae.define(),Vl=ae.define(),rf=ae.define(),nf=ae.define(),of=ae.define({combine:i=>i.some(e=>e)}),sf=ae.define({combine:i=>i.some(e=>e)});class es{constructor(e,t="nearest",r="nearest",n=5,o=5){this.range=e,this.y=t,this.x=r,this.yMargin=n,this.xMargin=o}map(e){return e.empty?this:new es(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const Zh=xe.define({map:(i,e)=>i.map(e)});function ni(i,e,t){let r=i.facet(tf);r.length?r[0](e):window.onerror?window.onerror(String(e),t,void 0,void 0,e):t?console.error(t+":",e):console.error(e)}const As=ae.define({combine:i=>i.length?i[0]:!0});let vb=0;const xn=ae.define();class Qe{constructor(e,t,r,n,o){this.id=e,this.create=t,this.domEventHandlers=r,this.domEventObservers=n,this.extension=o(this)}static define(e,t){const{eventHandlers:r,eventObservers:n,provide:o,decorations:s}=t||{};return new Qe(vb++,e,r,n,l=>{let a=[xn.of(l)];return s&&a.push(Fn.of(h=>{let c=h.plugin(l);return c?s(c):ye.none})),o&&a.push(o(l)),a})}static fromClass(e,t){return Qe.define(r=>new e(r),t)}}class Qs{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(r){if(ni(t.state,r,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){ni(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(r){ni(e.state,r,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const lf=ae.define(),Pa=ae.define(),Fn=ae.define(),La=ae.define(),af=ae.define();function Qh(i,e,t){let r=i.state.facet(af);if(!r.length)return r;let n=r.map(s=>s instanceof Function?s(i):s),o=[];return Ee.spans(n,e,t,{point(){},span(s,l,a,h){let c=o;for(let d=a.length-1;d>=0;d--,h--){let u=a[d].spec.bidiIsolate,f;if(u!=null)if(h>0&&c.length&&(f=c[c.length-1]).to==s&&f.direction==u)f.to=l,c=f.inner;else{let g={from:s,to:l,direction:u,inner:[]};c.push(g),c=g.inner}}}}),o}const hf=ae.define();function cf(i){let e=0,t=0,r=0,n=0;for(let o of i.state.facet(hf)){let s=o(i);s&&(s.left!=null&&(e=Math.max(e,s.left)),s.right!=null&&(t=Math.max(t,s.right)),s.top!=null&&(r=Math.max(r,s.top)),s.bottom!=null&&(n=Math.max(n,s.bottom)))}return{left:e,right:t,top:r,bottom:n}}const kn=ae.define();class Yt{constructor(e,t,r,n){this.fromA=e,this.toA=t,this.fromB=r,this.toB=n}join(e){return new Yt(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,r=this;for(;t>0;t--){let n=e[t-1];if(!(n.fromA>r.toA)){if(n.toA<r.fromA)break;r=r.join(n),e.splice(t-1,1)}}return e.splice(t,0,r),e}static extendWithRanges(e,t){if(t.length==0)return e;let r=[];for(let n=0,o=0,s=0,l=0;;n++){let a=n==e.length?null:e[n],h=s-l,c=a?a.fromB:1e9;for(;o<t.length&&t[o]<c;){let d=t[o],u=t[o+1],f=Math.max(l,d),g=Math.min(c,u);if(f<=g&&new Yt(f+h,g+h,f,g).addToSet(r),u>c)break;o+=2}if(!a)return r;new Yt(a.fromA,a.toA,a.fromB,a.toB).addToSet(r),s=a.toA,l=a.toB}}}class ts{constructor(e,t,r){this.view=e,this.state=t,this.transactions=r,this.flags=0,this.startState=e.state,this.changes=it.empty(this.startState.doc.length);for(let o of r)this.changes=this.changes.compose(o.changes);let n=[];this.changes.iterChangedRanges((o,s,l,a)=>n.push(new Yt(o,s,l,a))),this.changedRanges=n}static create(e,t,r){return new ts(e,t,r)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var Ue=function(i){return i[i.LTR=0]="LTR",i[i.RTL=1]="RTL",i}(Ue||(Ue={}));const $n=Ue.LTR,df=Ue.RTL;function uf(i){let e=[];for(let t=0;t<i.length;t++)e.push(1<<+i[t]);return e}const bb=uf("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),yb=uf("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),jl=Object.create(null),ui=[];for(let i of["()","[]","{}"]){let e=i.charCodeAt(0),t=i.charCodeAt(1);jl[e]=t,jl[t]=-e}function wb(i){return i<=247?bb[i]:1424<=i&&i<=1524?2:1536<=i&&i<=1785?yb[i-1536]:1774<=i&&i<=2220?4:8192<=i&&i<=8203?256:64336<=i&&i<=65023?4:i==8204?256:1}const xb=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class Xi{get dir(){return this.level%2?df:$n}constructor(e,t,r){this.from=e,this.to=t,this.level=r}side(e,t){return this.dir==t==e?this.to:this.from}static find(e,t,r,n){let o=-1;for(let s=0;s<e.length;s++){let l=e[s];if(l.from<=t&&l.to>=t){if(l.level==r)return s;(o<0||(n!=0?n<0?l.from<t:l.to>t:e[o].level>l.level))&&(o=s)}}if(o<0)throw new RangeError("Index out of range");return o}}function ff(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++){let r=i[t],n=e[t];if(r.from!=n.from||r.to!=n.to||r.direction!=n.direction||!ff(r.inner,n.inner))return!1}return!0}const ze=[];function kb(i,e,t,r,n){for(let o=0;o<=r.length;o++){let s=o?r[o-1].to:e,l=o<r.length?r[o].from:t,a=o?256:n;for(let h=s,c=a,d=a;h<l;h++){let u=wb(i.charCodeAt(h));u==512?u=c:u==8&&d==4&&(u=16),ze[h]=u==4?2:u,u&7&&(d=u),c=u}for(let h=s,c=a,d=a;h<l;h++){let u=ze[h];if(u==128)h<l-1&&c==ze[h+1]&&c&24?u=ze[h]=c:ze[h]=256;else if(u==64){let f=h+1;for(;f<l&&ze[f]==64;)f++;let g=h&&c==8||f<t&&ze[f]==8?d==1?1:8:256;for(let y=h;y<f;y++)ze[y]=g;h=f-1}else u==8&&d==1&&(ze[h]=1);c=u,u&7&&(d=u)}}}function Sb(i,e,t,r,n){let o=n==1?2:1;for(let s=0,l=0,a=0;s<=r.length;s++){let h=s?r[s-1].to:e,c=s<r.length?r[s].from:t;for(let d=h,u,f,g;d<c;d++)if(f=jl[u=i.charCodeAt(d)])if(f<0){for(let y=l-3;y>=0;y-=3)if(ui[y+1]==-f){let b=ui[y+2],C=b&2?n:b&4?b&1?o:n:0;C&&(ze[d]=ze[ui[y]]=C),l=y;break}}else{if(ui.length==189)break;ui[l++]=d,ui[l++]=u,ui[l++]=a}else if((g=ze[d])==2||g==1){let y=g==n;a=y?0:1;for(let b=l-3;b>=0;b-=3){let C=ui[b+2];if(C&2)break;if(y)ui[b+2]|=2;else{if(C&4)break;ui[b+2]|=4}}}}}function Cb(i,e,t,r){for(let n=0,o=r;n<=t.length;n++){let s=n?t[n-1].to:i,l=n<t.length?t[n].from:e;for(let a=s;a<l;){let h=ze[a];if(h==256){let c=a+1;for(;;)if(c==l){if(n==t.length)break;c=t[n++].to,l=n<t.length?t[n].from:e}else if(ze[c]==256)c++;else break;let d=o==1,u=(c<e?ze[c]:r)==1,f=d==u?d?1:2:r;for(let g=c,y=n,b=y?t[y-1].to:i;g>a;)g==b&&(g=t[--y].from,b=y?t[y-1].to:i),ze[--g]=f;a=c}else o=h,a++}}}function Ul(i,e,t,r,n,o,s){let l=r%2?2:1;if(r%2==n%2)for(let a=e,h=0;a<t;){let c=!0,d=!1;if(h==o.length||a<o[h].from){let y=ze[a];y!=l&&(c=!1,d=y==16)}let u=!c&&l==1?[]:null,f=c?r:r+1,g=a;e:for(;;)if(h<o.length&&g==o[h].from){if(d)break e;let y=o[h];if(!c)for(let b=y.to,C=h+1;;){if(b==t)break e;if(C<o.length&&o[C].from==b)b=o[C++].to;else{if(ze[b]==l)break e;break}}if(h++,u)u.push(y);else{y.from>a&&s.push(new Xi(a,y.from,f));let b=y.direction==$n!=!(f%2);_l(i,b?r+1:r,n,y.inner,y.from,y.to,s),a=y.to}g=y.to}else{if(g==t||(c?ze[g]!=l:ze[g]==l))break;g++}u?Ul(i,a,g,r+1,n,u,s):a<g&&s.push(new Xi(a,g,f)),a=g}else for(let a=t,h=o.length;a>e;){let c=!0,d=!1;if(!h||a>o[h-1].to){let y=ze[a-1];y!=l&&(c=!1,d=y==16)}let u=!c&&l==1?[]:null,f=c?r:r+1,g=a;e:for(;;)if(h&&g==o[h-1].to){if(d)break e;let y=o[--h];if(!c)for(let b=y.from,C=h;;){if(b==e)break e;if(C&&o[C-1].to==b)b=o[--C].from;else{if(ze[b-1]==l)break e;break}}if(u)u.push(y);else{y.to<a&&s.push(new Xi(y.to,a,f));let b=y.direction==$n!=!(f%2);_l(i,b?r+1:r,n,y.inner,y.from,y.to,s),a=y.from}g=y.from}else{if(g==e||(c?ze[g-1]!=l:ze[g-1]==l))break;g--}u?Ul(i,g,a,r+1,n,u,s):g<a&&s.push(new Xi(g,a,f)),a=g}}function _l(i,e,t,r,n,o,s){let l=e%2?2:1;kb(i,n,o,r,l),Sb(i,n,o,r,l),Cb(n,o,r,l),Ul(i,n,o,e,t,r,s)}function Ab(i,e,t){if(!i)return[new Xi(0,0,e==df?1:0)];if(e==$n&&!t.length&&!xb.test(i))return pf(i.length);if(t.length)for(;i.length>ze.length;)ze[ze.length]=256;let r=[],n=e==$n?0:1;return _l(i,n,n,t,0,i.length,r),r}function pf(i){return[new Xi(0,i,0)]}let gf="";function Mb(i,e,t,r,n){var o;let s=r.head-i.from,l=-1;if(s==0){if(!n||!i.length)return null;e[0].level!=t&&(s=e[0].side(!1,t),l=0)}else if(s==i.length){if(n)return null;let u=e[e.length-1];u.level!=t&&(s=u.side(!0,t),l=e.length-1)}l<0&&(l=Xi.find(e,s,(o=r.bidiLevel)!==null&&o!==void 0?o:-1,r.assoc));let a=e[l];s==a.side(n,t)&&(a=e[l+=n?1:-1],s=a.side(!n,t));let h=n==(a.dir==t),c=mt(i.text,s,h);if(gf=i.text.slice(Math.min(s,c),Math.max(s,c)),c!=a.side(n,t))return F.cursor(c+i.from,h?-1:1,a.level);let d=l==(n?e.length-1:0)?null:e[l+(n?1:-1)];return!d&&a.level!=t?F.cursor(n?i.to:i.from,n?-1:1,t):d&&d.level<a.level?F.cursor(d.side(!n,t)+i.from,n?1:-1,d.level):F.cursor(c+i.from,n?-1:1,a.level)}class ec extends We{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new tt],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Yt(0,0,0,e.state.doc.length)],0,null)}update(e){var t;let r=e.changedRanges;this.minWidth>0&&r.length&&(r.every(({fromA:h,toA:c})=>c<this.minWidthFrom||h>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0);let n=-1;this.view.inputState.composing>=0&&(!((t=this.domChanged)===null||t===void 0)&&t.newSel?n=this.domChanged.newSel.head:!Eb(e.changes,this.hasComposition)&&!e.selectionSet&&(n=e.state.selection.main.head));let o=n>-1?Tb(this.view,e.changes,n):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:h,to:c}=this.hasComposition;r=new Yt(h,c,e.changes.mapPos(h,-1),e.changes.mapPos(c,1)).addToSet(r.slice())}this.hasComposition=o?{from:o.range.fromB,to:o.range.toB}:null,(ce.ie||ce.chrome)&&!o&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let s=this.decorations,l=this.updateDeco(),a=Pb(s,l,e.changes);return r=Yt.extendWithRanges(r,a),!(this.flags&7)&&r.length==0?!1:(this.updateInner(r,e.startState.doc.length,o),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t,r){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t,r);let{observer:n}=this.view;n.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let s=ce.chrome||ce.ios?{node:n.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,s),this.flags&=-8,s&&(s.written||n.selectionRange.focusNode!=s.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(s=>s.flags&=-9);let o=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let s of this.children)s instanceof mr&&s.widget instanceof tc&&o.push(s.dom);n.updateGaps(o)}updateChildren(e,t,r){let n=r?r.range.addToSet(e.slice()):e,o=this.childCursor(t);for(let s=n.length-1;;s--){let l=s>=0?n[s]:null;if(!l)break;let{fromA:a,toA:h,fromB:c,toB:d}=l,u,f,g,y;if(r&&r.range.fromB<d&&r.range.toB>c){let A=Dn.build(this.view.state.doc,c,r.range.fromB,this.decorations,this.dynamicDecorationMap),S=Dn.build(this.view.state.doc,r.range.toB,d,this.decorations,this.dynamicDecorationMap);f=A.breakAtStart,g=A.openStart,y=S.openEnd;let k=this.compositionView(r);S.breakAtStart?k.breakAfter=1:S.content.length&&k.merge(k.length,k.length,S.content[0],!1,S.openStart,0)&&(k.breakAfter=S.content[0].breakAfter,S.content.shift()),A.content.length&&k.merge(0,0,A.content[A.content.length-1],!0,0,A.openEnd)&&A.content.pop(),u=A.content.concat(k).concat(S.content)}else({content:u,breakAtStart:f,openStart:g,openEnd:y}=Dn.build(this.view.state.doc,c,d,this.decorations,this.dynamicDecorationMap));let{i:b,off:C}=o.findPos(h,1),{i:D,off:T}=o.findPos(a,-1);Uu(this,D,T,b,C,u,f,g,y)}r&&this.fixCompositionDOM(r)}compositionView(e){let t=new Li(e.text.nodeValue);t.flags|=8;for(let{deco:n}of e.marks)t=new Ei(n,[t],t.length);let r=new tt;return r.append(t,0),r}fixCompositionDOM(e){let t=(o,s)=>{s.flags|=8|(s.children.some(a=>a.flags&7)?1:0),this.markedForComposition.add(s);let l=We.get(o);l&&l!=s&&(l.dom=null),s.setDOM(o)},r=this.childPos(e.range.fromB,1),n=this.children[r.i];t(e.line,n);for(let o=e.marks.length-1;o>=-1;o--)r=n.childPos(r.off,1),n=n.children[r.i],t(o>=0?e.marks[o].node:e.text,n)}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let r=this.view.root.activeElement,n=r==this.dom,o=!n&&zo(this.dom,this.view.observer.selectionRange)&&!(r&&this.dom.contains(r));if(!(n||t||o))return;let s=this.forceSelection;this.forceSelection=!1;let l=this.view.state.selection.main,a=this.moveToLine(this.domAtPos(l.anchor)),h=l.empty?a:this.moveToLine(this.domAtPos(l.head));if(ce.gecko&&l.empty&&!this.hasComposition&&Rb(a)){let d=document.createTextNode("");this.view.observer.ignore(()=>a.node.insertBefore(d,a.node.childNodes[a.offset]||null)),a=h=new gt(d,0),s=!0}let c=this.view.observer.selectionRange;(s||!c.focusNode||!Qo(a.node,a.offset,c.anchorNode,c.anchorOffset)||!Qo(h.node,h.offset,c.focusNode,c.focusOffset))&&(this.view.observer.ignore(()=>{ce.android&&ce.chrome&&this.dom.contains(c.focusNode)&&Lb(c.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let d=Zo(this.view.root);if(d)if(l.empty){if(ce.gecko){let u=Db(a.node,a.offset);if(u&&u!=3){let f=vf(a.node,a.offset,u==1?1:-1);f&&(a=new gt(f.node,f.offset))}}d.collapse(a.node,a.offset),l.bidiLevel!=null&&d.caretBidiLevel!==void 0&&(d.caretBidiLevel=l.bidiLevel)}else if(d.extend){d.collapse(a.node,a.offset);try{d.extend(h.node,h.offset)}catch{}}else{let u=document.createRange();l.anchor>l.head&&([a,h]=[h,a]),u.setEnd(h.node,h.offset),u.setStart(a.node,a.offset),d.removeAllRanges(),d.addRange(u)}o&&this.view.root.activeElement==this.dom&&(this.dom.blur(),r&&r.focus())}),this.view.observer.setSelectionRange(a,h)),this.impreciseAnchor=a.precise?null:new gt(c.anchorNode,c.anchorOffset),this.impreciseHead=h.precise?null:new gt(c.focusNode,c.focusOffset)}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,r=Zo(e.root),{anchorNode:n,anchorOffset:o}=e.observer.selectionRange;if(!r||!t.empty||!t.assoc||!r.modify)return;let s=tt.find(this,t.head);if(!s)return;let l=s.posAtStart;if(t.head==l||t.head==l+s.length)return;let a=this.coordsAt(t.head,-1),h=this.coordsAt(t.head,1);if(!a||!h||a.bottom>h.top)return;let c=this.domAtPos(t.head+t.assoc);r.collapse(c.node,c.offset),r.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let d=e.observer.selectionRange;e.docView.posFromDOM(d.anchorNode,d.anchorOffset)!=t.from&&r.collapse(n,o)}moveToLine(e){let t=this.dom,r;if(e.node!=t)return e;for(let n=e.offset;!r&&n<t.childNodes.length;n++){let o=We.get(t.childNodes[n]);o instanceof tt&&(r=o.domAtPos(0))}for(let n=e.offset-1;!r&&n>=0;n--){let o=We.get(t.childNodes[n]);o instanceof tt&&(r=o.domAtPos(o.length))}return r?new gt(r.node,r.offset,!0):e}nearest(e){for(let t=e;t;){let r=We.get(t);if(r&&r.rootView==this)return r;t=t.parentNode}return null}posFromDOM(e,t){let r=this.nearest(e);if(!r)throw new RangeError("Trying to find position for a DOM position outside of the document");return r.localPosFromDOM(e,t)+r.posAtStart}domAtPos(e){let{i:t,off:r}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let n=this.children[t];if(r<n.length||n instanceof tt)break;t++,r=0}return this.children[t].domAtPos(r)}coordsAt(e,t){let r=null,n=0;for(let o=this.length,s=this.children.length-1;s>=0;s--){let l=this.children[s],a=o-l.breakAfter,h=a-l.length;if(a<e)break;h<=e&&(h<e||l.covers(-1))&&(a>e||l.covers(1))&&(!r||l instanceof tt&&!(r instanceof tt&&t>=0))&&(r=l,n=h),o=h}return r?r.coordsAt(e-n,t):null}coordsForChar(e){let{i:t,off:r}=this.childPos(e,1),n=this.children[t];if(!(n instanceof tt))return null;for(;n.children.length;){let{i:l,off:a}=n.childPos(r,1);for(;;l++){if(l==n.children.length)return null;if((n=n.children[l]).length)break}r=a}if(!(n instanceof Li))return null;let o=mt(n.text,r);if(o==r)return null;let s=wr(n.dom,r,o).getClientRects();return!s.length||s[0].top>=s[0].bottom?null:s[0]}measureVisibleLineHeights(e){let t=[],{from:r,to:n}=e,o=this.view.contentDOM.clientWidth,s=o>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,a=this.view.textDirection==Ue.LTR;for(let h=0,c=0;c<this.children.length;c++){let d=this.children[c],u=h+d.length;if(u>n)break;if(h>=r){let f=d.dom.getBoundingClientRect();if(t.push(f.height),s){let g=d.dom.lastChild,y=g?In(g):[];if(y.length){let b=y[y.length-1],C=a?b.right-f.left:f.right-b.left;C>l&&(l=C,this.minWidth=o,this.minWidthFrom=h,this.minWidthTo=u)}}}h=u+d.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return getComputedStyle(this.children[t].dom).direction=="rtl"?Ue.RTL:Ue.LTR}measureTextSize(){for(let o of this.children)if(o instanceof tt){let s=o.measureTextSize();if(s)return s}let e=document.createElement("div"),t,r,n;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let o=In(e.firstChild)[0];t=e.getBoundingClientRect().height,r=o?o.width/27:7,n=o?o.height:t,e.remove()}),{lineHeight:t,charWidth:r,textHeight:n}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new ju(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let r=0,n=0;;n++){let o=n==t.viewports.length?null:t.viewports[n],s=o?o.from-1:this.length;if(s>r){let l=(t.lineBlockAt(s).bottom-t.lineBlockAt(r).top)/this.view.scaleY;e.push(ye.replace({widget:new tc(l),block:!0,inclusive:!0,isBlockGap:!0}).range(r,s))}if(!o)break;r=o.to+1}return ye.set(e)}updateDeco(){let e=this.view.state.facet(Fn).map((t,r)=>(this.dynamicDecorationMap[r]=typeof t=="function")?t(this.view):t);for(let t=e.length;t<e.length+3;t++)this.dynamicDecorationMap[t]=!1;return this.decorations=[...e,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:t}=e,r=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),n;if(!r)return;!t.empty&&(n=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(r={left:Math.min(r.left,n.left),top:Math.min(r.top,n.top),right:Math.max(r.right,n.right),bottom:Math.max(r.bottom,n.bottom)});let o=cf(this.view),s={left:r.left-o.left,top:r.top-o.top,right:r.right+o.right,bottom:r.bottom+o.bottom};lb(this.view.scrollDOM,s,t.head<t.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==Ue.LTR)}}function Rb(i){return i.node.nodeType==1&&i.node.firstChild&&(i.offset==0||i.node.childNodes[i.offset-1].contentEditable=="false")&&(i.offset==i.node.childNodes.length||i.node.childNodes[i.offset].contentEditable=="false")}class tc extends nr{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function mf(i,e){let t=i.observer.selectionRange,r=t.focusNode&&vf(t.focusNode,t.focusOffset,0);if(!r)return null;let n=e-r.offset;return{from:n,to:n+r.node.nodeValue.length,node:r.node}}function Tb(i,e,t){let r=mf(i,t);if(!r)return null;let{node:n,from:o,to:s}=r,l=n.nodeValue;if(/[\n\r]/.test(l)||i.state.doc.sliceString(r.from,r.to)!=l)return null;let a=e.invertedDesc,h=new Yt(a.mapPos(o),a.mapPos(s),o,s),c=[];for(let d=n.parentNode;;d=d.parentNode){let u=We.get(d);if(u instanceof Ei)c.push({node:d,deco:u.mark});else{if(u instanceof tt||d.nodeName=="DIV"&&d.parentNode==i.contentDOM)return{range:h,text:n,marks:c,line:d};if(d!=i.contentDOM)c.push({node:d,deco:new to({inclusive:!0,attributes:gb(d),tagName:d.tagName.toLowerCase()})});else return null}}}function vf(i,e,t){if(t<=0)for(let r=i,n=e;;){if(r.nodeType==3)return{node:r,offset:n};if(r.nodeType==1&&n>0)r=r.childNodes[n-1],n=Pi(r);else break}if(t>=0)for(let r=i,n=e;;){if(r.nodeType==3)return{node:r,offset:n};if(r.nodeType==1&&n<r.childNodes.length&&t>=0)r=r.childNodes[n],n=0;else break}return null}function Db(i,e){return i.nodeType!=1?0:(e&&i.childNodes[e-1].contentEditable=="false"?1:0)|(e<i.childNodes.length&&i.childNodes[e].contentEditable=="false"?2:0)}let Ob=class{constructor(){this.changes=[]}compareRange(i,e){Wl(i,e,this.changes)}comparePoint(i,e){Wl(i,e,this.changes)}};function Pb(i,e,t){let r=new Ob;return Ee.compare(i,e,t,r),r.changes}function Lb(i,e){for(let t=i;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function Eb(i,e){let t=!1;return e&&i.iterChangedRanges((r,n)=>{r<e.to&&n>e.from&&(t=!0)}),t}function Bb(i,e,t=1){let r=i.charCategorizer(e),n=i.doc.lineAt(e),o=e-n.from;if(n.length==0)return F.cursor(e);o==0?t=1:o==n.length&&(t=-1);let s=o,l=o;t<0?s=mt(n.text,o,!1):l=mt(n.text,o);let a=r(n.text.slice(s,l));for(;s>0;){let h=mt(n.text,s,!1);if(r(n.text.slice(h,s))!=a)break;s=h}for(;l<n.length;){let h=mt(n.text,l);if(r(n.text.slice(l,h))!=a)break;l=h}return F.range(s+n.from,l+n.from)}function Nb(i,e){return e.left>i?e.left-i:Math.max(0,i-e.right)}function Ib(i,e){return e.top>i?e.top-i:Math.max(0,i-e.bottom)}function el(i,e){return i.top<e.bottom-1&&i.bottom>e.top+1}function ic(i,e){return e<i.top?{top:e,left:i.left,right:i.right,bottom:i.bottom}:i}function rc(i,e){return e>i.bottom?{top:i.top,left:i.left,right:i.right,bottom:e}:i}function Kl(i,e,t){let r,n,o,s,l=!1,a,h,c,d;for(let g=i.firstChild;g;g=g.nextSibling){let y=In(g);for(let b=0;b<y.length;b++){let C=y[b];n&&el(n,C)&&(C=ic(rc(C,n.bottom),n.top));let D=Nb(e,C),T=Ib(t,C);if(D==0&&T==0)return g.nodeType==3?nc(g,e,t):Kl(g,e,t);if(!r||s>T||s==T&&o>D){r=g,n=C,o=D,s=T;let A=T?t<C.top?-1:1:D?e<C.left?-1:1:0;l=!A||(A>0?b<y.length-1:b>0)}D==0?t>C.bottom&&(!c||c.bottom<C.bottom)?(a=g,c=C):t<C.top&&(!d||d.top>C.top)&&(h=g,d=C):c&&el(c,C)?c=rc(c,C.bottom):d&&el(d,C)&&(d=ic(d,C.top))}}if(c&&c.bottom>=t?(r=a,n=c):d&&d.top<=t&&(r=h,n=d),!r)return{node:i,offset:0};let u=Math.max(n.left,Math.min(n.right,e));if(r.nodeType==3)return nc(r,u,t);if(l&&r.contentEditable!="false")return Kl(r,u,t);let f=Array.prototype.indexOf.call(i.childNodes,r)+(e>=(n.left+n.right)/2?1:0);return{node:i,offset:f}}function nc(i,e,t){let r=i.nodeValue.length,n=-1,o=1e9,s=0;for(let l=0;l<r;l++){let a=wr(i,l,l+1).getClientRects();for(let h=0;h<a.length;h++){let c=a[h];if(c.top==c.bottom)continue;s||(s=e-c.left);let d=(c.top>t?c.top-t:t-c.bottom)-1;if(c.left-1<=e&&c.right+1>=e&&d<o){let u=e>=(c.left+c.right)/2,f=u;if((ce.chrome||ce.gecko)&&wr(i,l).getBoundingClientRect().left==c.right&&(f=!u),d<=0)return{node:i,offset:l+(f?1:0)};n=l+(f?1:0),o=d}}}return{node:i,offset:n>-1?n:s>0?i.nodeValue.length:0}}function bf(i,e,t,r=-1){var n,o;let s=i.contentDOM.getBoundingClientRect(),l=s.top+i.viewState.paddingTop,a,{docHeight:h}=i.viewState,{x:c,y:d}=e,u=d-l;if(u<0)return 0;if(u>h)return i.state.doc.length;for(let A=i.viewState.heightOracle.textHeight/2,S=!1;a=i.elementAtHeight(u),a.type!=At.Text;)for(;u=r>0?a.bottom+A:a.top-A,!(u>=0&&u<=h);){if(S)return t?null:0;S=!0,r=-r}d=l+u;let f=a.from;if(f<i.viewport.from)return i.viewport.from==0?0:t?null:oc(i,s,a,c,d);if(f>i.viewport.to)return i.viewport.to==i.state.doc.length?i.state.doc.length:t?null:oc(i,s,a,c,d);let g=i.dom.ownerDocument,y=i.root.elementFromPoint?i.root:g,b=y.elementFromPoint(c,d);b&&!i.contentDOM.contains(b)&&(b=null),b||(c=Math.max(s.left+1,Math.min(s.right-1,c)),b=y.elementFromPoint(c,d),b&&!i.contentDOM.contains(b)&&(b=null));let C,D=-1;if(b&&((n=i.docView.nearest(b))===null||n===void 0?void 0:n.isEditable)!=!1){if(g.caretPositionFromPoint){let A=g.caretPositionFromPoint(c,d);A&&({offsetNode:C,offset:D}=A)}else if(g.caretRangeFromPoint){let A=g.caretRangeFromPoint(c,d);A&&({startContainer:C,startOffset:D}=A,(!i.contentDOM.contains(C)||ce.safari&&zb(C,D,c)||ce.chrome&&Fb(C,D,c))&&(C=void 0))}}if(!C||!i.docView.dom.contains(C)){let A=tt.find(i.docView,f);if(!A)return u>a.top+a.height/2?a.to:a.from;({node:C,offset:D}=Kl(A.dom,c,d))}let T=i.docView.nearest(C);if(!T)return null;if(T.isWidget&&((o=T.dom)===null||o===void 0?void 0:o.nodeType)==1){let A=T.dom.getBoundingClientRect();return e.y<A.top||e.y<=A.bottom&&e.x<=(A.left+A.right)/2?T.posAtStart:T.posAtEnd}else return T.localPosFromDOM(C,D)+T.posAtStart}function oc(i,e,t,r,n){let o=Math.round((r-e.left)*i.defaultCharacterWidth);if(i.lineWrapping&&t.height>i.defaultLineHeight*1.5){let l=i.viewState.heightOracle.textHeight,a=Math.floor((n-t.top-(i.defaultLineHeight-l)*.5)/l);o+=a*i.viewState.heightOracle.lineLength}let s=i.state.sliceDoc(t.from,t.to);return t.from+Ll(s,o,i.state.tabSize)}function zb(i,e,t){let r;if(i.nodeType!=3||e!=(r=i.nodeValue.length))return!1;for(let n=i.nextSibling;n;n=n.nextSibling)if(n.nodeType!=1||n.nodeName!="BR")return!1;return wr(i,r-1,r).getBoundingClientRect().left>t}function Fb(i,e,t){if(e!=0)return!1;for(let n=i;;){let o=n.parentNode;if(!o||o.nodeType!=1||o.firstChild!=n)return!1;if(o.classList.contains("cm-line"))break;n=o}let r=i.nodeType==1?i.getBoundingClientRect():wr(i,0,Math.max(i.nodeValue.length,1)).getBoundingClientRect();return t-r.left>5}function ql(i,e){let t=i.lineBlockAt(e);if(Array.isArray(t.type)){for(let r of t.type)if(r.to>e||r.to==e&&(r.to==t.to||r.type==At.Text))return r}return t}function $b(i,e,t,r){let n=ql(i,e.head),o=!r||n.type!=At.Text||!(i.lineWrapping||n.widgetLineBreaks)?null:i.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head);if(o){let s=i.dom.getBoundingClientRect(),l=i.textDirectionAt(n.from),a=i.posAtCoords({x:t==(l==Ue.LTR)?s.right-1:s.left+1,y:(o.top+o.bottom)/2});if(a!=null)return F.cursor(a,t?-1:1)}return F.cursor(t?n.to:n.from,t?-1:1)}function sc(i,e,t,r){let n=i.state.doc.lineAt(e.head),o=i.bidiSpans(n),s=i.textDirectionAt(n.from);for(let l=e,a=null;;){let h=Mb(n,o,s,l,t),c=gf;if(!h){if(n.number==(t?i.state.doc.lines:1))return l;c=`
`,n=i.state.doc.line(n.number+(t?1:-1)),o=i.bidiSpans(n),h=F.cursor(t?n.from:n.to)}if(a){if(!a(c))return l}else{if(!r)return h;a=r(c)}l=h}}function Hb(i,e,t){let r=i.state.charCategorizer(e),n=r(t);return o=>{let s=r(o);return n==Ve.Space&&(n=s),n==s}}function Wb(i,e,t,r){let n=e.head,o=t?1:-1;if(n==(t?i.state.doc.length:0))return F.cursor(n,e.assoc);let s=e.goalColumn,l,a=i.contentDOM.getBoundingClientRect(),h=i.coordsAtPos(n,e.assoc||-1),c=i.documentTop;if(h)s==null&&(s=h.left-a.left),l=o<0?h.top:h.bottom;else{let f=i.viewState.lineBlockAt(n);s==null&&(s=Math.min(a.right-a.left,i.defaultCharacterWidth*(n-f.from))),l=(o<0?f.top:f.bottom)+c}let d=a.left+s,u=r??i.viewState.heightOracle.textHeight>>1;for(let f=0;;f+=10){let g=l+(u+f)*o,y=bf(i,{x:d,y:g},!1,o);if(g<a.top||g>a.bottom||(o<0?y<n:y>n)){let b=i.docView.coordsForChar(y),C=!b||g<b.top?-1:1;return F.cursor(y,C,void 0,s)}}}function Fo(i,e,t){for(;;){let r=0;for(let n of i)n.between(e-1,e+1,(o,s,l)=>{if(e>o&&e<s){let a=r||t||(e-o<s-e?-1:1);e=a<0?o:s,r=a}});if(!r)return e}}function tl(i,e,t){let r=Fo(i.state.facet(La).map(n=>n(i)),t.from,e.head>t.from?-1:1);return r==t.from?t:F.cursor(r,r<t.from?1:-1)}class Vb{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.handleEvent=this.handleEvent.bind(this),e.scrollDOM.addEventListener("mousedown",t=>{if(t.target==e.scrollDOM&&t.clientY>e.contentDOM.getBoundingClientRect().bottom&&(this.runHandlers("mousedown",t),!t.defaultPrevented&&t.button==2)){let r=e.contentDOM.style.minHeight;e.contentDOM.style.minHeight="100%",setTimeout(()=>e.contentDOM.style.minHeight=r,200)}}),e.scrollDOM.addEventListener("drop",t=>{t.target==e.scrollDOM&&t.clientY>e.contentDOM.getBoundingClientRect().bottom&&this.runHandlers("drop",t)}),this.notifiedFocused=e.hasFocus,ce.safari&&e.contentDOM.addEventListener("input",()=>null),ce.gecko&&ny(e.contentDOM.ownerDocument)}handleEvent(e){!Yb(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||this.runHandlers(e.type,e)}runHandlers(e,t){let r=this.handlers[e];if(r){for(let n of r.observers)n(this.view,t);for(let n of r.handlers){if(t.defaultPrevented)break;if(n(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=jb(e),r=this.handlers,n=this.view.contentDOM;for(let o in t)if(o!="scroll"){let s=!t[o].handlers.length,l=r[o];l&&s!=!l.handlers.length&&(n.removeEventListener(o,this.handleEvent),l=null),l||n.addEventListener(o,this.handleEvent,{passive:s})}for(let o in r)o!="scroll"&&!t[o]&&n.removeEventListener(o,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(e.keyCode!=27&&wf.indexOf(e.keyCode)<0&&(this.view.inputState.lastEscPress=0),ce.android&&ce.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return ce.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((t=yf.find(r=>r.keyCode==e.keyCode))&&!e.ctrlKey||Ub.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(){let e=this.pendingIOSKey;return e?(this.pendingIOSKey=void 0,Vr(this.view.contentDOM,e.key,e.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:ce.safari&&!ce.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function lc(i,e){return(t,r)=>{try{return e.call(i,r,t)}catch(n){ni(t.state,n)}}}function jb(i){let e=Object.create(null);function t(r){return e[r]||(e[r]={observers:[],handlers:[]})}for(let r of i){let n=r.spec;if(n&&n.domEventHandlers)for(let o in n.domEventHandlers){let s=n.domEventHandlers[o];s&&t(o).handlers.push(lc(r.value,s))}if(n&&n.domEventObservers)for(let o in n.domEventObservers){let s=n.domEventObservers[o];s&&t(o).observers.push(lc(r.value,s))}}for(let r in Si)t(r).handlers.push(Si[r]);for(let r in oi)t(r).observers.push(oi[r]);return e}const yf=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Ub="dthko",wf=[16,17,18,20,91,92,224,225],mo=6;function vo(i){return Math.max(0,i)*.7+8}function _b(i,e){return Math.max(Math.abs(i.clientX-e.clientX),Math.abs(i.clientY-e.clientY))}class Kb{constructor(e,t,r,n){this.view=e,this.startEvent=t,this.style=r,this.mustSelect=n,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParent=ab(e.contentDOM),this.atoms=e.state.facet(La).map(s=>s(e));let o=e.contentDOM.ownerDocument;o.addEventListener("mousemove",this.move=this.move.bind(this)),o.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(Me.allowMultipleSelections)&&qb(e,t),this.dragging=Xb(e,t)&&Cf(t)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){var t;if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&_b(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let r=0,n=0,o=((t=this.scrollParent)===null||t===void 0?void 0:t.getBoundingClientRect())||{left:0,top:0,right:this.view.win.innerWidth,bottom:this.view.win.innerHeight},s=cf(this.view);e.clientX-s.left<=o.left+mo?r=-vo(o.left-e.clientX):e.clientX+s.right>=o.right-mo&&(r=vo(e.clientX-o.right)),e.clientY-s.top<=o.top+mo?n=-vo(o.top-e.clientY):e.clientY+s.bottom>=o.bottom-mo&&(n=vo(e.clientY-o.bottom)),this.setScrollSpeed(r,n)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){this.scrollParent?(this.scrollParent.scrollLeft+=this.scrollSpeed.x,this.scrollParent.scrollTop+=this.scrollSpeed.y):this.view.win.scrollBy(this.scrollSpeed.x,this.scrollSpeed.y),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(e){let t=null;for(let r=0;r<e.ranges.length;r++){let n=e.ranges[r],o=null;if(n.empty){let s=Fo(this.atoms,n.from,0);s!=n.from&&(o=F.cursor(s,-1))}else{let s=Fo(this.atoms,n.from,-1),l=Fo(this.atoms,n.to,1);(s!=n.from||l!=n.to)&&(o=F.range(n.from==n.anchor?s:l,n.from==n.head?s:l))}o&&(t||(t=e.ranges.slice()),t[r]=o)}return t?F.create(t,e.mainIndex):e}select(e){let{view:t}=this,r=this.skipAtoms(this.style.get(e,this.extend,this.multiple));(this.mustSelect||!r.eq(t.state.selection)||r.main.assoc!=t.state.selection.main.assoc&&this.dragging===!1)&&this.view.dispatch({selection:r,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function qb(i,e){let t=i.state.facet(Zu);return t.length?t[0](e):ce.mac?e.metaKey:e.ctrlKey}function Gb(i,e){let t=i.state.facet(Qu);return t.length?t[0](e):ce.mac?!e.altKey:!e.ctrlKey}function Xb(i,e){let{main:t}=i.state.selection;if(t.empty)return!1;let r=Zo(i.root);if(!r||r.rangeCount==0)return!0;let n=r.getRangeAt(0).getClientRects();for(let o=0;o<n.length;o++){let s=n[o];if(s.left<=e.clientX&&s.right>=e.clientX&&s.top<=e.clientY&&s.bottom>=e.clientY)return!0}return!1}function Yb(i,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,r;t!=i.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(r=We.get(t))&&r.ignoreEvent(e))return!1;return!0}const Si=Object.create(null),oi=Object.create(null),xf=ce.ie&&ce.ie_version<15||ce.ios&&ce.webkit_version<604;function Jb(i){let e=i.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{i.focus(),t.remove(),kf(i,t.value)},50)}function kf(i,e){let{state:t}=i,r,n=1,o=t.toText(e),s=o.lines==t.selection.ranges.length;if(Gl!=null&&t.selection.ranges.every(l=>l.empty)&&Gl==o.toString()){let l=-1;r=t.changeByRange(a=>{let h=t.doc.lineAt(a.from);if(h.from==l)return{range:a};l=h.from;let c=t.toText((s?o.line(n++).text:e)+t.lineBreak);return{changes:{from:h.from,insert:c},range:F.cursor(a.from+c.length)}})}else s?r=t.changeByRange(l=>{let a=o.line(n++);return{changes:{from:l.from,to:l.to,insert:a.text},range:F.cursor(l.from+a.length)}}):r=t.replaceSelection(o);i.dispatch(r,{userEvent:"input.paste",scrollIntoView:!0})}oi.scroll=i=>{i.inputState.lastScrollTop=i.scrollDOM.scrollTop,i.inputState.lastScrollLeft=i.scrollDOM.scrollLeft};Si.keydown=(i,e)=>(i.inputState.setSelectionOrigin("select"),e.keyCode==27&&(i.inputState.lastEscPress=Date.now()),!1);oi.touchstart=(i,e)=>{i.inputState.lastTouchTime=Date.now(),i.inputState.setSelectionOrigin("select.pointer")};oi.touchmove=i=>{i.inputState.setSelectionOrigin("select.pointer")};Si.mousedown=(i,e)=>{if(i.observer.flush(),i.inputState.lastTouchTime>Date.now()-2e3)return!1;let t=null;for(let r of i.state.facet(ef))if(t=r(i,e),t)break;if(!t&&e.button==0&&(t=ey(i,e)),t){let r=!i.hasFocus;i.inputState.startMouseSelection(new Kb(i,e,t,r)),r&&i.observer.ignore(()=>Hu(i.contentDOM));let n=i.inputState.mouseSelection;if(n)return n.start(e),!n.dragging}return!1};function ac(i,e,t,r){if(r==1)return F.cursor(e,t);if(r==2)return Bb(i.state,e,t);{let n=tt.find(i.docView,e),o=i.state.doc.lineAt(n?n.posAtEnd:e),s=n?n.posAtStart:o.from,l=n?n.posAtEnd:o.to;return l<i.state.doc.length&&l==o.to&&l++,F.range(s,l)}}let Sf=(i,e)=>i>=e.top&&i<=e.bottom,hc=(i,e,t)=>Sf(e,t)&&i>=t.left&&i<=t.right;function Zb(i,e,t,r){let n=tt.find(i.docView,e);if(!n)return 1;let o=e-n.posAtStart;if(o==0)return 1;if(o==n.length)return-1;let s=n.coordsAt(o,-1);if(s&&hc(t,r,s))return-1;let l=n.coordsAt(o,1);return l&&hc(t,r,l)?1:s&&Sf(r,s)?-1:1}function cc(i,e){let t=i.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:Zb(i,t,e.clientX,e.clientY)}}const Qb=ce.ie&&ce.ie_version<=11;let dc=null,uc=0,fc=0;function Cf(i){if(!Qb)return i.detail;let e=dc,t=fc;return dc=i,fc=Date.now(),uc=!e||t>Date.now()-400&&Math.abs(e.clientX-i.clientX)<2&&Math.abs(e.clientY-i.clientY)<2?(uc+1)%3:1}function ey(i,e){let t=cc(i,e),r=Cf(e),n=i.state.selection;return{update(o){o.docChanged&&(t.pos=o.changes.mapPos(t.pos),n=n.map(o.changes))},get(o,s,l){let a=cc(i,o),h,c=ac(i,a.pos,a.bias,r);if(t.pos!=a.pos&&!s){let d=ac(i,t.pos,t.bias,r),u=Math.min(d.from,c.from),f=Math.max(d.to,c.to);c=u<c.from?F.range(u,f):F.range(f,u)}return s?n.replaceRange(n.main.extend(c.from,c.to)):l&&r==1&&n.ranges.length>1&&(h=ty(n,a.pos))?h:l?n.addRange(c):F.create([c])}}}function ty(i,e){for(let t=0;t<i.ranges.length;t++){let{from:r,to:n}=i.ranges[t];if(r<=e&&n>=e)return F.create(i.ranges.slice(0,t).concat(i.ranges.slice(t+1)),i.mainIndex==t?0:i.mainIndex-(i.mainIndex>t?1:0))}return null}Si.dragstart=(i,e)=>{let{selection:{main:t}}=i.state,{mouseSelection:r}=i.inputState;return r&&(r.dragging=t),e.dataTransfer&&(e.dataTransfer.setData("Text",i.state.sliceDoc(t.from,t.to)),e.dataTransfer.effectAllowed="copyMove"),!1};function pc(i,e,t,r){if(!t)return;let n=i.posAtCoords({x:e.clientX,y:e.clientY},!1),{mouseSelection:o}=i.inputState,s=r&&o&&o.dragging&&Gb(i,e)?{from:o.dragging.from,to:o.dragging.to}:null,l={from:n,insert:t},a=i.state.changes(s?[s,l]:l);i.focus(),i.dispatch({changes:a,selection:{anchor:a.mapPos(n,-1),head:a.mapPos(n,1)},userEvent:s?"move.drop":"input.drop"})}Si.drop=(i,e)=>{if(!e.dataTransfer)return!1;if(i.state.readOnly)return!0;let t=e.dataTransfer.files;if(t&&t.length){let r=Array(t.length),n=0,o=()=>{++n==t.length&&pc(i,e,r.filter(s=>s!=null).join(i.state.lineBreak),!1)};for(let s=0;s<t.length;s++){let l=new FileReader;l.onerror=o,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(r[s]=l.result),o()},l.readAsText(t[s])}return!0}else{let r=e.dataTransfer.getData("Text");if(r)return pc(i,e,r,!0),!0}return!1};Si.paste=(i,e)=>{if(i.state.readOnly)return!0;i.observer.flush();let t=xf?null:e.clipboardData;return t?(kf(i,t.getData("text/plain")||t.getData("text/uri-text")),!0):(Jb(i),!1)};function iy(i,e){let t=i.dom.parentNode;if(!t)return;let r=t.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.value=e,r.focus(),r.selectionEnd=e.length,r.selectionStart=0,setTimeout(()=>{r.remove(),i.focus()},50)}function ry(i){let e=[],t=[],r=!1;for(let n of i.selection.ranges)n.empty||(e.push(i.sliceDoc(n.from,n.to)),t.push(n));if(!e.length){let n=-1;for(let{from:o}of i.selection.ranges){let s=i.doc.lineAt(o);s.number>n&&(e.push(s.text),t.push({from:s.from,to:Math.min(i.doc.length,s.to+1)})),n=s.number}r=!0}return{text:e.join(i.lineBreak),ranges:t,linewise:r}}let Gl=null;Si.copy=Si.cut=(i,e)=>{let{text:t,ranges:r,linewise:n}=ry(i.state);if(!t&&!n)return!1;Gl=n?t:null,e.type=="cut"&&!i.state.readOnly&&i.dispatch({changes:r,scrollIntoView:!0,userEvent:"delete.cut"});let o=xf?null:e.clipboardData;return o?(o.clearData(),o.setData("text/plain",t),!0):(iy(i,t),!1)};const Af=zi.define();function Mf(i,e){let t=[];for(let r of i.facet(nf)){let n=r(i,e);n&&t.push(n)}return t?i.update({effects:t,annotations:Af.of(!0)}):null}function Rf(i){setTimeout(()=>{let e=i.hasFocus;if(e!=i.inputState.notifiedFocused){let t=Mf(i.state,e);t?i.dispatch(t):i.update([])}},10)}oi.focus=i=>{i.inputState.lastFocusTime=Date.now(),!i.scrollDOM.scrollTop&&(i.inputState.lastScrollTop||i.inputState.lastScrollLeft)&&(i.scrollDOM.scrollTop=i.inputState.lastScrollTop,i.scrollDOM.scrollLeft=i.inputState.lastScrollLeft),Rf(i)};oi.blur=i=>{i.observer.clearSelectionRange(),Rf(i)};oi.compositionstart=oi.compositionupdate=i=>{i.inputState.compositionFirstChange==null&&(i.inputState.compositionFirstChange=!0),i.inputState.composing<0&&(i.inputState.composing=0)};oi.compositionend=i=>{i.inputState.composing=-1,i.inputState.compositionEndedAt=Date.now(),i.inputState.compositionPendingKey=!0,i.inputState.compositionPendingChange=i.observer.pendingRecords().length>0,i.inputState.compositionFirstChange=null,ce.chrome&&ce.android?i.observer.flushSoon():i.inputState.compositionPendingChange?Promise.resolve().then(()=>i.observer.flush()):setTimeout(()=>{i.inputState.composing<0&&i.docView.hasComposition&&i.update([])},50)};oi.contextmenu=i=>{i.inputState.lastContextMenu=Date.now()};Si.beforeinput=(i,e)=>{var t;let r;if(ce.chrome&&ce.android&&(r=yf.find(n=>n.inputType==e.inputType))&&(i.observer.delayAndroidKey(r.key,r.keyCode),r.key=="Backspace"||r.key=="Delete")){let n=((t=window.visualViewport)===null||t===void 0?void 0:t.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>n+10&&i.hasFocus&&(i.contentDOM.blur(),i.focus())},100)}return!1};const gc=new Set;function ny(i){gc.has(i)||(gc.add(i),i.addEventListener("copy",()=>{}),i.addEventListener("cut",()=>{}))}const mc=["pre-wrap","normal","pre-line","break-spaces"];class oy{constructor(e){this.lineWrapping=e,this.doc=Pe.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30,this.heightChanged=!1}heightForGap(e,t){let r=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(r+=Math.max(0,Math.ceil((t-e-r*this.lineLength*.5)/this.lineLength))),this.lineHeight*r}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return mc.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let r=0;r<e.length;r++){let n=e[r];n<0?r++:this.heightSamples[Math.floor(n*10)]||(t=!0,this.heightSamples[Math.floor(n*10)]=!0)}return t}refresh(e,t,r,n,o,s){let l=mc.indexOf(e)>-1,a=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=l;if(this.lineWrapping=l,this.lineHeight=t,this.charWidth=r,this.textHeight=n,this.lineLength=o,a){this.heightSamples={};for(let h=0;h<s.length;h++){let c=s[h];c<0?h++:this.heightSamples[Math.floor(c*10)]=!0}}return a}}class sy{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class bi{constructor(e,t,r,n,o){this.from=e,this.length=t,this.top=r,this.height=n,this._content=o}get type(){return typeof this._content=="number"?At.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof tr?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new bi(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var He=function(i){return i[i.ByPos=0]="ByPos",i[i.ByHeight=1]="ByHeight",i[i.ByPosNoHeight=2]="ByPosNoHeight",i}(He||(He={}));const $o=.001;class Mt{constructor(e,t,r=2){this.length=e,this.height=t,this.flags=r}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,t){this.height!=t&&(Math.abs(this.height-t)>$o&&(e.heightChanged=!0),this.height=t)}replace(e,t,r){return Mt.of(r)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,r,n){let o=this,s=r.doc;for(let l=n.length-1;l>=0;l--){let{fromA:a,toA:h,fromB:c,toB:d}=n[l],u=o.lineAt(a,He.ByPosNoHeight,r.setDoc(t),0,0),f=u.to>=h?u:o.lineAt(h,He.ByPosNoHeight,r,0,0);for(d+=f.to-h,h=f.to;l>0&&u.from<=n[l-1].toA;)a=n[l-1].fromA,c=n[l-1].fromB,l--,a<u.from&&(u=o.lineAt(a,He.ByPosNoHeight,r,0,0));c+=u.from-a,a=u.from;let g=Ea.build(r.setDoc(s),e,c,d);o=o.replace(a,h,g)}return o.updateHeight(r,0)}static empty(){return new $t(0,0)}static of(e){if(e.length==1)return e[0];let t=0,r=e.length,n=0,o=0;for(;;)if(t==r)if(n>o*2){let l=e[t-1];l.break?e.splice(--t,1,l.left,null,l.right):e.splice(--t,1,l.left,l.right),r+=1+l.break,n-=l.size}else if(o>n*2){let l=e[r];l.break?e.splice(r,1,l.left,null,l.right):e.splice(r,1,l.left,l.right),r+=2+l.break,o-=l.size}else break;else if(n<o){let l=e[t++];l&&(n+=l.size)}else{let l=e[--r];l&&(o+=l.size)}let s=0;return e[t-1]==null?(s=1,t--):e[t]==null&&(s=1,r++),new ly(Mt.of(e.slice(0,t)),s,Mt.of(e.slice(r)))}}Mt.prototype.size=1;class Tf extends Mt{constructor(e,t,r){super(e,t),this.deco=r}blockAt(e,t,r,n){return new bi(n,this.length,r,this.height,this.deco||0)}lineAt(e,t,r,n,o){return this.blockAt(0,r,n,o)}forEachLine(e,t,r,n,o,s){e<=o+this.length&&t>=o&&s(this.blockAt(0,r,n,o))}updateHeight(e,t=0,r=!1,n){return n&&n.from<=t&&n.more&&this.setHeight(e,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class $t extends Tf{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,r,n){return new bi(n,this.length,r,this.height,this.breaks)}replace(e,t,r){let n=r[0];return r.length==1&&(n instanceof $t||n instanceof st&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof st?n=new $t(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):Mt.of(r)}updateHeight(e,t=0,r=!1,n){return n&&n.from<=t&&n.more?this.setHeight(e,n.heights[n.index++]):(r||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class st extends Mt{constructor(e){super(e,0)}heightMetrics(e,t){let r=e.doc.lineAt(t).number,n=e.doc.lineAt(t+this.length).number,o=n-r+1,s,l=0;if(e.lineWrapping){let a=Math.min(this.height,e.lineHeight*o);s=a/o,this.length>o+1&&(l=(this.height-a)/(this.length-o-1))}else s=this.height/o;return{firstLine:r,lastLine:n,perLine:s,perChar:l}}blockAt(e,t,r,n){let{firstLine:o,lastLine:s,perLine:l,perChar:a}=this.heightMetrics(t,n);if(t.lineWrapping){let h=n+Math.round(Math.max(0,Math.min(1,(e-r)/this.height))*this.length),c=t.doc.lineAt(h),d=l+c.length*a,u=Math.max(r,e-d/2);return new bi(c.from,c.length,u,d,0)}else{let h=Math.max(0,Math.min(s-o,Math.floor((e-r)/l))),{from:c,length:d}=t.doc.line(o+h);return new bi(c,d,r+l*h,l,0)}}lineAt(e,t,r,n,o){if(t==He.ByHeight)return this.blockAt(e,r,n,o);if(t==He.ByPosNoHeight){let{from:f,to:g}=r.doc.lineAt(e);return new bi(f,g-f,0,0,0)}let{firstLine:s,perLine:l,perChar:a}=this.heightMetrics(r,o),h=r.doc.lineAt(e),c=l+h.length*a,d=h.number-s,u=n+l*d+a*(h.from-o-d);return new bi(h.from,h.length,Math.max(n,Math.min(u,n+this.height-c)),c,0)}forEachLine(e,t,r,n,o,s){e=Math.max(e,o),t=Math.min(t,o+this.length);let{firstLine:l,perLine:a,perChar:h}=this.heightMetrics(r,o);for(let c=e,d=n;c<=t;){let u=r.doc.lineAt(c);if(c==e){let g=u.number-l;d+=a*g+h*(e-o-g)}let f=a+h*u.length;s(new bi(u.from,u.length,d,f,0)),d+=f,c=u.to+1}}replace(e,t,r){let n=this.length-t;if(n>0){let o=r[r.length-1];o instanceof st?r[r.length-1]=new st(o.length+n):r.push(null,new st(n-1))}if(e>0){let o=r[0];o instanceof st?r[0]=new st(e+o.length):r.unshift(new st(e-1),null)}return Mt.of(r)}decomposeLeft(e,t){t.push(new st(e-1),null)}decomposeRight(e,t){t.push(null,new st(this.length-e-1))}updateHeight(e,t=0,r=!1,n){let o=t+this.length;if(n&&n.from<=t+this.length&&n.more){let s=[],l=Math.max(t,n.from),a=-1;for(n.from>t&&s.push(new st(n.from-t-1).updateHeight(e,t));l<=o&&n.more;){let c=e.doc.lineAt(l).length;s.length&&s.push(null);let d=n.heights[n.index++];a==-1?a=d:Math.abs(d-a)>=$o&&(a=-2);let u=new $t(c,d);u.outdated=!1,s.push(u),l+=c+1}l<=o&&s.push(null,new st(o-l).updateHeight(e,l));let h=Mt.of(s);return(a<0||Math.abs(h.height-this.height)>=$o||Math.abs(a-this.heightMetrics(e,t).perLine)>=$o)&&(e.heightChanged=!0),h}else(r||this.outdated)&&(this.setHeight(e,e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class ly extends Mt{constructor(e,t,r){super(e.length+t+r.length,e.height+r.height,t|(e.outdated||r.outdated?2:0)),this.left=e,this.right=r,this.size=e.size+r.size}get break(){return this.flags&1}blockAt(e,t,r,n){let o=r+this.left.height;return e<o?this.left.blockAt(e,t,r,n):this.right.blockAt(e,t,o,n+this.left.length+this.break)}lineAt(e,t,r,n,o){let s=n+this.left.height,l=o+this.left.length+this.break,a=t==He.ByHeight?e<s:e<l,h=a?this.left.lineAt(e,t,r,n,o):this.right.lineAt(e,t,r,s,l);if(this.break||(a?h.to<l:h.from>l))return h;let c=t==He.ByPosNoHeight?He.ByPosNoHeight:He.ByPos;return a?h.join(this.right.lineAt(l,c,r,s,l)):this.left.lineAt(l,c,r,n,o).join(h)}forEachLine(e,t,r,n,o,s){let l=n+this.left.height,a=o+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,r,n,o,s),t>=a&&this.right.forEachLine(e,t,r,l,a,s);else{let h=this.lineAt(a,He.ByPos,r,n,o);e<h.from&&this.left.forEachLine(e,h.from-1,r,n,o,s),h.to>=e&&h.from<=t&&s(h),t>h.to&&this.right.forEachLine(h.to+1,t,r,l,a,s)}}replace(e,t,r){let n=this.left.length+this.break;if(t<n)return this.balanced(this.left.replace(e,t,r),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-n,t-n,r));let o=[];e>0&&this.decomposeLeft(e,o);let s=o.length;for(let l of r)o.push(l);if(e>0&&vc(o,s-1),t<this.length){let l=o.length;this.decomposeRight(t,o),vc(o,l)}return Mt.of(o)}decomposeLeft(e,t){let r=this.left.length;if(e<=r)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(r++,e>=r&&t.push(null)),e>r&&this.right.decomposeLeft(e-r,t)}decomposeRight(e,t){let r=this.left.length,n=r+this.break;if(e>=n)return this.right.decomposeRight(e-n,t);e<r&&this.left.decomposeRight(e,t),this.break&&e<n&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Mt.of(this.break?[e,null,t]:[e,t]):(this.left=e,this.right=t,this.height=e.height+t.height,this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,r=!1,n){let{left:o,right:s}=this,l=t+o.length+this.break,a=null;return n&&n.from<=t+o.length&&n.more?a=o=o.updateHeight(e,t,r,n):o.updateHeight(e,t,r),n&&n.from<=l+s.length&&n.more?a=s=s.updateHeight(e,l,r,n):s.updateHeight(e,l,r),a?this.balanced(o,s):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function vc(i,e){let t,r;i[e]==null&&(t=i[e-1])instanceof st&&(r=i[e+1])instanceof st&&i.splice(e-1,3,new st(t.length+1+r.length))}const ay=5;class Ea{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let r=Math.min(t,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof $t?n.length+=r-this.pos:(r>this.pos||!this.isCovered)&&this.nodes.push(new $t(r-this.pos,-1)),this.writtenTo=r,t>r&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,r){if(e<t||r.heightRelevant){let n=r.widget?r.widget.estimatedHeight:0,o=r.widget?r.widget.lineBreaks:0;n<0&&(n=this.oracle.lineHeight);let s=t-e;r.block?this.addBlock(new Tf(s,n,r)):(s||o||n>=ay)&&this.addLineDeco(n,o,s)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new $t(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let r=new st(t-e);return this.oracle.doc.lineAt(e).to==t&&(r.flags|=4),r}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof $t)return e;let t=new $t(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,r){let n=this.ensureLine();n.length+=r,n.collapsed+=r,n.widgetHeight=Math.max(n.widgetHeight,e),n.breaks+=t,this.writtenTo=this.pos=this.pos+r}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof $t)&&!this.isCovered?this.nodes.push(new $t(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let r=e;for(let n of this.nodes)n instanceof $t&&n.updateHeight(this.oracle,r),r+=n?n.length:1;return this.nodes}static build(e,t,r,n){let o=new Ea(r,e);return Ee.spans(t,r,n,o,0),o.finish(r)}}function hy(i,e,t){let r=new cy;return Ee.compare(i,e,t,r,0),r.changes}class cy{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,r,n){(e<t||r&&r.heightRelevant||n&&n.heightRelevant)&&Wl(e,t,this.changes,5)}}function dy(i,e){let t=i.getBoundingClientRect(),r=i.ownerDocument,n=r.defaultView||window,o=Math.max(0,t.left),s=Math.min(n.innerWidth,t.right),l=Math.max(0,t.top),a=Math.min(n.innerHeight,t.bottom);for(let h=i.parentNode;h&&h!=r.body;)if(h.nodeType==1){let c=h,d=window.getComputedStyle(c);if((c.scrollHeight>c.clientHeight||c.scrollWidth>c.clientWidth)&&d.overflow!="visible"){let u=c.getBoundingClientRect();o=Math.max(o,u.left),s=Math.min(s,u.right),l=Math.max(l,u.top),a=h==i.parentNode?u.bottom:Math.min(a,u.bottom)}h=d.position=="absolute"||d.position=="fixed"?c.offsetParent:c.parentNode}else if(h.nodeType==11)h=h.host;else break;return{left:o-t.left,right:Math.max(o,s)-t.left,top:l-(t.top+e),bottom:Math.max(l,a)-(t.top+e)}}function uy(i,e){let t=i.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class il{constructor(e,t,r){this.from=e,this.to=t,this.size=r}static same(e,t){if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++){let n=e[r],o=t[r];if(n.from!=o.from||n.to!=o.to||n.size!=o.size)return!1}return!0}draw(e,t){return ye.replace({widget:new fy(this.size*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class fy extends nr{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class bc{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!0,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=yc,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Ue.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(Pa).some(r=>typeof r!="function"&&r.class=="cm-lineWrapping");this.heightOracle=new oy(t),this.stateDeco=e.facet(Fn).filter(r=>typeof r!="function"),this.heightMap=Mt.empty().applyChanges(this.stateDeco,Pe.empty,this.heightOracle.setDoc(e.doc),[new Yt(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ye.set(this.lineGaps.map(r=>r.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let r=0;r<=1;r++){let n=r?t.head:t.anchor;if(!e.some(({from:o,to:s})=>n>=o&&n<=s)){let{from:o,to:s}=this.lineBlockAt(n);e.push(new bo(o,s))}}this.viewports=e.sort((r,n)=>r.from-n.from),this.scaler=this.heightMap.height<=7e6?yc:new my(this.heightOracle,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:Sn(e,this.scaler))})}update(e,t=null){this.state=e.state;let r=this.stateDeco;this.stateDeco=this.state.facet(Fn).filter(c=>typeof c!="function");let n=e.changedRanges,o=Yt.extendWithRanges(n,hy(r,this.stateDeco,e?e.changes:it.empty(this.state.doc.length))),s=this.heightMap.height,l=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),o),this.heightMap.height!=s&&(e.flags|=2),l?(this.scrollAnchorPos=e.changes.mapPos(l.from,-1),this.scrollAnchorHeight=l.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let a=o.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let h=!e.changes.empty||e.flags&2||a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(sf)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,r=window.getComputedStyle(t),n=this.heightOracle,o=r.whiteSpace;this.defaultTextDirection=r.direction=="rtl"?Ue.RTL:Ue.LTR;let s=this.heightOracle.mustRefreshForWrapping(o),l=t.getBoundingClientRect(),a=s||this.mustMeasureContent||this.contentDOMHeight!=l.height;this.contentDOMHeight=l.height,this.mustMeasureContent=!1;let h=0,c=0;if(l.width&&l.height){let A=l.width/t.offsetWidth,S=l.height/t.offsetHeight;(A>.995&&A<1.005||!isFinite(A)||Math.abs(l.width-t.offsetWidth)<1)&&(A=1),(S>.995&&S<1.005||!isFinite(S)||Math.abs(l.height-t.offsetHeight)<1)&&(S=1),(this.scaleX!=A||this.scaleY!=S)&&(this.scaleX=A,this.scaleY=S,h|=8,s=a=!0)}let d=(parseInt(r.paddingTop)||0)*this.scaleY,u=(parseInt(r.paddingBottom)||0)*this.scaleY;(this.paddingTop!=d||this.paddingBottom!=u)&&(this.paddingTop=d,this.paddingBottom=u,h|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(n.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,h|=8);let f=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=f&&(this.scrollAnchorHeight=-1,this.scrollTop=f),this.scrolledToBottom=Vu(e.scrollDOM);let g=(this.printing?uy:dy)(t,this.paddingTop),y=g.top-this.pixelViewport.top,b=g.bottom-this.pixelViewport.bottom;this.pixelViewport=g;let C=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(C!=this.inView&&(this.inView=C,C&&(a=!0)),!this.inView&&!this.scrollTarget)return 0;let D=l.width;if((this.contentDOMWidth!=D||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=l.width,this.editorHeight=e.scrollDOM.clientHeight,h|=8),a){let A=e.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(A)&&(s=!0),s||n.lineWrapping&&Math.abs(D-this.contentDOMWidth)>n.charWidth){let{lineHeight:S,charWidth:k,textHeight:v}=e.docView.measureTextSize();s=S>0&&n.refresh(o,S,k,v,D/k,A),s&&(e.docView.minWidth=0,h|=8)}y>0&&b>0?c=Math.max(y,b):y<0&&b<0&&(c=Math.min(y,b)),n.heightChanged=!1;for(let S of this.viewports){let k=S.from==this.viewport.from?A:e.docView.measureVisibleLineHeights(S);this.heightMap=(s?Mt.empty().applyChanges(this.stateDeco,Pe.empty,this.heightOracle,[new Yt(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(n,0,s,new sy(S.from,k))}n.heightChanged&&(h|=2)}let T=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return T&&(this.viewport=this.getViewport(c,this.scrollTarget)),this.updateForViewport(),(h&2||T)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(s?[]:this.lineGaps,e)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let r=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),n=this.heightMap,o=this.heightOracle,{visibleTop:s,visibleBottom:l}=this,a=new bo(n.lineAt(s-r*1e3,He.ByHeight,o,0,0).from,n.lineAt(l+(1-r)*1e3,He.ByHeight,o,0,0).to);if(t){let{head:h}=t.range;if(h<a.from||h>a.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),d=n.lineAt(h,He.ByPos,o,0,0),u;t.y=="center"?u=(d.top+d.bottom)/2-c/2:t.y=="start"||t.y=="nearest"&&h<a.from?u=d.top:u=d.bottom-c,a=new bo(n.lineAt(u-1e3/2,He.ByHeight,o,0,0).from,n.lineAt(u+c+1e3/2,He.ByHeight,o,0,0).to)}}return a}mapViewport(e,t){let r=t.mapPos(e.from,-1),n=t.mapPos(e.to,1);return new bo(this.heightMap.lineAt(r,He.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(n,He.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},r=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(e,He.ByPos,this.heightOracle,0,0),{bottom:o}=this.heightMap.lineAt(t,He.ByPos,this.heightOracle,0,0),{visibleTop:s,visibleBottom:l}=this;return(e==0||n<=s-Math.max(10,Math.min(-r,250)))&&(t==this.state.doc.length||o>=l+Math.max(10,Math.min(r,250)))&&n>s-2*1e3&&o<l+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let r=[];for(let n of e)t.touchesRange(n.from,n.to)||r.push(new il(t.mapPos(n.from),t.mapPos(n.to),n.size));return r}ensureLineGaps(e,t){let r=this.heightOracle.lineWrapping,n=r?1e4:2e3,o=n>>1,s=n<<1;if(this.defaultTextDirection!=Ue.LTR&&!r)return[];let l=[],a=(h,c,d,u)=>{if(c-h<o)return;let f=this.state.selection.main,g=[f.from];f.empty||g.push(f.to);for(let b of g)if(b>h&&b<c){a(h,b-10,d,u),a(b+10,c,d,u);return}let y=gy(e,b=>b.from>=d.from&&b.to<=d.to&&Math.abs(b.from-h)<o&&Math.abs(b.to-c)<o&&!g.some(C=>b.from<C&&b.to>C));if(!y){if(c<d.to&&t&&r&&t.visibleRanges.some(b=>b.from<=c&&b.to>=c)){let b=t.moveToLineBoundary(F.cursor(c),!1,!0).head;b>h&&(c=b)}y=new il(h,c,this.gapSize(d,h,c,u))}l.push(y)};for(let h of this.viewportLines){if(h.length<s)continue;let c=py(h.from,h.to,this.stateDeco);if(c.total<s)continue;let d=this.scrollTarget?this.scrollTarget.range.head:null,u,f;if(r){let g=n/this.heightOracle.lineLength*this.heightOracle.lineHeight,y,b;if(d!=null){let C=wo(c,d),D=((this.visibleBottom-this.visibleTop)/2+g)/h.height;y=C-D,b=C+D}else y=(this.visibleTop-h.top-g)/h.height,b=(this.visibleBottom-h.top+g)/h.height;u=yo(c,y),f=yo(c,b)}else{let g=c.total*this.heightOracle.charWidth,y=n*this.heightOracle.charWidth,b,C;if(d!=null){let D=wo(c,d),T=((this.pixelViewport.right-this.pixelViewport.left)/2+y)/g;b=D-T,C=D+T}else b=(this.pixelViewport.left-y)/g,C=(this.pixelViewport.right+y)/g;u=yo(c,b),f=yo(c,C)}u>h.from&&a(h.from,u,h,c),f<h.to&&a(f,h.to,h,c)}return l}gapSize(e,t,r,n){let o=wo(n,r)-wo(n,t);return this.heightOracle.lineWrapping?e.height*o:n.total*this.heightOracle.charWidth*o}updateLineGaps(e){il.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=ye.set(e.map(t=>t.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];Ee.spans(e,this.viewport.from,this.viewport.to,{span(n,o){t.push({from:n,to:o})},point(){}},20);let r=t.length!=this.visibleRanges.length||this.visibleRanges.some((n,o)=>n.from!=t[o].from||n.to!=t[o].to);return this.visibleRanges=t,r?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||Sn(this.heightMap.lineAt(e,He.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return Sn(this.heightMap.lineAt(this.scaler.fromDOM(e),He.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return Sn(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class bo{constructor(e,t){this.from=e,this.to=t}}function py(i,e,t){let r=[],n=i,o=0;return Ee.spans(t,i,e,{span(){},point(s,l){s>n&&(r.push({from:n,to:s}),o+=s-n),n=l}},20),n<e&&(r.push({from:n,to:e}),o+=e-n),{total:o,ranges:r}}function yo({total:i,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let r=Math.floor(i*t);for(let n=0;;n++){let{from:o,to:s}=e[n],l=s-o;if(r<=l)return o+r;r-=l}}function wo(i,e){let t=0;for(let{from:r,to:n}of i.ranges){if(e<=n){t+=e-r;break}t+=n-r}return t/i.total}function gy(i,e){for(let t of i)if(e(t))return t}const yc={toDOM(i){return i},fromDOM(i){return i},scale:1};class my{constructor(e,t,r){let n=0,o=0,s=0;this.viewports=r.map(({from:l,to:a})=>{let h=t.lineAt(l,He.ByPos,e,0,0).top,c=t.lineAt(a,He.ByPos,e,0,0).bottom;return n+=c-h,{from:l,to:a,top:h,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(t.height-n);for(let l of this.viewports)l.domTop=s+(l.top-o)*this.scale,s=l.domBottom=l.domTop+(l.bottom-l.top),o=l.bottom}toDOM(e){for(let t=0,r=0,n=0;;t++){let o=t<this.viewports.length?this.viewports[t]:null;if(!o||e<o.top)return n+(e-r)*this.scale;if(e<=o.bottom)return o.domTop+(e-o.top);r=o.bottom,n=o.domBottom}}fromDOM(e){for(let t=0,r=0,n=0;;t++){let o=t<this.viewports.length?this.viewports[t]:null;if(!o||e<o.domTop)return r+(e-n)/this.scale;if(e<=o.domBottom)return o.top+(e-o.domTop);r=o.bottom,n=o.domBottom}}}function Sn(i,e){if(e.scale==1)return i;let t=e.toDOM(i.top),r=e.toDOM(i.bottom);return new bi(i.from,i.length,t,r-t,Array.isArray(i._content)?i._content.map(n=>Sn(n,e)):i._content)}const xo=ae.define({combine:i=>i.join(" ")}),Xl=ae.define({combine:i=>i.indexOf(!0)>-1}),Yl=Xr.newName(),Df=Xr.newName(),Of=Xr.newName(),Pf={"&light":"."+Df,"&dark":"."+Of};function Jl(i,e,t){return new Xr(e,{finish(r){return/&/.test(r)?r.replace(/&\w*/,n=>{if(n=="&")return i;if(!t||!t[n])throw new RangeError(`Unsupported selector: ${n}`);return t[n]}):i+" "+r}})}const vy=Jl("."+Yl,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Pf),Cn="￿";class by{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(Me.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=Cn}readRange(e,t){if(!e)return this;let r=e.parentNode;for(let n=e;;){this.findPointBefore(r,n);let o=this.text.length;this.readNode(n);let s=n.nextSibling;if(s==t)break;let l=We.get(n),a=We.get(s);(l&&a?l.breakAfter:(l?l.breakAfter:wc(n))||wc(s)&&(n.nodeName!="BR"||n.cmIgnore)&&this.text.length>o)&&this.lineBreak(),n=s}return this.findPointBefore(r,t),this}readTextNode(e){let t=e.nodeValue;for(let r of this.points)r.node==e&&(r.pos=this.text.length+Math.min(r.offset,t.length));for(let r=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let o=-1,s=1,l;if(this.lineSeparator?(o=t.indexOf(this.lineSeparator,r),s=this.lineSeparator.length):(l=n.exec(t))&&(o=l.index,s=l[0].length),this.append(t.slice(r,o<0?t.length:o)),o<0)break;if(this.lineBreak(),s>1)for(let a of this.points)a.node==e&&a.pos>this.text.length&&(a.pos-=s-1);r=o+s}}readNode(e){if(e.cmIgnore)return;let t=We.get(e),r=t&&t.overrideDOMText;if(r!=null){this.findPointInside(e,r.length);for(let n=r.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let r of this.points)r.node==e&&e.childNodes[r.offset]==t&&(r.pos=this.text.length)}findPointInside(e,t){for(let r of this.points)(e.nodeType==3?r.node==e:e.contains(r.node))&&(r.pos=this.text.length+(yy(e,r.node,r.offset)?t:0))}}function yy(i,e,t){for(;;){if(!e||t<Pi(e))return!1;if(e==i)return!0;t=zn(e)+1,e=e.parentNode}}function wc(i){return i.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(i.nodeName)}class xc{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class wy{constructor(e,t,r,n){this.typeOver=n,this.bounds=null,this.text="";let{impreciseHead:o,impreciseAnchor:s}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,r,0))){let l=o||s?[]:Sy(e),a=new by(l,e.state);a.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=a.text,this.newSel=Cy(l,this.bounds.from)}else{let l=e.observer.selectionRange,a=o&&o.node==l.focusNode&&o.offset==l.focusOffset||!Nl(e.contentDOM,l.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(l.focusNode,l.focusOffset),h=s&&s.node==l.anchorNode&&s.offset==l.anchorOffset||!Nl(e.contentDOM,l.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(l.anchorNode,l.anchorOffset);this.newSel=F.single(h,a)}}}function Lf(i,e){let t,{newSel:r}=e,n=i.state.selection.main,o=i.inputState.lastKeyTime>Date.now()-100?i.inputState.lastKeyCode:-1;if(e.bounds){let{from:s,to:l}=e.bounds,a=n.from,h=null;(o===8||ce.android&&e.text.length<l-s)&&(a=n.to,h="end");let c=ky(i.state.doc.sliceString(s,l,Cn),e.text,a-s,h);c&&(ce.chrome&&o==13&&c.toB==c.from+2&&e.text.slice(c.from,c.toB)==Cn+Cn&&c.toB--,t={from:s+c.from,to:s+c.toA,insert:Pe.of(e.text.slice(c.from,c.toB).split(Cn))})}else r&&(!i.hasFocus&&i.state.facet(As)||r.main.eq(n))&&(r=null);if(!t&&!r)return!1;if(!t&&e.typeOver&&!n.empty&&r&&r.main.empty?t={from:n.from,to:n.to,insert:i.state.doc.slice(n.from,n.to)}:t&&t.from>=n.from&&t.to<=n.to&&(t.from!=n.from||t.to!=n.to)&&n.to-n.from-(t.to-t.from)<=4?t={from:n.from,to:n.to,insert:i.state.doc.slice(n.from,t.from).append(t.insert).append(i.state.doc.slice(t.to,n.to))}:(ce.mac||ce.android)&&t&&t.from==t.to&&t.from==n.head-1&&/^\. ?$/.test(t.insert.toString())&&i.contentDOM.getAttribute("autocorrect")=="off"?(r&&t.insert.length==2&&(r=F.single(r.main.anchor-1,r.main.head-1)),t={from:n.from,to:n.to,insert:Pe.of([" "])}):ce.chrome&&t&&t.from==t.to&&t.from==n.head&&t.insert.toString()==`
 `&&i.lineWrapping&&(r&&(r=F.single(r.main.anchor-1,r.main.head-1)),t={from:n.from,to:n.to,insert:Pe.of([" "])}),t){if(ce.ios&&i.inputState.flushIOSKey()||ce.android&&(t.from==n.from&&t.to==n.to&&t.insert.length==1&&t.insert.lines==2&&Vr(i.contentDOM,"Enter",13)||(t.from==n.from-1&&t.to==n.to&&t.insert.length==0||o==8&&t.insert.length<t.to-t.from&&t.to>n.head)&&Vr(i.contentDOM,"Backspace",8)||t.from==n.from&&t.to==n.to+1&&t.insert.length==0&&Vr(i.contentDOM,"Delete",46)))return!0;let s=t.insert.toString();i.inputState.composing>=0&&i.inputState.composing++;let l,a=()=>l||(l=xy(i,t,r));return i.state.facet(rf).some(h=>h(i,t.from,t.to,s,a))||i.dispatch(a()),!0}else if(r&&!r.main.eq(n)){let s=!1,l="select";return i.inputState.lastSelectionTime>Date.now()-50&&(i.inputState.lastSelectionOrigin=="select"&&(s=!0),l=i.inputState.lastSelectionOrigin),i.dispatch({selection:r,scrollIntoView:s,userEvent:l}),!0}else return!1}function xy(i,e,t){let r,n=i.state,o=n.selection.main;if(e.from>=o.from&&e.to<=o.to&&e.to-e.from>=(o.to-o.from)/3&&(!t||t.main.empty&&t.main.from==e.from+e.insert.length)&&i.inputState.composing<0){let l=o.from<e.from?n.sliceDoc(o.from,e.from):"",a=o.to>e.to?n.sliceDoc(e.to,o.to):"";r=n.replaceSelection(i.state.toText(l+e.insert.sliceString(0,void 0,i.state.lineBreak)+a))}else{let l=n.changes(e),a=t&&t.main.to<=l.newLength?t.main:void 0;if(n.selection.ranges.length>1&&i.inputState.composing>=0&&e.to<=o.to&&e.to>=o.to-10){let h=i.state.sliceDoc(e.from,e.to),c,d=t&&mf(i,t.main.head);if(d){let g=e.insert.length-(e.to-e.from);c={from:d.from,to:d.to-g}}else c=i.state.doc.lineAt(o.head);let u=o.to-e.to,f=o.to-o.from;r=n.changeByRange(g=>{if(g.from==o.from&&g.to==o.to)return{changes:l,range:a||g.map(l)};let y=g.to-u,b=y-h.length;if(g.to-g.from!=f||i.state.sliceDoc(b,y)!=h||g.to>=c.from&&g.from<=c.to)return{range:g};let C=n.changes({from:b,to:y,insert:e.insert}),D=g.to-o.to;return{changes:C,range:a?F.range(Math.max(0,a.anchor+D),Math.max(0,a.head+D)):g.map(C)}})}else r={changes:l,selection:a&&n.selection.replaceRange(a)}}let s="input.type";return(i.composing||i.inputState.compositionPendingChange&&i.inputState.compositionEndedAt>Date.now()-50)&&(i.inputState.compositionPendingChange=!1,s+=".compose",i.inputState.compositionFirstChange&&(s+=".start",i.inputState.compositionFirstChange=!1)),n.update(r,{userEvent:s,scrollIntoView:!0})}function ky(i,e,t,r){let n=Math.min(i.length,e.length),o=0;for(;o<n&&i.charCodeAt(o)==e.charCodeAt(o);)o++;if(o==n&&i.length==e.length)return null;let s=i.length,l=e.length;for(;s>0&&l>0&&i.charCodeAt(s-1)==e.charCodeAt(l-1);)s--,l--;if(r=="end"){let a=Math.max(0,o-Math.min(s,l));t-=s+a-o}if(s<o&&i.length<e.length){let a=t<=o&&t>=s?o-t:0;o-=a,l=o+(l-s),s=o}else if(l<o){let a=t<=o&&t>=l?o-t:0;o-=a,s=o+(s-l),l=o}return{from:o,toA:s,toB:l}}function Sy(i){let e=[];if(i.root.activeElement!=i.contentDOM)return e;let{anchorNode:t,anchorOffset:r,focusNode:n,focusOffset:o}=i.observer.selectionRange;return t&&(e.push(new xc(t,r)),(n!=t||o!=r)&&e.push(new xc(n,o))),e}function Cy(i,e){if(i.length==0)return null;let t=i[0].pos,r=i.length==2?i[1].pos:t;return t>-1&&r>-1?F.single(t+e,r+e):null}const Ay={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},rl=ce.ie&&ce.ie_version<=11;class My{constructor(e){this.view=e,this.active=!1,this.selectionRange=new hb,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.resizeContent=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let r of t)this.queue.push(r);(ce.ie&&ce.ie_version<=11||ce.ios&&e.composing)&&t.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),rl&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM),this.resizeContent=new ResizeObserver(()=>this.view.requestMeasure()),this.resizeContent.observe(e.contentDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,r)=>t!=e[r]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:r}=this,n=this.selectionRange;if(r.state.facet(As)?r.root.activeElement!=this.dom:!zo(r.dom,n))return;let o=n.anchorNode&&r.docView.nearest(n.anchorNode);if(o&&o.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(ce.ie&&ce.ie_version<=11||ce.android&&ce.chrome)&&!r.state.selection.main.empty&&n.focusNode&&Qo(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=ce.safari&&e.root.nodeType==11&&ob(this.dom.ownerDocument)==this.dom&&Ry(this.view)||Zo(e.root);if(!t||this.selectionRange.eq(t))return!1;let r=zo(this.dom,t);return r&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&db(this.dom,t)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(t),r&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let r=this.dom;r;)if(r.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==r?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(r),r=r.assignedSlot||r.parentNode;else if(r.nodeType==11)r=r.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);for(let r of this.scrollTargets=t)r.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Ay),rl&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),rl&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var r;if(!this.delayedAndroidKey){let n=()=>{let o=this.delayedAndroidKey;o&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=o.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&o.force&&Vr(this.dom,o.key,o.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(n)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((r=this.delayedAndroidKey)===null||r===void 0)&&r.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,r=-1,n=!1;for(let o of e){let s=this.readMutation(o);s&&(s.typeOver&&(n=!0),t==-1?{from:t,to:r}=s:(t=Math.min(s.from,t),r=Math.max(s.to,r)))}return{from:t,to:r,typeOver:n}}readChange(){let{from:e,to:t,typeOver:r}=this.processRecords(),n=this.selectionChanged&&zo(this.dom,this.selectionRange);if(e<0&&!n)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let o=new wy(this.view,e,t,r);return this.view.docView.domChanged={newSel:o.newSel?o.newSel.main:null},o}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return!1;let r=this.view.state,n=Lf(this.view,t);return this.view.state==r&&this.view.update([]),n}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.flags|=4),e.type=="childList"){let r=kc(t,e.previousSibling||e.target.previousSibling,-1),n=kc(t,e.nextSibling||e.target.nextSibling,1);return{from:r?t.posAfter(r):t.posAtStart,to:n?t.posBefore(n):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var e,t,r,n;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(r=this.resizeScroll)===null||r===void 0||r.disconnect(),(n=this.resizeContent)===null||n===void 0||n.disconnect();for(let o of this.scrollTargets)o.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey)}}function kc(i,e,t){for(;e;){let r=We.get(e);if(r&&r.parent==i)return r;let n=e.parentNode;e=n!=i.dom?n:t>0?e.nextSibling:e.previousSibling}return null}function Ry(i){let e=null;function t(a){a.preventDefault(),a.stopImmediatePropagation(),e=a.getTargetRanges()[0]}if(i.contentDOM.addEventListener("beforeinput",t,!0),i.dom.ownerDocument.execCommand("indent"),i.contentDOM.removeEventListener("beforeinput",t,!0),!e)return null;let r=e.startContainer,n=e.startOffset,o=e.endContainer,s=e.endOffset,l=i.docView.domAtPos(i.state.selection.main.anchor);return Qo(l.node,l.offset,o,s)&&([r,n,o,s]=[o,s,r,n]),{anchorNode:r,anchorOffset:n,focusNode:o,focusOffset:s}}class oe{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: fixed; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM);let{dispatch:t}=e;this.dispatchTransactions=e.dispatchTransactions||t&&(r=>r.forEach(n=>t(n,this)))||(r=>this.update(r)),this.dispatch=this.dispatch.bind(this),this._root=e.root||cb(e.parent)||document,this.viewState=new bc(e.state||Me.create(e)),this.plugins=this.state.facet(xn).map(r=>new Qs(r));for(let r of this.plugins)r.update(this);this.observer=new My(this),this.inputState=new Vb(this),this.inputState.ensureHandlers(this.plugins),this.docView=new ec(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}dispatch(...e){let t=e.length==1&&e[0]instanceof rt?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,r=!1,n,o=this.state;for(let u of e){if(u.startState!=o)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");o=u.state}if(this.destroyed){this.viewState.state=o;return}let s=this.hasFocus,l=0,a=null;e.some(u=>u.annotation(Af))?(this.inputState.notifiedFocused=s,l=1):s!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=s,a=Mf(o,s),a||(l=1));let h=this.observer.delayedAndroidKey,c=null;if(h?(this.observer.clearDelayedAndroidKey(),c=this.observer.readChange(),(c&&!this.state.doc.eq(o.doc)||!this.state.selection.eq(o.selection))&&(c=null)):this.observer.clear(),o.facet(Me.phrases)!=this.state.facet(Me.phrases))return this.setState(o);n=ts.create(this,o,e),n.flags|=l;let d=this.viewState.scrollTarget;try{this.updateState=2;for(let u of e){if(d&&(d=d.map(u.changes)),u.scrollIntoView){let{main:f}=u.state.selection;d=new es(f.empty?f:F.cursor(f.head,f.head>f.anchor?-1:1))}for(let f of u.effects)f.is(Zh)&&(d=f.value)}this.viewState.update(n,d),this.bidiCache=is.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),t=this.docView.update(n),this.state.facet(kn)!=this.styleModules&&this.mountStyles(),r=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(u=>u.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(xo)!=n.state.facet(xo)&&(this.viewState.mustMeasureContent=!0),(t||r||d||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!n.empty)for(let u of this.state.facet(Vl))u(n);(a||c)&&Promise.resolve().then(()=>{a&&this.state==a.startState&&this.dispatch(a),c&&!Lf(this,c)&&h.force&&Vr(this.contentDOM,h.key,h.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let r of this.plugins)r.destroy(this);this.viewState=new bc(e),this.plugins=e.facet(xn).map(r=>new Qs(r)),this.pluginMap.clear();for(let r of this.plugins)r.update(this);this.docView=new ec(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(xn),r=e.state.facet(xn);if(t!=r){let n=[];for(let o of r){let s=t.indexOf(o);if(s<0)n.push(new Qs(o));else{let l=this.plugins[s];l.mustUpdate=e,n.push(l)}}for(let o of this.plugins)o.mustUpdate!=e&&o.destroy(this);this.plugins=n,this.pluginMap.clear()}else for(let n of this.plugins)n.mustUpdate=e;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this);t!=r&&this.inputState.ensureHandlers(this.plugins)}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,r=this.scrollDOM,n=r.scrollTop*this.scaleY,{scrollAnchorPos:o,scrollAnchorHeight:s}=this.viewState;Math.abs(n-this.viewState.scrollTop)>1&&(s=-1),this.viewState.scrollAnchorHeight=-1;try{for(let l=0;;l++){if(s<0)if(Vu(r))o=-1,s=this.viewState.heightMap.height;else{let f=this.viewState.scrollAnchorAt(n);o=f.from,s=f.top}this.updateState=1;let a=this.viewState.measure(this);if(!a&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(l>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let h=[];a&4||([this.measureRequests,h]=[h,this.measureRequests]);let c=h.map(f=>{try{return f.read(this)}catch(g){return ni(this.state,g),Sc}}),d=ts.create(this,this.state,[]),u=!1;d.flags|=a,t?t.flags|=a:t=d,this.updateState=2,d.empty||(this.updatePlugins(d),this.inputState.update(d),this.updateAttrs(),u=this.docView.update(d));for(let f=0;f<h.length;f++)if(c[f]!=Sc)try{let g=h[f];g.write&&g.write(c[f],this)}catch(g){ni(this.state,g)}if(u&&this.docView.updateSelection(!0),!d.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null;continue}else{let f=(o<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(o).top)-s;if(f>1||f<-1){n=n+f,r.scrollTop=n/this.scaleY,s=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let l of this.state.facet(Vl))l(t)}get themeClasses(){return Yl+" "+(this.state.facet(Xl)?Of:Df)+" "+this.state.facet(xo)}updateAttrs(){let e=Cc(this,lf,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(As)?"true":"false",class:"cm-content",style:`${ce.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),Cc(this,Pa,t);let r=this.observer.ignore(()=>{let n=Hl(this.contentDOM,this.contentAttrs,t),o=Hl(this.dom,this.editorAttrs,e);return n||o});return this.editorAttrs=e,this.contentAttrs=t,r}showAnnouncements(e){let t=!0;for(let r of e)for(let n of r.effects)if(n.is(oe.announce)){t&&(this.announceDOM.textContent=""),t=!1;let o=this.announceDOM.appendChild(document.createElement("div"));o.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(kn);let e=this.state.facet(oe.cspNonce);Xr.mount(this.root,this.styleModules.concat(vy).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(r=>r.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,r){return tl(this,e,sc(this,e,t,r))}moveByGroup(e,t){return tl(this,e,sc(this,e,t,r=>Hb(this,e.head,r)))}moveToLineBoundary(e,t,r=!0){return $b(this,e,t,r)}moveVertically(e,t,r){return tl(this,e,Wb(this,e,t,r))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),bf(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let r=this.docView.coordsAt(e,t);if(!r||r.left==r.right)return r;let n=this.state.doc.lineAt(e),o=this.bidiSpans(n),s=o[Xi.find(o,e-n.from,-1,t)];return Ta(r,s.dir==Ue.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(of)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>Ty)return pf(e.length);let t=this.textDirectionAt(e.from),r;for(let o of this.bidiCache)if(o.from==e.from&&o.dir==t&&(o.fresh||ff(o.isolates,r=Qh(this,e.from,e.to))))return o.order;r||(r=Qh(this,e.from,e.to));let n=Ab(e.text,t,r);return this.bidiCache.push(new is(e.from,e.to,t,r,!0,n)),n}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||ce.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{Hu(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Zh.of(new es(typeof e=="number"?F.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}static domEventHandlers(e){return Qe.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return Qe.define(()=>({}),{eventObservers:e})}static theme(e,t){let r=Xr.newName(),n=[xo.of(r),kn.of(Jl(`.${r}`,e))];return t&&t.dark&&n.push(Xl.of(!0)),n}static baseTheme(e){return on.lowest(kn.of(Jl("."+Yl,e,Pf)))}static findFromDOM(e){var t;let r=e.querySelector(".cm-content"),n=r&&We.get(r)||We.get(e);return((t=n==null?void 0:n.rootView)===null||t===void 0?void 0:t.view)||null}}oe.styleModule=kn;oe.inputHandler=rf;oe.focusChangeEffect=nf;oe.perLineTextDirection=of;oe.exceptionSink=tf;oe.updateListener=Vl;oe.editable=As;oe.mouseSelectionStyle=ef;oe.dragMovesSelection=Qu;oe.clickAddsSelectionRange=Zu;oe.decorations=Fn;oe.atomicRanges=La;oe.bidiIsolatedRanges=af;oe.scrollMargins=hf;oe.darkTheme=Xl;oe.cspNonce=ae.define({combine:i=>i.length?i[0]:""});oe.contentAttributes=Pa;oe.editorAttributes=lf;oe.lineWrapping=oe.contentAttributes.of({class:"cm-lineWrapping"});oe.announce=xe.define();const Ty=4096,Sc={};class is{constructor(e,t,r,n,o,s){this.from=e,this.to=t,this.dir=r,this.isolates=n,this.fresh=o,this.order=s}static update(e,t){if(t.empty&&!e.some(o=>o.fresh))return e;let r=[],n=e.length?e[e.length-1].dir:Ue.LTR;for(let o=Math.max(0,e.length-10);o<e.length;o++){let s=e[o];s.dir==n&&!t.touchesRange(s.from,s.to)&&r.push(new is(t.mapPos(s.from,1),t.mapPos(s.to,-1),s.dir,s.isolates,!1,s.order))}return r}}function Cc(i,e,t){for(let r=i.state.facet(e),n=r.length-1;n>=0;n--){let o=r[n],s=typeof o=="function"?o(i):o;s&&$l(s,t)}return t}const Dy=ce.mac?"mac":ce.windows?"win":ce.linux?"linux":"key";function Oy(i,e){const t=i.split(/-(?!$)/);let r=t[t.length-1];r=="Space"&&(r=" ");let n,o,s,l;for(let a=0;a<t.length-1;++a){const h=t[a];if(/^(cmd|meta|m)$/i.test(h))l=!0;else if(/^a(lt)?$/i.test(h))n=!0;else if(/^(c|ctrl|control)$/i.test(h))o=!0;else if(/^s(hift)?$/i.test(h))s=!0;else if(/^mod$/i.test(h))e=="mac"?l=!0:o=!0;else throw new Error("Unrecognized modifier name: "+h)}return n&&(r="Alt-"+r),o&&(r="Ctrl-"+r),l&&(r="Meta-"+r),s&&(r="Shift-"+r),r}function ko(i,e,t){return e.altKey&&(i="Alt-"+i),e.ctrlKey&&(i="Ctrl-"+i),e.metaKey&&(i="Meta-"+i),t!==!1&&e.shiftKey&&(i="Shift-"+i),i}const Py=on.default(oe.domEventHandlers({keydown(i,e){return Bf(Ef(e.state),i,e,"editor")}})),Ms=ae.define({enables:Py}),Ac=new WeakMap;function Ef(i){let e=i.facet(Ms),t=Ac.get(e);return t||Ac.set(e,t=By(e.reduce((r,n)=>r.concat(n),[]))),t}function Ly(i,e,t){return Bf(Ef(i.state),e,i,t)}let _i=null;const Ey=4e3;function By(i,e=Dy){let t=Object.create(null),r=Object.create(null),n=(s,l)=>{let a=r[s];if(a==null)r[s]=l;else if(a!=l)throw new Error("Key binding "+s+" is used both as a regular binding and as a multi-stroke prefix")},o=(s,l,a,h,c)=>{var d,u;let f=t[s]||(t[s]=Object.create(null)),g=l.split(/ (?!$)/).map(C=>Oy(C,e));for(let C=1;C<g.length;C++){let D=g.slice(0,C).join(" ");n(D,!0),f[D]||(f[D]={preventDefault:!0,stopPropagation:!1,run:[T=>{let A=_i={view:T,prefix:D,scope:s};return setTimeout(()=>{_i==A&&(_i=null)},Ey),!0}]})}let y=g.join(" ");n(y,!1);let b=f[y]||(f[y]={preventDefault:!1,stopPropagation:!1,run:((u=(d=f._any)===null||d===void 0?void 0:d.run)===null||u===void 0?void 0:u.slice())||[]});a&&b.run.push(a),h&&(b.preventDefault=!0),c&&(b.stopPropagation=!0)};for(let s of i){let l=s.scope?s.scope.split(" "):["editor"];if(s.any)for(let h of l){let c=t[h]||(t[h]=Object.create(null));c._any||(c._any={preventDefault:!1,stopPropagation:!1,run:[]});for(let d in c)c[d].run.push(s.any)}let a=s[e]||s.key;if(a)for(let h of l)o(h,a,s.run,s.preventDefault,s.stopPropagation),s.shift&&o(h,"Shift-"+a,s.shift,s.preventDefault,s.stopPropagation)}return t}function Bf(i,e,t,r){let n=nb(e),o=lt(n,0),s=Gt(o)==n.length&&n!=" ",l="",a=!1,h=!1,c=!1;_i&&_i.view==t&&_i.scope==r&&(l=_i.prefix+" ",wf.indexOf(e.keyCode)<0&&(h=!0,_i=null));let d=new Set,u=b=>{if(b){for(let C of b.run)if(!d.has(C)&&(d.add(C),C(t,e)))return b.stopPropagation&&(c=!0),!0;b.preventDefault&&(b.stopPropagation&&(c=!0),h=!0)}return!1},f=i[r],g,y;return f&&(u(f[l+ko(n,e,!s)])?a=!0:s&&(e.altKey||e.metaKey||e.ctrlKey)&&!(ce.windows&&e.ctrlKey&&e.altKey)&&(g=er[e.keyCode])&&g!=n?(u(f[l+ko(g,e,!0)])||e.shiftKey&&(y=Nn[e.keyCode])!=n&&y!=g&&u(f[l+ko(y,e,!1)]))&&(a=!0):s&&e.shiftKey&&u(f[l+ko(n,e,!0)])&&(a=!0),!a&&u(f._any)&&(a=!0)),h&&(a=!0),a&&c&&e.stopPropagation(),a}class ro{constructor(e,t,r,n,o){this.className=e,this.left=t,this.top=r,this.width=n,this.height=o}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,t){return t.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,t,r){if(r.empty){let n=e.coordsAtPos(r.head,r.assoc||1);if(!n)return[];let o=Nf(e);return[new ro(t,n.left-o.left,n.top-o.top,null,n.bottom-n.top)]}else return Ny(e,t,r)}}function Nf(i){let e=i.scrollDOM.getBoundingClientRect();return{left:(i.textDirection==Ue.LTR?e.left:e.right-i.scrollDOM.clientWidth*i.scaleX)-i.scrollDOM.scrollLeft*i.scaleX,top:e.top-i.scrollDOM.scrollTop*i.scaleY}}function Mc(i,e,t){let r=F.cursor(e);return{from:Math.max(t.from,i.moveToLineBoundary(r,!1,!0).from),to:Math.min(t.to,i.moveToLineBoundary(r,!0,!0).from),type:At.Text}}function Ny(i,e,t){if(t.to<=i.viewport.from||t.from>=i.viewport.to)return[];let r=Math.max(t.from,i.viewport.from),n=Math.min(t.to,i.viewport.to),o=i.textDirection==Ue.LTR,s=i.contentDOM,l=s.getBoundingClientRect(),a=Nf(i),h=s.querySelector(".cm-line"),c=h&&window.getComputedStyle(h),d=l.left+(c?parseInt(c.paddingLeft)+Math.min(0,parseInt(c.textIndent)):0),u=l.right-(c?parseInt(c.paddingRight):0),f=ql(i,r),g=ql(i,n),y=f.type==At.Text?f:null,b=g.type==At.Text?g:null;if(y&&(i.lineWrapping||f.widgetLineBreaks)&&(y=Mc(i,r,y)),b&&(i.lineWrapping||g.widgetLineBreaks)&&(b=Mc(i,n,b)),y&&b&&y.from==b.from)return D(T(t.from,t.to,y));{let S=y?T(t.from,null,y):A(f,!1),k=b?T(null,t.to,b):A(g,!0),v=[];return(y||f).to<(b||g).from-(y&&b?1:0)||f.widgetLineBreaks>1&&S.bottom+i.defaultLineHeight/2<k.top?v.push(C(d,S.bottom,u,k.top)):S.bottom<k.top&&i.elementAtHeight((S.bottom+k.top)/2).type==At.Text&&(S.bottom=k.top=(S.bottom+k.top)/2),D(S).concat(v).concat(D(k))}function C(S,k,v,R){return new ro(e,S-a.left,k-a.top-.01,v-S,R-k+.01)}function D({top:S,bottom:k,horizontal:v}){let R=[];for(let m=0;m<v.length;m+=2)R.push(C(v[m],S,v[m+1],k));return R}function T(S,k,v){let R=1e9,m=-1e9,N=[];function V(re,te,$,ne,X){let Z=i.coordsAtPos(re,re==v.to?-2:2),P=i.coordsAtPos($,$==v.from?2:-2);!Z||!P||(R=Math.min(Z.top,P.top,R),m=Math.max(Z.bottom,P.bottom,m),X==Ue.LTR?N.push(o&&te?d:Z.left,o&&ne?u:P.right):N.push(!o&&ne?d:P.left,!o&&te?u:Z.right))}let J=S??v.from,U=k??v.to;for(let re of i.visibleRanges)if(re.to>J&&re.from<U)for(let te=Math.max(re.from,J),$=Math.min(re.to,U);;){let ne=i.state.doc.lineAt(te);for(let X of i.bidiSpans(ne)){let Z=X.from+ne.from,P=X.to+ne.from;if(Z>=$)break;P>te&&V(Math.max(Z,te),S==null&&Z<=J,Math.min(P,$),k==null&&P>=U,X.dir)}if(te=ne.to+1,te>=$)break}return N.length==0&&V(J,S==null,U,k==null,i.textDirection),{top:R,bottom:m,horizontal:N}}function A(S,k){let v=l.top+(k?S.top:S.bottom);return{top:v,bottom:v,horizontal:[]}}}function Iy(i,e){return i.constructor==e.constructor&&i.eq(e)}class zy{constructor(e,t){this.view=e,this.layer=t,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),t.above&&this.dom.classList.add("cm-layer-above"),t.class&&this.dom.classList.add(t.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),t.mount&&t.mount(this.dom,e)}update(e){e.startState.facet(Ho)!=e.state.facet(Ho)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}setOrder(e){let t=0,r=e.facet(Ho);for(;t<r.length&&r[t]!=this.layer;)t++;this.dom.style.zIndex=String((this.layer.above?150:-1)-t)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:t}=this.view;(e!=this.scaleX||t!=this.scaleY)&&(this.scaleX=e,this.scaleY=t,this.dom.style.transform=`scale(${1/e}, ${1/t})`)}draw(e){if(e.length!=this.drawn.length||e.some((t,r)=>!Iy(t,this.drawn[r]))){let t=this.dom.firstChild,r=0;for(let n of e)n.update&&t&&n.constructor&&this.drawn[r].constructor&&n.update(t,this.drawn[r])?(t=t.nextSibling,r++):this.dom.insertBefore(n.draw(),t);for(;t;){let n=t.nextSibling;t.remove(),t=n}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const Ho=ae.define();function If(i){return[Qe.define(e=>new zy(e,i)),Ho.of(i)]}const zf=!ce.ios,Hn=ae.define({combine(i){return Ci(i,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})}});function Fy(i={}){return[Hn.of(i),$y,Hy,Wy,sf.of(!0)]}function Ff(i){return i.startState.facet(Hn)!=i.state.facet(Hn)}const $y=If({above:!0,markers(i){let{state:e}=i,t=e.facet(Hn),r=[];for(let n of e.selection.ranges){let o=n==e.selection.main;if(n.empty?!o||zf:t.drawRangeCursor){let s=o?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",l=n.empty?n:F.cursor(n.head,n.head>n.anchor?-1:1);for(let a of ro.forRange(i,s,l))r.push(a)}}return r},update(i,e){i.transactions.some(r=>r.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let t=Ff(i);return t&&Rc(i.state,e),i.docChanged||i.selectionSet||t},mount(i,e){Rc(e.state,i)},class:"cm-cursorLayer"});function Rc(i,e){e.style.animationDuration=i.facet(Hn).cursorBlinkRate+"ms"}const Hy=If({above:!1,markers(i){return i.state.selection.ranges.map(e=>e.empty?[]:ro.forRange(i,"cm-selectionBackground",e)).reduce((e,t)=>e.concat(t))},update(i,e){return i.docChanged||i.selectionSet||i.viewportChanged||Ff(i)},class:"cm-selectionLayer"}),$f={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};zf&&($f[".cm-line"].caretColor="transparent !important");const Wy=on.highest(oe.theme($f)),Hf=xe.define({map(i,e){return i==null?null:e.mapPos(i)}}),An=dt.define({create(){return null},update(i,e){return i!=null&&(i=e.changes.mapPos(i)),e.effects.reduce((t,r)=>r.is(Hf)?r.value:t,i)}}),Vy=Qe.fromClass(class{constructor(i){this.view=i,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(i){var e;let t=i.state.field(An);t==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(i.startState.field(An)!=t||i.docChanged||i.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:i}=this,e=i.state.field(An),t=e!=null&&i.coordsAtPos(e);if(!t)return null;let r=i.scrollDOM.getBoundingClientRect();return{left:t.left-r.left+i.scrollDOM.scrollLeft*i.scaleX,top:t.top-r.top+i.scrollDOM.scrollTop*i.scaleY,height:t.bottom-t.top}}drawCursor(i){if(this.cursor){let{scaleX:e,scaleY:t}=this.view;i?(this.cursor.style.left=i.left/e+"px",this.cursor.style.top=i.top/t+"px",this.cursor.style.height=i.height/t+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(i){this.view.state.field(An)!=i&&this.view.dispatch({effects:Hf.of(i)})}},{eventObservers:{dragover(i){this.setDropPos(this.view.posAtCoords({x:i.clientX,y:i.clientY}))},dragleave(i){(i.target==this.view.contentDOM||!this.view.contentDOM.contains(i.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function jy(){return[An,Vy]}function Tc(i,e,t,r,n){e.lastIndex=0;for(let o=i.iterRange(t,r),s=t,l;!o.next().done;s+=o.value.length)if(!o.lineBreak)for(;l=e.exec(o.value);)n(s+l.index,l)}function Uy(i,e){let t=i.visibleRanges;if(t.length==1&&t[0].from==i.viewport.from&&t[0].to==i.viewport.to)return t;let r=[];for(let{from:n,to:o}of t)n=Math.max(i.state.doc.lineAt(n).from,n-e),o=Math.min(i.state.doc.lineAt(o).to,o+e),r.length&&r[r.length-1].to>=n?r[r.length-1].to=o:r.push({from:n,to:o});return r}class _y{constructor(e){const{regexp:t,decoration:r,decorate:n,boundary:o,maxLength:s=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=t,n)this.addMatch=(l,a,h,c)=>n(c,h,h+l[0].length,l,a);else if(typeof r=="function")this.addMatch=(l,a,h,c)=>{let d=r(l,a,h);d&&c(h,h+l[0].length,d)};else if(r)this.addMatch=(l,a,h,c)=>c(h,h+l[0].length,r);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=o,this.maxLength=s}createDeco(e){let t=new Qi,r=t.add.bind(t);for(let{from:n,to:o}of Uy(e,this.maxLength))Tc(e.state.doc,this.regexp,n,o,(s,l)=>this.addMatch(l,e,s,r));return t.finish()}updateDeco(e,t){let r=1e9,n=-1;return e.docChanged&&e.changes.iterChanges((o,s,l,a)=>{a>e.view.viewport.from&&l<e.view.viewport.to&&(r=Math.min(l,r),n=Math.max(a,n))}),e.viewportChanged||n-r>1e3?this.createDeco(e.view):n>-1?this.updateRange(e.view,t.map(e.changes),r,n):t}updateRange(e,t,r,n){for(let o of e.visibleRanges){let s=Math.max(o.from,r),l=Math.min(o.to,n);if(l>s){let a=e.state.doc.lineAt(s),h=a.to<l?e.state.doc.lineAt(l):a,c=Math.max(o.from,a.from),d=Math.min(o.to,h.to);if(this.boundary){for(;s>a.from;s--)if(this.boundary.test(a.text[s-1-a.from])){c=s;break}for(;l<h.to;l++)if(this.boundary.test(h.text[l-h.from])){d=l;break}}let u=[],f,g=(y,b,C)=>u.push(C.range(y,b));if(a==h)for(this.regexp.lastIndex=c-a.from;(f=this.regexp.exec(a.text))&&f.index<d-a.from;)this.addMatch(f,e,f.index+a.from,g);else Tc(e.state.doc,this.regexp,c,d,(y,b)=>this.addMatch(b,e,y,g));t=t.update({filterFrom:c,filterTo:d,filter:(y,b)=>y<c||b>d,add:u})}}return t}}const Zl=/x/.unicode!=null?"gu":"g",Ky=new RegExp(`[\0-\b
--­؜​‎‏\u2028\u2029‭‮⁦⁧⁩\uFEFF￹-￼]`,Zl),qy={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let nl=null;function Gy(){var i;if(nl==null&&typeof document<"u"&&document.body){let e=document.body.style;nl=((i=e.tabSize)!==null&&i!==void 0?i:e.MozTabSize)!=null}return nl||!1}const Wo=ae.define({combine(i){let e=Ci(i,{render:null,specialChars:Ky,addSpecialChars:null});return(e.replaceTabs=!Gy())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,Zl)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,Zl)),e}});function Xy(i={}){return[Wo.of(i),Yy()]}let Dc=null;function Yy(){return Dc||(Dc=Qe.fromClass(class{constructor(i){this.view=i,this.decorations=ye.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(i.state.facet(Wo)),this.decorations=this.decorator.createDeco(i)}makeDecorator(i){return new _y({regexp:i.specialChars,decoration:(e,t,r)=>{let{doc:n}=t.state,o=lt(e[0],0);if(o==9){let s=n.lineAt(r),l=t.state.tabSize,a=eo(s.text,l,r-s.from);return ye.replace({widget:new ew((l-a%l)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[o]||(this.decorationCache[o]=ye.replace({widget:new Qy(i,o)}))},boundary:i.replaceTabs?void 0:/[^]/})}update(i){let e=i.state.facet(Wo);i.startState.facet(Wo)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(i.view)):this.decorations=this.decorator.updateDeco(i,this.decorations)}},{decorations:i=>i.decorations}))}const Jy="•";function Zy(i){return i>=32?Jy:i==10?"␤":String.fromCharCode(9216+i)}class Qy extends nr{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=Zy(this.code),r=e.state.phrase("Control character")+" "+(qy[this.code]||"0x"+this.code.toString(16)),n=this.options.render&&this.options.render(this.code,r,t);if(n)return n;let o=document.createElement("span");return o.textContent=t,o.title=r,o.setAttribute("aria-label",r),o.className="cm-specialChar",o}ignoreEvent(){return!1}}class ew extends nr{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}function tw(){return rw}const iw=ye.line({class:"cm-activeLine"}),rw=Qe.fromClass(class{constructor(i){this.decorations=this.getDeco(i)}update(i){(i.docChanged||i.selectionSet)&&(this.decorations=this.getDeco(i.view))}getDeco(i){let e=-1,t=[];for(let r of i.state.selection.ranges){let n=i.lineBlockAt(r.head);n.from>e&&(t.push(iw.range(n.from)),e=n.from)}return ye.set(t)}},{decorations:i=>i.decorations}),Ql=2e3;function nw(i,e,t){let r=Math.min(e.line,t.line),n=Math.max(e.line,t.line),o=[];if(e.off>Ql||t.off>Ql||e.col<0||t.col<0){let s=Math.min(e.off,t.off),l=Math.max(e.off,t.off);for(let a=r;a<=n;a++){let h=i.doc.line(a);h.length<=l&&o.push(F.range(h.from+s,h.to+l))}}else{let s=Math.min(e.col,t.col),l=Math.max(e.col,t.col);for(let a=r;a<=n;a++){let h=i.doc.line(a),c=Ll(h.text,s,i.tabSize,!0);if(c<0)o.push(F.cursor(h.to));else{let d=Ll(h.text,l,i.tabSize);o.push(F.range(h.from+c,h.from+d))}}}return o}function ow(i,e){let t=i.coordsAtPos(i.viewport.from);return t?Math.round(Math.abs((t.left-e)/i.defaultCharacterWidth)):-1}function Oc(i,e){let t=i.posAtCoords({x:e.clientX,y:e.clientY},!1),r=i.state.doc.lineAt(t),n=t-r.from,o=n>Ql?-1:n==r.length?ow(i,e.clientX):eo(r.text,i.state.tabSize,t-r.from);return{line:r.number,col:o,off:n}}function sw(i,e){let t=Oc(i,e),r=i.state.selection;return t?{update(n){if(n.docChanged){let o=n.changes.mapPos(n.startState.doc.line(t.line).from),s=n.state.doc.lineAt(o);t={line:s.number,col:t.col,off:Math.min(t.off,s.length)},r=r.map(n.changes)}},get(n,o,s){let l=Oc(i,n);if(!l)return r;let a=nw(i.state,t,l);return a.length?s?F.create(a.concat(r.ranges)):F.create(a):r}}:null}function lw(i){let e=(i==null?void 0:i.eventFilter)||(t=>t.altKey&&t.button==0);return oe.mouseSelectionStyle.of((t,r)=>e(r)?sw(t,r):null)}const aw={Alt:[18,i=>!!i.altKey],Control:[17,i=>!!i.ctrlKey],Shift:[16,i=>!!i.shiftKey],Meta:[91,i=>!!i.metaKey]},hw={style:"cursor: crosshair"};function cw(i={}){let[e,t]=aw[i.key||"Alt"],r=Qe.fromClass(class{constructor(n){this.view=n,this.isDown=!1}set(n){this.isDown!=n&&(this.isDown=n,this.view.update([]))}},{eventObservers:{keydown(n){this.set(n.keyCode==e||t(n))},keyup(n){(n.keyCode==e||!t(n))&&this.set(!1)},mousemove(n){this.set(t(n))}}});return[r,oe.contentAttributes.of(n=>{var o;return!((o=n.plugin(r))===null||o===void 0)&&o.isDown?hw:null})]}const So="-10000px";class Wf{constructor(e,t,r){this.facet=t,this.createTooltipView=r,this.input=e.state.facet(t),this.tooltips=this.input.filter(n=>n),this.tooltipViews=this.tooltips.map(r)}update(e){var t;let r=e.state.facet(this.facet),n=r.filter(s=>s);if(r===this.input){for(let s of this.tooltipViews)s.update&&s.update(e);return!1}let o=[];for(let s=0;s<n.length;s++){let l=n[s],a=-1;if(l){for(let h=0;h<this.tooltips.length;h++){let c=this.tooltips[h];c&&c.create==l.create&&(a=h)}if(a<0)o[s]=this.createTooltipView(l);else{let h=o[s]=this.tooltipViews[a];h.update&&h.update(e)}}}for(let s of this.tooltipViews)o.indexOf(s)<0&&(s.dom.remove(),(t=s.destroy)===null||t===void 0||t.call(s));return this.input=r,this.tooltips=n,this.tooltipViews=o,!0}}function dw(i){let{win:e}=i;return{top:0,left:0,bottom:e.innerHeight,right:e.innerWidth}}const ol=ae.define({combine:i=>{var e,t,r;return{position:ce.ios?"absolute":((e=i.find(n=>n.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((t=i.find(n=>n.parent))===null||t===void 0?void 0:t.parent)||null,tooltipSpace:((r=i.find(n=>n.tooltipSpace))===null||r===void 0?void 0:r.tooltipSpace)||dw}}}),Pc=new WeakMap,Vf=Qe.fromClass(class{constructor(i){this.view=i,this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=i.state.facet(ol);this.position=e.position,this.parent=e.parent,this.classes=i.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new Wf(i,Ba,t=>this.createTooltip(t)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(t=>{Date.now()>this.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),i.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let i of this.manager.tooltipViews)this.intersectionObserver.observe(i.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(i){i.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(i);e&&this.observeIntersection();let t=e||i.geometryChanged,r=i.state.facet(ol);if(r.position!=this.position&&!this.madeAbsolute){this.position=r.position;for(let n of this.manager.tooltipViews)n.dom.style.position=this.position;t=!0}if(r.parent!=this.parent){this.parent&&this.container.remove(),this.parent=r.parent,this.createContainer();for(let n of this.manager.tooltipViews)this.container.appendChild(n.dom);t=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);t&&this.maybeMeasure()}createTooltip(i){let e=i.create(this.view);if(e.dom.classList.add("cm-tooltip"),i.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let t=document.createElement("div");t.className="cm-tooltip-arrow",e.dom.appendChild(t)}return e.dom.style.position=this.position,e.dom.style.top=So,this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var i,e;this.view.win.removeEventListener("resize",this.measureSoon);for(let t of this.manager.tooltipViews)t.dom.remove(),(i=t.destroy)===null||i===void 0||i.call(t);this.parent&&this.container.remove(),(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let i=this.view.dom.getBoundingClientRect(),e=1,t=1,r=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{offsetParent:n}=this.manager.tooltipViews[0].dom;r=!!(n&&n!=this.container.ownerDocument.body)}if(r||this.position=="absolute")if(this.parent){let n=this.parent.getBoundingClientRect();n.width&&n.height&&(e=n.width/this.parent.offsetWidth,t=n.height/this.parent.offsetHeight)}else({scaleX:e,scaleY:t}=this.view.viewState);return{editor:i,parent:this.parent?this.container.getBoundingClientRect():i,pos:this.manager.tooltips.map((n,o)=>{let s=this.manager.tooltipViews[o];return s.getCoords?s.getCoords(n.pos):this.view.coordsAtPos(n.pos)}),size:this.manager.tooltipViews.map(({dom:n})=>n.getBoundingClientRect()),space:this.view.state.facet(ol).tooltipSpace(this.view),scaleX:e,scaleY:t,makeAbsolute:r}}writeMeasure(i){var e;if(i.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let l of this.manager.tooltipViews)l.dom.style.position="absolute"}let{editor:t,space:r,scaleX:n,scaleY:o}=i,s=[];for(let l=0;l<this.manager.tooltips.length;l++){let a=this.manager.tooltips[l],h=this.manager.tooltipViews[l],{dom:c}=h,d=i.pos[l],u=i.size[l];if(!d||d.bottom<=Math.max(t.top,r.top)||d.top>=Math.min(t.bottom,r.bottom)||d.right<Math.max(t.left,r.left)-.1||d.left>Math.min(t.right,r.right)+.1){c.style.top=So;continue}let f=a.arrow?h.dom.querySelector(".cm-tooltip-arrow"):null,g=f?7:0,y=u.right-u.left,b=(e=Pc.get(h))!==null&&e!==void 0?e:u.bottom-u.top,C=h.offset||fw,D=this.view.textDirection==Ue.LTR,T=u.width>r.right-r.left?D?r.left:r.right-u.width:D?Math.min(d.left-(f?14:0)+C.x,r.right-y):Math.max(r.left,d.left-y+(f?14:0)-C.x),A=!!a.above;!a.strictSide&&(A?d.top-(u.bottom-u.top)-C.y<r.top:d.bottom+(u.bottom-u.top)+C.y>r.bottom)&&A==r.bottom-d.bottom>d.top-r.top&&(A=!A);let S=(A?d.top-r.top:r.bottom-d.bottom)-g;if(S<b&&h.resize!==!1){if(S<this.view.defaultLineHeight){c.style.top=So;continue}Pc.set(h,b),c.style.height=(b=S)/o+"px"}else c.style.height&&(c.style.height="");let k=A?d.top-b-g-C.y:d.bottom+g+C.y,v=T+y;if(h.overlap!==!0)for(let R of s)R.left<v&&R.right>T&&R.top<k+b&&R.bottom>k&&(k=A?R.top-b-2-g:R.bottom+g+2);if(this.position=="absolute"?(c.style.top=(k-i.parent.top)/o+"px",c.style.left=(T-i.parent.left)/n+"px"):(c.style.top=k/o+"px",c.style.left=T/n+"px"),f){let R=d.left+(D?C.x:-C.x)-(T+14-7);f.style.left=R/n+"px"}h.overlap!==!0&&s.push({left:T,top:k,right:v,bottom:k+b}),c.classList.toggle("cm-tooltip-above",A),c.classList.toggle("cm-tooltip-below",!A),h.positioned&&h.positioned(i.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let i of this.manager.tooltipViews)i.dom.style.top=So}},{eventObservers:{scroll(){this.maybeMeasure()}}}),uw=oe.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),fw={x:0,y:0},Ba=ae.define({enables:[Vf,uw]}),rs=ae.define();class Na{static create(e){return new Na(e)}constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new Wf(e,rs,t=>this.createHostedView(t))}createHostedView(e){let t=e.create(this.view);return t.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(t.dom),this.mounted&&t.mount&&t.mount(this.view),t}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(e){for(let t of this.manager.tooltipViews)t.positioned&&t.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let t of this.manager.tooltipViews)(e=t.destroy)===null||e===void 0||e.call(t)}}const pw=Ba.compute([rs],i=>{let e=i.facet(rs).filter(t=>t);return e.length===0?null:{pos:Math.min(...e.map(t=>t.pos)),end:Math.max(...e.filter(t=>t.end!=null).map(t=>t.end)),create:Na.create,above:e[0].above,arrow:e.some(t=>t.arrow)}});class gw{constructor(e,t,r,n,o){this.view=e,this.source=t,this.field=r,this.setHover=n,this.hoverTime=o,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:e,lastMove:t}=this,r=e.docView.nearest(t.target);if(!r)return;let n,o=1;if(r instanceof Gi)n=r.posAtStart;else{if(n=e.posAtCoords(t),n==null)return;let l=e.coordsAtPos(n);if(!l||t.y<l.top||t.y>l.bottom||t.x<l.left-e.defaultCharacterWidth||t.x>l.right+e.defaultCharacterWidth)return;let a=e.bidiSpans(e.state.doc.lineAt(n)).find(c=>c.from<=n&&c.to>=n),h=a&&a.dir==Ue.RTL?-1:1;o=t.x<l.left?-h:h}let s=this.source(e,n,o);if(s!=null&&s.then){let l=this.pending={pos:n};s.then(a=>{this.pending==l&&(this.pending=null,a&&e.dispatch({effects:this.setHover.of(a)}))},a=>ni(e.state,a,"hover tooltip"))}else s&&e.dispatch({effects:this.setHover.of(s)})}mousemove(e){var t;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let r=this.active;if(r&&!Lc(this.lastMove.target)||this.pending){let{pos:n}=r||this.pending,o=(t=r==null?void 0:r.end)!==null&&t!==void 0?t:n;(n==o?this.view.posAtCoords(this.lastMove)!=n:!mw(this.view,n,o,e.clientX,e.clientY))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&!Lc(e.relatedTarget)&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function Lc(i){for(let e=i;e;e=e.parentNode)if(e.nodeType==1&&e.classList.contains("cm-tooltip"))return!0;return!1}function mw(i,e,t,r,n,o){let s=i.scrollDOM.getBoundingClientRect(),l=i.documentTop+i.documentPadding.top+i.contentHeight;if(s.left>r||s.right<r||s.top>n||Math.min(s.bottom,l)<n)return!1;let a=i.posAtCoords({x:r,y:n},!1);return a>=e&&a<=t}function vw(i,e={}){let t=xe.define(),r=dt.define({create(){return null},update(n,o){if(n&&(e.hideOnChange&&(o.docChanged||o.selection)||e.hideOn&&e.hideOn(o,n)))return null;if(n&&o.docChanged){let s=o.changes.mapPos(n.pos,-1,Ct.TrackDel);if(s==null)return null;let l=Object.assign(Object.create(null),n);l.pos=s,n.end!=null&&(l.end=o.changes.mapPos(n.end)),n=l}for(let s of o.effects)s.is(t)&&(n=s.value),s.is(bw)&&(n=null);return n},provide:n=>rs.from(n)});return[r,Qe.define(n=>new gw(n,i,r,t,e.hoverTime||300)),pw]}function jf(i,e){let t=i.plugin(Vf);if(!t)return null;let r=t.manager.tooltips.indexOf(e);return r<0?null:t.manager.tooltipViews[r]}const bw=xe.define(),Ec=ae.define({combine(i){let e,t;for(let r of i)e=e||r.topContainer,t=t||r.bottomContainer;return{topContainer:e,bottomContainer:t}}});function Wn(i,e){let t=i.plugin(Uf),r=t?t.specs.indexOf(e):-1;return r>-1?t.panels[r]:null}const Uf=Qe.fromClass(class{constructor(i){this.input=i.state.facet(Vn),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(i));let e=i.state.facet(Ec);this.top=new Co(i,!0,e.topContainer),this.bottom=new Co(i,!1,e.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(i){let e=i.state.facet(Ec);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new Co(i.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new Co(i.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let t=i.state.facet(Vn);if(t!=this.input){let r=t.filter(a=>a),n=[],o=[],s=[],l=[];for(let a of r){let h=this.specs.indexOf(a),c;h<0?(c=a(i.view),l.push(c)):(c=this.panels[h],c.update&&c.update(i)),n.push(c),(c.top?o:s).push(c)}this.specs=r,this.panels=n,this.top.sync(o),this.bottom.sync(s);for(let a of l)a.dom.classList.add("cm-panel"),a.mount&&a.mount()}else for(let r of this.panels)r.update&&r.update(i)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:i=>oe.scrollMargins.of(e=>{let t=e.plugin(i);return t&&{top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()}})});class Co{constructor(e,t,r){this.view=e,this.top=t,this.container=r,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=Bc(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=Bc(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function Bc(i){let e=i.nextSibling;return i.remove(),e}const Vn=ae.define({enables:Uf});class Bi extends yr{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Bi.prototype.elementClass="";Bi.prototype.toDOM=void 0;Bi.prototype.mapMode=Ct.TrackBefore;Bi.prototype.startSide=Bi.prototype.endSide=-1;Bi.prototype.point=!0;const Vo=ae.define(),yw={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>Ee.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},On=ae.define();function ww(i){return[_f(),On.of(Object.assign(Object.assign({},yw),i))]}const ea=ae.define({combine:i=>i.some(e=>e)});function _f(i){let e=[xw];return i&&i.fixed===!1&&e.push(ea.of(!0)),e}const xw=Qe.fromClass(class{constructor(i){this.view=i,this.prevViewport=i.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=i.state.facet(On).map(e=>new Ic(i,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!i.state.facet(ea),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),i.scrollDOM.insertBefore(this.dom,i.contentDOM)}update(i){if(this.updateGutters(i)){let e=this.prevViewport,t=i.view.viewport,r=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(r<(t.to-t.from)*.8)}i.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(ea)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=i.view.viewport}syncGutters(i){let e=this.dom.nextSibling;i&&this.dom.remove();let t=Ee.iter(this.view.state.facet(Vo),this.view.viewport.from),r=[],n=this.gutters.map(o=>new kw(o,this.view.viewport,-this.view.documentPadding.top));for(let o of this.view.viewportLineBlocks)if(r.length&&(r=[]),Array.isArray(o.type)){let s=!0;for(let l of o.type)if(l.type==At.Text&&s){ta(t,r,l.from);for(let a of n)a.line(this.view,l,r);s=!1}else if(l.widget)for(let a of n)a.widget(this.view,l)}else if(o.type==At.Text){ta(t,r,o.from);for(let s of n)s.line(this.view,o,r)}else if(o.widget)for(let s of n)s.widget(this.view,o);for(let o of n)o.finish();i&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(i){let e=i.startState.facet(On),t=i.state.facet(On),r=i.docChanged||i.heightChanged||i.viewportChanged||!Ee.eq(i.startState.facet(Vo),i.state.facet(Vo),i.view.viewport.from,i.view.viewport.to);if(e==t)for(let n of this.gutters)n.update(i)&&(r=!0);else{r=!0;let n=[];for(let o of t){let s=e.indexOf(o);s<0?n.push(new Ic(this.view,o)):(this.gutters[s].update(i),n.push(this.gutters[s]))}for(let o of this.gutters)o.dom.remove(),n.indexOf(o)<0&&o.destroy();for(let o of n)this.dom.appendChild(o.dom);this.gutters=n}return r}destroy(){for(let i of this.gutters)i.destroy();this.dom.remove()}},{provide:i=>oe.scrollMargins.of(e=>{let t=e.plugin(i);return!t||t.gutters.length==0||!t.fixed?null:e.textDirection==Ue.LTR?{left:t.dom.offsetWidth*e.scaleX}:{right:t.dom.offsetWidth*e.scaleX}})});function Nc(i){return Array.isArray(i)?i:[i]}function ta(i,e,t){for(;i.value&&i.from<=t;)i.from==t&&e.push(i.value),i.next()}class kw{constructor(e,t,r){this.gutter=e,this.height=r,this.i=0,this.cursor=Ee.iter(e.markers,t.from)}addElement(e,t,r){let{gutter:n}=this,o=(t.top-this.height)/e.scaleY,s=t.height/e.scaleY;if(this.i==n.elements.length){let l=new Kf(e,s,o,r);n.elements.push(l),n.dom.appendChild(l.dom)}else n.elements[this.i].update(e,s,o,r);this.height=t.bottom,this.i++}line(e,t,r){let n=[];ta(this.cursor,n,t.from),r.length&&(n=n.concat(r));let o=this.gutter.config.lineMarker(e,t,n);o&&n.unshift(o);let s=this.gutter;n.length==0&&!s.config.renderEmptyElements||this.addElement(e,t,n)}widget(e,t){let r=this.gutter.config.widgetMarker(e,t.widget,t);r&&this.addElement(e,t,[r])}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class Ic{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let r in t.domEventHandlers)this.dom.addEventListener(r,n=>{let o=n.target,s;if(o!=this.dom&&this.dom.contains(o)){for(;o.parentNode!=this.dom;)o=o.parentNode;let a=o.getBoundingClientRect();s=(a.top+a.bottom)/2}else s=n.clientY;let l=e.lineBlockAtHeight(s-e.documentTop);t.domEventHandlers[r](e,l,n)&&n.preventDefault()});this.markers=Nc(t.markers(e)),t.initialSpacer&&(this.spacer=new Kf(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=Nc(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let n=this.config.updateSpacer(this.spacer.markers[0],e);n!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[n])}let r=e.view.viewport;return!Ee.eq(this.markers,t,r.from,r.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class Kf{constructor(e,t,r,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,r,n)}update(e,t,r,n){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=r&&(this.dom.style.marginTop=(this.above=r)?r+"px":""),Sw(this.markers,n)||this.setMarkers(e,n)}setMarkers(e,t){let r="cm-gutterElement",n=this.dom.firstChild;for(let o=0,s=0;;){let l=s,a=o<t.length?t[o++]:null,h=!1;if(a){let c=a.elementClass;c&&(r+=" "+c);for(let d=s;d<this.markers.length;d++)if(this.markers[d].compare(a)){l=d,h=!0;break}}else l=this.markers.length;for(;s<l;){let c=this.markers[s++];if(c.toDOM){c.destroy(n);let d=n.nextSibling;n.remove(),n=d}}if(!a)break;a.toDOM&&(h?n=n.nextSibling:this.dom.insertBefore(a.toDOM(e),n)),h&&s++}this.dom.className=r,this.markers=t}destroy(){this.setMarkers(null,[])}}function Sw(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++)if(!i[t].compare(e[t]))return!1;return!0}const Cw=ae.define(),zr=ae.define({combine(i){return Ci(i,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let r=Object.assign({},e);for(let n in t){let o=r[n],s=t[n];r[n]=o?(l,a,h)=>o(l,a,h)||s(l,a,h):s}return r}})}});class sl extends Bi{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function ll(i,e){return i.state.facet(zr).formatNumber(e,i.state)}const Aw=On.compute([zr],i=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(Cw)},lineMarker(e,t,r){return r.some(n=>n.toDOM)?null:new sl(ll(e,e.state.doc.lineAt(t.from).number))},widgetMarker:()=>null,lineMarkerChange:e=>e.startState.facet(zr)!=e.state.facet(zr),initialSpacer(e){return new sl(ll(e,zc(e.state.doc.lines)))},updateSpacer(e,t){let r=ll(t.view,zc(t.view.state.doc.lines));return r==e.number?e:new sl(r)},domEventHandlers:i.facet(zr).domEventHandlers}));function Mw(i={}){return[zr.of(i),_f(),Aw]}function zc(i){let e=9;for(;e<i;)e=e*10+9;return e}const Rw=new class extends Bi{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},Tw=Vo.compute(["selection"],i=>{let e=[],t=-1;for(let r of i.selection.ranges){let n=i.doc.lineAt(r.head).from;n>t&&(t=n,e.push(Rw.range(n)))}return Ee.of(e)});function Dw(){return Tw}const Ow=1024;let Pw=0;class al{constructor(e,t){this.from=e,this.to=t}}let Le=class{constructor(i={}){this.id=Pw++,this.perNode=!!i.perNode,this.deserialize=i.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(i){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof i!="function"&&(i=Jt.match(i)),e=>{let t=i(e);return t===void 0?null:[this,t]}}};Le.closedBy=new Le({deserialize:i=>i.split(" ")});Le.openedBy=new Le({deserialize:i=>i.split(" ")});Le.group=new Le({deserialize:i=>i.split(" ")});Le.contextHash=new Le({perNode:!0});Le.lookAhead=new Le({perNode:!0});Le.mounted=new Le({perNode:!0});class ns{constructor(e,t,r){this.tree=e,this.overlay=t,this.parser=r}static get(e){return e&&e.props&&e.props[Le.mounted.id]}}const Lw=Object.create(null);let Jt=class qf{constructor(e,t,r,n=0){this.name=e,this.props=t,this.id=r,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):Lw,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),n=new qf(e.name||"",t,e.id,r);if(e.props){for(let o of e.props)if(Array.isArray(o)||(o=o(n)),o){if(o[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[o[0].id]=o[1]}}return n}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(Le.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let n of r.split(" "))t[n]=e[r];return r=>{for(let n=r.prop(Le.group),o=-1;o<(n?n.length:0);o++){let s=t[o<0?r.name:n[o]];if(s)return s}}}};Jt.none=new Jt("",Object.create(null),0,8);class Ia{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let r of this.types){let n=null;for(let o of e){let s=o(r);s&&(n||(n=Object.assign({},r.props)),n[s[0].id]=s[1])}t.push(n?new Jt(r.name,n,r.id,r.flags):r)}return new Ia(t)}}const Ao=new WeakMap,Fc=new WeakMap;var ht;(function(i){i[i.ExcludeBuffers=1]="ExcludeBuffers",i[i.IncludeAnonymous=2]="IncludeAnonymous",i[i.IgnoreMounts=4]="IgnoreMounts",i[i.IgnoreOverlays=8]="IgnoreOverlays"})(ht||(ht={}));let Ze=class ia{constructor(e,t,r,n,o){if(this.type=e,this.children=t,this.positions=r,this.length=n,this.props=null,o&&o.length){this.props=Object.create(null);for(let[s,l]of o)this.props[typeof s=="number"?s:s.id]=l}}toString(){let e=ns.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let r of this.children){let n=r.toString();n&&(t&&(t+=","),t+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new oa(this.topNode,e)}cursorAt(e,t=0,r=0){let n=Ao.get(this)||this.topNode,o=new oa(n);return o.moveTo(e,t),Ao.set(this,o._tree),o}get topNode(){return new ir(this,0,0,null)}resolve(e,t=0){let r=jn(Ao.get(this)||this.topNode,e,t,!1);return Ao.set(this,r),r}resolveInner(e,t=0){let r=jn(Fc.get(this)||this.topNode,e,t,!0);return Fc.set(this,r),r}resolveStack(e,t=0){return Iw(this,e,t)}iterate(e){let{enter:t,leave:r,from:n=0,to:o=this.length}=e,s=e.mode||0,l=(s&ht.IncludeAnonymous)>0;for(let a=this.cursor(s|ht.IncludeAnonymous);;){let h=!1;if(a.from<=o&&a.to>=n&&(!l&&a.type.isAnonymous||t(a)!==!1)){if(a.firstChild())continue;h=!0}for(;h&&r&&(l||!a.type.isAnonymous)&&r(a),!a.nextSibling();){if(!a.parent())return;h=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:Fa(Jt.none,this.children,this.positions,0,this.children.length,0,this.length,(t,r,n)=>new ia(this.type,t,r,n,this.propValues),e.makeTree||((t,r,n)=>new ia(Jt.none,t,r,n)))}static build(e){return zw(e)}};Ze.empty=new Ze(Jt.none,[],[],0);let Ew=class Gf{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Gf(this.buffer,this.index)}},no=class Xf{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return Jt.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],n=this.set.types[t],o=n.name;if(/\W/.test(o)&&!n.isError&&(o=JSON.stringify(o)),e+=4,r==e)return o;let s=[];for(;e<r;)s.push(this.childString(e)),e=this.buffer[e+3];return o+"("+s.join(",")+")"}findChild(e,t,r,n,o){let{buffer:s}=this,l=-1;for(let a=e;a!=t&&!(Yf(o,n,s[a+1],s[a+2])&&(l=a,r>0));a=s[a+3]);return l}slice(e,t,r){let n=this.buffer,o=new Uint16Array(t-e),s=0;for(let l=e,a=0;l<t;){o[a++]=n[l++],o[a++]=n[l++]-r;let h=o[a++]=n[l++]-r;o[a++]=n[l++]-e,s=Math.max(s,h)}return new Xf(o,s,this.set)}};function Yf(i,e,t,r){switch(i){case-2:return t<e;case-1:return r>=e&&t<e;case 0:return t<e&&r>e;case 1:return t<=e&&r>e;case 2:return r>e;case 4:return!0}}function jn(i,e,t,r){for(var n;i.from==i.to||(t<1?i.from>=e:i.from>e)||(t>-1?i.to<=e:i.to<e);){let s=!r&&i instanceof ir&&i.index<0?null:i.parent;if(!s)return i;i=s}let o=r?0:ht.IgnoreOverlays;if(r)for(let s=i,l=s.parent;l;s=l,l=s.parent)s instanceof ir&&s.index<0&&((n=l.enter(e,t,o))===null||n===void 0?void 0:n.from)!=s.from&&(i=l);for(;;){let s=i.enter(e,t,o);if(!s)return i;i=s}}class Jf{cursor(e=0){return new oa(this,e)}getChild(e,t=null,r=null){let n=$c(this,e,t,r);return n.length?n[0]:null}getChildren(e,t=null,r=null){return $c(this,e,t,r)}resolve(e,t=0){return jn(this,e,t,!1)}resolveInner(e,t=0){return jn(this,e,t,!0)}matchContext(e){return ra(this,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),r=this;for(;t;){let n=t.lastChild;if(!n||n.to!=t.to)break;n.type.isError&&n.from==n.to?(r=t,t=n.prevSibling):t=n}return r}get node(){return this}get next(){return this.parent}}let ir=class jo extends Jf{constructor(e,t,r,n){super(),this._tree=e,this.from=t,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,n,o=0){for(let s=this;;){for(let{children:l,positions:a}=s._tree,h=t>0?l.length:-1;e!=h;e+=t){let c=l[e],d=a[e]+s.from;if(Yf(n,r,d,d+c.length)){if(c instanceof no){if(o&ht.ExcludeBuffers)continue;let u=c.findChild(0,c.buffer.length,t,r-d,n);if(u>-1)return new na(new Bw(s,c,e,d),null,u)}else if(o&ht.IncludeAnonymous||!c.type.isAnonymous||za(c)){let u;if(!(o&ht.IgnoreMounts)&&(u=ns.get(c))&&!u.overlay)return new jo(u.tree,d,e,s);let f=new jo(c,d,e,s);return o&ht.IncludeAnonymous||!f.type.isAnonymous?f:f.nextChild(t<0?c.children.length-1:0,t,r,n)}}}if(o&ht.IncludeAnonymous||!s.type.isAnonymous||(s.index>=0?e=s.index+t:e=t<0?-1:s._parent._tree.children.length,s=s._parent,!s))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,r=0){let n;if(!(r&ht.IgnoreOverlays)&&(n=ns.get(this._tree))&&n.overlay){let o=e-this.from;for(let{from:s,to:l}of n.overlay)if((t>0?s<=o:s<o)&&(t<0?l>=o:l>o))return new jo(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}};function $c(i,e,t,r){let n=i.cursor(),o=[];if(!n.firstChild())return o;if(t!=null){for(;!n.type.is(t);)if(!n.nextSibling())return o}for(;;){if(r!=null&&n.type.is(r))return o;if(n.type.is(e)&&o.push(n.node),!n.nextSibling())return r==null?o:[]}}function ra(i,e,t=e.length-1){for(let r=i.parent;t>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[t]&&e[t]!=r.name)return!1;t--}}return!0}let Bw=class{constructor(i,e,t,r){this.parent=i,this.buffer=e,this.index=t,this.start=r}},na=class Mn extends Jf{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){super(),this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:n}=this.context,o=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,r);return o<0?null:new Mn(this.context,this,o)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,r=0){if(r&ht.ExcludeBuffers)return null;let{buffer:n}=this.context,o=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return o<0?null:new Mn(this.context,this,o)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new Mn(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new Mn(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,n=this.index+4,o=r.buffer[this.index+3];if(o>n){let s=r.buffer[this.index+1];e.push(r.slice(n,o,s)),t.push(0)}return new Ze(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}};function Zf(i){if(!i.length)return null;if(i.length==1)return i[0];let e=0,t=i[0];for(let o=1;o<i.length;o++){let s=i[o];(s.from>t.from||s.to<t.to)&&(t=s,e=o)}let r=t instanceof ir&&t.index<0?null:t.parent,n=i.slice();return r?n[e]=r:n.splice(e,1),new Nw(n,t)}class Nw{constructor(e,t){this.heads=e,this.node=t}get next(){return Zf(this.heads)}}function Iw(i,e,t){let r=i.resolveInner(e,t),n=null;for(let o=r instanceof ir?r:r.context.parent;o;o=o.parent)if(o.index<0){let s=o.parent;(n||(n=[r])).push(s.resolve(e,t)),o=s}else{let s=ns.get(o.tree);if(s&&s.overlay&&s.overlay[0].from<=e&&s.overlay[s.overlay.length-1].to>=e){let l=new ir(s.tree,s.overlay[0].from+o.from,0,null);(n||(n=[r])).push(jn(l,e,t,!1))}}return n?Zf(n):r}let oa=class{get name(){return this.type.name}constructor(i,e=0){if(this.mode=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,i instanceof ir)this.yieldNode(i);else{this._tree=i.context.parent,this.buffer=i.context;for(let t=i._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=i,this.yieldBuf(i.index)}}yieldNode(i){return i?(this._tree=i,this.type=i.type,this.from=i.from,this.to=i.to,!0):!1}yieldBuf(i,e){this.index=i;let{start:t,buffer:r}=this.buffer;return this.type=e||r.set.types[r.buffer[i]],this.from=t+r.buffer[i+1],this.to=t+r.buffer[i+2],!0}yield(i){return i?i instanceof ir?(this.buffer=null,this.yieldNode(i)):(this.buffer=i.context,this.yieldBuf(i.index,i.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(i,e,t){if(!this.buffer)return this.yield(this._tree.nextChild(i<0?this._tree._tree.children.length-1:0,i,e,t,this.mode));let{buffer:r}=this.buffer,n=r.findChild(this.index+4,r.buffer[this.index+3],i,e-this.buffer.start,t);return n<0?!1:(this.stack.push(this.index),this.yieldBuf(n))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(i){return this.enterChild(1,i,2)}childBefore(i){return this.enterChild(-1,i,-2)}enter(i,e,t=this.mode){return this.buffer?t&ht.ExcludeBuffers?!1:this.enterChild(1,i,e):this.yield(this._tree.enter(i,e,t))}parent(){if(!this.buffer)return this.yieldNode(this.mode&ht.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let i=this.mode&ht.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(i)}sibling(i){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+i,i,0,4,this.mode)):!1;let{buffer:e}=this.buffer,t=this.stack.length-1;if(i<0){let r=t<0?0:this.stack[t]+4;if(this.index!=r)return this.yieldBuf(e.findChild(r,this.index,-1,0,4))}else{let r=e.buffer[this.index+3];if(r<(t<0?e.buffer.length:e.buffer[this.stack[t]+3]))return this.yieldBuf(r)}return t<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+i,i,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(i){let e,t,{buffer:r}=this;if(r){if(i>0){if(this.index<r.buffer.buffer.length)return!1}else for(let n=0;n<this.index;n++)if(r.buffer.buffer[n+3]<this.index)return!1;({index:e,parent:t}=r)}else({index:e,_parent:t}=this._tree);for(;t;{index:e,_parent:t}=t)if(e>-1)for(let n=e+i,o=i<0?-1:t._tree.children.length;n!=o;n+=i){let s=t._tree.children[n];if(this.mode&ht.IncludeAnonymous||s instanceof no||!s.type.isAnonymous||za(s))return!1}return!0}move(i,e){if(e&&this.enterChild(i,0,4))return!0;for(;;){if(this.sibling(i))return!0;if(this.atLastNode(i)||!this.parent())return!1}}next(i=!0){return this.move(1,i)}prev(i=!0){return this.move(-1,i)}moveTo(i,e=0){for(;(this.from==this.to||(e<1?this.from>=i:this.from>i)||(e>-1?this.to<=i:this.to<i))&&this.parent(););for(;this.enterChild(1,i,e););return this}get node(){if(!this.buffer)return this._tree;let i=this.bufferNode,e=null,t=0;if(i&&i.context==this.buffer)e:for(let r=this.index,n=this.stack.length;n>=0;){for(let o=i;o;o=o._parent)if(o.index==r){if(r==this.index)return o;e=o,t=n+1;break e}r=this.stack[--n]}for(let r=t;r<this.stack.length;r++)e=new na(this.buffer,e,this.stack[r]);return this.bufferNode=new na(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(i,e){for(let t=0;;){let r=!1;if(this.type.isAnonymous||i(this)!==!1){if(this.firstChild()){t++;continue}this.type.isAnonymous||(r=!0)}for(;r&&e&&e(this),r=this.type.isAnonymous,!this.nextSibling();){if(!t)return;this.parent(),t--,r=!0}}}matchContext(i){if(!this.buffer)return ra(this.node,i);let{buffer:e}=this.buffer,{types:t}=e.set;for(let r=i.length-1,n=this.stack.length-1;r>=0;n--){if(n<0)return ra(this.node,i,r);let o=t[e.buffer[this.stack[n]]];if(!o.isAnonymous){if(i[r]&&i[r]!=o.name)return!1;r--}}return!0}};function za(i){return i.children.some(e=>e instanceof no||!e.type.isAnonymous||za(e))}function zw(i){var e;let{buffer:t,nodeSet:r,maxBufferLength:n=Ow,reused:o=[],minRepeatType:s=r.types.length}=i,l=Array.isArray(t)?new Ew(t,t.length):t,a=r.types,h=0,c=0;function d(A,S,k,v,R){let{id:m,start:N,end:V,size:J}=l,U=c;for(;J<0;)if(l.next(),J==-1){let X=o[m];k.push(X),v.push(N-A);return}else if(J==-3){h=m;return}else if(J==-4){c=m;return}else throw new RangeError(`Unrecognized record size: ${J}`);let re=a[m],te,$,ne=N-A;if(V-N<=n&&($=y(l.pos-S,R))){let X=new Uint16Array($.size-$.skip),Z=l.pos-$.size,P=X.length;for(;l.pos>Z;)P=b($.start,X,P);te=new no(X,V-$.start,r),ne=$.start-A}else{let X=l.pos-J;l.next();let Z=[],P=[],W=m>=s?m:-1,K=0,fe=V;for(;l.pos>X;)W>=0&&l.id==W&&l.size>=0?(l.end<=fe-n&&(f(Z,P,N,K,l.end,fe,W,U),K=Z.length,fe=l.end),l.next()):d(N,X,Z,P,W);if(W>=0&&K>0&&K<Z.length&&f(Z,P,N,K,N,fe,W,U),Z.reverse(),P.reverse(),W>-1&&K>0){let Ge=u(re);te=Fa(re,Z,P,0,Z.length,0,V-N,Ge,Ge)}else te=g(re,Z,P,V-N,U-V)}k.push(te),v.push(ne)}function u(A){return(S,k,v)=>{let R=0,m=S.length-1,N,V;if(m>=0&&(N=S[m])instanceof Ze){if(!m&&N.type==A&&N.length==v)return N;(V=N.prop(Le.lookAhead))&&(R=k[m]+N.length+V)}return g(A,S,k,v,R)}}function f(A,S,k,v,R,m,N,V){let J=[],U=[];for(;A.length>v;)J.push(A.pop()),U.push(S.pop()+k-R);A.push(g(r.types[N],J,U,m-R,V-m)),S.push(R-k)}function g(A,S,k,v,R=0,m){if(h){let N=[Le.contextHash,h];m=m?[N].concat(m):[N]}if(R>25){let N=[Le.lookAhead,R];m=m?[N].concat(m):[N]}return new Ze(A,S,k,v,m)}function y(A,S){let k=l.fork(),v=0,R=0,m=0,N=k.end-n,V={size:0,start:0,skip:0};e:for(let J=k.pos-A;k.pos>J;){let U=k.size;if(k.id==S&&U>=0){V.size=v,V.start=R,V.skip=m,m+=4,v+=4,k.next();continue}let re=k.pos-U;if(U<0||re<J||k.start<N)break;let te=k.id>=s?4:0,$=k.start;for(k.next();k.pos>re;){if(k.size<0)if(k.size==-3)te+=4;else break e;else k.id>=s&&(te+=4);k.next()}R=$,v+=U,m+=te}return(S<0||v==A)&&(V.size=v,V.start=R,V.skip=m),V.size>4?V:void 0}function b(A,S,k){let{id:v,start:R,end:m,size:N}=l;if(l.next(),N>=0&&v<s){let V=k;if(N>4){let J=l.pos-(N-4);for(;l.pos>J;)k=b(A,S,k)}S[--k]=V,S[--k]=m-A,S[--k]=R-A,S[--k]=v}else N==-3?h=v:N==-4&&(c=v);return k}let C=[],D=[];for(;l.pos>0;)d(i.start||0,i.bufferStart||0,C,D,-1);let T=(e=i.length)!==null&&e!==void 0?e:C.length?D[0]+C[0].length:0;return new Ze(a[i.topID],C.reverse(),D.reverse(),T)}const Hc=new WeakMap;function Uo(i,e){if(!i.isAnonymous||e instanceof no||e.type!=i)return 1;let t=Hc.get(e);if(t==null){t=1;for(let r of e.children){if(r.type!=i||!(r instanceof Ze)){t=1;break}t+=Uo(i,r)}Hc.set(e,t)}return t}function Fa(i,e,t,r,n,o,s,l,a){let h=0;for(let g=r;g<n;g++)h+=Uo(i,e[g]);let c=Math.ceil(h*1.5/8),d=[],u=[];function f(g,y,b,C,D){for(let T=b;T<C;){let A=T,S=y[T],k=Uo(i,g[T]);for(T++;T<C;T++){let v=Uo(i,g[T]);if(k+v>=c)break;k+=v}if(T==A+1){if(k>c){let v=g[A];f(v.children,v.positions,0,v.children.length,y[A]+D);continue}d.push(g[A])}else{let v=y[T-1]+g[T-1].length-S;d.push(Fa(i,g,y,A,T,S,v,null,a))}u.push(S+D-o)}}return f(e,t,r,n,0),(l||a)(d,u,s)}class vr{constructor(e,t,r,n,o=!1,s=!1){this.from=e,this.to=t,this.tree=r,this.offset=n,this.open=(o?1:0)|(s?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],r=!1){let n=[new vr(0,e.length,e,0,!1,r)];for(let o of t)o.to>e.length&&n.push(o);return n}static applyChanges(e,t,r=128){if(!t.length)return e;let n=[],o=1,s=e.length?e[0]:null;for(let l=0,a=0,h=0;;l++){let c=l<t.length?t[l]:null,d=c?c.fromA:1e9;if(d-a>=r)for(;s&&s.from<d;){let u=s;if(a>=u.from||d<=u.to||h){let f=Math.max(u.from,a)-h,g=Math.min(u.to,d)-h;u=f>=g?null:new vr(f,g,u.tree,u.offset+h,l>0,!!c)}if(u&&n.push(u),s.to>d)break;s=o<e.length?e[o++]:null}if(!c)break;a=c.toA,h=c.toA-c.toB}return n}}class Qf{startParse(e,t,r){return typeof e=="string"&&(e=new Fw(e)),r=r?r.length?r.map(n=>new al(n.from,n.to)):[new al(0,0)]:[new al(0,e.length)],this.createParse(e,t||[],r)}parse(e,t,r){let n=this.startParse(e,t,r);for(;;){let o=n.advance();if(o)return o}}}class Fw{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new Le({perNode:!0});let $w=0;class mi{constructor(e,t,r){this.set=e,this.base=t,this.modified=r,this.id=$w++}static define(e){if(e!=null&&e.base)throw new Error("Can not derive from a modified tag");let t=new mi([],null,[]);if(t.set.push(t),e)for(let r of e.set)t.set.push(r);return t}static defineModifier(){let e=new os;return t=>t.modified.indexOf(e)>-1?t:os.get(t.base||t,t.modified.concat(e).sort((r,n)=>r.id-n.id))}}let Hw=0;class os{constructor(){this.instances=[],this.id=Hw++}static get(e,t){if(!t.length)return e;let r=t[0].instances.find(l=>l.base==e&&Ww(t,l.modified));if(r)return r;let n=[],o=new mi(n,e,t);for(let l of t)l.instances.push(o);let s=Vw(t);for(let l of e.set)if(!l.modified.length)for(let a of s)n.push(os.get(l,a));return o}}function Ww(i,e){return i.length==e.length&&i.every((t,r)=>t==e[r])}function Vw(i){let e=[[]];for(let t=0;t<i.length;t++)for(let r=0,n=e.length;r<n;r++)e.push(e[r].concat(i[t]));return e.sort((t,r)=>r.length-t.length)}function jw(i){let e=Object.create(null);for(let t in i){let r=i[t];Array.isArray(r)||(r=[r]);for(let n of t.split(" "))if(n){let o=[],s=2,l=n;for(let d=0;;){if(l=="..."&&d>0&&d+3==n.length){s=1;break}let u=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(l);if(!u)throw new RangeError("Invalid path: "+n);if(o.push(u[0]=="*"?"":u[0][0]=='"'?JSON.parse(u[0]):u[0]),d+=u[0].length,d==n.length)break;let f=n[d++];if(d==n.length&&f=="!"){s=0;break}if(f!="/")throw new RangeError("Invalid path: "+n);l=n.slice(d)}let a=o.length-1,h=o[a];if(!h)throw new RangeError("Invalid path: "+n);let c=new ss(r,s,a>0?o.slice(0,a):null);e[h]=c.sort(e[h])}}return ep.add(e)}const ep=new Le;class ss{constructor(e,t,r,n){this.tags=e,this.mode=t,this.context=r,this.next=n}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}ss.empty=new ss([],2,null);function tp(i,e){let t=Object.create(null);for(let o of i)if(!Array.isArray(o.tag))t[o.tag.id]=o.class;else for(let s of o.tag)t[s.id]=o.class;let{scope:r,all:n=null}=e||{};return{style:o=>{let s=n;for(let l of o)for(let a of l.set){let h=t[a.id];if(h){s=s?s+" "+h:h;break}}return s},scope:r}}function Uw(i,e){let t=null;for(let r of i){let n=r.style(e);n&&(t=t?t+" "+n:n)}return t}function _w(i,e,t,r=0,n=i.length){let o=new Kw(r,Array.isArray(e)?e:[e],t);o.highlightRange(i.cursor(),r,n,"",o.highlighters),o.flush(n)}class Kw{constructor(e,t,r){this.at=e,this.highlighters=t,this.span=r,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,r,n,o){let{type:s,from:l,to:a}=e;if(l>=r||a<=t)return;s.isTop&&(o=this.highlighters.filter(f=>!f.scope||f.scope(s)));let h=n,c=qw(e)||ss.empty,d=Uw(o,c.tags);if(d&&(h&&(h+=" "),h+=d,c.mode==1&&(n+=(n?" ":"")+d)),this.startSpan(e.from,h),c.opaque)return;let u=e.tree&&e.tree.prop(Le.mounted);if(u&&u.overlay){let f=e.node.enter(u.overlay[0].from+l,1),g=this.highlighters.filter(b=>!b.scope||b.scope(u.tree.type)),y=e.firstChild();for(let b=0,C=l;;b++){let D=b<u.overlay.length?u.overlay[b]:null,T=D?D.from+l:a,A=Math.max(t,C),S=Math.min(r,T);if(A<S&&y)for(;e.from<S&&(this.highlightRange(e,A,S,n,o),this.startSpan(Math.min(S,e.to),h),!(e.to>=T||!e.nextSibling())););if(!D||T>r)break;C=D.to+l,C>t&&(this.highlightRange(f.cursor(),Math.max(t,D.from+l),Math.min(r,C),n,g),this.startSpan(C,h))}y&&e.parent()}else if(e.firstChild()){do if(!(e.to<=t)){if(e.from>=r)break;this.highlightRange(e,t,r,n,o),this.startSpan(Math.min(r,e.to),h)}while(e.nextSibling());e.parent()}}}function qw(i){let e=i.type.prop(ep);for(;e&&e.context&&!i.matchContext(e.context);)e=e.next;return e||null}const G=mi.define,Mo=G(),ji=G(),Wc=G(ji),Vc=G(ji),Ui=G(),Ro=G(Ui),hl=G(Ui),gi=G(),ar=G(gi),fi=G(),pi=G(),sa=G(),bn=G(sa),To=G(),E={comment:Mo,lineComment:G(Mo),blockComment:G(Mo),docComment:G(Mo),name:ji,variableName:G(ji),typeName:Wc,tagName:G(Wc),propertyName:Vc,attributeName:G(Vc),className:G(ji),labelName:G(ji),namespace:G(ji),macroName:G(ji),literal:Ui,string:Ro,docString:G(Ro),character:G(Ro),attributeValue:G(Ro),number:hl,integer:G(hl),float:G(hl),bool:G(Ui),regexp:G(Ui),escape:G(Ui),color:G(Ui),url:G(Ui),keyword:fi,self:G(fi),null:G(fi),atom:G(fi),unit:G(fi),modifier:G(fi),operatorKeyword:G(fi),controlKeyword:G(fi),definitionKeyword:G(fi),moduleKeyword:G(fi),operator:pi,derefOperator:G(pi),arithmeticOperator:G(pi),logicOperator:G(pi),bitwiseOperator:G(pi),compareOperator:G(pi),updateOperator:G(pi),definitionOperator:G(pi),typeOperator:G(pi),controlOperator:G(pi),punctuation:sa,separator:G(sa),bracket:bn,angleBracket:G(bn),squareBracket:G(bn),paren:G(bn),brace:G(bn),content:gi,heading:ar,heading1:G(ar),heading2:G(ar),heading3:G(ar),heading4:G(ar),heading5:G(ar),heading6:G(ar),contentSeparator:G(gi),list:G(gi),quote:G(gi),emphasis:G(gi),strong:G(gi),link:G(gi),monospace:G(gi),strikethrough:G(gi),inserted:G(),deleted:G(),changed:G(),invalid:G(),meta:To,documentMeta:G(To),annotation:G(To),processingInstruction:G(To),definition:mi.defineModifier(),constant:mi.defineModifier(),function:mi.defineModifier(),standard:mi.defineModifier(),local:mi.defineModifier(),special:mi.defineModifier()};tp([{tag:E.link,class:"tok-link"},{tag:E.heading,class:"tok-heading"},{tag:E.emphasis,class:"tok-emphasis"},{tag:E.strong,class:"tok-strong"},{tag:E.keyword,class:"tok-keyword"},{tag:E.atom,class:"tok-atom"},{tag:E.bool,class:"tok-bool"},{tag:E.url,class:"tok-url"},{tag:E.labelName,class:"tok-labelName"},{tag:E.inserted,class:"tok-inserted"},{tag:E.deleted,class:"tok-deleted"},{tag:E.literal,class:"tok-literal"},{tag:E.string,class:"tok-string"},{tag:E.number,class:"tok-number"},{tag:[E.regexp,E.escape,E.special(E.string)],class:"tok-string2"},{tag:E.variableName,class:"tok-variableName"},{tag:E.local(E.variableName),class:"tok-variableName tok-local"},{tag:E.definition(E.variableName),class:"tok-variableName tok-definition"},{tag:E.special(E.variableName),class:"tok-variableName2"},{tag:E.definition(E.propertyName),class:"tok-propertyName tok-definition"},{tag:E.typeName,class:"tok-typeName"},{tag:E.namespace,class:"tok-namespace"},{tag:E.className,class:"tok-className"},{tag:E.macroName,class:"tok-macroName"},{tag:E.propertyName,class:"tok-propertyName"},{tag:E.operator,class:"tok-operator"},{tag:E.comment,class:"tok-comment"},{tag:E.meta,class:"tok-meta"},{tag:E.invalid,class:"tok-invalid"},{tag:E.punctuation,class:"tok-punctuation"}]);const la="ͼ",jc=typeof Symbol>"u"?"__"+la:Symbol.for(la),aa=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),Uc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class _c{constructor(e,t){this.rules=[];let{finish:r}=t||{};function n(s){return/^@/.test(s)?[s]:s.split(/,\s*/)}function o(s,l,a,h){let c=[],d=/^@(\w+)\b/.exec(s[0]),u=d&&d[1]=="keyframes";if(d&&l==null)return a.push(s[0]+";");for(let f in l){let g=l[f];if(/&/.test(f))o(f.split(/,\s*/).map(y=>s.map(b=>y.replace(/&/,b))).reduce((y,b)=>y.concat(b)),g,a);else if(g&&typeof g=="object"){if(!d)throw new RangeError("The value of a property ("+f+") should be a primitive value.");o(n(f),g,c,u)}else g!=null&&c.push(f.replace(/_.*/,"").replace(/[A-Z]/g,y=>"-"+y.toLowerCase())+": "+g+";")}(c.length||u)&&a.push((r&&!d&&!h?s.map(r):s).join(", ")+" {"+c.join(" ")+"}")}for(let s in e)o(n(s),e[s],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=Uc[jc]||1;return Uc[jc]=e+1,la+e.toString(36)}static mount(e,t){(e[aa]||new Gw(e)).mount(Array.isArray(t)?t:[t])}}let Kc=new Map;class Gw{constructor(e){let t=e.ownerDocument||e,r=t.defaultView;if(!e.head&&e.adoptedStyleSheets&&r.CSSStyleSheet){let n=Kc.get(t);if(n)return e.adoptedStyleSheets=[n.sheet,...e.adoptedStyleSheets],e[aa]=n;this.sheet=new r.CSSStyleSheet,e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets],Kc.set(t,this)}else{this.styleTag=t.createElement("style");let n=e.head||e;n.insertBefore(this.styleTag,n.firstChild)}this.modules=[],e[aa]=this}mount(e){let t=this.sheet,r=0,n=0;for(let o=0;o<e.length;o++){let s=e[o],l=this.modules.indexOf(s);if(l<n&&l>-1&&(this.modules.splice(l,1),n--,l=-1),l==-1){if(this.modules.splice(n++,0,s),t)for(let a=0;a<s.rules.length;a++)t.insertRule(s.rules[a],r++)}else{for(;n<l;)r+=this.modules[n++].rules.length;r+=s.rules.length,n++}}if(!t){let o="";for(let s=0;s<this.modules.length;s++)o+=this.modules[s].getRules()+`
`;this.styleTag.textContent=o}}}var cl;const Fr=new Le;function Xw(i){return ae.define({combine:i?e=>e.concat(i):void 0})}const Yw=new Le;class ii{constructor(e,t,r=[],n=""){this.data=e,this.name=n,Me.prototype.hasOwnProperty("tree")||Object.defineProperty(Me.prototype,"tree",{get(){return ct(this)}}),this.parser=t,this.extension=[rr.of(this),Me.languageData.of((o,s,l)=>{let a=qc(o,s,l),h=a.type.prop(Fr);if(!h)return[];let c=o.facet(h),d=a.type.prop(Yw);if(d){let u=a.resolve(s-a.from,l);for(let f of d)if(f.test(u,o)){let g=o.facet(f.facet);return f.type=="replace"?g:g.concat(c)}}return c})].concat(r)}isActiveAt(e,t,r=-1){return qc(e,t,r).type.prop(Fr)==this.data}findRegions(e){let t=e.facet(rr);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let r=[],n=(o,s)=>{if(o.prop(Fr)==this.data){r.push({from:s,to:s+o.length});return}let l=o.prop(Le.mounted);if(l){if(l.tree.prop(Fr)==this.data){if(l.overlay)for(let a of l.overlay)r.push({from:a.from+s,to:a.to+s});else r.push({from:s,to:s+o.length});return}else if(l.overlay){let a=r.length;if(n(l.tree,l.overlay[0].from+s),r.length>a)return}}for(let a=0;a<o.children.length;a++){let h=o.children[a];h instanceof Ze&&n(h,o.positions[a]+s)}};return n(ct(e),0),r}get allowsNesting(){return!0}}ii.setState=xe.define();function qc(i,e,t){let r=i.facet(rr),n=ct(i).topNode;if(!r||r.allowsNesting)for(let o=n;o;o=o.enter(e,t,ht.ExcludeBuffers))o.type.isTop&&(n=o);return n}function ct(i){let e=i.field(ii.state,!1);return e?e.tree:Ze.empty}class Jw{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let r=this.cursorPos-this.string.length;return e<r||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-r,t-r)}}let yn=null;class Jr{constructor(e,t,r=[],n,o,s,l,a){this.parser=e,this.state=t,this.fragments=r,this.tree=n,this.treeLen=o,this.viewport=s,this.skipped=l,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,r){return new Jr(e,t,[],Ze.empty,0,r,[],null)}startParse(){return this.parser.startParse(new Jw(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=Ze.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let n=Date.now()+e;e=()=>Date.now()>n}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let n=this.parse.advance();if(n)if(this.fragments=this.withoutTempSkipped(vr.addTree(n,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=n,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(vr.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=yn;yn=this;try{return e()}finally{yn=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=Gc(e,t.from,t.to);return e}changes(e,t){let{fragments:r,tree:n,treeLen:o,viewport:s,skipped:l}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((h,c,d,u)=>a.push({fromA:h,toA:c,fromB:d,toB:u})),r=vr.applyChanges(r,a),n=Ze.empty,o=0,s={from:e.mapPos(s.from,-1),to:e.mapPos(s.to,1)},this.skipped.length){l=[];for(let h of this.skipped){let c=e.mapPos(h.from,1),d=e.mapPos(h.to,-1);c<d&&l.push({from:c,to:d})}}}return new Jr(this.parser,t,r,n,o,s,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:n,to:o}=this.skipped[r];n<e.to&&o>e.from&&(this.fragments=Gc(this.fragments,n,o),this.skipped.splice(r--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Qf{createParse(t,r,n){let o=n[0].from,s=n[n.length-1].to;return{parsedPos:o,advance(){let l=yn;if(l){for(let a of n)l.tempSkipped.push(a);e&&(l.scheduleOn=l.scheduleOn?Promise.all([l.scheduleOn,e]):e)}return this.parsedPos=s,new Ze(Jt.none,[],[],s-o)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return yn}}function Gc(i,e,t){return vr.applyChanges(i,[{fromA:e,toA:t,fromB:e,toB:t}])}class Zr{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,r)||t.takeTree(),new Zr(t)}static init(e){let t=Math.min(3e3,e.doc.length),r=Jr.create(e.facet(rr).parser,e,{from:0,to:t});return r.work(20,t)||r.takeTree(),new Zr(r)}}ii.state=dt.define({create:Zr.init,update(i,e){for(let t of e.effects)if(t.is(ii.setState))return t.value;return e.startState.facet(rr)!=e.state.facet(rr)?Zr.init(e.state):i.apply(e)}});let ip=i=>{let e=setTimeout(()=>i(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(ip=i=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(i,{timeout:500-100})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const dl=typeof navigator<"u"&&!((cl=navigator.scheduling)===null||cl===void 0)&&cl.isInputPending?()=>navigator.scheduling.isInputPending():null,Zw=Qe.fromClass(class{constructor(i){this.view=i,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(i){let e=this.view.state.field(ii.state).context;(e.updateViewport(i.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),(i.docChanged||i.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:i}=this.view,e=i.field(ii.state);(e.tree!=e.context.tree||!e.context.isDone(i.doc.length))&&(this.working=ip(this.work))}work(i){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:t,viewport:{to:r}}=this.view,n=t.field(ii.state);if(n.tree==n.context.tree&&n.context.isDone(r+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,i&&!dl?Math.max(25,i.timeRemaining()-5):1e9),s=n.context.treeLen<r&&t.doc.length>r+1e3,l=n.context.work(()=>dl&&dl()||Date.now()>o,r+(s?0:1e5));this.chunkBudget-=Date.now()-e,(l||this.chunkBudget<=0)&&(n.context.takeTree(),this.view.dispatch({effects:ii.setState.of(new Zr(n.context))})),this.chunkBudget>0&&!(l&&!s)&&this.scheduleWork(),this.checkAsyncSchedule(n.context)}checkAsyncSchedule(i){i.scheduleOn&&(this.workScheduled++,i.scheduleOn.then(()=>this.scheduleWork()).catch(e=>ni(this.view.state,e)).then(()=>this.workScheduled--),i.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),rr=ae.define({combine(i){return i.length?i[0]:null},enables:i=>[ii.state,Zw,oe.contentAttributes.compute([i],e=>{let t=e.facet(i);return t&&t.name?{"data-language":t.name}:{}})]}),rp=ae.define(),$a=ae.define({combine:i=>{if(!i.length)return"  ";let e=i[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(i[0]));return e}});function xr(i){let e=i.facet($a);return e.charCodeAt(0)==9?i.tabSize*e.length:e.length}function Un(i,e){let t="",r=i.tabSize,n=i.facet($a)[0];if(n=="	"){for(;e>=r;)t+="	",e-=r;n=" "}for(let o=0;o<e;o++)t+=n;return t}function Ha(i,e){i instanceof Me&&(i=new Rs(i));for(let r of i.state.facet(rp)){let n=r(i,e);if(n!==void 0)return n}let t=ct(i.state);return t.length>=e?ex(i,t,e):null}class Rs{constructor(e,t={}){this.state=e,this.options=t,this.unit=xr(e)}lineAt(e,t=1){let r=this.state.doc.lineAt(e),{simulateBreak:n,simulateDoubleBreak:o}=this.options;return n!=null&&n>=r.from&&n<=r.to?o&&n==e?{text:"",from:e}:(t<0?n<e:n<=e)?{text:r.text.slice(n-r.from),from:n}:{text:r.text.slice(0,n-r.from),from:r.from}:r}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:n}=this.lineAt(e,t);return r.slice(e-n,Math.min(r.length,e+100-n))}column(e,t=1){let{text:r,from:n}=this.lineAt(e,t),o=this.countColumn(r,e-n),s=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return s>-1&&(o+=s-this.countColumn(r,r.search(/\S|$/))),o}countColumn(e,t=e.length){return eo(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:r,from:n}=this.lineAt(e,t),o=this.options.overrideIndentation;if(o){let s=o(n);if(s>-1)return s}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const Qw=new Le;function ex(i,e,t){let r=e.resolveStack(t),n=r.node.enterUnfinishedNodesBefore(t);if(n!=r.node){let o=[];for(let s=n;s!=r.node;s=s.parent)o.push(s);for(let s=o.length-1;s>=0;s--)r={node:o[s],next:r}}return np(r,i,t)}function np(i,e,t){for(let r=i;r;r=r.next){let n=ix(r.node);if(n)return n(Wa.create(e,t,r))}return 0}function tx(i){return i.pos==i.options.simulateBreak&&i.options.simulateDoubleBreak}function ix(i){let e=i.type.prop(Qw);if(e)return e;let t=i.firstChild,r;if(t&&(r=t.type.prop(Le.closedBy))){let n=i.lastChild,o=n&&r.indexOf(n.name)>-1;return s=>sx(s,!0,1,void 0,o&&!tx(s)?n.from:void 0)}return i.parent==null?rx:null}function rx(){return 0}class Wa extends Rs{constructor(e,t,r){super(e.state,e.options),this.base=e,this.pos=t,this.context=r}get node(){return this.context.node}static create(e,t,r){return new Wa(e,t,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let r=e.resolve(t.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(nx(r,e))break;t=this.state.doc.lineAt(r.from)}return this.lineIndent(t.from)}continue(){return np(this.context.next,this.base,this.pos)}}function nx(i,e){for(let t=e;t;t=t.parent)if(i==t)return!0;return!1}function ox(i){let e=i.node,t=e.childAfter(e.from),r=e.lastChild;if(!t)return null;let n=i.options.simulateBreak,o=i.state.doc.lineAt(t.from),s=n==null||n<=o.from?o.to:Math.min(o.to,n);for(let l=t.to;;){let a=e.childAfter(l);if(!a||a==r)return null;if(!a.type.isSkipped)return a.from<s?t:null;l=a.to}}function sx(i,e,t,r,n){let o=i.textAfter,s=o.match(/^\s*/)[0].length,l=r&&o.slice(s,s+r.length)==r||n==i.pos+s,a=e?ox(i):null;return a?l?i.column(a.from):i.column(a.to):i.baseIndent+(l?0:i.unit*t)}const lx=200;function ax(){return Me.transactionFilter.of(i=>{if(!i.docChanged||!i.isUserEvent("input.type")&&!i.isUserEvent("input.complete"))return i;let e=i.startState.languageDataAt("indentOnInput",i.startState.selection.main.head);if(!e.length)return i;let t=i.newDoc,{head:r}=i.newSelection.main,n=t.lineAt(r);if(r>n.from+lx)return i;let o=t.sliceString(n.from,r);if(!e.some(h=>h.test(o)))return i;let{state:s}=i,l=-1,a=[];for(let{head:h}of s.selection.ranges){let c=s.doc.lineAt(h);if(c.from==l)continue;l=c.from;let d=Ha(s,c.from);if(d==null)continue;let u=/^\s*/.exec(c.text)[0],f=Un(s,d);u!=f&&a.push({from:c.from,to:c.from+u.length,insert:f})}return a.length?[i,{changes:a,sequential:!0}]:i})}const hx=ae.define(),cx=new Le;function dx(i,e,t){let r=ct(i);if(r.length<t)return null;let n=r.resolveStack(t,1),o=null;for(let s=n;s;s=s.next){let l=s.node;if(l.to<=t||l.from>t)continue;if(o&&l.from<e)break;let a=l.type.prop(cx);if(a&&(l.to<r.length-50||r.length==i.doc.length||!ux(l))){let h=a(l,i);h&&h.from<=t&&h.from>=e&&h.to>t&&(o=h)}}return o}function ux(i){let e=i.lastChild;return e&&e.to==i.to&&e.type.isError}function ls(i,e,t){for(let r of i.facet(hx)){let n=r(i,e,t);if(n)return n}return dx(i,e,t)}function op(i,e){let t=e.mapPos(i.from,1),r=e.mapPos(i.to,-1);return t>=r?void 0:{from:t,to:r}}const Ts=xe.define({map:op}),oo=xe.define({map:op});function sp(i){let e=[];for(let{head:t}of i.state.selection.ranges)e.some(r=>r.from<=t&&r.to>=t)||e.push(i.lineBlockAt(t));return e}const kr=dt.define({create(){return ye.none},update(i,e){i=i.map(e.changes);for(let t of e.effects)if(t.is(Ts)&&!fx(i,t.value.from,t.value.to)){let{preparePlaceholder:r}=e.state.facet(Va),n=r?ye.replace({widget:new wx(r(e.state,t.value))}):Xc;i=i.update({add:[n.range(t.value.from,t.value.to)]})}else t.is(oo)&&(i=i.update({filter:(r,n)=>t.value.from!=r||t.value.to!=n,filterFrom:t.value.from,filterTo:t.value.to}));if(e.selection){let t=!1,{head:r}=e.selection.main;i.between(r,r,(n,o)=>{n<r&&o>r&&(t=!0)}),t&&(i=i.update({filterFrom:r,filterTo:r,filter:(n,o)=>o<=r||n>=r}))}return i},provide:i=>oe.decorations.from(i),toJSON(i,e){let t=[];return i.between(0,e.doc.length,(r,n)=>{t.push(r,n)}),t},fromJSON(i){if(!Array.isArray(i)||i.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let t=0;t<i.length;){let r=i[t++],n=i[t++];if(typeof r!="number"||typeof n!="number")throw new RangeError("Invalid JSON for fold state");e.push(Xc.range(r,n))}return ye.set(e,!0)}});function as(i,e,t){var r;let n=null;return(r=i.field(kr,!1))===null||r===void 0||r.between(e,t,(o,s)=>{(!n||n.from>o)&&(n={from:o,to:s})}),n}function fx(i,e,t){let r=!1;return i.between(e,e,(n,o)=>{n==e&&o==t&&(r=!0)}),r}function lp(i,e){return i.field(kr,!1)?e:e.concat(xe.appendConfig.of(hp()))}const px=i=>{for(let e of sp(i)){let t=ls(i.state,e.from,e.to);if(t)return i.dispatch({effects:lp(i.state,[Ts.of(t),ap(i,t)])}),!0}return!1},gx=i=>{if(!i.state.field(kr,!1))return!1;let e=[];for(let t of sp(i)){let r=as(i.state,t.from,t.to);r&&e.push(oo.of(r),ap(i,r,!1))}return e.length&&i.dispatch({effects:e}),e.length>0};function ap(i,e,t=!0){let r=i.state.doc.lineAt(e.from).number,n=i.state.doc.lineAt(e.to).number;return oe.announce.of(`${i.state.phrase(t?"Folded lines":"Unfolded lines")} ${r} ${i.state.phrase("to")} ${n}.`)}const mx=i=>{let{state:e}=i,t=[];for(let r=0;r<e.doc.length;){let n=i.lineBlockAt(r),o=ls(e,n.from,n.to);o&&t.push(Ts.of(o)),r=(o?i.lineBlockAt(o.to):n).to+1}return t.length&&i.dispatch({effects:lp(i.state,t)}),!!t.length},vx=i=>{let e=i.state.field(kr,!1);if(!e||!e.size)return!1;let t=[];return e.between(0,i.state.doc.length,(r,n)=>{t.push(oo.of({from:r,to:n}))}),i.dispatch({effects:t}),!0},bx=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:px},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:gx},{key:"Ctrl-Alt-[",run:mx},{key:"Ctrl-Alt-]",run:vx}],yx={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},Va=ae.define({combine(i){return Ci(i,yx)}});function hp(i){let e=[kr,Sx];return i&&e.push(Va.of(i)),e}function cp(i,e){let{state:t}=i,r=t.facet(Va),n=s=>{let l=i.lineBlockAt(i.posAtDOM(s.target)),a=as(i.state,l.from,l.to);a&&i.dispatch({effects:oo.of(a)}),s.preventDefault()};if(r.placeholderDOM)return r.placeholderDOM(i,n,e);let o=document.createElement("span");return o.textContent=r.placeholderText,o.setAttribute("aria-label",t.phrase("folded code")),o.title=t.phrase("unfold"),o.className="cm-foldPlaceholder",o.onclick=n,o}const Xc=ye.replace({widget:new class extends nr{toDOM(i){return cp(i,null)}}});class wx extends nr{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return cp(e,this.value)}}const xx={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class ul extends Bi{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function kx(i={}){let e=Object.assign(Object.assign({},xx),i),t=new ul(e,!0),r=new ul(e,!1),n=Qe.fromClass(class{constructor(s){this.from=s.viewport.from,this.markers=this.buildMarkers(s)}update(s){(s.docChanged||s.viewportChanged||s.startState.facet(rr)!=s.state.facet(rr)||s.startState.field(kr,!1)!=s.state.field(kr,!1)||ct(s.startState)!=ct(s.state)||e.foldingChanged(s))&&(this.markers=this.buildMarkers(s.view))}buildMarkers(s){let l=new Qi;for(let a of s.viewportLineBlocks){let h=as(s.state,a.from,a.to)?r:ls(s.state,a.from,a.to)?t:null;h&&l.add(a.from,a.from,h)}return l.finish()}}),{domEventHandlers:o}=e;return[n,ww({class:"cm-foldGutter",markers(s){var l;return((l=s.plugin(n))===null||l===void 0?void 0:l.markers)||Ee.empty},initialSpacer(){return new ul(e,!1)},domEventHandlers:Object.assign(Object.assign({},o),{click:(s,l,a)=>{if(o.click&&o.click(s,l,a))return!0;let h=as(s.state,l.from,l.to);if(h)return s.dispatch({effects:oo.of(h)}),!0;let c=ls(s.state,l.from,l.to);return c?(s.dispatch({effects:Ts.of(c)}),!0):!1}})}),hp()]}const Sx=oe.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class so{constructor(e,t){this.specs=e;let r;function n(l){let a=_c.newName();return(r||(r=Object.create(null)))["."+a]=l,a}const o=typeof t.all=="string"?t.all:t.all?n(t.all):void 0,s=t.scope;this.scope=s instanceof ii?l=>l.prop(Fr)==s.data:s?l=>l==s:void 0,this.style=tp(e.map(l=>({tag:l.tag,class:l.class||n(Object.assign({},l,{tag:null}))})),{all:o}).style,this.module=r?new _c(r):null,this.themeType=t.themeType}static define(e,t){return new so(e,t||{})}}const ha=ae.define(),dp=ae.define({combine(i){return i.length?[i[0]]:null}});function fl(i){let e=i.facet(ha);return e.length?e:i.facet(dp)}function up(i,e){let t=[Ax],r;return i instanceof so&&(i.module&&t.push(oe.styleModule.of(i.module)),r=i.themeType),e!=null&&e.fallback?t.push(dp.of(i)):r?t.push(ha.computeN([oe.darkTheme],n=>n.facet(oe.darkTheme)==(r=="dark")?[i]:[])):t.push(ha.of(i)),t}class Cx{constructor(e){this.markCache=Object.create(null),this.tree=ct(e.state),this.decorations=this.buildDeco(e,fl(e.state))}update(e){let t=ct(e.state),r=fl(e.state),n=r!=fl(e.startState);t.length<e.view.viewport.to&&!n&&t.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(t!=this.tree||e.viewportChanged||n)&&(this.tree=t,this.decorations=this.buildDeco(e.view,r))}buildDeco(e,t){if(!t||!this.tree.length)return ye.none;let r=new Qi;for(let{from:n,to:o}of e.visibleRanges)_w(this.tree,t,(s,l,a)=>{r.add(s,l,this.markCache[a]||(this.markCache[a]=ye.mark({class:a})))},n,o);return r.finish()}}const Ax=on.high(Qe.fromClass(Cx,{decorations:i=>i.decorations})),Mx=so.define([{tag:E.meta,color:"#404740"},{tag:E.link,textDecoration:"underline"},{tag:E.heading,textDecoration:"underline",fontWeight:"bold"},{tag:E.emphasis,fontStyle:"italic"},{tag:E.strong,fontWeight:"bold"},{tag:E.strikethrough,textDecoration:"line-through"},{tag:E.keyword,color:"#708"},{tag:[E.atom,E.bool,E.url,E.contentSeparator,E.labelName],color:"#219"},{tag:[E.literal,E.inserted],color:"#164"},{tag:[E.string,E.deleted],color:"#a11"},{tag:[E.regexp,E.escape,E.special(E.string)],color:"#e40"},{tag:E.definition(E.variableName),color:"#00f"},{tag:E.local(E.variableName),color:"#30a"},{tag:[E.typeName,E.namespace],color:"#085"},{tag:E.className,color:"#167"},{tag:[E.special(E.variableName),E.macroName],color:"#256"},{tag:E.definition(E.propertyName),color:"#00c"},{tag:E.comment,color:"#940"},{tag:E.invalid,color:"#f00"}]),Rx=oe.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),fp=1e4,pp="()[]{}",gp=ae.define({combine(i){return Ci(i,{afterCursor:!0,brackets:pp,maxScanDistance:fp,renderMatch:Ox})}}),Tx=ye.mark({class:"cm-matchingBracket"}),Dx=ye.mark({class:"cm-nonmatchingBracket"});function Ox(i){let e=[],t=i.matched?Tx:Dx;return e.push(t.range(i.start.from,i.start.to)),i.end&&e.push(t.range(i.end.from,i.end.to)),e}const Px=dt.define({create(){return ye.none},update(i,e){if(!e.docChanged&&!e.selection)return i;let t=[],r=e.state.facet(gp);for(let n of e.state.selection.ranges){if(!n.empty)continue;let o=yi(e.state,n.head,-1,r)||n.head>0&&yi(e.state,n.head-1,1,r)||r.afterCursor&&(yi(e.state,n.head,1,r)||n.head<e.state.doc.length&&yi(e.state,n.head+1,-1,r));o&&(t=t.concat(r.renderMatch(o,e.state)))}return ye.set(t,!0)},provide:i=>oe.decorations.from(i)}),Lx=[Px,Rx];function Ex(i={}){return[gp.of(i),Lx]}const Bx=new Le;function ca(i,e,t){let r=i.prop(e<0?Le.openedBy:Le.closedBy);if(r)return r;if(i.name.length==1){let n=t.indexOf(i.name);if(n>-1&&n%2==(e<0?1:0))return[t[n+e]]}return null}function da(i){let e=i.type.prop(Bx);return e?e(i.node):i}function yi(i,e,t,r={}){let n=r.maxScanDistance||fp,o=r.brackets||pp,s=ct(i),l=s.resolveInner(e,t);for(let a=l;a;a=a.parent){let h=ca(a.type,t,o);if(h&&a.from<a.to){let c=da(a);if(c&&(t>0?e>=c.from&&e<c.to:e>c.from&&e<=c.to))return Nx(i,e,t,a,c,h,o)}}return Ix(i,e,t,s,l.type,n,o)}function Nx(i,e,t,r,n,o,s){let l=r.parent,a={from:n.from,to:n.to},h=0,c=l==null?void 0:l.cursor();if(c&&(t<0?c.childBefore(r.from):c.childAfter(r.to)))do if(t<0?c.to<=r.from:c.from>=r.to){if(h==0&&o.indexOf(c.type.name)>-1&&c.from<c.to){let d=da(c);return{start:a,end:d?{from:d.from,to:d.to}:void 0,matched:!0}}else if(ca(c.type,t,s))h++;else if(ca(c.type,-t,s)){if(h==0){let d=da(c);return{start:a,end:d&&d.from<d.to?{from:d.from,to:d.to}:void 0,matched:!1}}h--}}while(t<0?c.prevSibling():c.nextSibling());return{start:a,matched:!1}}function Ix(i,e,t,r,n,o,s){let l=t<0?i.sliceDoc(e-1,e):i.sliceDoc(e,e+1),a=s.indexOf(l);if(a<0||a%2==0!=t>0)return null;let h={from:t<0?e-1:e,to:t>0?e+1:e},c=i.doc.iterRange(e,t>0?i.doc.length:0),d=0;for(let u=0;!c.next().done&&u<=o;){let f=c.value;t<0&&(u+=f.length);let g=e+u*t;for(let y=t>0?0:f.length-1,b=t>0?f.length:-1;y!=b;y+=t){let C=s.indexOf(f[y]);if(!(C<0||r.resolveInner(g+y,1).type!=n))if(C%2==0==t>0)d++;else{if(d==1)return{start:h,end:{from:g+y,to:g+y+1},matched:C>>1==a>>1};d--}}t>0&&(u+=f.length)}return c.done?{start:h,matched:!1}:null}function Yc(i,e,t,r=0,n=0){e==null&&(e=i.search(/[^\s\u00a0]/),e==-1&&(e=i.length));let o=n;for(let s=r;s<e;s++)i.charCodeAt(s)==9?o+=t-o%t:o++;return o}class mp{constructor(e,t,r,n){this.string=e,this.tabSize=t,this.indentUnit=r,this.overrideIndent=n,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return this.pos==0}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(e){let t=this.string.charAt(this.pos),r;if(typeof e=="string"?r=t==e:r=t&&(e instanceof RegExp?e.test(t):e(t)),r)return++this.pos,t}eatWhile(e){let t=this.pos;for(;this.eat(e););return this.pos>t}eatSpace(){let e=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e}skipToEnd(){this.pos=this.string.length}skipTo(e){let t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0}backUp(e){this.pos-=e}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Yc(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var e;return(e=this.overrideIndent)!==null&&e!==void 0?e:Yc(this.string,null,this.tabSize)}match(e,t,r){if(typeof e=="string"){let n=s=>r?s.toLowerCase():s,o=this.string.substr(this.pos,e.length);return n(o)==n(e)?(t!==!1&&(this.pos+=e.length),!0):null}else{let n=this.string.slice(this.pos).match(e);return n&&n.index>0?null:(n&&t!==!1&&(this.pos+=n[0].length),n)}}current(){return this.string.slice(this.start,this.pos)}}function zx(i){return{name:i.name||"",token:i.token,blankLine:i.blankLine||(()=>{}),startState:i.startState||(()=>!0),copyState:i.copyState||Fx,indent:i.indent||(()=>null),languageData:i.languageData||{},tokenTable:i.tokenTable||_a}}function Fx(i){if(typeof i!="object")return i;let e={};for(let t in i){let r=i[t];e[t]=r instanceof Array?r.slice():r}return e}const Jc=new WeakMap;class ja extends ii{constructor(e){let t=Xw(e.languageData),r=zx(e),n,o=new class extends Qf{createParse(s,l,a){return new Hx(n,s,l,a)}};super(t,o,[rp.of((s,l)=>this.getIndent(s,l))],e.name),this.topNode=jx(t),n=this,this.streamParser=r,this.stateAfter=new Le({perNode:!0}),this.tokenTable=e.tokenTable?new wp(r.tokenTable):Vx}static define(e){return new ja(e)}getIndent(e,t){let r=ct(e.state),n=r.resolve(t);for(;n&&n.type!=this.topNode;)n=n.parent;if(!n)return null;let o,{overrideIndentation:s}=e.options;s&&(o=Jc.get(e.state),o!=null&&o<t-1e4&&(o=void 0));let l=Ua(this,r,0,n.from,o??t),a,h;if(l?(h=l.state,a=l.pos+1):(h=this.streamParser.startState(e.unit),a=0),t-a>1e4)return null;for(;a<t;){let d=e.state.doc.lineAt(a),u=Math.min(t,d.to);if(d.length){let f=s?s(d.from):-1,g=new mp(d.text,e.state.tabSize,e.unit,f<0?void 0:f);for(;g.pos<u-d.from;)bp(this.streamParser.token,g,h)}else this.streamParser.blankLine(h,e.unit);if(u==t)break;a=d.to+1}let c=e.lineAt(t);return s&&o==null&&Jc.set(e.state,c.from),this.streamParser.indent(h,/^\s*(.*)/.exec(c.text)[1],e)}get allowsNesting(){return!1}}function Ua(i,e,t,r,n){let o=t>=r&&t+e.length<=n&&e.prop(i.stateAfter);if(o)return{state:i.streamParser.copyState(o),pos:t+e.length};for(let s=e.children.length-1;s>=0;s--){let l=e.children[s],a=t+e.positions[s],h=l instanceof Ze&&a<n&&Ua(i,l,a,r,n);if(h)return h}return null}function vp(i,e,t,r,n){if(n&&t<=0&&r>=e.length)return e;!n&&e.type==i.topNode&&(n=!0);for(let o=e.children.length-1;o>=0;o--){let s=e.positions[o],l=e.children[o],a;if(s<r&&l instanceof Ze){if(!(a=vp(i,l,t-s,r-s,n)))break;return n?new Ze(e.type,e.children.slice(0,o).concat(a),e.positions.slice(0,o+1),s+a.length):a}}return null}function $x(i,e,t,r){for(let n of e){let o=n.from+(n.openStart?25:0),s=n.to-(n.openEnd?25:0),l=o<=t&&s>t&&Ua(i,n.tree,0-n.offset,t,s),a;if(l&&(a=vp(i,n.tree,t+n.offset,l.pos+n.offset,!1)))return{state:l.state,tree:a}}return{state:i.streamParser.startState(r?xr(r):4),tree:Ze.empty}}class Hx{constructor(e,t,r,n){this.lang=e,this.input=t,this.fragments=r,this.ranges=n,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=n[n.length-1].to;let o=Jr.get(),s=n[0].from,{state:l,tree:a}=$x(e,r,s,o==null?void 0:o.state);this.state=l,this.parsedPos=this.chunkStart=s+a.length;for(let h=0;h<a.children.length;h++)this.chunks.push(a.children[h]),this.chunkPos.push(a.positions[h]);o&&this.parsedPos<o.viewport.from-1e5&&(this.state=this.lang.streamParser.startState(xr(o.state)),o.skipUntilInView(this.parsedPos,o.viewport.from),this.parsedPos=o.viewport.from),this.moveRangeIndex()}advance(){let e=Jr.get(),t=this.stoppedAt==null?this.to:Math.min(this.to,this.stoppedAt),r=Math.min(t,this.chunkStart+2048);for(e&&(r=Math.min(r,e.viewport.to));this.parsedPos<r;)this.parseLine(e);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=t?this.finish():e&&this.parsedPos>=e.viewport.to?(e.skipUntilInView(this.parsedPos,t),this.finish()):null}stopAt(e){this.stoppedAt=e}lineAfter(e){let t=this.input.chunk(e);if(this.input.lineChunks)t==`
`&&(t="");else{let r=t.indexOf(`
`);r>-1&&(t=t.slice(0,r))}return e+t.length<=this.to?t:t.slice(0,this.to-e)}nextLine(){let e=this.parsedPos,t=this.lineAfter(e),r=e+t.length;for(let n=this.rangeIndex;;){let o=this.ranges[n].to;if(o>=r||(t=t.slice(0,o-(r-t.length)),n++,n==this.ranges.length))break;let s=this.ranges[n].from,l=this.lineAfter(s);t+=l,r=s+l.length}return{line:t,end:r}}skipGapsTo(e,t,r){for(;;){let n=this.ranges[this.rangeIndex].to,o=e+t;if(r>0?n>o:n>=o)break;let s=this.ranges[++this.rangeIndex].from;t+=s-n}return t}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(e,t,r,n,o){if(this.ranges.length>1){o=this.skipGapsTo(t,o,1),t+=o;let s=this.chunk.length;o=this.skipGapsTo(r,o,-1),r+=o,n+=this.chunk.length-s}return this.chunk.push(e,t,r,n),o}parseLine(e){let{line:t,end:r}=this.nextLine(),n=0,{streamParser:o}=this.lang,s=new mp(t,e?e.state.tabSize:4,e?xr(e.state):2);if(s.eol())o.blankLine(this.state,s.indentUnit);else for(;!s.eol();){let l=bp(o.token,s,this.state);if(l&&(n=this.emitToken(this.lang.tokenTable.resolve(l),this.parsedPos+s.start,this.parsedPos+s.pos,4,n)),s.start>1e4)break}this.parsedPos=r,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let e=Ze.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:Wx,topID:0,maxBufferLength:2048,reused:this.chunkReused});e=new Ze(e.type,e.children,e.positions,e.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(e),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new Ze(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function bp(i,e,t){e.start=e.pos;for(let r=0;r<10;r++){let n=i(e,t);if(e.pos>e.start)return n}throw new Error("Stream parser failed to advance stream.")}const _a=Object.create(null),_n=[Jt.none],Wx=new Ia(_n),Zc=[],yp=Object.create(null);for(let[i,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])yp[i]=xp(_a,e);class wp{constructor(e){this.extra=e,this.table=Object.assign(Object.create(null),yp)}resolve(e){return e?this.table[e]||(this.table[e]=xp(this.extra,e)):0}}const Vx=new wp(_a);function pl(i,e){Zc.indexOf(i)>-1||(Zc.push(i),console.warn(e))}function xp(i,e){let t=null;for(let o of e.split(".")){let s=i[o]||E[o];s?typeof s=="function"?t?t=s(t):pl(o,`Modifier ${o} used at start of tag`):t?pl(o,`Tag ${o} used as modifier`):t=s:pl(o,`Unknown highlighting tag ${o}`)}if(!t)return 0;let r=e.replace(/ /g,"_"),n=Jt.define({id:_n.length,name:r,props:[jw({[r]:t})]});return _n.push(n),n.id}function jx(i){let e=Jt.define({id:_n.length,name:"Document",props:[Fr.add(()=>i)],top:!0});return _n.push(e),e}const Ux=1024;let _x=0;class je{constructor(e={}){this.id=_x++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=Ni.match(e)),t=>{let r=e(t);return r===void 0?null:[this,r]}}}je.closedBy=new je({deserialize:i=>i.split(" ")});je.openedBy=new je({deserialize:i=>i.split(" ")});je.group=new je({deserialize:i=>i.split(" ")});je.contextHash=new je({perNode:!0});je.lookAhead=new je({perNode:!0});je.mounted=new je({perNode:!0});const Kx=Object.create(null);class Ni{constructor(e,t,r,n=0){this.name=e,this.props=t,this.id=r,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):Kx,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),n=new Ni(e.name||"",t,e.id,r);if(e.props){for(let o of e.props)if(Array.isArray(o)||(o=o(n)),o){if(o[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[o[0].id]=o[1]}}return n}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(je.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let n of r.split(" "))t[n]=e[r];return r=>{for(let n=r.prop(je.group),o=-1;o<(n?n.length:0);o++){let s=t[o<0?r.name:n[o]];if(s)return s}}}}Ni.none=new Ni("",Object.create(null),0,8);const Do=new WeakMap,Qc=new WeakMap;var St;(function(i){i[i.ExcludeBuffers=1]="ExcludeBuffers",i[i.IncludeAnonymous=2]="IncludeAnonymous",i[i.IgnoreMounts=4]="IgnoreMounts",i[i.IgnoreOverlays=8]="IgnoreOverlays"})(St||(St={}));class ki{constructor(e,t,r,n,o){if(this.type=e,this.children=t,this.positions=r,this.length=n,this.props=null,o&&o.length){this.props=Object.create(null);for(let[s,l]of o)this.props[typeof s=="number"?s:s.id]=l}}toString(){let e=this.prop(je.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let r of this.children){let n=r.toString();n&&(t&&(t+=","),t+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new ds(this.topNode,e)}cursorAt(e,t=0,r=0){let n=Do.get(this)||this.topNode,o=new ds(n);return o.moveTo(e,t),Do.set(this,o._tree),o}get topNode(){return new Di(this,0,0,null)}resolve(e,t=0){let r=Qr(Do.get(this)||this.topNode,e,t,!1);return Do.set(this,r),r}resolveInner(e,t=0){let r=Qr(Qc.get(this)||this.topNode,e,t,!0);return Qc.set(this,r),r}iterate(e){let{enter:t,leave:r,from:n=0,to:o=this.length}=e;for(let s=this.cursor((e.mode||0)|St.IncludeAnonymous);;){let l=!1;if(s.from<=o&&s.to>=n&&(s.type.isAnonymous||t(s)!==!1)){if(s.firstChild())continue;l=!0}for(;l&&r&&!s.type.isAnonymous&&r(s),!s.nextSibling();){if(!s.parent())return;l=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:Ga(Ni.none,this.children,this.positions,0,this.children.length,0,this.length,(t,r,n)=>new ki(this.type,t,r,n,this.propValues),e.makeTree||((t,r,n)=>new ki(Ni.none,t,r,n)))}static build(e){return Gx(e)}}ki.empty=new ki(Ni.none,[],[],0);class Ka{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Ka(this.buffer,this.index)}}class Cr{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return Ni.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],n=this.set.types[t],o=n.name;if(/\W/.test(o)&&!n.isError&&(o=JSON.stringify(o)),e+=4,r==e)return o;let s=[];for(;e<r;)s.push(this.childString(e)),e=this.buffer[e+3];return o+"("+s.join(",")+")"}findChild(e,t,r,n,o){let{buffer:s}=this,l=-1;for(let a=e;a!=t&&!(kp(o,n,s[a+1],s[a+2])&&(l=a,r>0));a=s[a+3]);return l}slice(e,t,r){let n=this.buffer,o=new Uint16Array(t-e),s=0;for(let l=e,a=0;l<t;){o[a++]=n[l++],o[a++]=n[l++]-r;let h=o[a++]=n[l++]-r;o[a++]=n[l++]-e,s=Math.max(s,h)}return new Cr(o,s,this.set)}}function kp(i,e,t,r){switch(i){case-2:return t<e;case-1:return r>=e&&t<e;case 0:return t<e&&r>e;case 1:return t<=e&&r>e;case 2:return r>e;case 4:return!0}}function Sp(i,e){let t=i.childBefore(e);for(;t;){let r=t.lastChild;if(!r||r.to!=t.to)break;r.type.isError&&r.from==r.to?(i=t,t=r.prevSibling):t=r}return i}function Qr(i,e,t,r){for(var n;i.from==i.to||(t<1?i.from>=e:i.from>e)||(t>-1?i.to<=e:i.to<e);){let s=!r&&i instanceof Di&&i.index<0?null:i.parent;if(!s)return i;i=s}let o=r?0:St.IgnoreOverlays;if(r)for(let s=i,l=s.parent;l;s=l,l=s.parent)s instanceof Di&&s.index<0&&((n=l.enter(e,t,o))===null||n===void 0?void 0:n.from)!=s.from&&(i=l);for(;;){let s=i.enter(e,t,o);if(!s)return i;i=s}}class Di{constructor(e,t,r,n){this._tree=e,this.from=t,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,n,o=0){for(let s=this;;){for(let{children:l,positions:a}=s._tree,h=t>0?l.length:-1;e!=h;e+=t){let c=l[e],d=a[e]+s.from;if(kp(n,r,d,d+c.length)){if(c instanceof Cr){if(o&St.ExcludeBuffers)continue;let u=c.findChild(0,c.buffer.length,t,r-d,n);if(u>-1)return new Yi(new qx(s,c,e,d),null,u)}else if(o&St.IncludeAnonymous||!c.type.isAnonymous||qa(c)){let u;if(!(o&St.IgnoreMounts)&&c.props&&(u=c.prop(je.mounted))&&!u.overlay)return new Di(u.tree,d,e,s);let f=new Di(c,d,e,s);return o&St.IncludeAnonymous||!f.type.isAnonymous?f:f.nextChild(t<0?c.children.length-1:0,t,r,n)}}}if(o&St.IncludeAnonymous||!s.type.isAnonymous||(s.index>=0?e=s.index+t:e=t<0?-1:s._parent._tree.children.length,s=s._parent,!s))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,r=0){let n;if(!(r&St.IgnoreOverlays)&&(n=this._tree.prop(je.mounted))&&n.overlay){let o=e-this.from;for(let{from:s,to:l}of n.overlay)if((t>0?s<=o:s<o)&&(t<0?l>=o:l>o))return new Di(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new ds(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,t=0){return Qr(this,e,t,!1)}resolveInner(e,t=0){return Qr(this,e,t,!0)}enterUnfinishedNodesBefore(e){return Sp(this,e)}getChild(e,t=null,r=null){let n=hs(this,e,t,r);return n.length?n[0]:null}getChildren(e,t=null,r=null){return hs(this,e,t,r)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return cs(this,e)}}function hs(i,e,t,r){let n=i.cursor(),o=[];if(!n.firstChild())return o;if(t!=null){for(;!n.type.is(t);)if(!n.nextSibling())return o}for(;;){if(r!=null&&n.type.is(r))return o;if(n.type.is(e)&&o.push(n.node),!n.nextSibling())return r==null?o:[]}}function cs(i,e,t=e.length-1){for(let r=i.parent;t>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[t]&&e[t]!=r.name)return!1;t--}}return!0}class qx{constructor(e,t,r,n){this.parent=e,this.buffer=t,this.index=r,this.start=n}}class Yi{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:n}=this.context,o=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,r);return o<0?null:new Yi(this.context,this,o)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,r=0){if(r&St.ExcludeBuffers)return null;let{buffer:n}=this.context,o=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return o<0?null:new Yi(this.context,this,o)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new Yi(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new Yi(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}cursor(e=0){return new ds(this,e)}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,n=this.index+4,o=r.buffer[this.index+3];if(o>n){let s=r.buffer[this.index+1];e.push(r.slice(n,o,s)),t.push(0)}return new ki(this.type,e,t,this.to-this.from)}resolve(e,t=0){return Qr(this,e,t,!1)}resolveInner(e,t=0){return Qr(this,e,t,!0)}enterUnfinishedNodesBefore(e){return Sp(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,r=null){let n=hs(this,e,t,r);return n.length?n[0]:null}getChildren(e,t=null,r=null){return hs(this,e,t,r)}get node(){return this}matchContext(e){return cs(this,e)}}class ds{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof Di)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:r,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=r+n.buffer[e+1],this.to=r+n.buffer[e+2],!0}yield(e){return e?e instanceof Di?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,r,this.mode));let{buffer:n}=this.buffer,o=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,r);return o<0?!1:(this.stack.push(this.index),this.yieldBuf(o))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,r=this.mode){return this.buffer?r&St.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&St.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&St.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,r=this.stack.length-1;if(e<0){let n=r<0?0:this.stack[r]+4;if(this.index!=n)return this.yieldBuf(t.findChild(n,this.index,-1,0,4))}else{let n=t.buffer[this.index+3];if(n<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(n)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,r,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let o=0;o<this.index;o++)if(n.buffer.buffer[o+3]<this.index)return!1;({index:t,parent:r}=n)}else({index:t,_parent:r}=this._tree);for(;r;{index:t,_parent:r}=r)if(t>-1)for(let o=t+e,s=e<0?-1:r._tree.children.length;o!=s;o+=e){let l=r._tree.children[o];if(this.mode&St.IncludeAnonymous||l instanceof Cr||!l.type.isAnonymous||qa(l))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer)e:for(let n=this.index,o=this.stack.length;o>=0;){for(let s=e;s;s=s._parent)if(s.index==n){if(n==this.index)return s;t=s,r=o+1;break e}n=this.stack[--o]}for(let n=r;n<this.stack.length;n++)t=new Yi(this.buffer,t,this.stack[n]);return this.bufferNode=new Yi(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let r=0;;){let n=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(n=!0)}for(;n&&t&&t(this),n=this.type.isAnonymous,!this.nextSibling();){if(!r)return;this.parent(),r--,n=!0}}}matchContext(e){if(!this.buffer)return cs(this.node,e);let{buffer:t}=this.buffer,{types:r}=t.set;for(let n=e.length-1,o=this.stack.length-1;n>=0;o--){if(o<0)return cs(this.node,e,n);let s=r[t.buffer[this.stack[o]]];if(!s.isAnonymous){if(e[n]&&e[n]!=s.name)return!1;n--}}return!0}}function qa(i){return i.children.some(e=>e instanceof Cr||!e.type.isAnonymous||qa(e))}function Gx(i){var e;let{buffer:t,nodeSet:r,maxBufferLength:n=Ux,reused:o=[],minRepeatType:s=r.types.length}=i,l=Array.isArray(t)?new Ka(t,t.length):t,a=r.types,h=0,c=0;function d(A,S,k,v,R){let{id:m,start:N,end:V,size:J}=l,U=c;for(;J<0;)if(l.next(),J==-1){let X=o[m];k.push(X),v.push(N-A);return}else if(J==-3){h=m;return}else if(J==-4){c=m;return}else throw new RangeError(`Unrecognized record size: ${J}`);let re=a[m],te,$,ne=N-A;if(V-N<=n&&($=y(l.pos-S,R))){let X=new Uint16Array($.size-$.skip),Z=l.pos-$.size,P=X.length;for(;l.pos>Z;)P=b($.start,X,P);te=new Cr(X,V-$.start,r),ne=$.start-A}else{let X=l.pos-J;l.next();let Z=[],P=[],W=m>=s?m:-1,K=0,fe=V;for(;l.pos>X;)W>=0&&l.id==W&&l.size>=0?(l.end<=fe-n&&(f(Z,P,N,K,l.end,fe,W,U),K=Z.length,fe=l.end),l.next()):d(N,X,Z,P,W);if(W>=0&&K>0&&K<Z.length&&f(Z,P,N,K,N,fe,W,U),Z.reverse(),P.reverse(),W>-1&&K>0){let Ge=u(re);te=Ga(re,Z,P,0,Z.length,0,V-N,Ge,Ge)}else te=g(re,Z,P,V-N,U-V)}k.push(te),v.push(ne)}function u(A){return(S,k,v)=>{let R=0,m=S.length-1,N,V;if(m>=0&&(N=S[m])instanceof ki){if(!m&&N.type==A&&N.length==v)return N;(V=N.prop(je.lookAhead))&&(R=k[m]+N.length+V)}return g(A,S,k,v,R)}}function f(A,S,k,v,R,m,N,V){let J=[],U=[];for(;A.length>v;)J.push(A.pop()),U.push(S.pop()+k-R);A.push(g(r.types[N],J,U,m-R,V-m)),S.push(R-k)}function g(A,S,k,v,R=0,m){if(h){let N=[je.contextHash,h];m=m?[N].concat(m):[N]}if(R>25){let N=[je.lookAhead,R];m=m?[N].concat(m):[N]}return new ki(A,S,k,v,m)}function y(A,S){let k=l.fork(),v=0,R=0,m=0,N=k.end-n,V={size:0,start:0,skip:0};e:for(let J=k.pos-A;k.pos>J;){let U=k.size;if(k.id==S&&U>=0){V.size=v,V.start=R,V.skip=m,m+=4,v+=4,k.next();continue}let re=k.pos-U;if(U<0||re<J||k.start<N)break;let te=k.id>=s?4:0,$=k.start;for(k.next();k.pos>re;){if(k.size<0)if(k.size==-3)te+=4;else break e;else k.id>=s&&(te+=4);k.next()}R=$,v+=U,m+=te}return(S<0||v==A)&&(V.size=v,V.start=R,V.skip=m),V.size>4?V:void 0}function b(A,S,k){let{id:v,start:R,end:m,size:N}=l;if(l.next(),N>=0&&v<s){let V=k;if(N>4){let J=l.pos-(N-4);for(;l.pos>J;)k=b(A,S,k)}S[--k]=V,S[--k]=m-A,S[--k]=R-A,S[--k]=v}else N==-3?h=v:N==-4&&(c=v);return k}let C=[],D=[];for(;l.pos>0;)d(i.start||0,i.bufferStart||0,C,D,-1);let T=(e=i.length)!==null&&e!==void 0?e:C.length?D[0]+C[0].length:0;return new ki(a[i.topID],C.reverse(),D.reverse(),T)}const ed=new WeakMap;function _o(i,e){if(!i.isAnonymous||e instanceof Cr||e.type!=i)return 1;let t=ed.get(e);if(t==null){t=1;for(let r of e.children){if(r.type!=i||!(r instanceof ki)){t=1;break}t+=_o(i,r)}ed.set(e,t)}return t}function Ga(i,e,t,r,n,o,s,l,a){let h=0;for(let g=r;g<n;g++)h+=_o(i,e[g]);let c=Math.ceil(h*1.5/8),d=[],u=[];function f(g,y,b,C,D){for(let T=b;T<C;){let A=T,S=y[T],k=_o(i,g[T]);for(T++;T<C;T++){let v=_o(i,g[T]);if(k+v>=c)break;k+=v}if(T==A+1){if(k>c){let v=g[A];f(v.children,v.positions,0,v.children.length,y[A]+D);continue}d.push(g[A])}else{let v=y[T-1]+g[T-1].length-S;d.push(Ga(i,g,y,A,T,S,v,null,a))}u.push(S+D-o)}}return f(e,t,r,n,0),(l||a)(d,u,s)}new je({perNode:!0});const Xx=i=>{let{state:e}=i,t=e.doc.lineAt(e.selection.main.from),r=Ya(i.state,t.from);return r.line?Yx(i):r.block?Zx(i):!1};function Xa(i,e){return({state:t,dispatch:r})=>{if(t.readOnly)return!1;let n=i(e,t);return n?(r(t.update(n)),!0):!1}}const Yx=Xa(tk,0),Jx=Xa(Cp,0),Zx=Xa((i,e)=>Cp(i,e,ek(e)),0);function Ya(i,e){let t=i.languageDataAt("commentTokens",e);return t.length?t[0]:{}}const wn=50;function Qx(i,{open:e,close:t},r,n){let o=i.sliceDoc(r-wn,r),s=i.sliceDoc(n,n+wn),l=/\s*$/.exec(o)[0].length,a=/^\s*/.exec(s)[0].length,h=o.length-l;if(o.slice(h-e.length,h)==e&&s.slice(a,a+t.length)==t)return{open:{pos:r-l,margin:l&&1},close:{pos:n+a,margin:a&&1}};let c,d;n-r<=2*wn?c=d=i.sliceDoc(r,n):(c=i.sliceDoc(r,r+wn),d=i.sliceDoc(n-wn,n));let u=/^\s*/.exec(c)[0].length,f=/\s*$/.exec(d)[0].length,g=d.length-f-t.length;return c.slice(u,u+e.length)==e&&d.slice(g,g+t.length)==t?{open:{pos:r+u+e.length,margin:/\s/.test(c.charAt(u+e.length))?1:0},close:{pos:n-f-t.length,margin:/\s/.test(d.charAt(g-1))?1:0}}:null}function ek(i){let e=[];for(let t of i.selection.ranges){let r=i.doc.lineAt(t.from),n=t.to<=r.to?r:i.doc.lineAt(t.to),o=e.length-1;o>=0&&e[o].to>r.from?e[o].to=n.to:e.push({from:r.from+/^\s*/.exec(r.text)[0].length,to:n.to})}return e}function Cp(i,e,t=e.selection.ranges){let r=t.map(o=>Ya(e,o.from).block);if(!r.every(o=>o))return null;let n=t.map((o,s)=>Qx(e,r[s],o.from,o.to));if(i!=2&&!n.every(o=>o))return{changes:e.changes(t.map((o,s)=>n[s]?[]:[{from:o.from,insert:r[s].open+" "},{from:o.to,insert:" "+r[s].close}]))};if(i!=1&&n.some(o=>o)){let o=[];for(let s=0,l;s<n.length;s++)if(l=n[s]){let a=r[s],{open:h,close:c}=l;o.push({from:h.pos-a.open.length,to:h.pos+h.margin},{from:c.pos-c.margin,to:c.pos+a.close.length})}return{changes:o}}return null}function tk(i,e,t=e.selection.ranges){let r=[],n=-1;for(let{from:o,to:s}of t){let l=r.length,a=1e9,h=Ya(e,o).line;if(h){for(let c=o;c<=s;){let d=e.doc.lineAt(c);if(d.from>n&&(o==s||s>d.from)){n=d.from;let u=/^\s*/.exec(d.text)[0].length,f=u==d.length,g=d.text.slice(u,u+h.length)==h?u:-1;u<d.text.length&&u<a&&(a=u),r.push({line:d,comment:g,token:h,indent:u,empty:f,single:!1})}c=d.to+1}if(a<1e9)for(let c=l;c<r.length;c++)r[c].indent<r[c].line.text.length&&(r[c].indent=a);r.length==l+1&&(r[l].single=!0)}}if(i!=2&&r.some(o=>o.comment<0&&(!o.empty||o.single))){let o=[];for(let{line:l,token:a,indent:h,empty:c,single:d}of r)(d||!c)&&o.push({from:l.from+h,insert:a+" "});let s=e.changes(o);return{changes:s,selection:e.selection.map(s,1)}}else if(i!=1&&r.some(o=>o.comment>=0)){let o=[];for(let{line:s,comment:l,token:a}of r)if(l>=0){let h=s.from+l,c=h+a.length;s.text[c-s.from]==" "&&c++,o.push({from:h,to:c})}return{changes:o}}return null}const ua=zi.define(),ik=zi.define(),rk=ae.define(),Ap=ae.define({combine(i){return Ci(i,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(r,n)=>e(r,n)||t(r,n)})}});function nk(i){let e=0;return i.iterChangedRanges((t,r)=>e=r),e}const Mp=dt.define({create(){return wi.empty},update(i,e){let t=e.state.facet(Ap),r=e.annotation(ua);if(r){let a=e.docChanged?F.single(nk(e.changes)):void 0,h=Bt.fromTransaction(e,a),c=r.side,d=c==0?i.undone:i.done;return h?d=us(d,d.length,t.minDepth,h):d=Dp(d,e.startState.selection),new wi(c==0?r.rest:d,c==0?d:r.rest)}let n=e.annotation(ik);if((n=="full"||n=="before")&&(i=i.isolate()),e.annotation(rt.addToHistory)===!1)return e.changes.empty?i:i.addMapping(e.changes.desc);let o=Bt.fromTransaction(e),s=e.annotation(rt.time),l=e.annotation(rt.userEvent);return o?i=i.addChanges(o,s,l,t,e):e.selection&&(i=i.addSelection(e.startState.selection,s,l,t.newGroupDelay)),(n=="full"||n=="after")&&(i=i.isolate()),i},toJSON(i){return{done:i.done.map(e=>e.toJSON()),undone:i.undone.map(e=>e.toJSON())}},fromJSON(i){return new wi(i.done.map(Bt.fromJSON),i.undone.map(Bt.fromJSON))}});function ok(i={}){return[Mp,Ap.of(i),oe.domEventHandlers({beforeinput(e,t){let r=e.inputType=="historyUndo"?Rp:e.inputType=="historyRedo"?fa:null;return r?(e.preventDefault(),r(t)):!1}})]}function Ds(i,e){return function({state:t,dispatch:r}){if(!e&&t.readOnly)return!1;let n=t.field(Mp,!1);if(!n)return!1;let o=n.pop(i,t,e);return o?(r(o),!0):!1}}const Rp=Ds(0,!1),fa=Ds(1,!1),sk=Ds(0,!0),lk=Ds(1,!0);class Bt{constructor(e,t,r,n,o){this.changes=e,this.effects=t,this.mapped=r,this.startSelection=n,this.selectionsAfter=o}setSelAfter(e){return new Bt(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,r;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(r=this.startSelection)===null||r===void 0?void 0:r.toJSON(),selectionsAfter:this.selectionsAfter.map(n=>n.toJSON())}}static fromJSON(e){return new Bt(e.changes&&it.fromJSON(e.changes),[],e.mapped&&xi.fromJSON(e.mapped),e.startSelection&&F.fromJSON(e.startSelection),e.selectionsAfter.map(F.fromJSON))}static fromTransaction(e,t){let r=Xt;for(let n of e.startState.facet(rk)){let o=n(e);o.length&&(r=r.concat(o))}return!r.length&&e.changes.empty?null:new Bt(e.changes.invert(e.startState.doc),r,void 0,t||e.startState.selection,Xt)}static selection(e){return new Bt(void 0,Xt,void 0,void 0,e)}}function us(i,e,t,r){let n=e+1>t+20?e-t-1:0,o=i.slice(n,e);return o.push(r),o}function ak(i,e){let t=[],r=!1;return i.iterChangedRanges((n,o)=>t.push(n,o)),e.iterChangedRanges((n,o,s,l)=>{for(let a=0;a<t.length;){let h=t[a++],c=t[a++];l>=h&&s<=c&&(r=!0)}}),r}function hk(i,e){return i.ranges.length==e.ranges.length&&i.ranges.filter((t,r)=>t.empty!=e.ranges[r].empty).length===0}function Tp(i,e){return i.length?e.length?i.concat(e):i:e}const Xt=[],ck=200;function Dp(i,e){if(i.length){let t=i[i.length-1],r=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-ck));return r.length&&r[r.length-1].eq(e)?i:(r.push(e),us(i,i.length-1,1e9,t.setSelAfter(r)))}else return[Bt.selection([e])]}function dk(i){let e=i[i.length-1],t=i.slice();return t[i.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function gl(i,e){if(!i.length)return i;let t=i.length,r=Xt;for(;t;){let n=uk(i[t-1],e,r);if(n.changes&&!n.changes.empty||n.effects.length){let o=i.slice(0,t);return o[t-1]=n,o}else e=n.mapped,t--,r=n.selectionsAfter}return r.length?[Bt.selection(r)]:Xt}function uk(i,e,t){let r=Tp(i.selectionsAfter.length?i.selectionsAfter.map(l=>l.map(e)):Xt,t);if(!i.changes)return Bt.selection(r);let n=i.changes.map(e),o=e.mapDesc(i.changes,!0),s=i.mapped?i.mapped.composeDesc(o):o;return new Bt(n,xe.mapEffects(i.effects,e),s,i.startSelection.map(o),r)}const fk=/^(input\.type|delete)($|\.)/;class wi{constructor(e,t,r=0,n=void 0){this.done=e,this.undone=t,this.prevTime=r,this.prevUserEvent=n}isolate(){return this.prevTime?new wi(this.done,this.undone):this}addChanges(e,t,r,n,o){let s=this.done,l=s[s.length-1];return l&&l.changes&&!l.changes.empty&&e.changes&&(!r||fk.test(r))&&(!l.selectionsAfter.length&&t-this.prevTime<n.newGroupDelay&&n.joinToEvent(o,ak(l.changes,e.changes))||r=="input.type.compose")?s=us(s,s.length-1,n.minDepth,new Bt(e.changes.compose(l.changes),Tp(e.effects,l.effects),l.mapped,l.startSelection,Xt)):s=us(s,s.length,n.minDepth,e),new wi(s,Xt,t,r)}addSelection(e,t,r,n){let o=this.done.length?this.done[this.done.length-1].selectionsAfter:Xt;return o.length>0&&t-this.prevTime<n&&r==this.prevUserEvent&&r&&/^select($|\.)/.test(r)&&hk(o[o.length-1],e)?this:new wi(Dp(this.done,e),this.undone,t,r)}addMapping(e){return new wi(gl(this.done,e),gl(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,r){let n=e==0?this.done:this.undone;if(n.length==0)return null;let o=n[n.length-1];if(r&&o.selectionsAfter.length)return t.update({selection:o.selectionsAfter[o.selectionsAfter.length-1],annotations:ua.of({side:e,rest:dk(n)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(o.changes){let s=n.length==1?Xt:n.slice(0,n.length-1);return o.mapped&&(s=gl(s,o.mapped)),t.update({changes:o.changes,selection:o.startSelection,effects:o.effects,annotations:ua.of({side:e,rest:s}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}wi.empty=new wi(Xt,Xt);const pk=[{key:"Mod-z",run:Rp,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:fa,preventDefault:!0},{linux:"Ctrl-Shift-z",run:fa,preventDefault:!0},{key:"Mod-u",run:sk,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:lk,preventDefault:!0}];function sn(i,e){return F.create(i.ranges.map(e),i.mainIndex)}function Ai(i,e){return i.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function li({state:i,dispatch:e},t){let r=sn(i.selection,t);return r.eq(i.selection)?!1:(e(Ai(i,r)),!0)}function Os(i,e){return F.cursor(e?i.to:i.from)}function Op(i,e){return li(i,t=>t.empty?i.moveByChar(t,e):Os(t,e))}function vt(i){return i.textDirectionAt(i.state.selection.main.head)==Ue.LTR}const Pp=i=>Op(i,!vt(i)),Lp=i=>Op(i,vt(i));function Ep(i,e){return li(i,t=>t.empty?i.moveByGroup(t,e):Os(t,e))}const gk=i=>Ep(i,!vt(i)),mk=i=>Ep(i,vt(i));function vk(i,e,t){if(e.type.prop(t))return!0;let r=e.to-e.from;return r&&(r>2||/[^\s,.;:]/.test(i.sliceDoc(e.from,e.to)))||e.firstChild}function Ps(i,e,t){let r=ct(i).resolveInner(e.head),n=t?je.closedBy:je.openedBy;for(let a=e.head;;){let h=t?r.childAfter(a):r.childBefore(a);if(!h)break;vk(i,h,n)?r=h:a=t?h.to:h.from}let o=r.type.prop(n),s,l;return o&&(s=t?yi(i,r.from,1):yi(i,r.to,-1))&&s.matched?l=t?s.end.to:s.end.from:l=t?r.to:r.from,F.cursor(l,t?-1:1)}const bk=i=>li(i,e=>Ps(i.state,e,!vt(i))),yk=i=>li(i,e=>Ps(i.state,e,vt(i)));function Bp(i,e){return li(i,t=>{if(!t.empty)return Os(t,e);let r=i.moveVertically(t,e);return r.head!=t.head?r:i.moveToLineBoundary(t,e)})}const Np=i=>Bp(i,!1),Ip=i=>Bp(i,!0);function zp(i){let e=i.scrollDOM.clientHeight<i.scrollDOM.scrollHeight-2,t=0,r=0,n;if(e){for(let o of i.state.facet(oe.scrollMargins)){let s=o(i);s!=null&&s.top&&(t=Math.max(s==null?void 0:s.top,t)),s!=null&&s.bottom&&(r=Math.max(s==null?void 0:s.bottom,r))}n=i.scrollDOM.clientHeight-t-r}else n=(i.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:t,marginBottom:r,selfScroll:e,height:Math.max(i.defaultLineHeight,n-5)}}function Fp(i,e){let t=zp(i),{state:r}=i,n=sn(r.selection,s=>s.empty?i.moveVertically(s,e,t.height):Os(s,e));if(n.eq(r.selection))return!1;let o;if(t.selfScroll){let s=i.coordsAtPos(r.selection.main.head),l=i.scrollDOM.getBoundingClientRect(),a=l.top+t.marginTop,h=l.bottom-t.marginBottom;s&&s.top>a&&s.bottom<h&&(o=oe.scrollIntoView(n.main.head,{y:"start",yMargin:s.top-a}))}return i.dispatch(Ai(r,n),{effects:o}),!0}const td=i=>Fp(i,!1),pa=i=>Fp(i,!0);function or(i,e,t){let r=i.lineBlockAt(e.head),n=i.moveToLineBoundary(e,t);if(n.head==e.head&&n.head!=(t?r.to:r.from)&&(n=i.moveToLineBoundary(e,t,!1)),!t&&n.head==r.from&&r.length){let o=/^\s*/.exec(i.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;o&&e.head!=r.from+o&&(n=F.cursor(r.from+o))}return n}const wk=i=>li(i,e=>or(i,e,!0)),xk=i=>li(i,e=>or(i,e,!1)),kk=i=>li(i,e=>or(i,e,!vt(i))),Sk=i=>li(i,e=>or(i,e,vt(i))),Ck=i=>li(i,e=>F.cursor(i.lineBlockAt(e.head).from,1)),Ak=i=>li(i,e=>F.cursor(i.lineBlockAt(e.head).to,-1));function Mk(i,e,t){let r=!1,n=sn(i.selection,o=>{let s=yi(i,o.head,-1)||yi(i,o.head,1)||o.head>0&&yi(i,o.head-1,1)||o.head<i.doc.length&&yi(i,o.head+1,-1);if(!s||!s.end)return o;r=!0;let l=s.start.from==o.head?s.end.to:s.end.from;return t?F.range(o.anchor,l):F.cursor(l)});return r?(e(Ai(i,n)),!0):!1}const Rk=({state:i,dispatch:e})=>Mk(i,e,!1);function Zt(i,e){let t=sn(i.state.selection,r=>{let n=e(r);return F.range(r.anchor,n.head,n.goalColumn,n.bidiLevel||void 0)});return t.eq(i.state.selection)?!1:(i.dispatch(Ai(i.state,t)),!0)}function $p(i,e){return Zt(i,t=>i.moveByChar(t,e))}const Hp=i=>$p(i,!vt(i)),Wp=i=>$p(i,vt(i));function Vp(i,e){return Zt(i,t=>i.moveByGroup(t,e))}const Tk=i=>Vp(i,!vt(i)),Dk=i=>Vp(i,vt(i)),Ok=i=>Zt(i,e=>Ps(i.state,e,!vt(i))),Pk=i=>Zt(i,e=>Ps(i.state,e,vt(i)));function jp(i,e){return Zt(i,t=>i.moveVertically(t,e))}const Up=i=>jp(i,!1),_p=i=>jp(i,!0);function Kp(i,e){return Zt(i,t=>i.moveVertically(t,e,zp(i).height))}const id=i=>Kp(i,!1),rd=i=>Kp(i,!0),Lk=i=>Zt(i,e=>or(i,e,!0)),Ek=i=>Zt(i,e=>or(i,e,!1)),Bk=i=>Zt(i,e=>or(i,e,!vt(i))),Nk=i=>Zt(i,e=>or(i,e,vt(i))),Ik=i=>Zt(i,e=>F.cursor(i.lineBlockAt(e.head).from)),zk=i=>Zt(i,e=>F.cursor(i.lineBlockAt(e.head).to)),nd=({state:i,dispatch:e})=>(e(Ai(i,{anchor:0})),!0),od=({state:i,dispatch:e})=>(e(Ai(i,{anchor:i.doc.length})),!0),sd=({state:i,dispatch:e})=>(e(Ai(i,{anchor:i.selection.main.anchor,head:0})),!0),ld=({state:i,dispatch:e})=>(e(Ai(i,{anchor:i.selection.main.anchor,head:i.doc.length})),!0),Fk=({state:i,dispatch:e})=>(e(i.update({selection:{anchor:0,head:i.doc.length},userEvent:"select"})),!0),$k=({state:i,dispatch:e})=>{let t=Es(i).map(({from:r,to:n})=>F.range(r,Math.min(n+1,i.doc.length)));return e(i.update({selection:F.create(t),userEvent:"select"})),!0},Hk=({state:i,dispatch:e})=>{let t=sn(i.selection,r=>{var n;let o=ct(i).resolveInner(r.head,1);for(;!(o.from<r.from&&o.to>=r.to||o.to>r.to&&o.from<=r.from||!(!((n=o.parent)===null||n===void 0)&&n.parent));)o=o.parent;return F.range(o.to,o.from)});return e(Ai(i,t)),!0},Wk=({state:i,dispatch:e})=>{let t=i.selection,r=null;return t.ranges.length>1?r=F.create([t.main]):t.main.empty||(r=F.create([F.cursor(t.main.head)])),r?(e(Ai(i,r)),!0):!1};function Ls(i,e){if(i.state.readOnly)return!1;let t="delete.selection",{state:r}=i,n=r.changeByRange(o=>{let{from:s,to:l}=o;if(s==l){let a=e(s);a<s?(t="delete.backward",a=Oo(i,a,!1)):a>s&&(t="delete.forward",a=Oo(i,a,!0)),s=Math.min(s,a),l=Math.max(l,a)}else s=Oo(i,s,!1),l=Oo(i,l,!0);return s==l?{range:o}:{changes:{from:s,to:l},range:F.cursor(s)}});return n.changes.empty?!1:(i.dispatch(r.update(n,{scrollIntoView:!0,userEvent:t,effects:t=="delete.selection"?oe.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function Oo(i,e,t){if(i instanceof oe)for(let r of i.state.facet(oe.atomicRanges).map(n=>n(i)))r.between(e,e,(n,o)=>{n<e&&o>e&&(e=t?o:n)});return e}const qp=(i,e)=>Ls(i,t=>{let{state:r}=i,n=r.doc.lineAt(t),o,s;if(!e&&t>n.from&&t<n.from+200&&!/[^ \t]/.test(o=n.text.slice(0,t-n.from))){if(o[o.length-1]=="	")return t-1;let l=eo(o,r.tabSize),a=l%xr(r)||xr(r);for(let h=0;h<a&&o[o.length-1-h]==" ";h++)t--;s=t}else s=mt(n.text,t-n.from,e,e)+n.from,s==t&&n.number!=(e?r.doc.lines:1)&&(s+=e?1:-1);return s}),ga=i=>qp(i,!1),Gp=i=>qp(i,!0),Xp=(i,e)=>Ls(i,t=>{let r=t,{state:n}=i,o=n.doc.lineAt(r),s=n.charCategorizer(r);for(let l=null;;){if(r==(e?o.to:o.from)){r==t&&o.number!=(e?n.doc.lines:1)&&(r+=e?1:-1);break}let a=mt(o.text,r-o.from,e)+o.from,h=o.text.slice(Math.min(r,a)-o.from,Math.max(r,a)-o.from),c=s(h);if(l!=null&&c!=l)break;(h!=" "||r!=t)&&(l=c),r=a}return r}),Yp=i=>Xp(i,!1),Vk=i=>Xp(i,!0),Jp=i=>Ls(i,e=>{let t=i.lineBlockAt(e).to;return e<t?t:Math.min(i.state.doc.length,e+1)}),jk=i=>Ls(i,e=>{let t=i.lineBlockAt(e).from;return e>t?t:Math.max(0,e-1)}),Uk=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let t=i.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:Pe.of(["",""])},range:F.cursor(r.from)}));return e(i.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},_k=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let t=i.changeByRange(r=>{if(!r.empty||r.from==0||r.from==i.doc.length)return{range:r};let n=r.from,o=i.doc.lineAt(n),s=n==o.from?n-1:mt(o.text,n-o.from,!1)+o.from,l=n==o.to?n+1:mt(o.text,n-o.from,!0)+o.from;return{changes:{from:s,to:l,insert:i.doc.slice(n,l).append(i.doc.slice(s,n))},range:F.cursor(l)}});return t.changes.empty?!1:(e(i.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Es(i){let e=[],t=-1;for(let r of i.selection.ranges){let n=i.doc.lineAt(r.from),o=i.doc.lineAt(r.to);if(!r.empty&&r.to==o.from&&(o=i.doc.lineAt(r.to-1)),t>=n.number){let s=e[e.length-1];s.to=o.to,s.ranges.push(r)}else e.push({from:n.from,to:o.to,ranges:[r]});t=o.number+1}return e}function Zp(i,e,t){if(i.readOnly)return!1;let r=[],n=[];for(let o of Es(i)){if(t?o.to==i.doc.length:o.from==0)continue;let s=i.doc.lineAt(t?o.to+1:o.from-1),l=s.length+1;if(t){r.push({from:o.to,to:s.to},{from:o.from,insert:s.text+i.lineBreak});for(let a of o.ranges)n.push(F.range(Math.min(i.doc.length,a.anchor+l),Math.min(i.doc.length,a.head+l)))}else{r.push({from:s.from,to:o.from},{from:o.to,insert:i.lineBreak+s.text});for(let a of o.ranges)n.push(F.range(a.anchor-l,a.head-l))}}return r.length?(e(i.update({changes:r,scrollIntoView:!0,selection:F.create(n,i.selection.mainIndex),userEvent:"move.line"})),!0):!1}const Kk=({state:i,dispatch:e})=>Zp(i,e,!1),qk=({state:i,dispatch:e})=>Zp(i,e,!0);function Qp(i,e,t){if(i.readOnly)return!1;let r=[];for(let n of Es(i))t?r.push({from:n.from,insert:i.doc.slice(n.from,n.to)+i.lineBreak}):r.push({from:n.to,insert:i.lineBreak+i.doc.slice(n.from,n.to)});return e(i.update({changes:r,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const Gk=({state:i,dispatch:e})=>Qp(i,e,!1),Xk=({state:i,dispatch:e})=>Qp(i,e,!0),Yk=i=>{if(i.state.readOnly)return!1;let{state:e}=i,t=e.changes(Es(e).map(({from:n,to:o})=>(n>0?n--:o<e.doc.length&&o++,{from:n,to:o}))),r=sn(e.selection,n=>i.moveVertically(n,!0)).map(t);return i.dispatch({changes:t,selection:r,scrollIntoView:!0,userEvent:"delete.line"}),!0};function Jk(i,e){if(/\(\)|\[\]|\{\}/.test(i.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=ct(i).resolveInner(e),r=t.childBefore(e),n=t.childAfter(e),o;return r&&n&&r.to<=e&&n.from>=e&&(o=r.type.prop(je.closedBy))&&o.indexOf(n.name)>-1&&i.doc.lineAt(r.to).from==i.doc.lineAt(n.from).from?{from:r.to,to:n.from}:null}const Zk=eg(!1),Qk=eg(!0);function eg(i){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let r=e.changeByRange(n=>{let{from:o,to:s}=n,l=e.doc.lineAt(o),a=!i&&o==s&&Jk(e,o);i&&(o=s=(s<=l.to?l:e.doc.lineAt(s)).to);let h=new Rs(e,{simulateBreak:o,simulateDoubleBreak:!!a}),c=Ha(h,o);for(c==null&&(c=/^\s*/.exec(e.doc.lineAt(o).text)[0].length);s<l.to&&/\s/.test(l.text[s-l.from]);)s++;a?{from:o,to:s}=a:o>l.from&&o<l.from+100&&!/\S/.test(l.text.slice(0,o))&&(o=l.from);let d=["",Un(e,c)];return a&&d.push(Un(e,h.lineIndent(l.from,-1))),{changes:{from:o,to:s,insert:Pe.of(d)},range:F.cursor(o+1+d[1].length)}});return t(e.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function Ja(i,e){let t=-1;return i.changeByRange(r=>{let n=[];for(let s=r.from;s<=r.to;){let l=i.doc.lineAt(s);l.number>t&&(r.empty||r.to>l.from)&&(e(l,n,r),t=l.number),s=l.to+1}let o=i.changes(n);return{changes:n,range:F.range(o.mapPos(r.anchor,1),o.mapPos(r.head,1))}})}const e2=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let t=Object.create(null),r=new Rs(i,{overrideIndentation:o=>t[o]??-1}),n=Ja(i,(o,s,l)=>{let a=Ha(r,o.from);if(a==null)return;/\S/.test(o.text)||(a=0);let h=/^\s*/.exec(o.text)[0],c=Un(i,a);(h!=c||l.from<o.from+h.length)&&(t[o.from]=a,s.push({from:o.from,to:o.from+h.length,insert:c}))});return n.changes.empty||e(i.update(n,{userEvent:"indent"})),!0},t2=({state:i,dispatch:e})=>i.readOnly?!1:(e(i.update(Ja(i,(t,r)=>{r.push({from:t.from,insert:i.facet($a)})}),{userEvent:"input.indent"})),!0),i2=({state:i,dispatch:e})=>i.readOnly?!1:(e(i.update(Ja(i,(t,r)=>{let n=/^\s*/.exec(t.text)[0];if(!n)return;let o=eo(n,i.tabSize),s=0,l=Un(i,Math.max(0,o-xr(i)));for(;s<n.length&&s<l.length&&n.charCodeAt(s)==l.charCodeAt(s);)s++;r.push({from:t.from+s,to:t.from+n.length,insert:l.slice(s)})}),{userEvent:"delete.dedent"})),!0),r2=[{key:"Ctrl-b",run:Pp,shift:Hp,preventDefault:!0},{key:"Ctrl-f",run:Lp,shift:Wp},{key:"Ctrl-p",run:Np,shift:Up},{key:"Ctrl-n",run:Ip,shift:_p},{key:"Ctrl-a",run:Ck,shift:Ik},{key:"Ctrl-e",run:Ak,shift:zk},{key:"Ctrl-d",run:Gp},{key:"Ctrl-h",run:ga},{key:"Ctrl-k",run:Jp},{key:"Ctrl-Alt-h",run:Yp},{key:"Ctrl-o",run:Uk},{key:"Ctrl-t",run:_k},{key:"Ctrl-v",run:pa}],n2=[{key:"ArrowLeft",run:Pp,shift:Hp,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:gk,shift:Tk,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:kk,shift:Bk,preventDefault:!0},{key:"ArrowRight",run:Lp,shift:Wp,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:mk,shift:Dk,preventDefault:!0},{mac:"Cmd-ArrowRight",run:Sk,shift:Nk,preventDefault:!0},{key:"ArrowUp",run:Np,shift:Up,preventDefault:!0},{mac:"Cmd-ArrowUp",run:nd,shift:sd},{mac:"Ctrl-ArrowUp",run:td,shift:id},{key:"ArrowDown",run:Ip,shift:_p,preventDefault:!0},{mac:"Cmd-ArrowDown",run:od,shift:ld},{mac:"Ctrl-ArrowDown",run:pa,shift:rd},{key:"PageUp",run:td,shift:id},{key:"PageDown",run:pa,shift:rd},{key:"Home",run:xk,shift:Ek,preventDefault:!0},{key:"Mod-Home",run:nd,shift:sd},{key:"End",run:wk,shift:Lk,preventDefault:!0},{key:"Mod-End",run:od,shift:ld},{key:"Enter",run:Zk},{key:"Mod-a",run:Fk},{key:"Backspace",run:ga,shift:ga},{key:"Delete",run:Gp},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Yp},{key:"Mod-Delete",mac:"Alt-Delete",run:Vk},{mac:"Mod-Backspace",run:jk},{mac:"Mod-Delete",run:Jp}].concat(r2.map(i=>({mac:i.key,run:i.run,shift:i.shift}))),o2=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:bk,shift:Ok},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:yk,shift:Pk},{key:"Alt-ArrowUp",run:Kk},{key:"Shift-Alt-ArrowUp",run:Gk},{key:"Alt-ArrowDown",run:qk},{key:"Shift-Alt-ArrowDown",run:Xk},{key:"Escape",run:Wk},{key:"Mod-Enter",run:Qk},{key:"Alt-l",mac:"Ctrl-l",run:$k},{key:"Mod-i",run:Hk,preventDefault:!0},{key:"Mod-[",run:i2},{key:"Mod-]",run:t2},{key:"Mod-Alt-\\",run:e2},{key:"Shift-Mod-k",run:Yk},{key:"Shift-Mod-\\",run:Rk},{key:"Mod-/",run:Xx},{key:"Alt-A",run:Jx}].concat(n2);function Fe(){var i=arguments[0];typeof i=="string"&&(i=document.createElement(i));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=t[r];typeof n=="string"?i.setAttribute(r,n):n!=null&&(i[r]=n)}e++}for(;e<arguments.length;e++)tg(i,arguments[e]);return i}function tg(i,e){if(typeof e=="string")i.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)i.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)tg(i,e[t]);else throw new RangeError("Unsupported child node: "+e)}const ad=typeof String.prototype.normalize=="function"?i=>i.normalize("NFKD"):i=>i;class en{constructor(e,t,r=0,n=e.length,o,s){this.test=s,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(r,n),this.bufferStart=r,this.normalize=o?l=>o(ad(l)):ad,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return lt(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=Ca(e),r=this.bufferStart+this.bufferPos;this.bufferPos+=Gt(e);let n=this.normalize(t);for(let o=0,s=r;;o++){let l=n.charCodeAt(o),a=this.match(l,s);if(a)return this.value=a,this;if(o==n.length-1)break;s==r&&o<t.length&&t.charCodeAt(o)==l&&s++}}}match(e,t){let r=null;for(let n=0;n<this.matches.length;n+=2){let o=this.matches[n],s=!1;this.query.charCodeAt(o)==e&&(o==this.query.length-1?r={from:this.matches[n+1],to:t+1}:(this.matches[n]++,s=!0)),s||(this.matches.splice(n,2),n-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?r={from:t,to:t+1}:this.matches.push(1,t)),r&&this.test&&!this.test(r.from,r.to,this.buffer,this.bufferPos)&&(r=null),r}}typeof Symbol<"u"&&(en.prototype[Symbol.iterator]=function(){return this});const ig={from:-1,to:-1,match:/.*/.exec("")},Za="gm"+(/x/.unicode==null?"":"u");class rg{constructor(e,t,r,n=0,o=e.length){if(this.text=e,this.to=o,this.curLine="",this.done=!1,this.value=ig,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new ng(e,t,r,n,o);this.re=new RegExp(t,Za+(r!=null&&r.ignoreCase?"i":"")),this.test=r==null?void 0:r.test,this.iter=e.iter();let s=e.lineAt(n);this.curLineStart=s.from,this.matchPos=fs(e,n),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let r=this.curLineStart+t.index,n=r+t[0].length;if(this.matchPos=fs(this.text,n+(r==n?1:0)),r==this.curLineStart+this.curLine.length&&this.nextLine(),(r<n||r>this.value.to)&&(!this.test||this.test(r,n,t)))return this.value={from:r,to:n,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const ml=new WeakMap;class jr{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,r){let n=ml.get(e);if(!n||n.from>=r||n.to<=t){let l=new jr(t,e.sliceString(t,r));return ml.set(e,l),l}if(n.from==t&&n.to==r)return n;let{text:o,from:s}=n;return s>t&&(o=e.sliceString(t,s)+o,s=t),n.to<r&&(o+=e.sliceString(n.to,r)),ml.set(e,new jr(s,o)),new jr(t,o.slice(t-s,r-s))}}class ng{constructor(e,t,r,n,o){this.text=e,this.to=o,this.done=!1,this.value=ig,this.matchPos=fs(e,n),this.re=new RegExp(t,Za+(r!=null&&r.ignoreCase?"i":"")),this.test=r==null?void 0:r.test,this.flat=jr.get(e,n,this.chunkEnd(n+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let r=this.flat.from+t.index,n=r+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(r,n,t)))return this.value={from:r,to:n,match:t},this.matchPos=fs(this.text,n+(r==n?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=jr.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(rg.prototype[Symbol.iterator]=ng.prototype[Symbol.iterator]=function(){return this});function s2(i){try{return new RegExp(i,Za),!0}catch{return!1}}function fs(i,e){if(e>=i.length)return e;let t=i.lineAt(e),r;for(;e<t.to&&(r=t.text.charCodeAt(e-t.from))>=56320&&r<57344;)e++;return e}function ma(i){let e=Fe("input",{class:"cm-textfield",name:"line"}),t=Fe("form",{class:"cm-gotoLine",onkeydown:n=>{n.keyCode==27?(n.preventDefault(),i.dispatch({effects:ps.of(!1)}),i.focus()):n.keyCode==13&&(n.preventDefault(),r())},onsubmit:n=>{n.preventDefault(),r()}},Fe("label",i.state.phrase("Go to line"),": ",e)," ",Fe("button",{class:"cm-button",type:"submit"},i.state.phrase("go")));function r(){let n=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!n)return;let{state:o}=i,s=o.doc.lineAt(o.selection.main.head),[,l,a,h,c]=n,d=h?+h.slice(1):0,u=a?+a:s.number;if(a&&c){let g=u/100;l&&(g=g*(l=="-"?-1:1)+s.number/o.doc.lines),u=Math.round(o.doc.lines*g)}else a&&l&&(u=u*(l=="-"?-1:1)+s.number);let f=o.doc.line(Math.max(1,Math.min(o.doc.lines,u)));i.dispatch({effects:ps.of(!1),selection:F.cursor(f.from+Math.max(0,Math.min(d,f.length))),scrollIntoView:!0}),i.focus()}return{dom:t}}const ps=xe.define(),hd=dt.define({create(){return!0},update(i,e){for(let t of e.effects)t.is(ps)&&(i=t.value);return i},provide:i=>Vn.from(i,e=>e?ma:null)}),l2=i=>{let e=Wn(i,ma);if(!e){let t=[ps.of(!0)];i.state.field(hd,!1)==null&&t.push(xe.appendConfig.of([hd,a2])),i.dispatch({effects:t}),e=Wn(i,ma)}return e&&e.dom.querySelector("input").focus(),!0},a2=oe.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),h2={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},og=ae.define({combine(i){return Ci(i,h2,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function c2(i){let e=[g2,p2];return i&&e.push(og.of(i)),e}const d2=ye.mark({class:"cm-selectionMatch"}),u2=ye.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function cd(i,e,t,r){return(t==0||i(e.sliceDoc(t-1,t))!=Ve.Word)&&(r==e.doc.length||i(e.sliceDoc(r,r+1))!=Ve.Word)}function f2(i,e,t,r){return i(e.sliceDoc(t,t+1))==Ve.Word&&i(e.sliceDoc(r-1,r))==Ve.Word}const p2=Qe.fromClass(class{constructor(i){this.decorations=this.getDeco(i)}update(i){(i.selectionSet||i.docChanged||i.viewportChanged)&&(this.decorations=this.getDeco(i.view))}getDeco(i){let e=i.state.facet(og),{state:t}=i,r=t.selection;if(r.ranges.length>1)return ye.none;let n=r.main,o,s=null;if(n.empty){if(!e.highlightWordAroundCursor)return ye.none;let a=t.wordAt(n.head);if(!a)return ye.none;s=t.charCategorizer(n.head),o=t.sliceDoc(a.from,a.to)}else{let a=n.to-n.from;if(a<e.minSelectionLength||a>200)return ye.none;if(e.wholeWords){if(o=t.sliceDoc(n.from,n.to),s=t.charCategorizer(n.head),!(cd(s,t,n.from,n.to)&&f2(s,t,n.from,n.to)))return ye.none}else if(o=t.sliceDoc(n.from,n.to).trim(),!o)return ye.none}let l=[];for(let a of i.visibleRanges){let h=new en(t.doc,o,a.from,a.to);for(;!h.next().done;){let{from:c,to:d}=h.value;if((!s||cd(s,t,c,d))&&(n.empty&&c<=n.from&&d>=n.to?l.push(u2.range(c,d)):(c>=n.to||d<=n.from)&&l.push(d2.range(c,d)),l.length>e.maxMatches))return ye.none}}return ye.set(l)}},{decorations:i=>i.decorations}),g2=oe.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),m2=({state:i,dispatch:e})=>{let{selection:t}=i,r=F.create(t.ranges.map(n=>i.wordAt(n.head)||F.cursor(n.head)),t.mainIndex);return r.eq(t)?!1:(e(i.update({selection:r})),!0)};function v2(i,e){let{main:t,ranges:r}=i.selection,n=i.wordAt(t.head),o=n&&n.from==t.from&&n.to==t.to;for(let s=!1,l=new en(i.doc,e,r[r.length-1].to);;)if(l.next(),l.done){if(s)return null;l=new en(i.doc,e,0,Math.max(0,r[r.length-1].from-1)),s=!0}else{if(s&&r.some(a=>a.from==l.value.from))continue;if(o){let a=i.wordAt(l.value.from);if(!a||a.from!=l.value.from||a.to!=l.value.to)continue}return l.value}}const b2=({state:i,dispatch:e})=>{let{ranges:t}=i.selection;if(t.some(o=>o.from===o.to))return m2({state:i,dispatch:e});let r=i.sliceDoc(t[0].from,t[0].to);if(i.selection.ranges.some(o=>i.sliceDoc(o.from,o.to)!=r))return!1;let n=v2(i,r);return n?(e(i.update({selection:i.selection.addRange(F.range(n.from,n.to),!1),effects:oe.scrollIntoView(n.to)})),!0):!1},ln=ae.define({combine(i){return Ci(i,{top:!1,caseSensitive:!1,literal:!1,wholeWord:!1,createPanel:e=>new O2(e),scrollToMatch:e=>oe.scrollIntoView(e)})}});class sg{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||s2(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(t,r)=>r=="n"?`
`:r=="r"?"\r":r=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new k2(this):new w2(this)}getCursor(e,t=0,r){let n=e.doc?e:Me.create({doc:e});return r==null&&(r=n.doc.length),this.regexp?Br(this,n,t,r):Er(this,n,t,r)}}class lg{constructor(e){this.spec=e}}function Er(i,e,t,r){return new en(e.doc,i.unquoted,t,r,i.caseSensitive?void 0:n=>n.toLowerCase(),i.wholeWord?y2(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function y2(i,e){return(t,r,n,o)=>((o>t||o+n.length<r)&&(o=Math.max(0,t-2),n=i.sliceString(o,Math.min(i.length,r+2))),(e(gs(n,t-o))!=Ve.Word||e(ms(n,t-o))!=Ve.Word)&&(e(ms(n,r-o))!=Ve.Word||e(gs(n,r-o))!=Ve.Word))}class w2 extends lg{constructor(e){super(e)}nextMatch(e,t,r){let n=Er(this.spec,e,r,e.doc.length).nextOverlapping();return n.done&&(n=Er(this.spec,e,0,t).nextOverlapping()),n.done?null:n.value}prevMatchInRange(e,t,r){for(let n=r;;){let o=Math.max(t,n-1e4-this.spec.unquoted.length),s=Er(this.spec,e,o,n),l=null;for(;!s.nextOverlapping().done;)l=s.value;if(l)return l;if(o==t)return null;n-=1e4}}prevMatch(e,t,r){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let r=Er(this.spec,e,0,e.doc.length),n=[];for(;!r.next().done;){if(n.length>=t)return null;n.push(r.value)}return n}highlight(e,t,r,n){let o=Er(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(r+this.spec.unquoted.length,e.doc.length));for(;!o.next().done;)n(o.value.from,o.value.to)}}function Br(i,e,t,r){return new rg(e.doc,i.search,{ignoreCase:!i.caseSensitive,test:i.wholeWord?x2(e.charCategorizer(e.selection.main.head)):void 0},t,r)}function gs(i,e){return i.slice(mt(i,e,!1),e)}function ms(i,e){return i.slice(e,mt(i,e))}function x2(i){return(e,t,r)=>!r[0].length||(i(gs(r.input,r.index))!=Ve.Word||i(ms(r.input,r.index))!=Ve.Word)&&(i(ms(r.input,r.index+r[0].length))!=Ve.Word||i(gs(r.input,r.index+r[0].length))!=Ve.Word)}class k2 extends lg{nextMatch(e,t,r){let n=Br(this.spec,e,r,e.doc.length).next();return n.done&&(n=Br(this.spec,e,0,t).next()),n.done?null:n.value}prevMatchInRange(e,t,r){for(let n=1;;n++){let o=Math.max(t,r-n*1e4),s=Br(this.spec,e,o,r),l=null;for(;!s.next().done;)l=s.value;if(l&&(o==t||l.from>o+10))return l;if(o==t)return null}}prevMatch(e,t,r){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace.replace(/\$([$&\d+])/g,(t,r)=>r=="$"?"$":r=="&"?e.match[0]:r!="0"&&+r<e.match.length?e.match[r]:t))}matchAll(e,t){let r=Br(this.spec,e,0,e.doc.length),n=[];for(;!r.next().done;){if(n.length>=t)return null;n.push(r.value)}return n}highlight(e,t,r,n){let o=Br(this.spec,e,Math.max(0,t-250),Math.min(r+250,e.doc.length));for(;!o.next().done;)n(o.value.from,o.value.to)}}const Kn=xe.define(),Qa=xe.define(),Ji=dt.define({create(i){return new vl(va(i).create(),null)},update(i,e){for(let t of e.effects)t.is(Kn)?i=new vl(t.value.create(),i.panel):t.is(Qa)&&(i=new vl(i.query,t.value?eh:null));return i},provide:i=>Vn.from(i,e=>e.panel)});class vl{constructor(e,t){this.query=e,this.panel=t}}const S2=ye.mark({class:"cm-searchMatch"}),C2=ye.mark({class:"cm-searchMatch cm-searchMatch-selected"}),A2=Qe.fromClass(class{constructor(i){this.view=i,this.decorations=this.highlight(i.state.field(Ji))}update(i){let e=i.state.field(Ji);(e!=i.startState.field(Ji)||i.docChanged||i.selectionSet||i.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:i,panel:e}){if(!e||!i.spec.valid)return ye.none;let{view:t}=this,r=new Qi;for(let n=0,o=t.visibleRanges,s=o.length;n<s;n++){let{from:l,to:a}=o[n];for(;n<s-1&&a>o[n+1].from-2*250;)a=o[++n].to;i.highlight(t.state,l,a,(h,c)=>{let d=t.state.selection.ranges.some(u=>u.from==h&&u.to==c);r.add(h,c,d?C2:S2)})}return r.finish()}},{decorations:i=>i.decorations});function lo(i){return e=>{let t=e.state.field(Ji,!1);return t&&t.query.spec.valid?i(e,t):ag(e)}}const vs=lo((i,{query:e})=>{let{to:t}=i.state.selection.main,r=e.nextMatch(i.state,t,t);if(!r)return!1;let n=F.single(r.from,r.to),o=i.state.facet(ln);return i.dispatch({selection:n,effects:[th(i,r),o.scrollToMatch(n.main)],userEvent:"select.search"}),!0}),bs=lo((i,{query:e})=>{let{state:t}=i,{from:r}=t.selection.main,n=e.prevMatch(t,r,r);if(!n)return!1;let o=F.single(n.from,n.to),s=i.state.facet(ln);return i.dispatch({selection:o,effects:[th(i,n),s.scrollToMatch(o.main)],userEvent:"select.search"}),!0}),M2=lo((i,{query:e})=>{let t=e.matchAll(i.state,1e3);return!t||!t.length?!1:(i.dispatch({selection:F.create(t.map(r=>F.range(r.from,r.to))),userEvent:"select.search.matches"}),!0)}),R2=({state:i,dispatch:e})=>{let t=i.selection;if(t.ranges.length>1||t.main.empty)return!1;let{from:r,to:n}=t.main,o=[],s=0;for(let l=new en(i.doc,i.sliceDoc(r,n));!l.next().done;){if(o.length>1e3)return!1;l.value.from==r&&(s=o.length),o.push(F.range(l.value.from,l.value.to))}return e(i.update({selection:F.create(o,s),userEvent:"select.search.matches"})),!0},dd=lo((i,{query:e})=>{let{state:t}=i,{from:r,to:n}=t.selection.main;if(t.readOnly)return!1;let o=e.nextMatch(t,r,r);if(!o)return!1;let s=[],l,a,h=[];if(o.from==r&&o.to==n&&(a=t.toText(e.getReplacement(o)),s.push({from:o.from,to:o.to,insert:a}),o=e.nextMatch(t,o.from,o.to),h.push(oe.announce.of(t.phrase("replaced match on line $",t.doc.lineAt(r).number)+"."))),o){let c=s.length==0||s[0].from>=o.to?0:o.to-o.from-a.length;l=F.single(o.from-c,o.to-c),h.push(th(i,o)),h.push(t.facet(ln).scrollToMatch(l.main))}return i.dispatch({changes:s,selection:l,effects:h,userEvent:"input.replace"}),!0}),T2=lo((i,{query:e})=>{if(i.state.readOnly)return!1;let t=e.matchAll(i.state,1e9).map(n=>{let{from:o,to:s}=n;return{from:o,to:s,insert:e.getReplacement(n)}});if(!t.length)return!1;let r=i.state.phrase("replaced $ matches",t.length)+".";return i.dispatch({changes:t,effects:oe.announce.of(r),userEvent:"input.replace.all"}),!0});function eh(i){return i.state.facet(ln).createPanel(i)}function va(i,e){var t,r,n,o;let s=i.selection.main,l=s.empty||s.to>s.from+100?"":i.sliceDoc(s.from,s.to);if(e&&!l)return e;let a=i.facet(ln);return new sg({search:((t=e==null?void 0:e.literal)!==null&&t!==void 0?t:a.literal)?l:l.replace(/\n/g,"\\n"),caseSensitive:(r=e==null?void 0:e.caseSensitive)!==null&&r!==void 0?r:a.caseSensitive,literal:(n=e==null?void 0:e.literal)!==null&&n!==void 0?n:a.literal,wholeWord:(o=e==null?void 0:e.wholeWord)!==null&&o!==void 0?o:a.wholeWord})}const ag=i=>{let e=i.state.field(Ji,!1);if(e&&e.panel){let t=Wn(i,eh);if(!t)return!1;let r=t.dom.querySelector("[main-field]");if(r&&r!=i.root.activeElement){let n=va(i.state,e.query.spec);n.valid&&i.dispatch({effects:Kn.of(n)}),r.focus(),r.select()}}else i.dispatch({effects:[Qa.of(!0),e?Kn.of(va(i.state,e.query.spec)):xe.appendConfig.of(L2)]});return!0},hg=i=>{let e=i.state.field(Ji,!1);if(!e||!e.panel)return!1;let t=Wn(i,eh);return t&&t.dom.contains(i.root.activeElement)&&i.focus(),i.dispatch({effects:Qa.of(!1)}),!0},D2=[{key:"Mod-f",run:ag,scope:"editor search-panel"},{key:"F3",run:vs,shift:bs,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:vs,shift:bs,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:hg,scope:"editor search-panel"},{key:"Mod-Shift-l",run:R2},{key:"Alt-g",run:l2},{key:"Mod-d",run:b2,preventDefault:!0}];class O2{constructor(e){this.view=e;let t=this.query=e.state.field(Ji).query.spec;this.commit=this.commit.bind(this),this.searchField=Fe("input",{value:t.search,placeholder:Ft(e,"Find"),"aria-label":Ft(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=Fe("input",{value:t.replace,placeholder:Ft(e,"Replace"),"aria-label":Ft(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=Fe("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=Fe("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=Fe("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit});function r(n,o,s){return Fe("button",{class:"cm-button",name:n,onclick:o,type:"button"},s)}this.dom=Fe("div",{onkeydown:n=>this.keydown(n),class:"cm-search"},[this.searchField,r("next",()=>vs(e),[Ft(e,"next")]),r("prev",()=>bs(e),[Ft(e,"previous")]),r("select",()=>M2(e),[Ft(e,"all")]),Fe("label",null,[this.caseField,Ft(e,"match case")]),Fe("label",null,[this.reField,Ft(e,"regexp")]),Fe("label",null,[this.wordField,Ft(e,"by word")]),...e.state.readOnly?[]:[Fe("br"),this.replaceField,r("replace",()=>dd(e),[Ft(e,"replace")]),r("replaceAll",()=>T2(e),[Ft(e,"replace all")])],Fe("button",{name:"close",onclick:()=>hg(e),"aria-label":Ft(e,"close"),type:"button"},["×"])])}commit(){let e=new sg({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:Kn.of(e)}))}keydown(e){Ly(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?bs:vs)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),dd(this.view))}update(e){for(let t of e.transactions)for(let r of t.effects)r.is(Kn)&&!r.value.eq(this.query)&&this.setQuery(r.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(ln).top}}function Ft(i,e){return i.state.phrase(e)}const Po=30,Lo=/[\s\.,:;?!]/;function th(i,{from:e,to:t}){let r=i.state.doc.lineAt(e),n=i.state.doc.lineAt(t).to,o=Math.max(r.from,e-Po),s=Math.min(n,t+Po),l=i.state.sliceDoc(o,s);if(o!=r.from){for(let a=0;a<Po;a++)if(!Lo.test(l[a+1])&&Lo.test(l[a])){l=l.slice(a);break}}if(s!=n){for(let a=l.length-1;a>l.length-Po;a--)if(!Lo.test(l[a-1])&&Lo.test(l[a])){l=l.slice(0,a);break}}return oe.announce.of(`${i.state.phrase("current match")}. ${l} ${i.state.phrase("on line")} ${r.number}.`)}const P2=oe.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),L2=[Ji,on.lowest(A2),P2];class cg{constructor(e,t,r){this.state=e,this.pos=t,this.explicit=r,this.abortListeners=[]}tokenBefore(e){let t=ct(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),r=Math.max(t.from,this.pos-250),n=t.text.slice(r-t.from,this.pos-t.from),o=n.search(dg(e,!1));return o<0?null:{from:r+o,to:this.pos,text:n.slice(o)}}get aborted(){return this.abortListeners==null}addEventListener(e,t){e=="abort"&&this.abortListeners&&this.abortListeners.push(t)}}function ud(i){let e=Object.keys(i).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function E2(i){let e=Object.create(null),t=Object.create(null);for(let{label:n}of i){e[n[0]]=!0;for(let o=1;o<n.length;o++)t[n[o]]=!0}let r=ud(e)+ud(t)+"*$";return[new RegExp("^"+r),new RegExp(r)]}function B2(i){let e=i.map(n=>typeof n=="string"?{label:n}:n),[t,r]=e.every(n=>/^\w+$/.test(n.label))?[/\w*$/,/\w+$/]:E2(e);return n=>{let o=n.matchBefore(r);return o||n.explicit?{from:o?o.from:n.pos,options:e,validFor:t}:null}}class fd{constructor(e,t,r,n){this.completion=e,this.source=t,this.match=r,this.score=n}}function Zi(i){return i.selection.main.from}function dg(i,e){var t;let{source:r}=i,n=e&&r[0]!="^",o=r[r.length-1]!="$";return!n&&!o?i:new RegExp(`${n?"^":""}(?:${r})${o?"$":""}`,(t=i.flags)!==null&&t!==void 0?t:i.ignoreCase?"i":"")}const N2=zi.define();function I2(i,e,t,r){let{main:n}=i.selection,o=r-t;return Object.assign(Object.assign({},i.changeByRange(s=>s!=n&&o&&i.sliceDoc(s.from-o,s.from+r-n.from)!=i.sliceDoc(t,r)?{range:s}:{changes:{from:s.from-o,to:r==n.from?s.to:s.from+r-n.from,insert:e},range:F.cursor(s.from-o+e.length)})),{userEvent:"input.complete"})}function ug(i,e){const t=e.completion.apply||e.completion.label;let r=e.source;typeof t=="string"?i.dispatch(Object.assign(Object.assign({},I2(i.state,t,r.from,r.to)),{annotations:N2.of(e.completion)})):t(i,e.completion,r.from,r.to)}const pd=new WeakMap;function z2(i){if(!Array.isArray(i))return i;let e=pd.get(i);return e||pd.set(i,e=B2(i)),e}const ih=xe.define(),qn=xe.define();class F2{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let t=0;t<e.length;){let r=lt(e,t),n=Gt(r);this.chars.push(r);let o=e.slice(t,t+n),s=o.toUpperCase();this.folded.push(lt(s==o?o.toLowerCase():s,0)),t+=n}this.astral=e.length!=this.chars.length}match(e){if(this.pattern.length==0)return[0];if(e.length<this.pattern.length)return null;let{chars:t,folded:r,any:n,precise:o,byWord:s}=this;if(t.length==1){let D=lt(e,0),T=Gt(D),A=T==e.length?0:-100;if(D!=t[0])if(D==r[0])A+=-200;else return null;return[A,0,T]}let l=e.indexOf(this.pattern);if(l==0)return[e.length==this.pattern.length?0:-100,0,this.pattern.length];let a=t.length,h=0;if(l<0){for(let D=0,T=Math.min(e.length,200);D<T&&h<a;){let A=lt(e,D);(A==t[h]||A==r[h])&&(n[h++]=D),D+=Gt(A)}if(h<a)return null}let c=0,d=0,u=!1,f=0,g=-1,y=-1,b=/[a-z]/.test(e),C=!0;for(let D=0,T=Math.min(e.length,200),A=0;D<T&&d<a;){let S=lt(e,D);l<0&&(c<a&&S==t[c]&&(o[c++]=D),f<a&&(S==t[f]||S==r[f]?(f==0&&(g=D),y=D+1,f++):f=0));let k,v=S<255?S>=48&&S<=57||S>=97&&S<=122?2:S>=65&&S<=90?1:0:(k=Ca(S))!=k.toLowerCase()?1:k!=k.toUpperCase()?2:0;(!D||v==1&&b||A==0&&v!=0)&&(t[d]==S||r[d]==S&&(u=!0)?s[d++]=D:s.length&&(C=!1)),A=v,D+=Gt(S)}return d==a&&s[0]==0&&C?this.result(-100+(u?-200:0),s,e):f==a&&g==0?[-200-e.length+(y==e.length?0:-100),0,y]:l>-1?[-700-e.length,l,l+this.pattern.length]:f==a?[-200+-700-e.length,g,y]:d==a?this.result(-100+(u?-200:0)+-700+(C?0:-1100),s,e):t.length==2?null:this.result((n[0]?-700:0)+-200+-1100,n,e)}result(e,t,r){let n=[e-r.length],o=1;for(let s of t){let l=s+(this.astral?Gt(lt(r,s)):1);o>1&&n[o-1]==s?n[o-1]=l:(n[o++]=s,n[o++]=l)}return n}}const Nt=ae.define({combine(i){return Ci(i,{activateOnTyping:!0,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:$2,compareCompletions:(e,t)=>e.label.localeCompare(t.label),interactionDelay:75},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>r=>gd(e(r),t(r)),optionClass:(e,t)=>r=>gd(e(r),t(r)),addToOptions:(e,t)=>e.concat(t)})}});function gd(i,e){return i?e?i+" "+e:i:e}function $2(i,e,t,r,n){let o=i.textDirection==Ue.RTL,s=o,l=!1,a="top",h,c,d=e.left-n.left,u=n.right-e.right,f=r.right-r.left,g=r.bottom-r.top;if(s&&d<Math.min(f,u)?s=!1:!s&&u<Math.min(f,d)&&(s=!0),f<=(s?d:u))h=Math.max(n.top,Math.min(t.top,n.bottom-g))-e.top,c=Math.min(400,s?d:u);else{l=!0,c=Math.min(400,(o?e.right:n.right-e.left)-30);let y=n.bottom-e.bottom;y>=g||y>e.top?h=t.bottom-e.top:(a="bottom",h=e.bottom-t.top)}return{style:`${a}: ${h}px; max-width: ${c}px`,class:"cm-completionInfo-"+(l?o?"left-narrow":"right-narrow":s?"left":"right")}}function H2(i){let e=i.addToOptions.slice();return i.icons&&e.push({render(t){let r=document.createElement("div");return r.classList.add("cm-completionIcon"),t.type&&r.classList.add(...t.type.split(/\s+/g).map(n=>"cm-completionIcon-"+n)),r.setAttribute("aria-hidden","true"),r},position:20}),e.push({render(t,r,n){let o=document.createElement("span");o.className="cm-completionLabel";let{label:s}=t,l=0;for(let a=1;a<n.length;){let h=n[a++],c=n[a++];h>l&&o.appendChild(document.createTextNode(s.slice(l,h)));let d=o.appendChild(document.createElement("span"));d.appendChild(document.createTextNode(s.slice(h,c))),d.className="cm-completionMatchedText",l=c}return l<s.length&&o.appendChild(document.createTextNode(s.slice(l))),o},position:50},{render(t){if(!t.detail)return null;let r=document.createElement("span");return r.className="cm-completionDetail",r.textContent=t.detail,r},position:80}),e.sort((t,r)=>t.position-r.position).map(t=>t.render)}function md(i,e,t){if(i<=t)return{from:0,to:i};if(e<0&&(e=0),e<=i>>1){let n=Math.floor(e/t);return{from:n*t,to:(n+1)*t}}let r=Math.floor((i-e)/t);return{from:i-(r+1)*t,to:i-r*t}}class W2{constructor(e,t){this.view=e,this.stateField=t,this.info=null,this.placeInfoReq={read:()=>this.measureInfo(),write:l=>this.placeInfo(l),key:this},this.space=null,this.currentClass="";let r=e.state.field(t),{options:n,selected:o}=r.open,s=e.state.facet(Nt);this.optionContent=H2(s),this.optionClass=s.optionClass,this.tooltipClass=s.tooltipClass,this.range=md(n.length,o,s.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",l=>{for(let a=l.target,h;a&&a!=this.dom;a=a.parentNode)if(a.nodeName=="LI"&&(h=/-(\d+)$/.exec(a.id))&&+h[1]<n.length){ug(e,n[+h[1]]),l.preventDefault();return}}),this.dom.addEventListener("focusout",l=>{let a=e.state.field(this.stateField,!1);a&&a.tooltip&&e.state.facet(Nt).closeOnBlur&&l.relatedTarget!=e.contentDOM&&e.dispatch({effects:qn.of(null)})}),this.list=this.dom.appendChild(this.createListBox(n,r.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}mount(){this.updateSel()}update(e){var t,r,n;let o=e.state.field(this.stateField),s=e.startState.field(this.stateField);this.updateTooltipClass(e.state),o!=s&&(this.updateSel(),((t=o.open)===null||t===void 0?void 0:t.disabled)!=((r=s.open)===null||r===void 0?void 0:r.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!(!((n=o.open)===null||n===void 0)&&n.disabled)))}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let r of this.currentClass.split(" "))r&&this.dom.classList.remove(r);for(let r of t.split(" "))r&&this.dom.classList.add(r);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=md(t.options.length,t.selected,this.view.state.facet(Nt).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(t.options,e.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})),this.updateSelectedOption(t.selected)){this.info&&(this.info.remove(),this.info=null);let{completion:r}=t.options[t.selected],{info:n}=r;if(!n)return;let o=typeof n=="string"?document.createTextNode(n):n(r);if(!o)return;"then"in o?o.then(s=>{s&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(s)}).catch(s=>ni(this.view.state,s,"completion info")):this.addInfoPane(o)}}addInfoPane(e){let t=this.info=document.createElement("div");t.className="cm-tooltip cm-completionInfo",t.appendChild(e),this.dom.appendChild(t),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let r=this.list.firstChild,n=this.range.from;r;r=r.nextSibling,n++)r.nodeName!="LI"||!r.id?n--:n==e?r.hasAttribute("aria-selected")||(r.setAttribute("aria-selected","true"),t=r):r.hasAttribute("aria-selected")&&r.removeAttribute("aria-selected");return t&&j2(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),r=this.info.getBoundingClientRect(),n=e.getBoundingClientRect(),o=this.space;if(!o){let s=this.dom.ownerDocument.defaultView||window;o={left:0,top:0,right:s.innerWidth,bottom:s.innerHeight}}return n.top>Math.min(o.bottom,t.bottom)-10||n.bottom<Math.max(o.top,t.top)+10?null:this.view.state.facet(Nt).positionInfo(this.view,t,n,r,o)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,r){const n=document.createElement("ul");n.id=t,n.setAttribute("role","listbox"),n.setAttribute("aria-expanded","true"),n.setAttribute("aria-label",this.view.state.phrase("Completions"));let o=null;for(let s=r.from;s<r.to;s++){let{completion:l,match:a}=e[s],{section:h}=l;if(h){let u=typeof h=="string"?h:h.name;if(u!=o&&(s>r.from||r.from==0))if(o=u,typeof h!="string"&&h.header)n.appendChild(h.header(h));else{let f=n.appendChild(document.createElement("completion-section"));f.textContent=u}}const c=n.appendChild(document.createElement("li"));c.id=t+"-"+s,c.setAttribute("role","option");let d=this.optionClass(l);d&&(c.className=d);for(let u of this.optionContent){let f=u(l,this.view.state,a);f&&c.appendChild(f)}}return r.from&&n.classList.add("cm-completionListIncompleteTop"),r.to<e.length&&n.classList.add("cm-completionListIncompleteBottom"),n}}function V2(i){return e=>new W2(e,i)}function j2(i,e){let t=i.getBoundingClientRect(),r=e.getBoundingClientRect();r.top<t.top?i.scrollTop-=t.top-r.top:r.bottom>t.bottom&&(i.scrollTop+=r.bottom-t.bottom)}function vd(i){return(i.boost||0)*100+(i.apply?10:0)+(i.info?5:0)+(i.type?1:0)}function U2(i,e){let t=[],r=null,n=a=>{t.push(a);let{section:h}=a.completion;if(h){r||(r=[]);let c=typeof h=="string"?h:h.name;r.some(d=>d.name==c)||r.push(typeof h=="string"?{name:c}:h)}};for(let a of i)if(a.hasResult())if(a.result.filter===!1){let h=a.result.getMatch;for(let c of a.result.options){let d=[1e9-t.length];if(h)for(let u of h(c))d.push(u);n(new fd(c,a,d,d[0]))}}else{let h=new F2(e.sliceDoc(a.from,a.to)),c;for(let d of a.result.options)(c=h.match(d.label))&&n(new fd(d,a,c,c[0]+(d.boost||0)))}if(r){let a=Object.create(null),h=0,c=(d,u)=>{var f,g;return((f=d.rank)!==null&&f!==void 0?f:1e9)-((g=u.rank)!==null&&g!==void 0?g:1e9)||(d.name<u.name?-1:1)};for(let d of r.sort(c))h-=1e5,a[d.name]=h;for(let d of t){let{section:u}=d.completion;u&&(d.score+=a[typeof u=="string"?u:u.name])}}let o=[],s=null,l=e.facet(Nt).compareCompletions;for(let a of t.sort((h,c)=>c.score-h.score||l(h.completion,c.completion)))!s||s.label!=a.completion.label||s.detail!=a.completion.detail||s.type!=null&&a.completion.type!=null&&s.type!=a.completion.type||s.apply!=a.completion.apply?o.push(a):vd(a.completion)>vd(s)&&(o[o.length-1]=a),s=a.completion;return o}class $r{constructor(e,t,r,n,o,s){this.options=e,this.attrs=t,this.tooltip=r,this.timestamp=n,this.selected=o,this.disabled=s}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new $r(this.options,bd(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,r,n,o){let s=U2(e,t);if(!s.length)return n&&e.some(a=>a.state==1)?new $r(n.options,n.attrs,n.tooltip,n.timestamp,n.selected,!0):null;let l=t.facet(Nt).selectOnOpen?0:-1;if(n&&n.selected!=l&&n.selected!=-1){let a=n.options[n.selected].completion;for(let h=0;h<s.length;h++)if(s[h].completion==a){l=h;break}}return new $r(s,bd(r,l),{pos:e.reduce((a,h)=>h.hasResult()?Math.min(a,h.from):a,1e8),create:V2(qt),above:o.aboveCursor},n?n.timestamp:Date.now(),l,!1)}map(e){return new $r(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class ys{constructor(e,t,r){this.active=e,this.id=t,this.open=r}static start(){return new ys(q2,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:t}=e,r=t.facet(Nt),n=(r.override||t.languageDataAt("autocomplete",Zi(t)).map(z2)).map(s=>(this.active.find(l=>l.source==s)||new Et(s,this.active.some(l=>l.state!=0)?1:0)).update(e,r));n.length==this.active.length&&n.every((s,l)=>s==this.active[l])&&(n=this.active);let o=this.open;o&&e.docChanged&&(o=o.map(e.changes)),e.selection||n.some(s=>s.hasResult()&&e.changes.touchesRange(s.from,s.to))||!_2(n,this.active)?o=$r.build(n,t,this.id,o,r):o&&o.disabled&&!n.some(s=>s.state==1)&&(o=null),!o&&n.every(s=>s.state!=1)&&n.some(s=>s.hasResult())&&(n=n.map(s=>s.hasResult()?new Et(s.source,0):s));for(let s of e.effects)s.is(pg)&&(o=o&&o.setSelected(s.value,this.id));return n==this.active&&o==this.open?this:new ys(n,this.id,o)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:K2}}function _2(i,e){if(i==e)return!0;for(let t=0,r=0;;){for(;t<i.length&&!i[t].hasResult;)t++;for(;r<e.length&&!e[r].hasResult;)r++;let n=t==i.length,o=r==e.length;if(n||o)return n==o;if(i[t++].result!=e[r++].result)return!1}}const K2={"aria-autocomplete":"list"};function bd(i,e){let t={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":i};return e>-1&&(t["aria-activedescendant"]=i+"-"+e),t}const q2=[];function ba(i){return i.isUserEvent("input.type")?"input":i.isUserEvent("delete.backward")?"delete":null}class Et{constructor(e,t,r=-1){this.source=e,this.state=t,this.explicitPos=r}hasResult(){return!1}update(e,t){let r=ba(e),n=this;r?n=n.handleUserEvent(e,r,t):e.docChanged?n=n.handleChange(e):e.selection&&n.state!=0&&(n=new Et(n.source,0));for(let o of e.effects)if(o.is(ih))n=new Et(n.source,1,o.value?Zi(e.state):-1);else if(o.is(qn))n=new Et(n.source,0);else if(o.is(fg))for(let s of o.value)s.source==n.source&&(n=s);return n}handleUserEvent(e,t,r){return t=="delete"||!r.activateOnTyping?this.map(e.changes):new Et(this.source,1)}handleChange(e){return e.changes.touchesRange(Zi(e.startState))?new Et(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new Et(this.source,this.state,e.mapPos(this.explicitPos))}}class Pn extends Et{constructor(e,t,r,n,o){super(e,2,t),this.result=r,this.from=n,this.to=o}hasResult(){return!0}handleUserEvent(e,t,r){var n;let o=e.changes.mapPos(this.from),s=e.changes.mapPos(this.to,1),l=Zi(e.state);if((this.explicitPos<0?l<=o:l<this.from)||l>s||t=="delete"&&Zi(e.startState)==this.from)return new Et(this.source,t=="input"&&r.activateOnTyping?1:0);let a=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos),h;return G2(this.result.validFor,e.state,o,s)?new Pn(this.source,a,this.result,o,s):this.result.update&&(h=this.result.update(this.result,o,s,new cg(e.state,l,a>=0)))?new Pn(this.source,a,h,h.from,(n=h.to)!==null&&n!==void 0?n:Zi(e.state)):new Et(this.source,1,a)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new Et(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new Pn(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}}function G2(i,e,t,r){if(!i)return!1;let n=e.sliceDoc(t,r);return typeof i=="function"?i(n,t,r,e):dg(i,!0).test(n)}const fg=xe.define({map(i,e){return i.map(t=>t.map(e))}}),pg=xe.define(),qt=dt.define({create(){return ys.start()},update(i,e){return i.update(e)},provide:i=>[Ba.from(i,e=>e.tooltip),oe.contentAttributes.from(i,e=>e.attrs)]});function Eo(i,e="option"){return t=>{let r=t.state.field(qt,!1);if(!r||!r.open||r.open.disabled||Date.now()-r.open.timestamp<t.state.facet(Nt).interactionDelay)return!1;let n=1,o;e=="page"&&(o=jf(t,r.open.tooltip))&&(n=Math.max(2,Math.floor(o.dom.offsetHeight/o.dom.querySelector("li").offsetHeight)-1));let{length:s}=r.open.options,l=r.open.selected>-1?r.open.selected+n*(i?1:-1):i?0:s-1;return l<0?l=e=="page"?0:s-1:l>=s&&(l=e=="page"?s-1:0),t.dispatch({effects:pg.of(l)}),!0}}const X2=i=>{let e=i.state.field(qt,!1);return i.state.readOnly||!e||!e.open||e.open.selected<0||Date.now()-e.open.timestamp<i.state.facet(Nt).interactionDelay?!1:(e.open.disabled||ug(i,e.open.options[e.open.selected]),!0)},Y2=i=>i.state.field(qt,!1)?(i.dispatch({effects:ih.of(!0)}),!0):!1,J2=i=>{let e=i.state.field(qt,!1);return!e||!e.active.some(t=>t.state!=0)?!1:(i.dispatch({effects:qn.of(null)}),!0)};class Z2{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const yd=50,Q2=50,eS=1e3,tS=Qe.fromClass(class{constructor(i){this.view=i,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of i.state.field(qt).active)e.state==1&&this.startQuery(e)}update(i){let e=i.state.field(qt);if(!i.selectionSet&&!i.docChanged&&i.startState.field(qt)==e)return;let t=i.transactions.some(r=>(r.selection||r.docChanged)&&!ba(r));for(let r=0;r<this.running.length;r++){let n=this.running[r];if(t||n.updates.length+i.transactions.length>Q2&&Date.now()-n.time>eS){for(let o of n.context.abortListeners)try{o()}catch(s){ni(this.view.state,s)}n.context.abortListeners=null,this.running.splice(r--,1)}else n.updates.push(...i.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some(r=>r.state==1&&!this.running.some(n=>n.active.source==r.source))?setTimeout(()=>this.startUpdate(),yd):-1,this.composing!=0)for(let r of i.transactions)ba(r)=="input"?this.composing=2:this.composing==2&&r.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:i}=this.view,e=i.field(qt);for(let t of e.active)t.state==1&&!this.running.some(r=>r.active.source==t.source)&&this.startQuery(t)}startQuery(i){let{state:e}=this.view,t=Zi(e),r=new cg(e,t,i.explicitPos==t),n=new Z2(i,r);this.running.push(n),Promise.resolve(i.source(r)).then(o=>{n.context.aborted||(n.done=o||null,this.scheduleAccept())},o=>{this.view.dispatch({effects:qn.of(null)}),ni(this.view.state,o)})}scheduleAccept(){this.running.every(i=>i.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),yd))}accept(){var i;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],t=this.view.state.facet(Nt);for(let r=0;r<this.running.length;r++){let n=this.running[r];if(n.done===void 0)continue;if(this.running.splice(r--,1),n.done){let s=new Pn(n.active.source,n.active.explicitPos,n.done,n.done.from,(i=n.done.to)!==null&&i!==void 0?i:Zi(n.updates.length?n.updates[0].startState:this.view.state));for(let l of n.updates)s=s.update(l,t);if(s.hasResult()){e.push(s);continue}}let o=this.view.state.field(qt).active.find(s=>s.source==n.active.source);if(o&&o.state==1)if(n.done==null){let s=new Et(n.active.source,0);for(let l of n.updates)s=s.update(l,t);s.state!=1&&e.push(s)}else this.startQuery(o)}e.length&&this.view.dispatch({effects:fg.of(e)})}},{eventHandlers:{blur(i){let e=this.view.state.field(qt,!1);if(e&&e.tooltip&&this.view.state.facet(Nt).closeOnBlur){let t=e.open&&jf(this.view,e.open.tooltip);(!t||!t.dom.contains(i.relatedTarget))&&this.view.dispatch({effects:qn.of(null)})}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:ih.of(!1)}),20),this.composing=0}}}),iS=oe.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),Gn={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},fr=xe.define({map(i,e){return e.mapPos(i,-1,Ct.TrackAfter)??void 0}}),rh=new class extends yr{};rh.startSide=1;rh.endSide=-1;const gg=dt.define({create(){return Ee.empty},update(i,e){if(e.selection){let t=e.state.doc.lineAt(e.selection.main.head).from,r=e.startState.doc.lineAt(e.startState.selection.main.head).from;t!=e.changes.mapPos(r,-1)&&(i=Ee.empty)}i=i.map(e.changes);for(let t of e.effects)t.is(fr)&&(i=i.update({add:[rh.range(t.value,t.value+1)]}));return i}});function rS(){return[oS,gg]}const bl="()[]{}<>";function mg(i){for(let e=0;e<bl.length;e+=2)if(bl.charCodeAt(e)==i)return bl.charAt(e+1);return Ca(i<128?i:i+1)}function vg(i,e){return i.languageDataAt("closeBrackets",e)[0]||Gn}const nS=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),oS=oe.inputHandler.of((i,e,t,r)=>{if((nS?i.composing:i.compositionStarted)||i.state.readOnly)return!1;let n=i.state.selection.main;if(r.length>2||r.length==2&&Gt(lt(r,0))==1||e!=n.from||t!=n.to)return!1;let o=aS(i.state,r);return o?(i.dispatch(o),!0):!1}),sS=({state:i,dispatch:e})=>{if(i.readOnly)return!1;let t=vg(i,i.selection.main.head).brackets||Gn.brackets,r=null,n=i.changeByRange(o=>{if(o.empty){let s=hS(i.doc,o.head);for(let l of t)if(l==s&&Bs(i.doc,o.head)==mg(lt(l,0)))return{changes:{from:o.head-l.length,to:o.head+l.length},range:F.cursor(o.head-l.length)}}return{range:r=o}});return r||e(i.update(n,{scrollIntoView:!0,userEvent:"delete.backward"})),!r},lS=[{key:"Backspace",run:sS}];function aS(i,e){let t=vg(i,i.selection.main.head),r=t.brackets||Gn.brackets;for(let n of r){let o=mg(lt(n,0));if(e==n)return o==n?uS(i,n,r.indexOf(n+n+n)>-1,t):cS(i,n,o,t.before||Gn.before);if(e==o&&bg(i,i.selection.main.from))return dS(i,n,o)}return null}function bg(i,e){let t=!1;return i.field(gg).between(0,i.doc.length,r=>{r==e&&(t=!0)}),t}function Bs(i,e){let t=i.sliceString(e,e+2);return t.slice(0,Gt(lt(t,0)))}function hS(i,e){let t=i.sliceString(e-2,e);return Gt(lt(t,0))==t.length?t:t.slice(1)}function cS(i,e,t,r){let n=null,o=i.changeByRange(s=>{if(!s.empty)return{changes:[{insert:e,from:s.from},{insert:t,from:s.to}],effects:fr.of(s.to+e.length),range:F.range(s.anchor+e.length,s.head+e.length)};let l=Bs(i.doc,s.head);return!l||/\s/.test(l)||r.indexOf(l)>-1?{changes:{insert:e+t,from:s.head},effects:fr.of(s.head+e.length),range:F.cursor(s.head+e.length)}:{range:n=s}});return n?null:i.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function dS(i,e,t){let r=null,n=i.changeByRange(o=>o.empty&&Bs(i.doc,o.head)==t?{changes:{from:o.head,to:o.head+t.length,insert:t},range:F.cursor(o.head+t.length)}:r={range:o});return r?null:i.update(n,{scrollIntoView:!0,userEvent:"input.type"})}function uS(i,e,t,r){let n=r.stringPrefixes||Gn.stringPrefixes,o=null,s=i.changeByRange(l=>{if(!l.empty)return{changes:[{insert:e,from:l.from},{insert:e,from:l.to}],effects:fr.of(l.to+e.length),range:F.range(l.anchor+e.length,l.head+e.length)};let a=l.head,h=Bs(i.doc,a),c;if(h==e){if(wd(i,a))return{changes:{insert:e+e,from:a},effects:fr.of(a+e.length),range:F.cursor(a+e.length)};if(bg(i,a)){let d=t&&i.sliceDoc(a,a+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:a,to:a+d.length,insert:d},range:F.cursor(a+d.length)}}}else{if(t&&i.sliceDoc(a-2*e.length,a)==e+e&&(c=xd(i,a-2*e.length,n))>-1&&wd(i,c))return{changes:{insert:e+e+e+e,from:a},effects:fr.of(a+e.length),range:F.cursor(a+e.length)};if(i.charCategorizer(a)(h)!=Ve.Word&&xd(i,a,n)>-1&&!fS(i,a,e,n))return{changes:{insert:e+e,from:a},effects:fr.of(a+e.length),range:F.cursor(a+e.length)}}return{range:o=l}});return o?null:i.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function wd(i,e){let t=ct(i).resolveInner(e+1);return t.parent&&t.from==e}function fS(i,e,t,r){let n=ct(i).resolveInner(e,-1),o=r.reduce((s,l)=>Math.max(s,l.length),0);for(let s=0;s<5;s++){let l=i.sliceDoc(n.from,Math.min(n.to,n.from+t.length+o)),a=l.indexOf(t);if(!a||a>-1&&r.indexOf(l.slice(0,a))>-1){let c=n.firstChild;for(;c&&c.from==n.from&&c.to-c.from>t.length+a;){if(i.sliceDoc(c.to-t.length,c.to)==t)return!1;c=c.firstChild}return!0}let h=n.to==e&&n.parent;if(!h)break;n=h}return!1}function xd(i,e,t){let r=i.charCategorizer(e);if(r(i.sliceDoc(e-1,e))!=Ve.Word)return e;for(let n of t){let o=e-n.length;if(i.sliceDoc(o,e)==n&&r(i.sliceDoc(o-1,o))!=Ve.Word)return o}return-1}function pS(i={}){return[qt,Nt.of(i),tS,gS,iS]}const yg=[{key:"Ctrl-Space",run:Y2},{key:"Escape",run:J2},{key:"ArrowDown",run:Eo(!0)},{key:"ArrowUp",run:Eo(!1)},{key:"PageDown",run:Eo(!0,"page")},{key:"PageUp",run:Eo(!1,"page")},{key:"Enter",run:X2}],gS=on.highest(Ms.computeN([Nt],i=>i.facet(Nt).defaultKeymap?[yg]:[]));class mS{constructor(e,t,r){this.from=e,this.to=t,this.diagnostic=r}}class cr{constructor(e,t,r){this.diagnostics=e,this.panel=t,this.selected=r}static init(e,t,r){let n=e,o=r.facet(kg).markerFilter;o&&(n=o(n));let s=ye.set(n.map(l=>l.from==l.to||l.from==l.to-1&&r.doc.lineAt(l.from).to==l.from?ye.widget({widget:new AS(l),diagnostic:l}).range(l.from):ye.mark({attributes:{class:"cm-lintRange cm-lintRange-"+l.severity},diagnostic:l}).range(l.from,l.to)),!0);return new cr(s,t,tn(s))}}function tn(i,e=null,t=0){let r=null;return i.between(t,1e9,(n,o,{spec:s})=>{if(!(e&&s.diagnostic!=e))return r=new mS(n,o,s.diagnostic),!1}),r}function vS(i,e){return!!(i.effects.some(t=>t.is(wg))||i.changes.touchesRange(e.pos))}function bS(i,e){return i.field(Vt,!1)?e:e.concat(xe.appendConfig.of(TS))}const wg=xe.define(),nh=xe.define(),xg=xe.define(),Vt=dt.define({create(){return new cr(ye.none,null,null)},update(i,e){if(e.docChanged){let t=i.diagnostics.map(e.changes),r=null;if(i.selected){let n=e.changes.mapPos(i.selected.from,1);r=tn(t,i.selected.diagnostic,n)||tn(t,null,n)}i=new cr(t,i.panel,r)}for(let t of e.effects)t.is(wg)?i=cr.init(t.value,i.panel,e.state):t.is(nh)?i=new cr(i.diagnostics,t.value?Ns.open:null,i.selected):t.is(xg)&&(i=new cr(i.diagnostics,i.panel,t.value));return i},provide:i=>[Vn.from(i,e=>e.panel),oe.decorations.from(i,e=>e.diagnostics)]}),yS=ye.mark({class:"cm-lintRange cm-lintRange-active"});function wS(i,e,t){let{diagnostics:r}=i.state.field(Vt),n=[],o=2e8,s=0;r.between(e-(t<0?1:0),e+(t>0?1:0),(a,h,{spec:c})=>{e>=a&&e<=h&&(a==h||(e>a||t>0)&&(e<h||t<0))&&(n.push(c.diagnostic),o=Math.min(a,o),s=Math.max(h,s))});let l=i.state.facet(kg).tooltipFilter;return l&&(n=l(n)),n.length?{pos:o,end:s,above:i.state.doc.lineAt(o).to<s,create(){return{dom:xS(i,n)}}}:null}function xS(i,e){return Fe("ul",{class:"cm-tooltip-lint"},e.map(t=>Cg(i,t,!1)))}const kS=i=>{let e=i.state.field(Vt,!1);(!e||!e.panel)&&i.dispatch({effects:bS(i.state,[nh.of(!0)])});let t=Wn(i,Ns.open);return t&&t.dom.querySelector(".cm-panel-lint ul").focus(),!0},kd=i=>{let e=i.state.field(Vt,!1);return!e||!e.panel?!1:(i.dispatch({effects:nh.of(!1)}),!0)},SS=i=>{let e=i.state.field(Vt,!1);if(!e)return!1;let t=i.state.selection.main,r=e.diagnostics.iter(t.to+1);return!r.value&&(r=e.diagnostics.iter(0),!r.value||r.from==t.from&&r.to==t.to)?!1:(i.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0}),!0)},CS=[{key:"Mod-Shift-m",run:kS,preventDefault:!0},{key:"F8",run:SS}],kg=ae.define({combine(i){return Object.assign({sources:i.map(e=>e.source)},Ci(i.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null},{needsRefresh:(e,t)=>e?t?r=>e(r)||t(r):e:t}))}});function Sg(i){let e=[];if(i)e:for(let{name:t}of i){for(let r=0;r<t.length;r++){let n=t[r];if(/[a-zA-Z]/.test(n)&&!e.some(o=>o.toLowerCase()==n.toLowerCase())){e.push(n);continue e}}e.push("")}return e}function Cg(i,e,t){var r;let n=t?Sg(e.actions):[];return Fe("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},Fe("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage():e.message),(r=e.actions)===null||r===void 0?void 0:r.map((o,s)=>{let l=!1,a=u=>{if(u.preventDefault(),l)return;l=!0;let f=tn(i.state.field(Vt).diagnostics,e);f&&o.apply(i,f.from,f.to)},{name:h}=o,c=n[s]?h.indexOf(n[s]):-1,d=c<0?h:[h.slice(0,c),Fe("u",h.slice(c,c+1)),h.slice(c+1)];return Fe("button",{type:"button",class:"cm-diagnosticAction",onclick:a,onmousedown:a,"aria-label":` Action: ${h}${c<0?"":` (access key "${n[s]})"`}.`},d)}),e.source&&Fe("div",{class:"cm-diagnosticSource"},e.source))}class AS extends nr{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return Fe("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class Sd{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=Cg(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class Ns{constructor(e){this.view=e,this.items=[];let t=n=>{if(n.keyCode==27)kd(this.view),this.view.focus();else if(n.keyCode==38||n.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(n.keyCode==40||n.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(n.keyCode==36)this.moveSelection(0);else if(n.keyCode==35)this.moveSelection(this.items.length-1);else if(n.keyCode==13)this.view.focus();else if(n.keyCode>=65&&n.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:o}=this.items[this.selectedIndex],s=Sg(o.actions);for(let l=0;l<s.length;l++)if(s[l].toUpperCase().charCodeAt(0)==n.keyCode){let a=tn(this.view.state.field(Vt).diagnostics,o);a&&o.actions[l].apply(e,a.from,a.to)}}else return;n.preventDefault()},r=n=>{for(let o=0;o<this.items.length;o++)this.items[o].dom.contains(n.target)&&this.moveSelection(o)};this.list=Fe("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t,onclick:r}),this.dom=Fe("div",{class:"cm-panel-lint"},this.list,Fe("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>kd(this.view)},"×")),this.update()}get selectedIndex(){let e=this.view.state.field(Vt).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(Vt),r=0,n=!1,o=null;for(e.between(0,this.view.state.doc.length,(s,l,{spec:a})=>{let h=-1,c;for(let d=r;d<this.items.length;d++)if(this.items[d].diagnostic==a.diagnostic){h=d;break}h<0?(c=new Sd(this.view,a.diagnostic),this.items.splice(r,0,c),n=!0):(c=this.items[h],h>r&&(this.items.splice(r,h-r),n=!0)),t&&c.diagnostic==t.diagnostic?c.dom.hasAttribute("aria-selected")||(c.dom.setAttribute("aria-selected","true"),o=c):c.dom.hasAttribute("aria-selected")&&c.dom.removeAttribute("aria-selected"),r++});r<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)n=!0,this.items.pop();this.items.length==0&&(this.items.push(new Sd(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),n=!0),o?(this.list.setAttribute("aria-activedescendant",o.id),this.view.requestMeasure({key:this,read:()=>({sel:o.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:s,panel:l})=>{s.top<l.top?this.list.scrollTop-=l.top-s.top:s.bottom>l.bottom&&(this.list.scrollTop+=s.bottom-l.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),n&&this.sync()}sync(){let e=this.list.firstChild;function t(){let r=e;e=r.nextSibling,r.remove()}for(let r of this.items)if(r.dom.parentNode==this.list){for(;e!=r.dom;)t();e=r.dom.nextSibling}else this.list.insertBefore(r.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=this.view.state.field(Vt),r=tn(t.diagnostics,this.items[e].diagnostic);r&&this.view.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:xg.of(r)})}static open(e){return new Ns(e)}}function MS(i,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(i)}</svg>')`}function yl(i){return MS(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${i}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const RS=oe.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:yl("#d11")},".cm-lintRange-warning":{backgroundImage:yl("orange")},".cm-lintRange-info":{backgroundImage:yl("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}}),TS=[Vt,oe.decorations.compute([Vt],i=>{let{selected:e,panel:t}=i.field(Vt);return!e||!t||e.from==e.to?ye.none:ye.set([yS.range(e.from,e.to)])}),vw(wS,{hideOn:vS}),RS],DS=(()=>[Mw(),Dw(),Xy(),ok(),kx(),Fy(),jy(),Me.allowMultipleSelections.of(!0),ax(),up(Mx,{fallback:!0}),Ex(),rS(),pS(),lw(),cw(),tw(),c2(),Ms.of([...lS,...o2,...D2,...pk,...bx,...yg,...CS])])();var OS=i=>{var{theme:e,settings:t={},styles:r=[]}=i,n={".cm-gutters":{}},o={};t.background&&(o.backgroundColor=t.background),t.backgroundImage&&(o.backgroundImage=t.backgroundImage),t.foreground&&(o.color=t.foreground),(t.background||t.foreground)&&(n["&"]=o),t.fontFamily&&(n["&.cm-editor .cm-scroller"]={fontFamily:t.fontFamily}),t.gutterBackground&&(n[".cm-gutters"].backgroundColor=t.gutterBackground),t.gutterForeground&&(n[".cm-gutters"].color=t.gutterForeground),t.gutterBorder&&(n[".cm-gutters"].borderRightColor=t.gutterBorder),t.caret&&(n[".cm-content"]={caretColor:t.caret},n[".cm-cursor, .cm-dropCursor"]={borderLeftColor:t.caret});var s={};t.gutterActiveForeground&&(s.color=t.gutterActiveForeground),t.lineHighlight&&(n[".cm-activeLine"]={backgroundColor:t.lineHighlight},s.backgroundColor=t.lineHighlight),n[".cm-activeLineGutter"]=s,t.selection&&(n["&.cm-focused .cm-selectionBackground, & .cm-line::selection, & .cm-selectionLayer .cm-selectionBackground, .cm-content ::selection"]={background:t.selection+" !important"}),t.selectionMatch&&(n["& .cm-selectionMatch"]={backgroundColor:t.selectionMatch});var l=oe.theme(n,{dark:e==="dark"}),a=so.define(r),h=[l,up(a)];return h},PS={background:"#1e1e1e",foreground:"#9cdcfe",caret:"#c6c6c6",selection:"#6199ff2f",selectionMatch:"#72a1ff59",lineHighlight:"#ffffff0f",gutterBackground:"#1e1e1e",gutterForeground:"#838383",gutterActiveForeground:"#fff",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace'};function LS(i){var{theme:e="dark",settings:t={},styles:r=[]}=i||{};return OS({theme:e,settings:xl({},PS,t),styles:[{tag:[E.keyword,E.operatorKeyword,E.modifier,E.color,E.constant(E.name),E.standard(E.name),E.standard(E.tagName),E.special(E.brace),E.atom,E.bool,E.special(E.variableName)],color:"#569cd6"},{tag:[E.controlKeyword,E.moduleKeyword],color:"#c586c0"},{tag:[E.name,E.deleted,E.character,E.macroName,E.propertyName,E.variableName,E.labelName,E.definition(E.name)],color:"#9cdcfe"},{tag:E.heading,fontWeight:"bold",color:"#9cdcfe"},{tag:[E.typeName,E.className,E.tagName,E.number,E.changed,E.annotation,E.self,E.namespace],color:"#4ec9b0"},{tag:[E.function(E.variableName),E.function(E.propertyName)],color:"#dcdcaa"},{tag:[E.number],color:"#b5cea8"},{tag:[E.operator,E.punctuation,E.separator,E.url,E.escape,E.regexp],color:"#d4d4d4"},{tag:[E.regexp],color:"#d16969"},{tag:[E.special(E.string),E.processingInstruction,E.string,E.inserted],color:"#ce9178"},{tag:[E.angleBracket],color:"#808080"},{tag:E.strong,fontWeight:"bold"},{tag:E.emphasis,fontStyle:"italic"},{tag:E.strikethrough,textDecoration:"line-through"},{tag:[E.meta,E.comment],color:"#6a9955"},{tag:E.link,color:"#6a9955",textDecoration:"underline"},{tag:E.invalid,color:"#ff0000"},...r]})}var Cd=LS();const ES=Ce({__name:"CodeEditor",props:{fs:{},height:{},theme:{},langParserMap:{},extLangMap:{},onCloseUnsaved:{},onErrorSaveFile:{}},setup(i,{expose:e}){const t=i,{fs:r,langParserMap:n,extLangMap:o,onCloseUnsaved:s,onErrorSaveFile:l}=Zn(t),{height:a,theme:h}=ws(t);let c;const d=ie(),u={};for(const[$,ne]of Object.entries(n))u[$]=ja.define(ne);function f($){const ne=$.split(".");if(ne.length>1){const X=ne[ne.length-1];if(X in o)return o[X]}return""}const g=[{key:"Mod-s",run:()=>{const $=k.value;return N[$]&&J($).catch(()=>0),!0}}],y=new Gr;function b(){c.dispatch({effects:y.reconfigure(h.value==="dark"?Cd:[])})}ti(h,()=>{k.value&&b()});const C=new Gr;function D(){return oe.theme({"&":{height:a.value}})}function T(){c.dispatch({effects:C.reconfigure(D())})}ti(a,()=>{k.value&&T()});const A=[DS,Ms.of(g),oe.updateListener.of($=>{$.docChanged&&(N[k.value].value=$.state.doc.toString()!==m[k.value])})],S=ie([]),k=ie(""),v=[],R={},m={},N={};ti(k,($,ne)=>{if(ne&&(R[ne]=c.state),$){c.setState(R[$]),b(),T();const X=v.indexOf($);if(X>=0){for(let Z=X;Z<v.length-1;++Z)v[Z]=v[Z+1];v[v.length-1]=$}else v.push($)}});async function V($){if(!S.value.includes($)){const ne=await r.readFile($),X=new TextDecoder("utf-8",{fatal:!0}).decode(ne),Z=[...A,y.of(h.value==="dark"?Cd:[]),C.of(D())],P=f($);P&&Z.push(u[P]);const W=Me.create({doc:X,extensions:Z});R[$]=W,m[$]=X,N[$]=ie(!1),S.value.push($)}k.value=$}async function J($){const ne=($===k.value?c.state:R[$]).doc.toString();try{await r.writeFile($,ne)}catch(X){throw l&&l($),X}m[$]=ne,N[$].value=!1}function U($){delete R[$],S.value=S.value.filter(X=>X!==$);const ne=v.indexOf($);v.splice(ne,1),$===k.value&&(k.value=v.length?v[v.length-1]:"")}function re($){const ne=()=>U($);N[$].value?s($,()=>J($).then(()=>U($)).catch(()=>{}),ne):ne()}function te($){return N[$].value?`${$} ⚬`:$}return _r(()=>{c=new oe({parent:d.value})}),e({openFile:V}),($,ne)=>qo((ri(),br("div",null,[Je(ve(k1),{value:k.value,"onUpdate:value":ne[0]||(ne[0]=X=>k.value=X),type:"card",closable:"",onClose:re},{default:Ht(()=>[(ri(!0),br(Ur,null,vm(S.value,X=>(ri(),xs(ve(Xo),{key:X,name:X,tab:te(X)},null,8,["name","tab"]))),128))]),_:1},8,["value"]),Kr("div",{ref_key:"editor",ref:d},null,512)],512)),[[wa,S.value.length]])}}),BS={style:{display:"flex"}},NS={style:{width:"20%","margin-top":"17px"}},IS=Ce({__name:"WasmCodeCore",props:{height:{},theme:{default:void 0},fs:{},langParserMap:{default:()=>({})},extLangMap:{default:()=>({})},hidePath:{default:void 0},onCloseUnsaved:{},onErrorOpenFile:{default:void 0},onErrorNonText:{default:void 0},onErrorSaveFile:{default:void 0},onNewFile:{},onNewFolder:{},onErrorPaste:{default:void 0},onUpload:{},onRename:{},onDeleteFile:{default:(i,e)=>e(i)},onDeleteFolder:{default:(i,e)=>e(i)},onErrorDownload:{default:void 0}},setup(i,{expose:e}){const t=i,{fs:r,hidePath:n,onCloseUnsaved:o,onErrorOpenFile:s,onErrorNonText:l,onErrorSaveFile:a,onNewFile:h,onNewFolder:c,onErrorPaste:d,onUpload:u,onRename:f,onDeleteFile:g,onDeleteFolder:y}=Zn(t),{height:b,theme:C}=ws(t),D=ie(),T=ie();async function A(v){try{await T.value.openFile(v)}catch(R){R.name==="TypeError"?l&&l(v):s&&s(v)}}const S=Id(),k=be(()=>C.value||S.value);return e({expandFolder(v){return D.value.expandFolder(v)}}),(v,R)=>(ri(),xs(ve(Fd),{theme:k.value==="dark"?ve(zd):null},{default:Ht(()=>[Je(ve(fm),null,{default:Ht(()=>[Kr("div",BS,[Kr("div",NS,[Je(zv,{ref_key:"fm",ref:D,fs:ve(r),height:ve(b),"hide-path":ve(n),"on-open-file":A,"on-new-file":ve(h),"on-new-folder":ve(c),"on-error-paste":ve(d),"on-upload":ve(u),"on-rename":ve(f),"on-delete-file":ve(g),"on-delete-folder":ve(y),"on-error-download":v.onErrorDownload},null,8,["fs","height","hide-path","on-new-file","on-new-folder","on-error-paste","on-upload","on-rename","on-delete-file","on-delete-folder","on-error-download"])]),Je(ES,{ref_key:"ce",ref:T,style:{width:"80%"},fs:ve(r),height:ve(b),theme:k.value,"lang-parser-map":v.langParserMap,"ext-lang-map":v.extLangMap,"on-close-unsaved":ve(o),"on-error-save-file":ve(a)},null,8,["fs","height","theme","lang-parser-map","ext-lang-map","on-close-unsaved","on-error-save-file"])])]),_:1})]),_:1},8,["theme"]))}}),zS=Ce({__name:"WasmCodeWrapper",props:{fs:{},height:{},theme:{},langParserMap:{},extLangMap:{},hidePath:{}},setup(i,{expose:e}){const t=i,{hidePath:r}=Zn(t),n=ie(),o=U0(),s=um();function l(v,R,m){o.warning({title:`Do you want to save the changes you made to ${v}?`,content:"Your changes will be lost if you don't save them.",positiveText:"Save",negativeText:"Don't save",onPositiveClick:R,onNegativeClick:m})}function a(v){s.error(`Cannot open ${v}`)}function h(v){s.error(`Non UTF-8 file ${v} can't be opened`)}function c(v){s.error(`Cannot save ${v}`)}function d(v,R,m,N){const V=ie(""),J=o.info({title:R,content:()=>[v,x(bm,{clearable:!0,value:V.value,onKeyup:U=>{U.key==="Enter"&&(N(V.value),J.destroy())},"onUpdate:value":U=>{V.value=U}})],positiveText:m,onPositiveClick:()=>N(V.value)})}function u(v){return(R,m)=>{d(R,`Set ${v} name`,"Create",N=>m(R+N).catch(V=>{V.name==="PathExistsError"?s.error("Name already exists in the folder"):s.error(`Cannot create ${v}`)}))}}const f=u("file"),g=u("folder");function y(v){s.error(`Cannot paste under ${v}`)}const b=ie([]);function C(v,R){o.info({title:"Select files to upload",content:()=>[v,x(Q1,{multiple:!0,fileList:b.value,"onUpdate:fileList":m=>{b.value=m}},[x(uu,["Click, or drag files to this area"])])],positiveText:"Upload",negativeText:"Clear all",onPositiveClick:async()=>{const m=await Promise.all(b.value.map(async N=>({name:N.name,content:new Uint8Array(await N.file.arrayBuffer())})));try{await R(m),b.value=[]}catch{s.error(`Cannot upload to ${v}`)}},onNegativeClick:()=>(b.value=[],!1)})}function D(v,R){d(v,"Set new name","Rename",m=>R(m).catch(()=>s.error("Cannot rename")))}function T(v){return(R,m)=>{const N=o.warning({title:`Are you sure you want to delete ${R}?`,content:`The ${v} cannot be restored.`,positiveText:"Delete",negativeText:"Cancel",onPositiveClick:()=>m(R).catch(()=>s.error(`Cannot remove ${v}`)),onNegativeClick:()=>N.destroy()})}}const A=T("file"),S=T("folder");function k(v){s.error(`Cannot download ${v}`)}return e({expandFolder(v){return n.value.expandFolder(v)}}),(v,R)=>(ri(),xs(IS,{ref_key:"wcc",ref:n,fs:v.fs,theme:v.theme,height:v.height,"lang-parser-map":v.langParserMap,"ext-lang-map":v.extLangMap,"hide-path":ve(r),"on-close-unsaved":l,"on-error-open-file":a,"on-error-non-text":h,"on-error-save-file":c,"on-new-file":ve(f),"on-new-folder":ve(g),"on-error-paste":y,"on-upload":C,"on-rename":D,"on-delete-file":ve(A),"on-delete-folder":ve(S),"on-error-download":k},null,8,["fs","theme","height","lang-parser-map","ext-lang-map","hide-path","on-new-file","on-new-folder","on-delete-file","on-delete-folder"]))}}),FS=Ce({__name:"WasmCode",props:{fs:{},height:{},theme:{default:void 0},langParserMap:{default:()=>({})},extLangMap:{default:()=>({})},hidePath:{default:void 0}},setup(i,{expose:e}){const t=i,{theme:r}=ws(t),{hidePath:n}=Zn(t),o=Id(),s=be(()=>r.value||o.value),l=ie();return e({expandFolder(a){return l.value.expandFolder(a)}}),(a,h)=>(ri(),xs(ve(Fd),{theme:s.value==="dark"?ve(zd):null},{default:Ht(()=>[Je(ve(cm),null,{default:Ht(()=>[Je(ve(dm),null,{default:Ht(()=>[Je(zS,{ref_key:"wcw",ref:l,fs:a.fs,theme:s.value,height:a.height,"lang-parser-map":a.langParserMap,"ext-lang-map":a.extLangMap,"hide-path":ve(n)},null,8,["fs","theme","height","lang-parser-map","ext-lang-map","hide-path"])]),_:1})]),_:1})]),_:1},8,["theme"]))}}),HS=Ce({__name:"MyEditor",setup(i){const e={json:ev,lua:av,yaml:dv},t={json:"json",lua:"lua",yaml:"yaml"},r=ie();function n(o){return o.match(/^\/(rime|usr)(\/|$)/)===null}return _r(()=>{["/","/rime/","/usr/","/usr/share/","/usr/share/opencc/","/usr/share/rime-data/"].forEach(r.value.expandFolder)}),(o,s)=>(ri(),br("div",null,[Je(ve(Ki),{secondary:"",type:"info",onClick:s[0]||(s[0]=l=>ve(wm)())},{default:Ht(()=>[ym(" Deploy ")]),_:1}),Je(ve(FS),{ref_key:"wc",ref:r,fs:ve(xm),height:"80vh","lang-parser-map":e,"ext-lang-map":t,"hide-path":n},null,8,["fs"])]))}});export{HS as default};
